function VJ(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var WS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function HJ(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var i=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}),i}var rP={exports:{}},z1={},nP={exports:{}},Ki={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GU;function GJ(){if(GU)return Ki;GU=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(j){return j===null||typeof j!="object"?null:(j=h&&j[h]||j["@@iterator"],typeof j=="function"?j:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(j,$,se){this.props=j,this.context=$,this.refs=v,this.updater=se||f}g.prototype.isReactComponent={},g.prototype.setState=function(j,$){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,$,"setState")},g.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function x(){}x.prototype=g.prototype;function S(j,$,se){this.props=j,this.context=$,this.refs=v,this.updater=se||f}var _=S.prototype=new x;_.constructor=S,m(_,g.prototype),_.isPureReactComponent=!0;var A=Array.isArray,T=Object.prototype.hasOwnProperty,E={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function P(j,$,se){var re,he={},oe=null,ve=null;if($!=null)for(re in $.ref!==void 0&&(ve=$.ref),$.key!==void 0&&(oe=""+$.key),$)T.call($,re)&&!I.hasOwnProperty(re)&&(he[re]=$[re]);var xe=arguments.length-2;if(xe===1)he.children=se;else if(1<xe){for(var be=Array(xe),Me=0;Me<xe;Me++)be[Me]=arguments[Me+2];he.children=be}if(j&&j.defaultProps)for(re in xe=j.defaultProps,xe)he[re]===void 0&&(he[re]=xe[re]);return{$$typeof:e,type:j,key:oe,ref:ve,props:he,_owner:E.current}}function C(j,$){return{$$typeof:e,type:j.type,key:$,ref:j.ref,props:j.props,_owner:j._owner}}function L(j){return typeof j=="object"&&j!==null&&j.$$typeof===e}function z(j){var $={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(se){return $[se]})}var F=/\/+/g;function G(j,$){return typeof j=="object"&&j!==null&&j.key!=null?z(""+j.key):$.toString(36)}function N(j,$,se,re,he){var oe=typeof j;(oe==="undefined"||oe==="boolean")&&(j=null);var ve=!1;if(j===null)ve=!0;else switch(oe){case"string":case"number":ve=!0;break;case"object":switch(j.$$typeof){case e:case t:ve=!0}}if(ve)return ve=j,he=he(ve),j=re===""?"."+G(ve,0):re,A(he)?(se="",j!=null&&(se=j.replace(F,"$&/")+"/"),N(he,$,se,"",function(Me){return Me})):he!=null&&(L(he)&&(he=C(he,se+(!he.key||ve&&ve.key===he.key?"":(""+he.key).replace(F,"$&/")+"/")+j)),$.push(he)),1;if(ve=0,re=re===""?".":re+":",A(j))for(var xe=0;xe<j.length;xe++){oe=j[xe];var be=re+G(oe,xe);ve+=N(oe,$,se,be,he)}else if(be=d(j),typeof be=="function")for(j=be.call(j),xe=0;!(oe=j.next()).done;)oe=oe.value,be=re+G(oe,xe++),ve+=N(oe,$,se,be,he);else if(oe==="object")throw $=String(j),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return ve}function q(j,$,se){if(j==null)return j;var re=[],he=0;return N(j,re,"","",function(oe){return $.call(se,oe,he++)}),re}function ie(j){if(j._status===-1){var $=j._result;$=$(),$.then(function(se){(j._status===0||j._status===-1)&&(j._status=1,j._result=se)},function(se){(j._status===0||j._status===-1)&&(j._status=2,j._result=se)}),j._status===-1&&(j._status=0,j._result=$)}if(j._status===1)return j._result.default;throw j._result}var Q={current:null},W={transition:null},ee={ReactCurrentDispatcher:Q,ReactCurrentBatchConfig:W,ReactCurrentOwner:E};function K(){throw Error("act(...) is not supported in production builds of React.")}return Ki.Children={map:q,forEach:function(j,$,se){q(j,function(){$.apply(this,arguments)},se)},count:function(j){var $=0;return q(j,function(){$++}),$},toArray:function(j){return q(j,function($){return $})||[]},only:function(j){if(!L(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},Ki.Component=g,Ki.Fragment=i,Ki.Profiler=n,Ki.PureComponent=S,Ki.StrictMode=r,Ki.Suspense=l,Ki.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ee,Ki.act=K,Ki.cloneElement=function(j,$,se){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var re=m({},j.props),he=j.key,oe=j.ref,ve=j._owner;if($!=null){if($.ref!==void 0&&(oe=$.ref,ve=E.current),$.key!==void 0&&(he=""+$.key),j.type&&j.type.defaultProps)var xe=j.type.defaultProps;for(be in $)T.call($,be)&&!I.hasOwnProperty(be)&&(re[be]=$[be]===void 0&&xe!==void 0?xe[be]:$[be])}var be=arguments.length-2;if(be===1)re.children=se;else if(1<be){xe=Array(be);for(var Me=0;Me<be;Me++)xe[Me]=arguments[Me+2];re.children=xe}return{$$typeof:e,type:j.type,key:he,ref:oe,props:re,_owner:ve}},Ki.createContext=function(j){return j={$$typeof:a,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:s,_context:j},j.Consumer=j},Ki.createElement=P,Ki.createFactory=function(j){var $=P.bind(null,j);return $.type=j,$},Ki.createRef=function(){return{current:null}},Ki.forwardRef=function(j){return{$$typeof:o,render:j}},Ki.isValidElement=L,Ki.lazy=function(j){return{$$typeof:u,_payload:{_status:-1,_result:j},_init:ie}},Ki.memo=function(j,$){return{$$typeof:c,type:j,compare:$===void 0?null:$}},Ki.startTransition=function(j){var $=W.transition;W.transition={};try{j()}finally{W.transition=$}},Ki.unstable_act=K,Ki.useCallback=function(j,$){return Q.current.useCallback(j,$)},Ki.useContext=function(j){return Q.current.useContext(j)},Ki.useDebugValue=function(){},Ki.useDeferredValue=function(j){return Q.current.useDeferredValue(j)},Ki.useEffect=function(j,$){return Q.current.useEffect(j,$)},Ki.useId=function(){return Q.current.useId()},Ki.useImperativeHandle=function(j,$,se){return Q.current.useImperativeHandle(j,$,se)},Ki.useInsertionEffect=function(j,$){return Q.current.useInsertionEffect(j,$)},Ki.useLayoutEffect=function(j,$){return Q.current.useLayoutEffect(j,$)},Ki.useMemo=function(j,$){return Q.current.useMemo(j,$)},Ki.useReducer=function(j,$,se){return Q.current.useReducer(j,$,se)},Ki.useRef=function(j){return Q.current.useRef(j)},Ki.useState=function(j){return Q.current.useState(j)},Ki.useSyncExternalStore=function(j,$,se){return Q.current.useSyncExternalStore(j,$,se)},Ki.useTransition=function(){return Q.current.useTransition()},Ki.version="18.3.1",Ki}var jU;function Kg(){return jU||(jU=1,nP.exports=GJ()),nP.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WU;function jJ(){if(WU)return z1;WU=1;var e=Kg(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,c){var u,h={},d=null,f=null;c!==void 0&&(d=""+c),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(f=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(h[u]=l[u]);if(o&&o.defaultProps)for(u in l=o.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:t,type:o,key:d,ref:f,props:h,_owner:n.current}}return z1.Fragment=i,z1.jsx=a,z1.jsxs=a,z1}var XU;function WJ(){return XU||(XU=1,rP.exports=jJ()),rP.exports}var Qe=WJ(),Se=Kg();const Gc=Cp(Se),XJ=VJ({__proto__:null,default:Gc},[Se]);var XS={},sP={exports:{}},Po={},aP={exports:{}},oP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qU;function qJ(){return qU||(qU=1,function(e){function t(W,ee){var K=W.length;W.push(ee);e:for(;0<K;){var j=K-1>>>1,$=W[j];if(0<n($,ee))W[j]=ee,W[K]=$,K=j;else break e}}function i(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var ee=W[0],K=W.pop();if(K!==ee){W[0]=K;e:for(var j=0,$=W.length,se=$>>>1;j<se;){var re=2*(j+1)-1,he=W[re],oe=re+1,ve=W[oe];if(0>n(he,K))oe<$&&0>n(ve,he)?(W[j]=ve,W[oe]=K,j=oe):(W[j]=he,W[re]=K,j=re);else if(oe<$&&0>n(ve,K))W[j]=ve,W[oe]=K,j=oe;else break e}}return ee}function n(W,ee){var K=W.sortIndex-ee.sortIndex;return K!==0?K:W.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,m=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(W){for(var ee=i(c);ee!==null;){if(ee.callback===null)r(c);else if(ee.startTime<=W)r(c),ee.sortIndex=ee.expirationTime,t(l,ee);else break;ee=i(c)}}function A(W){if(v=!1,_(W),!m)if(i(l)!==null)m=!0,ie(T);else{var ee=i(c);ee!==null&&Q(A,ee.startTime-W)}}function T(W,ee){m=!1,v&&(v=!1,x(P),P=-1),f=!0;var K=d;try{for(_(ee),h=i(l);h!==null&&(!(h.expirationTime>ee)||W&&!z());){var j=h.callback;if(typeof j=="function"){h.callback=null,d=h.priorityLevel;var $=j(h.expirationTime<=ee);ee=e.unstable_now(),typeof $=="function"?h.callback=$:h===i(l)&&r(l),_(ee)}else r(l);h=i(l)}if(h!==null)var se=!0;else{var re=i(c);re!==null&&Q(A,re.startTime-ee),se=!1}return se}finally{h=null,d=K,f=!1}}var E=!1,I=null,P=-1,C=5,L=-1;function z(){return!(e.unstable_now()-L<C)}function F(){if(I!==null){var W=e.unstable_now();L=W;var ee=!0;try{ee=I(!0,W)}finally{ee?G():(E=!1,I=null)}}else E=!1}var G;if(typeof S=="function")G=function(){S(F)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,q=N.port2;N.port1.onmessage=F,G=function(){q.postMessage(null)}}else G=function(){g(F,0)};function ie(W){I=W,E||(E=!0,G())}function Q(W,ee){P=g(function(){W(e.unstable_now())},ee)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,ie(T))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(W){switch(d){case 1:case 2:case 3:var ee=3;break;default:ee=d}var K=d;d=ee;try{return W()}finally{d=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,ee){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var K=d;d=W;try{return ee()}finally{d=K}},e.unstable_scheduleCallback=function(W,ee,K){var j=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?j+K:j):K=j,W){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=K+$,W={id:u++,callback:ee,priorityLevel:W,startTime:K,expirationTime:$,sortIndex:-1},K>j?(W.sortIndex=K,t(c,W),i(l)===null&&W===i(c)&&(v?(x(P),P=-1):v=!0,Q(A,K-j))):(W.sortIndex=$,t(l,W),m||f||(m=!0,ie(T))),W},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(W){var ee=d;return function(){var K=d;d=ee;try{return W.apply(this,arguments)}finally{d=K}}}}(oP)),oP}var YU;function YJ(){return YU||(YU=1,aP.exports=qJ()),aP.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QU;function QJ(){if(QU)return Po;QU=1;var e=Kg(),t=YJ();function i(p){for(var y="https://reactjs.org/docs/error-decoder.html?invariant="+p,M=1;M<arguments.length;M++)y+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+p+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,n={};function s(p,y){a(p,y),a(p+"Capture",y)}function a(p,y){for(n[p]=y,p=0;p<y.length;p++)r.add(y[p])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function d(p){return l.call(h,p)?!0:l.call(u,p)?!1:c.test(p)?h[p]=!0:(u[p]=!0,!1)}function f(p,y,M,R){if(M!==null&&M.type===0)return!1;switch(typeof y){case"function":case"symbol":return!0;case"boolean":return R?!1:M!==null?!M.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function m(p,y,M,R){if(y===null||typeof y>"u"||f(p,y,M,R))return!0;if(R)return!1;if(M!==null)switch(M.type){case 3:return!y;case 4:return y===!1;case 5:return isNaN(y);case 6:return isNaN(y)||1>y}return!1}function v(p,y,M,R,B,H,ne){this.acceptsBooleans=y===2||y===3||y===4,this.attributeName=R,this.attributeNamespace=B,this.mustUseProperty=M,this.propertyName=p,this.type=y,this.sanitizeURL=H,this.removeEmptyString=ne}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){g[p]=new v(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var y=p[0];g[y]=new v(y,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){g[p]=new v(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){g[p]=new v(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){g[p]=new v(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){g[p]=new v(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){g[p]=new v(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){g[p]=new v(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){g[p]=new v(p,5,!1,p.toLowerCase(),null,!1,!1)});var x=/[\-:]([a-z])/g;function S(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var y=p.replace(x,S);g[y]=new v(y,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var y=p.replace(x,S);g[y]=new v(y,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var y=p.replace(x,S);g[y]=new v(y,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){g[p]=new v(p,1,!1,p.toLowerCase(),null,!1,!1)}),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){g[p]=new v(p,1,!1,p.toLowerCase(),null,!0,!0)});function _(p,y,M,R){var B=g.hasOwnProperty(y)?g[y]:null;(B!==null?B.type!==0:R||!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(m(y,M,B,R)&&(M=null),R||B===null?d(y)&&(M===null?p.removeAttribute(y):p.setAttribute(y,""+M)):B.mustUseProperty?p[B.propertyName]=M===null?B.type===3?!1:"":M:(y=B.attributeName,R=B.attributeNamespace,M===null?p.removeAttribute(y):(B=B.type,M=B===3||B===4&&M===!0?"":""+M,R?p.setAttributeNS(R,y,M):p.setAttribute(y,M))))}var A=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),E=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),z=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),Q=Symbol.for("react.offscreen"),W=Symbol.iterator;function ee(p){return p===null||typeof p!="object"?null:(p=W&&p[W]||p["@@iterator"],typeof p=="function"?p:null)}var K=Object.assign,j;function $(p){if(j===void 0)try{throw Error()}catch(M){var y=M.stack.trim().match(/\n( *(at )?)/);j=y&&y[1]||""}return`
`+j+p}var se=!1;function re(p,y){if(!p||se)return"";se=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(y)if(y=function(){throw Error()},Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(st){var R=st}Reflect.construct(p,[],y)}else{try{y.call()}catch(st){R=st}p.call(y.prototype)}else{try{throw Error()}catch(st){R=st}p()}}catch(st){if(st&&R&&typeof st.stack=="string"){for(var B=st.stack.split(`
`),H=R.stack.split(`
`),ne=B.length-1,Ae=H.length-1;1<=ne&&0<=Ae&&B[ne]!==H[Ae];)Ae--;for(;1<=ne&&0<=Ae;ne--,Ae--)if(B[ne]!==H[Ae]){if(ne!==1||Ae!==1)do if(ne--,Ae--,0>Ae||B[ne]!==H[Ae]){var Re=`
`+B[ne].replace(" at new "," at ");return p.displayName&&Re.includes("<anonymous>")&&(Re=Re.replace("<anonymous>",p.displayName)),Re}while(1<=ne&&0<=Ae);break}}}finally{se=!1,Error.prepareStackTrace=M}return(p=p?p.displayName||p.name:"")?$(p):""}function he(p){switch(p.tag){case 5:return $(p.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return p=re(p.type,!1),p;case 11:return p=re(p.type.render,!1),p;case 1:return p=re(p.type,!0),p;default:return""}}function oe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case I:return"Fragment";case E:return"Portal";case C:return"Profiler";case P:return"StrictMode";case G:return"Suspense";case N:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case z:return(p.displayName||"Context")+".Consumer";case L:return(p._context.displayName||"Context")+".Provider";case F:var y=p.render;return p=p.displayName,p||(p=y.displayName||y.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case q:return y=p.displayName||null,y!==null?y:oe(p.type)||"Memo";case ie:y=p._payload,p=p._init;try{return oe(p(y))}catch{}}return null}function ve(p){var y=p.type;switch(p.tag){case 24:return"Cache";case 9:return(y.displayName||"Context")+".Consumer";case 10:return(y._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=y.render,p=p.displayName||p.name||"",y.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return y;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return oe(y);case 8:return y===P?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y}return null}function xe(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function be(p){var y=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function Me(p){var y=be(p)?"checked":"value",M=Object.getOwnPropertyDescriptor(p.constructor.prototype,y),R=""+p[y];if(!p.hasOwnProperty(y)&&typeof M<"u"&&typeof M.get=="function"&&typeof M.set=="function"){var B=M.get,H=M.set;return Object.defineProperty(p,y,{configurable:!0,get:function(){return B.call(this)},set:function(ne){R=""+ne,H.call(this,ne)}}),Object.defineProperty(p,y,{enumerable:M.enumerable}),{getValue:function(){return R},setValue:function(ne){R=""+ne},stopTracking:function(){p._valueTracker=null,delete p[y]}}}}function Te(p){p._valueTracker||(p._valueTracker=Me(p))}function ae(p){if(!p)return!1;var y=p._valueTracker;if(!y)return!0;var M=y.getValue(),R="";return p&&(R=be(p)?p.checked?"true":"false":p.value),p=R,p!==M?(y.setValue(p),!0):!1}function Ce(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Ie(p,y){var M=y.checked;return K({},y,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:M??p._wrapperState.initialChecked})}function Be(p,y){var M=y.defaultValue==null?"":y.defaultValue,R=y.checked!=null?y.checked:y.defaultChecked;M=xe(y.value!=null?y.value:M),p._wrapperState={initialChecked:R,initialValue:M,controlled:y.type==="checkbox"||y.type==="radio"?y.checked!=null:y.value!=null}}function Ve(p,y){y=y.checked,y!=null&&_(p,"checked",y,!1)}function lt(p,y){Ve(p,y);var M=xe(y.value),R=y.type;if(M!=null)R==="number"?(M===0&&p.value===""||p.value!=M)&&(p.value=""+M):p.value!==""+M&&(p.value=""+M);else if(R==="submit"||R==="reset"){p.removeAttribute("value");return}y.hasOwnProperty("value")?je(p,y.type,M):y.hasOwnProperty("defaultValue")&&je(p,y.type,xe(y.defaultValue)),y.checked==null&&y.defaultChecked!=null&&(p.defaultChecked=!!y.defaultChecked)}function We(p,y,M){if(y.hasOwnProperty("value")||y.hasOwnProperty("defaultValue")){var R=y.type;if(!(R!=="submit"&&R!=="reset"||y.value!==void 0&&y.value!==null))return;y=""+p._wrapperState.initialValue,M||y===p.value||(p.value=y),p.defaultValue=y}M=p.name,M!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,M!==""&&(p.name=M)}function je(p,y,M){(y!=="number"||Ce(p.ownerDocument)!==p)&&(M==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+M&&(p.defaultValue=""+M))}var xt=Array.isArray;function Mt(p,y,M,R){if(p=p.options,y){y={};for(var B=0;B<M.length;B++)y["$"+M[B]]=!0;for(M=0;M<p.length;M++)B=y.hasOwnProperty("$"+p[M].value),p[M].selected!==B&&(p[M].selected=B),B&&R&&(p[M].defaultSelected=!0)}else{for(M=""+xe(M),y=null,B=0;B<p.length;B++){if(p[B].value===M){p[B].selected=!0,R&&(p[B].defaultSelected=!0);return}y!==null||p[B].disabled||(y=p[B])}y!==null&&(y.selected=!0)}}function de(p,y){if(y.dangerouslySetInnerHTML!=null)throw Error(i(91));return K({},y,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function V(p,y){var M=y.value;if(M==null){if(M=y.children,y=y.defaultValue,M!=null){if(y!=null)throw Error(i(92));if(xt(M)){if(1<M.length)throw Error(i(93));M=M[0]}y=M}y==null&&(y=""),M=y}p._wrapperState={initialValue:xe(M)}}function X(p,y){var M=xe(y.value),R=xe(y.defaultValue);M!=null&&(M=""+M,M!==p.value&&(p.value=M),y.defaultValue==null&&p.defaultValue!==M&&(p.defaultValue=M)),R!=null&&(p.defaultValue=""+R)}function we(p){var y=p.textContent;y===p._wrapperState.initialValue&&y!==""&&y!==null&&(p.value=y)}function J(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Le(p,y){return p==null||p==="http://www.w3.org/1999/xhtml"?J(y):p==="http://www.w3.org/2000/svg"&&y==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var qe,ct=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(y,M,R,B){MSApp.execUnsafeLocalFunction(function(){return p(y,M,R,B)})}:p}(function(p,y){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=y;else{for(qe=qe||document.createElement("div"),qe.innerHTML="<svg>"+y.valueOf().toString()+"</svg>",y=qe.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;y.firstChild;)p.appendChild(y.firstChild)}});function Pe(p,y){if(y){var M=p.firstChild;if(M&&M===p.lastChild&&M.nodeType===3){M.nodeValue=y;return}}p.textContent=y}var nt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gt=["Webkit","ms","Moz","O"];Object.keys(nt).forEach(function(p){gt.forEach(function(y){y=y+p.charAt(0).toUpperCase()+p.substring(1),nt[y]=nt[p]})});function Tt(p,y,M){return y==null||typeof y=="boolean"||y===""?"":M||typeof y!="number"||y===0||nt.hasOwnProperty(p)&&nt[p]?(""+y).trim():y+"px"}function rt(p,y){p=p.style;for(var M in y)if(y.hasOwnProperty(M)){var R=M.indexOf("--")===0,B=Tt(M,y[M],R);M==="float"&&(M="cssFloat"),R?p.setProperty(M,B):p[M]=B}}var Dt=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ge(p,y){if(y){if(Dt[p]&&(y.children!=null||y.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(y.dangerouslySetInnerHTML!=null){if(y.children!=null)throw Error(i(60));if(typeof y.dangerouslySetInnerHTML!="object"||!("__html"in y.dangerouslySetInnerHTML))throw Error(i(61))}if(y.style!=null&&typeof y.style!="object")throw Error(i(62))}}function $e(p,y){if(p.indexOf("-")===-1)return typeof y.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mt=null;function me(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Ne=null,ue=null,et=null;function at(p){if(p=rc(p)){if(typeof Ne!="function")throw Error(i(280));var y=p.stateNode;y&&(y=Gv(y),Ne(p.stateNode,p.type,y))}}function Ze(p){ue?et?et.push(p):et=[p]:ue=p}function bt(){if(ue){var p=ue,y=et;if(et=ue=null,at(p),y)for(p=0;p<y.length;p++)at(y[p])}}function Ft(p,y){return p(y)}function ui(){}var ci=!1;function Qi(p,y,M){if(ci)return p(y,M);ci=!0;try{return Ft(p,y,M)}finally{ci=!1,(ue!==null||et!==null)&&(ui(),bt())}}function mi(p,y){var M=p.stateNode;if(M===null)return null;var R=Gv(M);if(R===null)return null;M=R[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(p=p.type,R=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!R;break e;default:p=!1}if(p)return null;if(M&&typeof M!="function")throw Error(i(231,y,typeof M));return M}var Or=!1;if(o)try{var bn={};Object.defineProperty(bn,"passive",{get:function(){Or=!0}}),window.addEventListener("test",bn,bn),window.removeEventListener("test",bn,bn)}catch{Or=!1}function Yl(p,y,M,R,B,H,ne,Ae,Re){var st=Array.prototype.slice.call(arguments,3);try{y.apply(M,st)}catch(Et){this.onError(Et)}}var Qs=!1,fe=null,Ye=!1,ut=null,Xe={onError:function(p){Qs=!0,fe=p}};function ft(p,y,M,R,B,H,ne,Ae,Re){Qs=!1,fe=null,Yl.apply(Xe,arguments)}function Yt(p,y,M,R,B,H,ne,Ae,Re){if(ft.apply(this,arguments),Qs){if(Qs){var st=fe;Qs=!1,fe=null}else throw Error(i(198));Ye||(Ye=!0,ut=st)}}function oi(p){var y=p,M=p;if(p.alternate)for(;y.return;)y=y.return;else{p=y;do y=p,(y.flags&4098)!==0&&(M=y.return),p=y.return;while(p)}return y.tag===3?M:null}function gi(p){if(p.tag===13){var y=p.memoizedState;if(y===null&&(p=p.alternate,p!==null&&(y=p.memoizedState)),y!==null)return y.dehydrated}return null}function le(p){if(oi(p)!==p)throw Error(i(188))}function Oe(p){var y=p.alternate;if(!y){if(y=oi(p),y===null)throw Error(i(188));return y!==p?null:p}for(var M=p,R=y;;){var B=M.return;if(B===null)break;var H=B.alternate;if(H===null){if(R=B.return,R!==null){M=R;continue}break}if(B.child===H.child){for(H=B.child;H;){if(H===M)return le(B),p;if(H===R)return le(B),y;H=H.sibling}throw Error(i(188))}if(M.return!==R.return)M=B,R=H;else{for(var ne=!1,Ae=B.child;Ae;){if(Ae===M){ne=!0,M=B,R=H;break}if(Ae===R){ne=!0,R=B,M=H;break}Ae=Ae.sibling}if(!ne){for(Ae=H.child;Ae;){if(Ae===M){ne=!0,M=H,R=B;break}if(Ae===R){ne=!0,R=H,M=B;break}Ae=Ae.sibling}if(!ne)throw Error(i(189))}}if(M.alternate!==R)throw Error(i(190))}if(M.tag!==3)throw Error(i(188));return M.stateNode.current===M?p:y}function ke(p){return p=Oe(p),p!==null?Ge(p):null}function Ge(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var y=Ge(p);if(y!==null)return y;p=p.sibling}return null}var Ue=t.unstable_scheduleCallback,Rt=t.unstable_cancelCallback,Xt=t.unstable_shouldYield,ri=t.unstable_requestPaint,Pt=t.unstable_now,zt=t.unstable_getCurrentPriorityLevel,ni=t.unstable_ImmediatePriority,Lt=t.unstable_UserBlockingPriority,Zi=t.unstable_NormalPriority,Vr=t.unstable_LowPriority,$i=t.unstable_IdlePriority,lr=null,Z=null;function te(p){if(Z&&typeof Z.onCommitFiberRoot=="function")try{Z.onCommitFiberRoot(lr,p,void 0,(p.current.flags&128)===128)}catch{}}var _e=Math.clz32?Math.clz32:_t,ce=Math.log,De=Math.LN2;function _t(p){return p>>>=0,p===0?32:31-(ce(p)/De|0)|0}var Hr=64,Gr=4194304;function gr(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function cs(p,y){var M=p.pendingLanes;if(M===0)return 0;var R=0,B=p.suspendedLanes,H=p.pingedLanes,ne=M&268435455;if(ne!==0){var Ae=ne&~B;Ae!==0?R=gr(Ae):(H&=ne,H!==0&&(R=gr(H)))}else ne=M&~B,ne!==0?R=gr(ne):H!==0&&(R=gr(H));if(R===0)return 0;if(y!==0&&y!==R&&(y&B)===0&&(B=R&-R,H=y&-y,B>=H||B===16&&(H&4194240)!==0))return y;if((R&4)!==0&&(R|=M&16),y=p.entangledLanes,y!==0)for(p=p.entanglements,y&=R;0<y;)M=31-_e(y),B=1<<M,R|=p[M],y&=~B;return R}function Yo(p,y){switch(p){case 1:case 2:case 4:return y+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fn(p,y){for(var M=p.suspendedLanes,R=p.pingedLanes,B=p.expirationTimes,H=p.pendingLanes;0<H;){var ne=31-_e(H),Ae=1<<ne,Re=B[ne];Re===-1?((Ae&M)===0||(Ae&R)!==0)&&(B[ne]=Yo(Ae,y)):Re<=y&&(p.expiredLanes|=Ae),H&=~Ae}}function iu(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function ya(){var p=Hr;return Hr<<=1,(Hr&4194240)===0&&(Hr=64),p}function Vd(p){for(var y=[],M=0;31>M;M++)y.push(p);return y}function Fp(p,y,M){p.pendingLanes|=y,y!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,y=31-_e(y),p[y]=M}function TC(p,y){var M=p.pendingLanes&~y;p.pendingLanes=y,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=y,p.mutableReadLanes&=y,p.entangledLanes&=y,y=p.entanglements;var R=p.eventTimes;for(p=p.expirationTimes;0<M;){var B=31-_e(M),H=1<<B;y[B]=0,R[B]=-1,p[B]=-1,M&=~H}}function Hd(p,y){var M=p.entangledLanes|=y;for(p=p.entanglements;M;){var R=31-_e(M),B=1<<R;B&y|p[R]&y&&(p[R]|=y),M&=~B}}var cr=0;function Gd(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var kp,Vx,$_,hv,dv,ah=!1,fv=[],gl=null,ji=null,Ql=null,oh=new Map,jd=new Map,ru=[],CC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function In(p,y){switch(p){case"focusin":case"focusout":gl=null;break;case"dragenter":case"dragleave":ji=null;break;case"mouseover":case"mouseout":Ql=null;break;case"pointerover":case"pointerout":oh.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":jd.delete(y.pointerId)}}function lh(p,y,M,R,B,H){return p===null||p.nativeEvent!==H?(p={blockedOn:y,domEventName:M,eventSystemFlags:R,nativeEvent:H,targetContainers:[B]},y!==null&&(y=rc(y),y!==null&&Vx(y)),p):(p.eventSystemFlags|=R,y=p.targetContainers,B!==null&&y.indexOf(B)===-1&&y.push(B),p)}function PC(p,y,M,R,B){switch(y){case"focusin":return gl=lh(gl,p,y,M,R,B),!0;case"dragenter":return ji=lh(ji,p,y,M,R,B),!0;case"mouseover":return Ql=lh(Ql,p,y,M,R,B),!0;case"pointerover":var H=B.pointerId;return oh.set(H,lh(oh.get(H)||null,p,y,M,R,B)),!0;case"gotpointercapture":return H=B.pointerId,jd.set(H,lh(jd.get(H)||null,p,y,M,R,B)),!0}return!1}function pv(p){var y=uu(p.target);if(y!==null){var M=oi(y);if(M!==null){if(y=M.tag,y===13){if(y=gi(M),y!==null){p.blockedOn=y,dv(p.priority,function(){$_(M)});return}}else if(y===3&&M.stateNode.current.memoizedState.isDehydrated){p.blockedOn=M.tag===3?M.stateNode.containerInfo:null;return}}}p.blockedOn=null}function mv(p){if(p.blockedOn!==null)return!1;for(var y=p.targetContainers;0<y.length;){var M=xo(p.domEventName,p.eventSystemFlags,y[0],p.nativeEvent);if(M===null){M=p.nativeEvent;var R=new M.constructor(M.type,M);mt=R,M.target.dispatchEvent(R),mt=null}else return y=rc(M),y!==null&&Vx(y),p.blockedOn=M,!1;y.shift()}return!0}function Vp(p,y,M){mv(p)&&M.delete(y)}function vl(){ah=!1,gl!==null&&mv(gl)&&(gl=null),ji!==null&&mv(ji)&&(ji=null),Ql!==null&&mv(Ql)&&(Ql=null),oh.forEach(Vp),jd.forEach(Vp)}function Hp(p,y){p.blockedOn===y&&(p.blockedOn=null,ah||(ah=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,vl)))}function Gp(p){function y(B){return Hp(B,p)}if(0<fv.length){Hp(fv[0],p);for(var M=1;M<fv.length;M++){var R=fv[M];R.blockedOn===p&&(R.blockedOn=null)}}for(gl!==null&&Hp(gl,p),ji!==null&&Hp(ji,p),Ql!==null&&Hp(Ql,p),oh.forEach(y),jd.forEach(y),M=0;M<ru.length;M++)R=ru[M],R.blockedOn===p&&(R.blockedOn=null);for(;0<ru.length&&(M=ru[0],M.blockedOn===null);)pv(M),M.blockedOn===null&&ru.shift()}var Zs=A.ReactCurrentBatchConfig,yo=!0;function gv(p,y,M,R){var B=cr,H=Zs.transition;Zs.transition=null;try{cr=1,vv(p,y,M,R)}finally{cr=B,Zs.transition=H}}function Hx(p,y,M,R){var B=cr,H=Zs.transition;Zs.transition=null;try{cr=4,vv(p,y,M,R)}finally{cr=B,Zs.transition=H}}function vv(p,y,M,R){if(yo){var B=xo(p,y,M,R);if(B===null)Nv(p,y,R,yv,M),In(p,R);else if(PC(B,p,y,M,R))R.stopPropagation();else if(In(p,R),y&4&&-1<CC.indexOf(p)){for(;B!==null;){var H=rc(B);if(H!==null&&kp(H),H=xo(p,y,M,R),H===null&&Nv(p,y,R,yv,M),H===B)break;B=H}B!==null&&R.stopPropagation()}else Nv(p,y,R,null,M)}}var yv=null;function xo(p,y,M,R){if(yv=null,p=me(R),p=uu(p),p!==null)if(y=oi(p),y===null)p=null;else if(M=y.tag,M===13){if(p=gi(y),p!==null)return p;p=null}else if(M===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;p=null}else y!==p&&(p=null);return yv=p,null}function eS(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zt()){case ni:return 1;case Lt:return 4;case Zi:case Vr:return 16;case $i:return 536870912;default:return 16}default:return 16}}var Qo=null,Gx=null,xa=null;function jp(){if(xa)return xa;var p,y=Gx,M=y.length,R,B="value"in Qo?Qo.value:Qo.textContent,H=B.length;for(p=0;p<M&&y[p]===B[p];p++);var ne=M-p;for(R=1;R<=ne&&y[M-R]===B[H-R];R++);return xa=B.slice(p,1<R?1-R:void 0)}function ch(p){var y=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&y===13&&(p=13)):p=y,p===10&&(p=13),32<=p||p===13?p:0}function Zl(){return!0}function xv(){return!1}function Ks(p){function y(M,R,B,H,ne){this._reactName=M,this._targetInst=B,this.type=R,this.nativeEvent=H,this.target=ne,this.currentTarget=null;for(var Ae in p)p.hasOwnProperty(Ae)&&(M=p[Ae],this[Ae]=M?M(H):H[Ae]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Zl:xv,this.isPropagationStopped=xv,this}return K(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var M=this.nativeEvent;M&&(M.preventDefault?M.preventDefault():typeof M.returnValue!="unknown"&&(M.returnValue=!1),this.isDefaultPrevented=Zl)},stopPropagation:function(){var M=this.nativeEvent;M&&(M.stopPropagation?M.stopPropagation():typeof M.cancelBubble!="unknown"&&(M.cancelBubble=!0),this.isPropagationStopped=Zl)},persist:function(){},isPersistent:Zl}),y}var uh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wp=Ks(uh),hh=K({},uh,{view:0,detail:0}),Wd=Ks(hh),wa,wo,bo,Xd=K({},hh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:su,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==bo&&(bo&&p.type==="mousemove"?(wa=p.screenX-bo.screenX,wo=p.screenY-bo.screenY):wo=wa=0,bo=p),wa)},movementY:function(p){return"movementY"in p?p.movementY:wo}}),jx=Ks(Xd),Kl=K({},Xd,{dataTransfer:0}),nu=Ks(Kl),wv=K({},hh,{relatedTarget:0}),bv=Ks(wv),_v=K({},uh,{animationName:0,elapsedTime:0,pseudoElement:0}),tS=Ks(_v),iS=K({},uh,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Wx=Ks(iS),Sv=K({},uh,{data:0}),Xx=Ks(Sv),rS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qd(p){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(p):(p=qx[p])?!!y[p]:!1}function su(){return qd}var Mv=K({},hh,{key:function(p){if(p.key){var y=rS[p.key]||p.key;if(y!=="Unidentified")return y}return p.type==="keypress"?(p=ch(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?nS[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:su,charCode:function(p){return p.type==="keypress"?ch(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?ch(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),Av=Ks(Mv),_o=K({},Xd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ka=Ks(_o),dh=K({},hh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:su}),Jl=Ks(dh),$l=K({},uh,{propertyName:0,elapsedTime:0,pseudoElement:0}),fh=Ks($l),sS=K({},Xd,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Yx=Ks(sS),Qx=[9,13,27,32],Js=o&&"CompositionEvent"in window,us=null;o&&"documentMode"in document&&(us=document.documentMode);var Yr=o&&"TextEvent"in window&&!us,Yd=o&&(!Js||us&&8<us&&11>=us),So=" ",Zx=!1;function Kx(p,y){switch(p){case"keyup":return Qx.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ev(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var au=!1;function aS(p,y){switch(p){case"compositionend":return Ev(y);case"keypress":return y.which!==32?null:(Zx=!0,So);case"textInput":return p=y.data,p===So&&Zx?null:p;default:return null}}function Xp(p,y){if(au)return p==="compositionend"||!Js&&Kx(p,y)?(p=jp(),xa=Gx=Qo=null,au=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return Yd&&y.locale!=="ko"?null:y.data;default:return null}}var Qd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tv(p){var y=p&&p.nodeName&&p.nodeName.toLowerCase();return y==="input"?!!Qd[p.type]:y==="textarea"}function Zd(p,y,M,R){Ze(R),y=Uv(y,"onChange"),0<y.length&&(M=new Wp("onChange","change",null,M,R),p.push({event:M,listeners:y}))}var ou=null,Kd=null;function oS(p){tf(p,0)}function ec(p){var y=pn(p);if(ae(y))return p}function lS(p,y){if(p==="change")return y}var Jd=!1;if(o){var ba;if(o){var ph="oninput"in document;if(!ph){var mh=document.createElement("div");mh.setAttribute("oninput","return;"),ph=typeof mh.oninput=="function"}ba=ph}else ba=!1;Jd=ba&&(!document.documentMode||9<document.documentMode)}function Zo(){ou&&(ou.detachEvent("onpropertychange",Cv),Kd=ou=null)}function Cv(p){if(p.propertyName==="value"&&ec(Kd)){var y=[];Zd(y,Kd,p,me(p)),Qi(oS,y)}}function $d(p,y,M){p==="focusin"?(Zo(),ou=y,Kd=M,ou.attachEvent("onpropertychange",Cv)):p==="focusout"&&Zo()}function cS(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return ec(Kd)}function Jx(p,y){if(p==="click")return ec(y)}function en(p,y){if(p==="input"||p==="change")return ec(y)}function Pv(p,y){return p===y&&(p!==0||1/p===1/y)||p!==p&&y!==y}var Va=typeof Object.is=="function"?Object.is:Pv;function gh(p,y){if(Va(p,y))return!0;if(typeof p!="object"||p===null||typeof y!="object"||y===null)return!1;var M=Object.keys(p),R=Object.keys(y);if(M.length!==R.length)return!1;for(R=0;R<M.length;R++){var B=M[R];if(!l.call(y,B)||!Va(p[B],y[B]))return!1}return!0}function qp(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Ha(p,y){var M=qp(p);p=0;for(var R;M;){if(M.nodeType===3){if(R=p+M.textContent.length,p<=y&&R>=y)return{node:M,offset:y-p};p=R}e:{for(;M;){if(M.nextSibling){M=M.nextSibling;break e}M=M.parentNode}M=void 0}M=qp(M)}}function vh(p,y){return p&&y?p===y?!0:p&&p.nodeType===3?!1:y&&y.nodeType===3?vh(p,y.parentNode):"contains"in p?p.contains(y):p.compareDocumentPosition?!!(p.compareDocumentPosition(y)&16):!1:!1}function tn(){for(var p=window,y=Ce();y instanceof p.HTMLIFrameElement;){try{var M=typeof y.contentWindow.location.href=="string"}catch{M=!1}if(M)p=y.contentWindow;else break;y=Ce(p.document)}return y}function Wn(p){var y=p&&p.nodeName&&p.nodeName.toLowerCase();return y&&(y==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||y==="textarea"||p.contentEditable==="true")}function Xn(p){var y=tn(),M=p.focusedElem,R=p.selectionRange;if(y!==M&&M&&M.ownerDocument&&vh(M.ownerDocument.documentElement,M)){if(R!==null&&Wn(M)){if(y=R.start,p=R.end,p===void 0&&(p=y),"selectionStart"in M)M.selectionStart=y,M.selectionEnd=Math.min(p,M.value.length);else if(p=(y=M.ownerDocument||document)&&y.defaultView||window,p.getSelection){p=p.getSelection();var B=M.textContent.length,H=Math.min(R.start,B);R=R.end===void 0?H:Math.min(R.end,B),!p.extend&&H>R&&(B=R,R=H,H=B),B=Ha(M,H);var ne=Ha(M,R);B&&ne&&(p.rangeCount!==1||p.anchorNode!==B.node||p.anchorOffset!==B.offset||p.focusNode!==ne.node||p.focusOffset!==ne.offset)&&(y=y.createRange(),y.setStart(B.node,B.offset),p.removeAllRanges(),H>R?(p.addRange(y),p.extend(ne.node,ne.offset)):(y.setEnd(ne.node,ne.offset),p.addRange(y)))}}for(y=[],p=M;p=p.parentNode;)p.nodeType===1&&y.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<y.length;M++)p=y[M],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var Dv=o&&"documentMode"in document&&11>=document.documentMode,yl=null,yh=null,Yp=null,qn=!1;function Rv(p,y,M){var R=M.window===M?M.document:M.nodeType===9?M:M.ownerDocument;qn||yl==null||yl!==Ce(R)||(R=yl,"selectionStart"in R&&Wn(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),Yp&&gh(Yp,R)||(Yp=R,R=Uv(yh,"onSelect"),0<R.length&&(y=new Wp("onSelect","select",null,y,M),p.push({event:y,listeners:R}),y.target=yl)))}function ef(p,y){var M={};return M[p.toLowerCase()]=y.toLowerCase(),M["Webkit"+p]="webkit"+y,M["Moz"+p]="moz"+y,M}var lu={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionend:ef("Transition","TransitionEnd")},Ko={},Jo={};o&&(Jo=document.createElement("div").style,"AnimationEvent"in window||(delete lu.animationend.animation,delete lu.animationiteration.animation,delete lu.animationstart.animation),"TransitionEvent"in window||delete lu.transitionend.transition);function xl(p){if(Ko[p])return Ko[p];if(!lu[p])return p;var y=lu[p],M;for(M in y)if(y.hasOwnProperty(M)&&M in Jo)return Ko[p]=y[M];return p}var Qp=xl("animationend"),Zp=xl("animationiteration"),$x=xl("animationstart"),e1=xl("transitionend"),t1=new Map,i1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tc(p,y){t1.set(p,y),s(y,[p])}for(var Iv=0;Iv<i1.length;Iv++){var Kp=i1[Iv],Jp=Kp.toLowerCase(),uS=Kp[0].toUpperCase()+Kp.slice(1);tc(Jp,"on"+uS)}tc(Qp,"onAnimationEnd"),tc(Zp,"onAnimationIteration"),tc($x,"onAnimationStart"),tc("dblclick","onDoubleClick"),tc("focusin","onFocus"),tc("focusout","onBlur"),tc(e1,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lv=new Set("cancel close invalid load scroll toggle".split(" ").concat(cu));function Ov(p,y,M){var R=p.type||"unknown-event";p.currentTarget=M,Yt(R,y,void 0,p),p.currentTarget=null}function tf(p,y){y=(y&4)!==0;for(var M=0;M<p.length;M++){var R=p[M],B=R.event;R=R.listeners;e:{var H=void 0;if(y)for(var ne=R.length-1;0<=ne;ne--){var Ae=R[ne],Re=Ae.instance,st=Ae.currentTarget;if(Ae=Ae.listener,Re!==H&&B.isPropagationStopped())break e;Ov(B,Ae,st),H=Re}else for(ne=0;ne<R.length;ne++){if(Ae=R[ne],Re=Ae.instance,st=Ae.currentTarget,Ae=Ae.listener,Re!==H&&B.isPropagationStopped())break e;Ov(B,Ae,st),H=Re}}}if(Ye)throw p=ut,Ye=!1,ut=null,p}function zr(p,y){var M=y[bh];M===void 0&&(M=y[bh]=new Set);var R=p+"__bubble";M.has(R)||(Bv(y,p,2,!1),M.add(R))}function zv(p,y,M){var R=0;y&&(R|=4),Bv(M,p,R,y)}var $p="_reactListening"+Math.random().toString(36).slice(2);function rf(p){if(!p[$p]){p[$p]=!0,r.forEach(function(M){M!=="selectionchange"&&(Lv.has(M)||zv(M,!1,p),zv(M,!0,p))});var y=p.nodeType===9?p:p.ownerDocument;y===null||y[$p]||(y[$p]=!0,zv("selectionchange",!1,y))}}function Bv(p,y,M,R){switch(eS(y)){case 1:var B=gv;break;case 4:B=Hx;break;default:B=vv}M=B.bind(null,y,M,p),B=void 0,!Or||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(B=!0),R?B!==void 0?p.addEventListener(y,M,{capture:!0,passive:B}):p.addEventListener(y,M,!0):B!==void 0?p.addEventListener(y,M,{passive:B}):p.addEventListener(y,M,!1)}function Nv(p,y,M,R,B){var H=R;if((y&1)===0&&(y&2)===0&&R!==null)e:for(;;){if(R===null)return;var ne=R.tag;if(ne===3||ne===4){var Ae=R.stateNode.containerInfo;if(Ae===B||Ae.nodeType===8&&Ae.parentNode===B)break;if(ne===4)for(ne=R.return;ne!==null;){var Re=ne.tag;if((Re===3||Re===4)&&(Re=ne.stateNode.containerInfo,Re===B||Re.nodeType===8&&Re.parentNode===B))return;ne=ne.return}for(;Ae!==null;){if(ne=uu(Ae),ne===null)return;if(Re=ne.tag,Re===5||Re===6){R=H=ne;continue e}Ae=Ae.parentNode}}R=R.return}Qi(function(){var st=H,Et=me(M),Ct=[];e:{var At=t1.get(p);if(At!==void 0){var Qt=Wp,ei=p;switch(p){case"keypress":if(ch(M)===0)break e;case"keydown":case"keyup":Qt=Av;break;case"focusin":ei="focus",Qt=bv;break;case"focusout":ei="blur",Qt=bv;break;case"beforeblur":case"afterblur":Qt=bv;break;case"click":if(M.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Qt=jx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Qt=nu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Qt=Jl;break;case Qp:case Zp:case $x:Qt=tS;break;case e1:Qt=fh;break;case"scroll":Qt=Wd;break;case"wheel":Qt=Yx;break;case"copy":case"cut":case"paste":Qt=Wx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Qt=ka}var si=(y&4)!==0,On=!si&&p==="scroll",Ke=si?At!==null?At+"Capture":null:At;si=[];for(var ze=st,tt;ze!==null;){tt=ze;var Ot=tt.stateNode;if(tt.tag===5&&Ot!==null&&(tt=Ot,Ke!==null&&(Ot=mi(ze,Ke),Ot!=null&&si.push(nf(ze,Ot,tt)))),On)break;ze=ze.return}0<si.length&&(At=new Qt(At,ei,null,M,Et),Ct.push({event:At,listeners:si}))}}if((y&7)===0){e:{if(At=p==="mouseover"||p==="pointerover",Qt=p==="mouseout"||p==="pointerout",At&&M!==mt&&(ei=M.relatedTarget||M.fromElement)&&(uu(ei)||ei[Ga]))break e;if((Qt||At)&&(At=Et.window===Et?Et:(At=Et.ownerDocument)?At.defaultView||At.parentWindow:window,Qt?(ei=M.relatedTarget||M.toElement,Qt=st,ei=ei?uu(ei):null,ei!==null&&(On=oi(ei),ei!==On||ei.tag!==5&&ei.tag!==6)&&(ei=null)):(Qt=null,ei=st),Qt!==ei)){if(si=jx,Ot="onMouseLeave",Ke="onMouseEnter",ze="mouse",(p==="pointerout"||p==="pointerover")&&(si=ka,Ot="onPointerLeave",Ke="onPointerEnter",ze="pointer"),On=Qt==null?At:pn(Qt),tt=ei==null?At:pn(ei),At=new si(Ot,ze+"leave",Qt,M,Et),At.target=On,At.relatedTarget=tt,Ot=null,uu(Et)===st&&(si=new si(Ke,ze+"enter",ei,M,Et),si.target=tt,si.relatedTarget=On,Ot=si),On=Ot,Qt&&ei)t:{for(si=Qt,Ke=ei,ze=0,tt=si;tt;tt=xh(tt))ze++;for(tt=0,Ot=Ke;Ot;Ot=xh(Ot))tt++;for(;0<ze-tt;)si=xh(si),ze--;for(;0<tt-ze;)Ke=xh(Ke),tt--;for(;ze--;){if(si===Ke||Ke!==null&&si===Ke.alternate)break t;si=xh(si),Ke=xh(Ke)}si=null}else si=null;Qt!==null&&hS(Ct,At,Qt,si,!1),ei!==null&&On!==null&&hS(Ct,On,ei,si,!0)}}e:{if(At=st?pn(st):window,Qt=At.nodeName&&At.nodeName.toLowerCase(),Qt==="select"||Qt==="input"&&At.type==="file")var li=lS;else if(Tv(At))if(Jd)li=en;else{li=cS;var bi=$d}else(Qt=At.nodeName)&&Qt.toLowerCase()==="input"&&(At.type==="checkbox"||At.type==="radio")&&(li=Jx);if(li&&(li=li(p,st))){Zd(Ct,li,M,Et);break e}bi&&bi(p,At,st),p==="focusout"&&(bi=At._wrapperState)&&bi.controlled&&At.type==="number"&&je(At,"number",At.value)}switch(bi=st?pn(st):window,p){case"focusin":(Tv(bi)||bi.contentEditable==="true")&&(yl=bi,yh=st,Yp=null);break;case"focusout":Yp=yh=yl=null;break;case"mousedown":qn=!0;break;case"contextmenu":case"mouseup":case"dragend":qn=!1,Rv(Ct,M,Et);break;case"selectionchange":if(Dv)break;case"keydown":case"keyup":Rv(Ct,M,Et)}var _i;if(Js)e:{switch(p){case"compositionstart":var Ri="onCompositionStart";break e;case"compositionend":Ri="onCompositionEnd";break e;case"compositionupdate":Ri="onCompositionUpdate";break e}Ri=void 0}else au?Kx(p,M)&&(Ri="onCompositionEnd"):p==="keydown"&&M.keyCode===229&&(Ri="onCompositionStart");Ri&&(Yd&&M.locale!=="ko"&&(au||Ri!=="onCompositionStart"?Ri==="onCompositionEnd"&&au&&(_i=jp()):(Qo=Et,Gx="value"in Qo?Qo.value:Qo.textContent,au=!0)),bi=Uv(st,Ri),0<bi.length&&(Ri=new Xx(Ri,p,null,M,Et),Ct.push({event:Ri,listeners:bi}),_i?Ri.data=_i:(_i=Ev(M),_i!==null&&(Ri.data=_i)))),(_i=Yr?aS(p,M):Xp(p,M))&&(st=Uv(st,"onBeforeInput"),0<st.length&&(Et=new Xx("onBeforeInput","beforeinput",null,M,Et),Ct.push({event:Et,listeners:st}),Et.data=_i))}tf(Ct,y)})}function nf(p,y,M){return{instance:p,listener:y,currentTarget:M}}function Uv(p,y){for(var M=y+"Capture",R=[];p!==null;){var B=p,H=B.stateNode;B.tag===5&&H!==null&&(B=H,H=mi(p,M),H!=null&&R.unshift(nf(p,H,B)),H=mi(p,y),H!=null&&R.push(nf(p,H,B))),p=p.return}return R}function xh(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function hS(p,y,M,R,B){for(var H=y._reactName,ne=[];M!==null&&M!==R;){var Ae=M,Re=Ae.alternate,st=Ae.stateNode;if(Re!==null&&Re===R)break;Ae.tag===5&&st!==null&&(Ae=st,B?(Re=mi(M,H),Re!=null&&ne.unshift(nf(M,Re,Ae))):B||(Re=mi(M,H),Re!=null&&ne.push(nf(M,Re,Ae)))),M=M.return}ne.length!==0&&p.push({event:y,listeners:ne})}var DC=/\r\n?/g,dS=/\u0000|\uFFFD/g;function r1(p){return(typeof p=="string"?p:""+p).replace(DC,`
`).replace(dS,"")}function em(p,y,M){if(y=r1(y),r1(p)!==y&&M)throw Error(i(425))}function tm(){}var sf=null,n1=null;function s1(p,y){return p==="textarea"||p==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var a1=typeof setTimeout=="function"?setTimeout:void 0,o1=typeof clearTimeout=="function"?clearTimeout:void 0,Fv=typeof Promise=="function"?Promise:void 0,RC=typeof queueMicrotask=="function"?queueMicrotask:typeof Fv<"u"?function(p){return Fv.resolve(null).then(p).catch(fS)}:a1;function fS(p){setTimeout(function(){throw p})}function kv(p,y){var M=y,R=0;do{var B=M.nextSibling;if(p.removeChild(M),B&&B.nodeType===8)if(M=B.data,M==="/$"){if(R===0){p.removeChild(B),Gp(y);return}R--}else M!=="$"&&M!=="$?"&&M!=="$!"||R++;M=B}while(M);Gp(y)}function ic(p){for(;p!=null;p=p.nextSibling){var y=p.nodeType;if(y===1||y===3)break;if(y===8){if(y=p.data,y==="$"||y==="$!"||y==="$?")break;if(y==="/$")return null}}return p}function l1(p){p=p.previousSibling;for(var y=0;p;){if(p.nodeType===8){var M=p.data;if(M==="$"||M==="$!"||M==="$?"){if(y===0)return p;y--}else M==="/$"&&y++}p=p.previousSibling}return null}var wh=Math.random().toString(36).slice(2),Ln="__reactFiber$"+wh,af="__reactProps$"+wh,Ga="__reactContainer$"+wh,bh="__reactEvents$"+wh,Vv="__reactListeners$"+wh,Hv="__reactHandles$"+wh;function uu(p){var y=p[Ln];if(y)return y;for(var M=p.parentNode;M;){if(y=M[Ga]||M[Ln]){if(M=y.alternate,y.child!==null||M!==null&&M.child!==null)for(p=l1(p);p!==null;){if(M=p[Ln])return M;p=l1(p)}return y}p=M,M=p.parentNode}return null}function rc(p){return p=p[Ln]||p[Ga],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function pn(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function Gv(p){return p[af]||null}var c1=[],Yn=-1;function an(p){return{current:p}}function Br(p){0>Yn||(p.current=c1[Yn],c1[Yn]=null,Yn--)}function Ar(p,y){Yn++,c1[Yn]=p.current,p.current=y}var nc={},hs=an(nc),$s=an(!1),sc=nc;function _h(p,y){var M=p.type.contextTypes;if(!M)return nc;var R=p.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===y)return R.__reactInternalMemoizedMaskedChildContext;var B={},H;for(H in M)B[H]=y[H];return R&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=y,p.__reactInternalMemoizedMaskedChildContext=B),B}function Rs(p){return p=p.childContextTypes,p!=null}function im(){Br($s),Br(hs)}function u1(p,y,M){if(hs.current!==nc)throw Error(i(168));Ar(hs,y),Ar($s,M)}function rm(p,y,M){var R=p.stateNode;if(y=y.childContextTypes,typeof R.getChildContext!="function")return M;R=R.getChildContext();for(var B in R)if(!(B in y))throw Error(i(108,ve(p)||"Unknown",B));return K({},M,R)}function Sh(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||nc,sc=hs.current,Ar(hs,p),Ar($s,$s.current),!0}function h1(p,y,M){var R=p.stateNode;if(!R)throw Error(i(169));M?(p=rm(p,y,sc),R.__reactInternalMemoizedMergedChildContext=p,Br($s),Br(hs),Ar(hs,p)):Br($s),Ar($s,M)}var $o=null,nm=!1,jv=!1;function sm(p){$o===null?$o=[p]:$o.push(p)}function pS(p){nm=!0,sm(p)}function wl(){if(!jv&&$o!==null){jv=!0;var p=0,y=cr;try{var M=$o;for(cr=1;p<M.length;p++){var R=M[p];do R=R(!0);while(R!==null)}$o=null,nm=!1}catch(B){throw $o!==null&&($o=$o.slice(p+1)),Ue(ni,wl),B}finally{cr=y,jv=!1}}return null}var Mh=[],_a=0,Wv=null,Xv=0,ea=[],Qn=0,Ah=null,Nt=1,Mo="";function ac(p,y){Mh[_a++]=Xv,Mh[_a++]=Wv,Wv=p,Xv=y}function d1(p,y,M){ea[Qn++]=Nt,ea[Qn++]=Mo,ea[Qn++]=Ah,Ah=p;var R=Nt;p=Mo;var B=32-_e(R)-1;R&=~(1<<B),M+=1;var H=32-_e(y)+B;if(30<H){var ne=B-B%5;H=(R&(1<<ne)-1).toString(32),R>>=ne,B-=ne,Nt=1<<32-_e(y)+B|M<<B|R,Mo=H+p}else Nt=1<<H|M<<B|R,Mo=p}function f1(p){p.return!==null&&(ac(p,1),d1(p,1,0))}function oc(p){for(;p===Wv;)Wv=Mh[--_a],Mh[_a]=null,Xv=Mh[--_a],Mh[_a]=null;for(;p===Ah;)Ah=ea[--Qn],ea[Qn]=null,Mo=ea[--Qn],ea[Qn]=null,Nt=ea[--Qn],ea[Qn]=null}var ds=null,ta=null,jr=!1,Ao=null;function p1(p,y){var M=Al(5,null,null,0);M.elementType="DELETED",M.stateNode=y,M.return=p,y=p.deletions,y===null?(p.deletions=[M],p.flags|=16):y.push(M)}function m1(p,y){switch(p.tag){case 5:var M=p.type;return y=y.nodeType!==1||M.toLowerCase()!==y.nodeName.toLowerCase()?null:y,y!==null?(p.stateNode=y,ds=p,ta=ic(y.firstChild),!0):!1;case 6:return y=p.pendingProps===""||y.nodeType!==3?null:y,y!==null?(p.stateNode=y,ds=p,ta=null,!0):!1;case 13:return y=y.nodeType!==8?null:y,y!==null?(M=Ah!==null?{id:Nt,overflow:Mo}:null,p.memoizedState={dehydrated:y,treeContext:M,retryLane:1073741824},M=Al(18,null,null,0),M.stateNode=y,M.return=p,p.child=M,ds=p,ta=null,!0):!1;default:return!1}}function qv(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Yv(p){if(jr){var y=ta;if(y){var M=y;if(!m1(p,y)){if(qv(p))throw Error(i(418));y=ic(M.nextSibling);var R=ds;y&&m1(p,y)?p1(R,M):(p.flags=p.flags&-4097|2,jr=!1,ds=p)}}else{if(qv(p))throw Error(i(418));p.flags=p.flags&-4097|2,jr=!1,ds=p}}}function Qv(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;ds=p}function of(p){if(p!==ds)return!1;if(!jr)return Qv(p),jr=!0,!1;var y;if((y=p.tag!==3)&&!(y=p.tag!==5)&&(y=p.type,y=y!=="head"&&y!=="body"&&!s1(p.type,p.memoizedProps)),y&&(y=ta)){if(qv(p))throw g1(),Error(i(418));for(;y;)p1(p,y),y=ic(y.nextSibling)}if(Qv(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,y=0;p;){if(p.nodeType===8){var M=p.data;if(M==="/$"){if(y===0){ta=ic(p.nextSibling);break e}y--}else M!=="$"&&M!=="$!"&&M!=="$?"||y++}p=p.nextSibling}ta=null}}else ta=ds?ic(p.stateNode.nextSibling):null;return!0}function g1(){for(var p=ta;p;)p=ic(p.nextSibling)}function hu(){ta=ds=null,jr=!1}function lf(p){Ao===null?Ao=[p]:Ao.push(p)}var IC=A.ReactCurrentBatchConfig;function am(p,y,M){if(p=M.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(i(309));var R=M.stateNode}if(!R)throw Error(i(147,p));var B=R,H=""+p;return y!==null&&y.ref!==null&&typeof y.ref=="function"&&y.ref._stringRef===H?y.ref:(y=function(ne){var Ae=B.refs;ne===null?delete Ae[H]:Ae[H]=ne},y._stringRef=H,y)}if(typeof p!="string")throw Error(i(284));if(!M._owner)throw Error(i(290,p))}return p}function om(p,y){throw p=Object.prototype.toString.call(y),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":p))}function v1(p){var y=p._init;return y(p._payload)}function y1(p){function y(Ke,ze){if(p){var tt=Ke.deletions;tt===null?(Ke.deletions=[ze],Ke.flags|=16):tt.push(ze)}}function M(Ke,ze){if(!p)return null;for(;ze!==null;)y(Ke,ze),ze=ze.sibling;return null}function R(Ke,ze){for(Ke=new Map;ze!==null;)ze.key!==null?Ke.set(ze.key,ze):Ke.set(ze.index,ze),ze=ze.sibling;return Ke}function B(Ke,ze){return Ke=xf(Ke,ze),Ke.index=0,Ke.sibling=null,Ke}function H(Ke,ze,tt){return Ke.index=tt,p?(tt=Ke.alternate,tt!==null?(tt=tt.index,tt<ze?(Ke.flags|=2,ze):tt):(Ke.flags|=2,ze)):(Ke.flags|=1048576,ze)}function ne(Ke){return p&&Ke.alternate===null&&(Ke.flags|=2),Ke}function Ae(Ke,ze,tt,Ot){return ze===null||ze.tag!==6?(ze=KC(tt,Ke.mode,Ot),ze.return=Ke,ze):(ze=B(ze,tt),ze.return=Ke,ze)}function Re(Ke,ze,tt,Ot){var li=tt.type;return li===I?Et(Ke,ze,tt.props.children,Ot,tt.key):ze!==null&&(ze.elementType===li||typeof li=="object"&&li!==null&&li.$$typeof===ie&&v1(li)===ze.type)?(Ot=B(ze,tt.props),Ot.ref=am(Ke,ze,tt),Ot.return=Ke,Ot):(Ot=NS(tt.type,tt.key,tt.props,null,Ke.mode,Ot),Ot.ref=am(Ke,ze,tt),Ot.return=Ke,Ot)}function st(Ke,ze,tt,Ot){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==tt.containerInfo||ze.stateNode.implementation!==tt.implementation?(ze=JC(tt,Ke.mode,Ot),ze.return=Ke,ze):(ze=B(ze,tt.children||[]),ze.return=Ke,ze)}function Et(Ke,ze,tt,Ot,li){return ze===null||ze.tag!==7?(ze=Mm(tt,Ke.mode,Ot,li),ze.return=Ke,ze):(ze=B(ze,tt),ze.return=Ke,ze)}function Ct(Ke,ze,tt){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return ze=KC(""+ze,Ke.mode,tt),ze.return=Ke,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case T:return tt=NS(ze.type,ze.key,ze.props,null,Ke.mode,tt),tt.ref=am(Ke,null,ze),tt.return=Ke,tt;case E:return ze=JC(ze,Ke.mode,tt),ze.return=Ke,ze;case ie:var Ot=ze._init;return Ct(Ke,Ot(ze._payload),tt)}if(xt(ze)||ee(ze))return ze=Mm(ze,Ke.mode,tt,null),ze.return=Ke,ze;om(Ke,ze)}return null}function At(Ke,ze,tt,Ot){var li=ze!==null?ze.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number")return li!==null?null:Ae(Ke,ze,""+tt,Ot);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case T:return tt.key===li?Re(Ke,ze,tt,Ot):null;case E:return tt.key===li?st(Ke,ze,tt,Ot):null;case ie:return li=tt._init,At(Ke,ze,li(tt._payload),Ot)}if(xt(tt)||ee(tt))return li!==null?null:Et(Ke,ze,tt,Ot,null);om(Ke,tt)}return null}function Qt(Ke,ze,tt,Ot,li){if(typeof Ot=="string"&&Ot!==""||typeof Ot=="number")return Ke=Ke.get(tt)||null,Ae(ze,Ke,""+Ot,li);if(typeof Ot=="object"&&Ot!==null){switch(Ot.$$typeof){case T:return Ke=Ke.get(Ot.key===null?tt:Ot.key)||null,Re(ze,Ke,Ot,li);case E:return Ke=Ke.get(Ot.key===null?tt:Ot.key)||null,st(ze,Ke,Ot,li);case ie:var bi=Ot._init;return Qt(Ke,ze,tt,bi(Ot._payload),li)}if(xt(Ot)||ee(Ot))return Ke=Ke.get(tt)||null,Et(ze,Ke,Ot,li,null);om(ze,Ot)}return null}function ei(Ke,ze,tt,Ot){for(var li=null,bi=null,_i=ze,Ri=ze=0,zs=null;_i!==null&&Ri<tt.length;Ri++){_i.index>Ri?(zs=_i,_i=null):zs=_i.sibling;var vr=At(Ke,_i,tt[Ri],Ot);if(vr===null){_i===null&&(_i=zs);break}p&&_i&&vr.alternate===null&&y(Ke,_i),ze=H(vr,ze,Ri),bi===null?li=vr:bi.sibling=vr,bi=vr,_i=zs}if(Ri===tt.length)return M(Ke,_i),jr&&ac(Ke,Ri),li;if(_i===null){for(;Ri<tt.length;Ri++)_i=Ct(Ke,tt[Ri],Ot),_i!==null&&(ze=H(_i,ze,Ri),bi===null?li=_i:bi.sibling=_i,bi=_i);return jr&&ac(Ke,Ri),li}for(_i=R(Ke,_i);Ri<tt.length;Ri++)zs=Qt(_i,Ke,Ri,tt[Ri],Ot),zs!==null&&(p&&zs.alternate!==null&&_i.delete(zs.key===null?Ri:zs.key),ze=H(zs,ze,Ri),bi===null?li=zs:bi.sibling=zs,bi=zs);return p&&_i.forEach(function(wf){return y(Ke,wf)}),jr&&ac(Ke,Ri),li}function si(Ke,ze,tt,Ot){var li=ee(tt);if(typeof li!="function")throw Error(i(150));if(tt=li.call(tt),tt==null)throw Error(i(151));for(var bi=li=null,_i=ze,Ri=ze=0,zs=null,vr=tt.next();_i!==null&&!vr.done;Ri++,vr=tt.next()){_i.index>Ri?(zs=_i,_i=null):zs=_i.sibling;var wf=At(Ke,_i,vr.value,Ot);if(wf===null){_i===null&&(_i=zs);break}p&&_i&&wf.alternate===null&&y(Ke,_i),ze=H(wf,ze,Ri),bi===null?li=wf:bi.sibling=wf,bi=wf,_i=zs}if(vr.done)return M(Ke,_i),jr&&ac(Ke,Ri),li;if(_i===null){for(;!vr.done;Ri++,vr=tt.next())vr=Ct(Ke,vr.value,Ot),vr!==null&&(ze=H(vr,ze,Ri),bi===null?li=vr:bi.sibling=vr,bi=vr);return jr&&ac(Ke,Ri),li}for(_i=R(Ke,_i);!vr.done;Ri++,vr=tt.next())vr=Qt(_i,Ke,Ri,vr.value,Ot),vr!==null&&(p&&vr.alternate!==null&&_i.delete(vr.key===null?Ri:vr.key),ze=H(vr,ze,Ri),bi===null?li=vr:bi.sibling=vr,bi=vr);return p&&_i.forEach(function(kJ){return y(Ke,kJ)}),jr&&ac(Ke,Ri),li}function On(Ke,ze,tt,Ot){if(typeof tt=="object"&&tt!==null&&tt.type===I&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case T:e:{for(var li=tt.key,bi=ze;bi!==null;){if(bi.key===li){if(li=tt.type,li===I){if(bi.tag===7){M(Ke,bi.sibling),ze=B(bi,tt.props.children),ze.return=Ke,Ke=ze;break e}}else if(bi.elementType===li||typeof li=="object"&&li!==null&&li.$$typeof===ie&&v1(li)===bi.type){M(Ke,bi.sibling),ze=B(bi,tt.props),ze.ref=am(Ke,bi,tt),ze.return=Ke,Ke=ze;break e}M(Ke,bi);break}else y(Ke,bi);bi=bi.sibling}tt.type===I?(ze=Mm(tt.props.children,Ke.mode,Ot,tt.key),ze.return=Ke,Ke=ze):(Ot=NS(tt.type,tt.key,tt.props,null,Ke.mode,Ot),Ot.ref=am(Ke,ze,tt),Ot.return=Ke,Ke=Ot)}return ne(Ke);case E:e:{for(bi=tt.key;ze!==null;){if(ze.key===bi)if(ze.tag===4&&ze.stateNode.containerInfo===tt.containerInfo&&ze.stateNode.implementation===tt.implementation){M(Ke,ze.sibling),ze=B(ze,tt.children||[]),ze.return=Ke,Ke=ze;break e}else{M(Ke,ze);break}else y(Ke,ze);ze=ze.sibling}ze=JC(tt,Ke.mode,Ot),ze.return=Ke,Ke=ze}return ne(Ke);case ie:return bi=tt._init,On(Ke,ze,bi(tt._payload),Ot)}if(xt(tt))return ei(Ke,ze,tt,Ot);if(ee(tt))return si(Ke,ze,tt,Ot);om(Ke,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"?(tt=""+tt,ze!==null&&ze.tag===6?(M(Ke,ze.sibling),ze=B(ze,tt),ze.return=Ke,Ke=ze):(M(Ke,ze),ze=KC(tt,Ke.mode,Ot),ze.return=Ke,Ke=ze),ne(Ke)):M(Ke,ze)}return On}var Eh=y1(!0),lm=y1(!1),Th=an(null),Ch=null,lc=null,cf=null;function Ph(){cf=lc=Ch=null}function cm(p){var y=Th.current;Br(Th),p._currentValue=y}function um(p,y,M){for(;p!==null;){var R=p.alternate;if((p.childLanes&y)!==y?(p.childLanes|=y,R!==null&&(R.childLanes|=y)):R!==null&&(R.childLanes&y)!==y&&(R.childLanes|=y),p===M)break;p=p.return}}function du(p,y){Ch=p,cf=lc=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&y)!==0&&(Hi=!0),p.firstContext=null)}function ja(p){var y=p._currentValue;if(cf!==p)if(p={context:p,memoizedValue:y,next:null},lc===null){if(Ch===null)throw Error(i(308));lc=p,Ch.dependencies={lanes:0,firstContext:p}}else lc=lc.next=p;return y}var cc=null;function x1(p){cc===null?cc=[p]:cc.push(p)}function hm(p,y,M,R){var B=y.interleaved;return B===null?(M.next=M,x1(y)):(M.next=B.next,B.next=M),y.interleaved=M,el(p,R)}function el(p,y){p.lanes|=y;var M=p.alternate;for(M!==null&&(M.lanes|=y),M=p,p=p.return;p!==null;)p.childLanes|=y,M=p.alternate,M!==null&&(M.childLanes|=y),M=p,p=p.return;return M.tag===3?M.stateNode:null}var br=!1;function ki(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(p,y){p=p.updateQueue,y.updateQueue===p&&(y.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function _r(p,y){return{eventTime:p,lane:y,tag:0,payload:null,callback:null,next:null}}function Qr(p,y,M){var R=p.updateQueue;if(R===null)return null;if(R=R.shared,(fr&2)!==0){var B=R.pending;return B===null?y.next=y:(y.next=B.next,B.next=y),R.pending=y,el(p,M)}return B=R.interleaved,B===null?(y.next=y,x1(R)):(y.next=B.next,B.next=y),R.interleaved=y,el(p,M)}function Is(p,y,M){if(y=y.updateQueue,y!==null&&(y=y.shared,(M&4194240)!==0)){var R=y.lanes;R&=p.pendingLanes,M|=R,y.lanes=M,Hd(p,M)}}function Dh(p,y){var M=p.updateQueue,R=p.alternate;if(R!==null&&(R=R.updateQueue,M===R)){var B=null,H=null;if(M=M.firstBaseUpdate,M!==null){do{var ne={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};H===null?B=H=ne:H=H.next=ne,M=M.next}while(M!==null);H===null?B=H=y:H=H.next=y}else B=H=y;M={baseState:R.baseState,firstBaseUpdate:B,lastBaseUpdate:H,shared:R.shared,effects:R.effects},p.updateQueue=M;return}p=M.lastBaseUpdate,p===null?M.firstBaseUpdate=y:p.next=y,M.lastBaseUpdate=y}function on(p,y,M,R){var B=p.updateQueue;br=!1;var H=B.firstBaseUpdate,ne=B.lastBaseUpdate,Ae=B.shared.pending;if(Ae!==null){B.shared.pending=null;var Re=Ae,st=Re.next;Re.next=null,ne===null?H=st:ne.next=st,ne=Re;var Et=p.alternate;Et!==null&&(Et=Et.updateQueue,Ae=Et.lastBaseUpdate,Ae!==ne&&(Ae===null?Et.firstBaseUpdate=st:Ae.next=st,Et.lastBaseUpdate=Re))}if(H!==null){var Ct=B.baseState;ne=0,Et=st=Re=null,Ae=H;do{var At=Ae.lane,Qt=Ae.eventTime;if((R&At)===At){Et!==null&&(Et=Et.next={eventTime:Qt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var ei=p,si=Ae;switch(At=y,Qt=M,si.tag){case 1:if(ei=si.payload,typeof ei=="function"){Ct=ei.call(Qt,Ct,At);break e}Ct=ei;break e;case 3:ei.flags=ei.flags&-65537|128;case 0:if(ei=si.payload,At=typeof ei=="function"?ei.call(Qt,Ct,At):ei,At==null)break e;Ct=K({},Ct,At);break e;case 2:br=!0}}Ae.callback!==null&&Ae.lane!==0&&(p.flags|=64,At=B.effects,At===null?B.effects=[Ae]:At.push(Ae))}else Qt={eventTime:Qt,lane:At,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},Et===null?(st=Et=Qt,Re=Ct):Et=Et.next=Qt,ne|=At;if(Ae=Ae.next,Ae===null){if(Ae=B.shared.pending,Ae===null)break;At=Ae,Ae=At.next,At.next=null,B.lastBaseUpdate=At,B.shared.pending=null}}while(!0);if(Et===null&&(Re=Ct),B.baseState=Re,B.firstBaseUpdate=st,B.lastBaseUpdate=Et,y=B.shared.interleaved,y!==null){B=y;do ne|=B.lane,B=B.next;while(B!==y)}else H===null&&(B.shared.lanes=0);wm|=ne,p.lanes=ne,p.memoizedState=Ct}}function uf(p,y,M){if(p=y.effects,y.effects=null,p!==null)for(y=0;y<p.length;y++){var R=p[y],B=R.callback;if(B!==null){if(R.callback=null,R=M,typeof B!="function")throw Error(i(191,B));B.call(R)}}}var bl={},Wa=an(bl),Rh=an(bl),uc=an(bl);function _n(p){if(p===bl)throw Error(i(174));return p}function dm(p,y){switch(Ar(uc,y),Ar(Rh,p),Ar(Wa,bl),p=y.nodeType,p){case 9:case 11:y=(y=y.documentElement)?y.namespaceURI:Le(null,"");break;default:p=p===8?y.parentNode:y,y=p.namespaceURI||null,p=p.tagName,y=Le(y,p)}Br(Wa),Ar(Wa,y)}function fu(){Br(Wa),Br(Rh),Br(uc)}function Ih(p){_n(uc.current);var y=_n(Wa.current),M=Le(y,p.type);y!==M&&(Ar(Rh,p),Ar(Wa,M))}function hf(p){Rh.current===p&&(Br(Wa),Br(Rh))}var Wr=an(0);function tl(p){for(var y=p;y!==null;){if(y.tag===13){var M=y.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||M.data==="$?"||M.data==="$!"))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var df=[];function _l(){for(var p=0;p<df.length;p++)df[p]._workInProgressVersionPrimary=null;df.length=0}var Lh=A.ReactCurrentDispatcher,Oh=A.ReactCurrentBatchConfig,hc=0,Nr=null,ln=null,ur=null,il=!1,Ls=!1,pu=0,Sa=0;function fs(){throw Error(i(321))}function fm(p,y){if(y===null)return!1;for(var M=0;M<y.length&&M<p.length;M++)if(!Va(p[M],y[M]))return!1;return!0}function pm(p,y,M,R,B,H){if(hc=H,Nr=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,Lh.current=p===null||p.memoizedState===null?bS:_S,p=M(R,B),Ls){H=0;do{if(Ls=!1,pu=0,25<=H)throw Error(i(301));H+=1,ur=ln=null,y.updateQueue=null,Lh.current=SS,p=M(R,B)}while(Ls)}if(Lh.current=i0,y=ln!==null&&ln.next!==null,hc=0,ur=ln=Nr=null,il=!1,y)throw Error(i(300));return p}function w1(){var p=pu!==0;return pu=0,p}function ps(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ur===null?Nr.memoizedState=ur=p:ur=ur.next=p,ur}function Xa(){if(ln===null){var p=Nr.alternate;p=p!==null?p.memoizedState:null}else p=ln.next;var y=ur===null?Nr.memoizedState:ur.next;if(y!==null)ur=y,ln=p;else{if(p===null)throw Error(i(310));ln=p,p={memoizedState:ln.memoizedState,baseState:ln.baseState,baseQueue:ln.baseQueue,queue:ln.queue,next:null},ur===null?Nr.memoizedState=ur=p:ur=ur.next=p}return ur}function ff(p,y){return typeof y=="function"?y(p):y}function mm(p){var y=Xa(),M=y.queue;if(M===null)throw Error(i(311));M.lastRenderedReducer=p;var R=ln,B=R.baseQueue,H=M.pending;if(H!==null){if(B!==null){var ne=B.next;B.next=H.next,H.next=ne}R.baseQueue=B=H,M.pending=null}if(B!==null){H=B.next,R=R.baseState;var Ae=ne=null,Re=null,st=H;do{var Et=st.lane;if((hc&Et)===Et)Re!==null&&(Re=Re.next={lane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),R=st.hasEagerState?st.eagerState:p(R,st.action);else{var Ct={lane:Et,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null};Re===null?(Ae=Re=Ct,ne=R):Re=Re.next=Ct,Nr.lanes|=Et,wm|=Et}st=st.next}while(st!==null&&st!==H);Re===null?ne=R:Re.next=Ae,Va(R,y.memoizedState)||(Hi=!0),y.memoizedState=R,y.baseState=ne,y.baseQueue=Re,M.lastRenderedState=R}if(p=M.interleaved,p!==null){B=p;do H=B.lane,Nr.lanes|=H,wm|=H,B=B.next;while(B!==p)}else B===null&&(M.lanes=0);return[y.memoizedState,M.dispatch]}function dc(p){var y=Xa(),M=y.queue;if(M===null)throw Error(i(311));M.lastRenderedReducer=p;var R=M.dispatch,B=M.pending,H=y.memoizedState;if(B!==null){M.pending=null;var ne=B=B.next;do H=p(H,ne.action),ne=ne.next;while(ne!==B);Va(H,y.memoizedState)||(Hi=!0),y.memoizedState=H,y.baseQueue===null&&(y.baseState=H),M.lastRenderedState=H}return[H,R]}function b1(){}function _1(p,y){var M=Nr,R=Xa(),B=y(),H=!Va(R.memoizedState,B);if(H&&(R.memoizedState=B,Hi=!0),R=R.queue,A1(mS.bind(null,M,R,p),[p]),R.getSnapshot!==y||H||ur!==null&&ur.memoizedState.tag&1){if(M.flags|=2048,rl(9,gm.bind(null,M,R,B,y),void 0,null),Os===null)throw Error(i(349));(hc&30)!==0||Zv(M,y,B)}return B}function Zv(p,y,M){p.flags|=16384,p={getSnapshot:y,value:M},y=Nr.updateQueue,y===null?(y={lastEffect:null,stores:null},Nr.updateQueue=y,y.stores=[p]):(M=y.stores,M===null?y.stores=[p]:M.push(p))}function gm(p,y,M,R){y.value=M,y.getSnapshot=R,gS(y)&&S1(p)}function mS(p,y,M){return M(function(){gS(y)&&S1(p)})}function gS(p){var y=p.getSnapshot;p=p.value;try{var M=y();return!Va(p,M)}catch{return!0}}function S1(p){var y=el(p,1);y!==null&&vc(y,p,1,-1)}function M1(p){var y=ps();return typeof p=="function"&&(p=p()),y.memoizedState=y.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ff,lastRenderedState:p},y.queue=p,p=p.dispatch=zh.bind(null,Nr,p),[y.memoizedState,p]}function rl(p,y,M,R){return p={tag:p,create:y,destroy:M,deps:R,next:null},y=Nr.updateQueue,y===null?(y={lastEffect:null,stores:null},Nr.updateQueue=y,y.lastEffect=p.next=p):(M=y.lastEffect,M===null?y.lastEffect=p.next=p:(R=M.next,M.next=p,p.next=R,y.lastEffect=p)),p}function vS(){return Xa().memoizedState}function Sl(p,y,M,R){var B=ps();Nr.flags|=p,B.memoizedState=rl(1|y,M,void 0,R===void 0?null:R)}function vm(p,y,M,R){var B=Xa();R=R===void 0?null:R;var H=void 0;if(ln!==null){var ne=ln.memoizedState;if(H=ne.destroy,R!==null&&fm(R,ne.deps)){B.memoizedState=rl(y,M,H,R);return}}Nr.flags|=p,B.memoizedState=rl(1|y,M,H,R)}function ia(p,y){return Sl(8390656,8,p,y)}function A1(p,y){return vm(2048,8,p,y)}function E1(p,y){return vm(4,2,p,y)}function yS(p,y){return vm(4,4,p,y)}function xS(p,y){if(typeof y=="function")return p=p(),y(p),function(){y(null)};if(y!=null)return p=p(),y.current=p,function(){y.current=null}}function T1(p,y,M){return M=M!=null?M.concat([p]):null,vm(4,4,xS.bind(null,y,p),M)}function Kv(){}function wS(p,y){var M=Xa();y=y===void 0?null:y;var R=M.memoizedState;return R!==null&&y!==null&&fm(y,R[1])?R[0]:(M.memoizedState=[p,y],p)}function qa(p,y){var M=Xa();y=y===void 0?null:y;var R=M.memoizedState;return R!==null&&y!==null&&fm(y,R[1])?R[0]:(p=p(),M.memoizedState=[p,y],p)}function Jv(p,y,M){return(hc&21)===0?(p.baseState&&(p.baseState=!1,Hi=!0),p.memoizedState=M):(Va(M,y)||(M=ya(),Nr.lanes|=M,wm|=M,p.baseState=!0),y)}function LC(p,y){var M=cr;cr=M!==0&&4>M?M:4,p(!0);var R=Oh.transition;Oh.transition={};try{p(!1),y()}finally{cr=M,Oh.transition=R}}function fc(){return Xa().memoizedState}function $v(p,y,M){var R=vf(p);if(M={lane:R,action:M,hasEagerState:!1,eagerState:null,next:null},ym(p))e0(y,M);else if(M=hm(p,y,M,R),M!==null){var B=Qa();vc(M,p,R,B),t0(M,y,R)}}function zh(p,y,M){var R=vf(p),B={lane:R,action:M,hasEagerState:!1,eagerState:null,next:null};if(ym(p))e0(y,B);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=y.lastRenderedReducer,H!==null))try{var ne=y.lastRenderedState,Ae=H(ne,M);if(B.hasEagerState=!0,B.eagerState=Ae,Va(Ae,ne)){var Re=y.interleaved;Re===null?(B.next=B,x1(y)):(B.next=Re.next,Re.next=B),y.interleaved=B;return}}catch{}finally{}M=hm(p,y,B,R),M!==null&&(B=Qa(),vc(M,p,R,B),t0(M,y,R))}}function ym(p){var y=p.alternate;return p===Nr||y!==null&&y===Nr}function e0(p,y){Ls=il=!0;var M=p.pending;M===null?y.next=y:(y.next=M.next,M.next=y),p.pending=y}function t0(p,y,M){if((M&4194240)!==0){var R=y.lanes;R&=p.pendingLanes,M|=R,y.lanes=M,Hd(p,M)}}var i0={readContext:ja,useCallback:fs,useContext:fs,useEffect:fs,useImperativeHandle:fs,useInsertionEffect:fs,useLayoutEffect:fs,useMemo:fs,useReducer:fs,useRef:fs,useState:fs,useDebugValue:fs,useDeferredValue:fs,useTransition:fs,useMutableSource:fs,useSyncExternalStore:fs,useId:fs,unstable_isNewReconciler:!1},bS={readContext:ja,useCallback:function(p,y){return ps().memoizedState=[p,y===void 0?null:y],p},useContext:ja,useEffect:ia,useImperativeHandle:function(p,y,M){return M=M!=null?M.concat([p]):null,Sl(4194308,4,xS.bind(null,y,p),M)},useLayoutEffect:function(p,y){return Sl(4194308,4,p,y)},useInsertionEffect:function(p,y){return Sl(4,2,p,y)},useMemo:function(p,y){var M=ps();return y=y===void 0?null:y,p=p(),M.memoizedState=[p,y],p},useReducer:function(p,y,M){var R=ps();return y=M!==void 0?M(y):y,R.memoizedState=R.baseState=y,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:y},R.queue=p,p=p.dispatch=$v.bind(null,Nr,p),[R.memoizedState,p]},useRef:function(p){var y=ps();return p={current:p},y.memoizedState=p},useState:M1,useDebugValue:Kv,useDeferredValue:function(p){return ps().memoizedState=p},useTransition:function(){var p=M1(!1),y=p[0];return p=LC.bind(null,p[1]),ps().memoizedState=p,[y,p]},useMutableSource:function(){},useSyncExternalStore:function(p,y,M){var R=Nr,B=ps();if(jr){if(M===void 0)throw Error(i(407));M=M()}else{if(M=y(),Os===null)throw Error(i(349));(hc&30)!==0||Zv(R,y,M)}B.memoizedState=M;var H={value:M,getSnapshot:y};return B.queue=H,ia(mS.bind(null,R,H,p),[p]),R.flags|=2048,rl(9,gm.bind(null,R,H,M,y),void 0,null),M},useId:function(){var p=ps(),y=Os.identifierPrefix;if(jr){var M=Mo,R=Nt;M=(R&~(1<<32-_e(R)-1)).toString(32)+M,y=":"+y+"R"+M,M=pu++,0<M&&(y+="H"+M.toString(32)),y+=":"}else M=Sa++,y=":"+y+"r"+M.toString(32)+":";return p.memoizedState=y},unstable_isNewReconciler:!1},_S={readContext:ja,useCallback:wS,useContext:ja,useEffect:A1,useImperativeHandle:T1,useInsertionEffect:E1,useLayoutEffect:yS,useMemo:qa,useReducer:mm,useRef:vS,useState:function(){return mm(ff)},useDebugValue:Kv,useDeferredValue:function(p){var y=Xa();return Jv(y,ln.memoizedState,p)},useTransition:function(){var p=mm(ff)[0],y=Xa().memoizedState;return[p,y]},useMutableSource:b1,useSyncExternalStore:_1,useId:fc,unstable_isNewReconciler:!1},SS={readContext:ja,useCallback:wS,useContext:ja,useEffect:A1,useImperativeHandle:T1,useInsertionEffect:E1,useLayoutEffect:yS,useMemo:qa,useReducer:dc,useRef:vS,useState:function(){return dc(ff)},useDebugValue:Kv,useDeferredValue:function(p){var y=Xa();return ln===null?y.memoizedState=p:Jv(y,ln.memoizedState,p)},useTransition:function(){var p=dc(ff)[0],y=Xa().memoizedState;return[p,y]},useMutableSource:b1,useSyncExternalStore:_1,useId:fc,unstable_isNewReconciler:!1};function Eo(p,y){if(p&&p.defaultProps){y=K({},y),p=p.defaultProps;for(var M in p)y[M]===void 0&&(y[M]=p[M]);return y}return y}function xm(p,y,M,R){y=p.memoizedState,M=M(R,y),M=M==null?y:K({},y,M),p.memoizedState=M,p.lanes===0&&(p.updateQueue.baseState=M)}var r0={isMounted:function(p){return(p=p._reactInternals)?oi(p)===p:!1},enqueueSetState:function(p,y,M){p=p._reactInternals;var R=Qa(),B=vf(p),H=_r(R,B);H.payload=y,M!=null&&(H.callback=M),y=Qr(p,H,B),y!==null&&(vc(y,p,B,R),Is(y,p,B))},enqueueReplaceState:function(p,y,M){p=p._reactInternals;var R=Qa(),B=vf(p),H=_r(R,B);H.tag=1,H.payload=y,M!=null&&(H.callback=M),y=Qr(p,H,B),y!==null&&(vc(y,p,B,R),Is(y,p,B))},enqueueForceUpdate:function(p,y){p=p._reactInternals;var M=Qa(),R=vf(p),B=_r(M,R);B.tag=2,y!=null&&(B.callback=y),y=Qr(p,B,R),y!==null&&(vc(y,p,R,M),Is(y,p,R))}};function MS(p,y,M,R,B,H,ne){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(R,H,ne):y.prototype&&y.prototype.isPureReactComponent?!gh(M,R)||!gh(B,H):!0}function w(p,y,M){var R=!1,B=nc,H=y.contextType;return typeof H=="object"&&H!==null?H=ja(H):(B=Rs(y)?sc:hs.current,R=y.contextTypes,H=(R=R!=null)?_h(p,B):nc),y=new y(M,H),p.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=r0,p.stateNode=y,y._reactInternals=p,R&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=B,p.__reactInternalMemoizedMaskedChildContext=H),y}function b(p,y,M,R){p=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(M,R),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(M,R),y.state!==p&&r0.enqueueReplaceState(y,y.state,null)}function D(p,y,M,R){var B=p.stateNode;B.props=M,B.state=p.memoizedState,B.refs={},ki(p);var H=y.contextType;typeof H=="object"&&H!==null?B.context=ja(H):(H=Rs(y)?sc:hs.current,B.context=_h(p,H)),B.state=p.memoizedState,H=y.getDerivedStateFromProps,typeof H=="function"&&(xm(p,y,H,M),B.state=p.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(y=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),y!==B.state&&r0.enqueueReplaceState(B,B.state,null),on(p,M,B,R),B.state=p.memoizedState),typeof B.componentDidMount=="function"&&(p.flags|=4194308)}function O(p,y){try{var M="",R=y;do M+=he(R),R=R.return;while(R);var B=M}catch(H){B=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:y,stack:B,digest:null}}function U(p,y,M){return{value:p,source:null,stack:M??null,digest:y??null}}function Y(p,y){try{console.error(y.value)}catch(M){setTimeout(function(){throw M})}}var ye=typeof WeakMap=="function"?WeakMap:Map;function Fe(p,y,M){M=_r(-1,M),M.tag=3,M.payload={element:null};var R=y.value;return M.callback=function(){RS||(RS=!0,GC=R),Y(p,y)},M}function pt(p,y,M){M=_r(-1,M),M.tag=3;var R=p.type.getDerivedStateFromError;if(typeof R=="function"){var B=y.value;M.payload=function(){return R(B)},M.callback=function(){Y(p,y)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(M.callback=function(){Y(p,y),typeof R!="function"&&(mf===null?mf=new Set([this]):mf.add(this));var ne=y.stack;this.componentDidCatch(y.value,{componentStack:ne!==null?ne:""})}),M}function It(p,y,M){var R=p.pingCache;if(R===null){R=p.pingCache=new ye;var B=new Set;R.set(y,B)}else B=R.get(y),B===void 0&&(B=new Set,R.set(y,B));B.has(M)||(B.add(M),p=PJ.bind(null,p,y,M),y.then(p,p))}function Kt(p){do{var y;if((y=p.tag===13)&&(y=p.memoizedState,y=y!==null?y.dehydrated!==null:!0),y)return p;p=p.return}while(p!==null);return null}function Ii(p,y,M,R,B){return(p.mode&1)===0?(p===y?p.flags|=65536:(p.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(y=_r(-1,1),y.tag=2,Qr(M,y,1))),M.lanes|=1),p):(p.flags|=65536,p.lanes=B,p)}var vi=A.ReactCurrentOwner,Hi=!1;function jt(p,y,M,R){y.child=p===null?lm(y,null,M,R):Eh(y,p.child,M,R)}function ms(p,y,M,R,B){M=M.render;var H=y.ref;return du(y,B),R=pm(p,y,M,R,H,B),M=w1(),p!==null&&!Hi?(y.updateQueue=p.updateQueue,y.flags&=-2053,p.lanes&=~B,Bh(p,y,B)):(jr&&M&&f1(y),y.flags|=1,jt(p,y,R,B),y.child)}function Ya(p,y,M,R,B){if(p===null){var H=M.type;return typeof H=="function"&&!ZC(H)&&H.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(y.tag=15,y.type=H,it(p,y,H,R,B)):(p=NS(M.type,null,R,y,y.mode,B),p.ref=y.ref,p.return=y,y.child=p)}if(H=p.child,(p.lanes&B)===0){var ne=H.memoizedProps;if(M=M.compare,M=M!==null?M:gh,M(ne,R)&&p.ref===y.ref)return Bh(p,y,B)}return y.flags|=1,p=xf(H,R),p.ref=y.ref,p.return=y,y.child=p}function it(p,y,M,R,B){if(p!==null){var H=p.memoizedProps;if(gh(H,R)&&p.ref===y.ref)if(Hi=!1,y.pendingProps=R=H,(p.lanes&B)!==0)(p.flags&131072)!==0&&(Hi=!0);else return y.lanes=p.lanes,Bh(p,y,B)}return Ht(p,y,M,R,B)}function He(p,y,M){var R=y.pendingProps,B=R.children,H=p!==null?p.memoizedState:null;if(R.mode==="hidden")if((y.mode&1)===0)y.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ar(s0,nl),nl|=M;else{if((M&1073741824)===0)return p=H!==null?H.baseLanes|M:M,y.lanes=y.childLanes=1073741824,y.memoizedState={baseLanes:p,cachePool:null,transitions:null},y.updateQueue=null,Ar(s0,nl),nl|=p,null;y.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=H!==null?H.baseLanes:M,Ar(s0,nl),nl|=R}else H!==null?(R=H.baseLanes|M,y.memoizedState=null):R=M,Ar(s0,nl),nl|=R;return jt(p,y,B,M),y.child}function ht(p,y){var M=y.ref;(p===null&&M!==null||p!==null&&p.ref!==M)&&(y.flags|=512,y.flags|=2097152)}function Ht(p,y,M,R,B){var H=Rs(M)?sc:hs.current;return H=_h(y,H),du(y,B),M=pm(p,y,M,R,H,B),R=w1(),p!==null&&!Hi?(y.updateQueue=p.updateQueue,y.flags&=-2053,p.lanes&=~B,Bh(p,y,B)):(jr&&R&&f1(y),y.flags|=1,jt(p,y,M,B),y.child)}function ai(p,y,M,R,B){if(Rs(M)){var H=!0;Sh(y)}else H=!1;if(du(y,B),y.stateNode===null)ES(p,y),w(y,M,R),D(y,M,R,B),R=!0;else if(p===null){var ne=y.stateNode,Ae=y.memoizedProps;ne.props=Ae;var Re=ne.context,st=M.contextType;typeof st=="object"&&st!==null?st=ja(st):(st=Rs(M)?sc:hs.current,st=_h(y,st));var Et=M.getDerivedStateFromProps,Ct=typeof Et=="function"||typeof ne.getSnapshotBeforeUpdate=="function";Ct||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(Ae!==R||Re!==st)&&b(y,ne,R,st),br=!1;var At=y.memoizedState;ne.state=At,on(y,R,ne,B),Re=y.memoizedState,Ae!==R||At!==Re||$s.current||br?(typeof Et=="function"&&(xm(y,M,Et,R),Re=y.memoizedState),(Ae=br||MS(y,M,Ae,R,At,Re,st))?(Ct||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount()),typeof ne.componentDidMount=="function"&&(y.flags|=4194308)):(typeof ne.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=R,y.memoizedState=Re),ne.props=R,ne.state=Re,ne.context=st,R=Ae):(typeof ne.componentDidMount=="function"&&(y.flags|=4194308),R=!1)}else{ne=y.stateNode,mn(p,y),Ae=y.memoizedProps,st=y.type===y.elementType?Ae:Eo(y.type,Ae),ne.props=st,Ct=y.pendingProps,At=ne.context,Re=M.contextType,typeof Re=="object"&&Re!==null?Re=ja(Re):(Re=Rs(M)?sc:hs.current,Re=_h(y,Re));var Qt=M.getDerivedStateFromProps;(Et=typeof Qt=="function"||typeof ne.getSnapshotBeforeUpdate=="function")||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(Ae!==Ct||At!==Re)&&b(y,ne,R,Re),br=!1,At=y.memoizedState,ne.state=At,on(y,R,ne,B);var ei=y.memoizedState;Ae!==Ct||At!==ei||$s.current||br?(typeof Qt=="function"&&(xm(y,M,Qt,R),ei=y.memoizedState),(st=br||MS(y,M,st,R,At,ei,Re)||!1)?(Et||typeof ne.UNSAFE_componentWillUpdate!="function"&&typeof ne.componentWillUpdate!="function"||(typeof ne.componentWillUpdate=="function"&&ne.componentWillUpdate(R,ei,Re),typeof ne.UNSAFE_componentWillUpdate=="function"&&ne.UNSAFE_componentWillUpdate(R,ei,Re)),typeof ne.componentDidUpdate=="function"&&(y.flags|=4),typeof ne.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof ne.componentDidUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(y.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(y.flags|=1024),y.memoizedProps=R,y.memoizedState=ei),ne.props=R,ne.state=ei,ne.context=Re,R=st):(typeof ne.componentDidUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(y.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&At===p.memoizedState||(y.flags|=1024),R=!1)}return Ni(p,y,M,R,H,B)}function Ni(p,y,M,R,B,H){ht(p,y);var ne=(y.flags&128)!==0;if(!R&&!ne)return B&&h1(y,M,!1),Bh(p,y,H);R=y.stateNode,vi.current=y;var Ae=ne&&typeof M.getDerivedStateFromError!="function"?null:R.render();return y.flags|=1,p!==null&&ne?(y.child=Eh(y,p.child,null,H),y.child=Eh(y,null,Ae,H)):jt(p,y,Ae,H),y.memoizedState=R.state,B&&h1(y,M,!0),y.child}function Li(p){var y=p.stateNode;y.pendingContext?u1(p,y.pendingContext,y.pendingContext!==y.context):y.context&&u1(p,y.context,!1),dm(p,y.containerInfo)}function sr(p,y,M,R,B){return hu(),lf(B),y.flags|=256,jt(p,y,M,R),y.child}var Sn={dehydrated:null,treeContext:null,retryLane:0};function ir(p){return{baseLanes:p,cachePool:null,transitions:null}}function pc(p,y,M){var R=y.pendingProps,B=Wr.current,H=!1,ne=(y.flags&128)!==0,Ae;if((Ae=ne)||(Ae=p!==null&&p.memoizedState===null?!1:(B&2)!==0),Ae?(H=!0,y.flags&=-129):(p===null||p.memoizedState!==null)&&(B|=1),Ar(Wr,B&1),p===null)return Yv(y),p=y.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((y.mode&1)===0?y.lanes=1:p.data==="$!"?y.lanes=8:y.lanes=1073741824,null):(ne=R.children,p=R.fallback,H?(R=y.mode,H=y.child,ne={mode:"hidden",children:ne},(R&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ne):H=US(ne,R,0,null),p=Mm(p,R,M,null),H.return=y,p.return=y,H.sibling=p,y.child=H,y.child.memoizedState=ir(M),y.memoizedState=Sn,p):C1(y,ne));if(B=p.memoizedState,B!==null&&(Ae=B.dehydrated,Ae!==null))return vJ(p,y,ne,R,Ae,B,M);if(H){H=R.fallback,ne=y.mode,B=p.child,Ae=B.sibling;var Re={mode:"hidden",children:R.children};return(ne&1)===0&&y.child!==B?(R=y.child,R.childLanes=0,R.pendingProps=Re,y.deletions=null):(R=xf(B,Re),R.subtreeFlags=B.subtreeFlags&14680064),Ae!==null?H=xf(Ae,H):(H=Mm(H,ne,M,null),H.flags|=2),H.return=y,R.return=y,R.sibling=H,y.child=R,R=H,H=y.child,ne=p.child.memoizedState,ne=ne===null?ir(M):{baseLanes:ne.baseLanes|M,cachePool:null,transitions:ne.transitions},H.memoizedState=ne,H.childLanes=p.childLanes&~M,y.memoizedState=Sn,R}return H=p.child,p=H.sibling,R=xf(H,{mode:"visible",children:R.children}),(y.mode&1)===0&&(R.lanes=M),R.return=y,R.sibling=null,p!==null&&(M=y.deletions,M===null?(y.deletions=[p],y.flags|=16):M.push(p)),y.child=R,y.memoizedState=null,R}function C1(p,y){return y=US({mode:"visible",children:y},p.mode,0,null),y.return=p,p.child=y}function AS(p,y,M,R){return R!==null&&lf(R),Eh(y,p.child,null,M),p=C1(y,y.pendingProps.children),p.flags|=2,y.memoizedState=null,p}function vJ(p,y,M,R,B,H,ne){if(M)return y.flags&256?(y.flags&=-257,R=U(Error(i(422))),AS(p,y,ne,R)):y.memoizedState!==null?(y.child=p.child,y.flags|=128,null):(H=R.fallback,B=y.mode,R=US({mode:"visible",children:R.children},B,0,null),H=Mm(H,B,ne,null),H.flags|=2,R.return=y,H.return=y,R.sibling=H,y.child=R,(y.mode&1)!==0&&Eh(y,p.child,null,ne),y.child.memoizedState=ir(ne),y.memoizedState=Sn,H);if((y.mode&1)===0)return AS(p,y,ne,null);if(B.data==="$!"){if(R=B.nextSibling&&B.nextSibling.dataset,R)var Ae=R.dgst;return R=Ae,H=Error(i(419)),R=U(H,R,void 0),AS(p,y,ne,R)}if(Ae=(ne&p.childLanes)!==0,Hi||Ae){if(R=Os,R!==null){switch(ne&-ne){case 4:B=2;break;case 16:B=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:B=32;break;case 536870912:B=268435456;break;default:B=0}B=(B&(R.suspendedLanes|ne))!==0?0:B,B!==0&&B!==H.retryLane&&(H.retryLane=B,el(p,B),vc(R,p,B,-1))}return QC(),R=U(Error(i(421))),AS(p,y,ne,R)}return B.data==="$?"?(y.flags|=128,y.child=p.child,y=DJ.bind(null,p),B._reactRetry=y,null):(p=H.treeContext,ta=ic(B.nextSibling),ds=y,jr=!0,Ao=null,p!==null&&(ea[Qn++]=Nt,ea[Qn++]=Mo,ea[Qn++]=Ah,Nt=p.id,Mo=p.overflow,Ah=y),y=C1(y,R.children),y.flags|=4096,y)}function dU(p,y,M){p.lanes|=y;var R=p.alternate;R!==null&&(R.lanes|=y),um(p.return,y,M)}function OC(p,y,M,R,B){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:R,tail:M,tailMode:B}:(H.isBackwards=y,H.rendering=null,H.renderingStartTime=0,H.last=R,H.tail=M,H.tailMode=B)}function fU(p,y,M){var R=y.pendingProps,B=R.revealOrder,H=R.tail;if(jt(p,y,R.children,M),R=Wr.current,(R&2)!==0)R=R&1|2,y.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=y.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&dU(p,M,y);else if(p.tag===19)dU(p,M,y);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===y)break e;for(;p.sibling===null;){if(p.return===null||p.return===y)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}R&=1}if(Ar(Wr,R),(y.mode&1)===0)y.memoizedState=null;else switch(B){case"forwards":for(M=y.child,B=null;M!==null;)p=M.alternate,p!==null&&tl(p)===null&&(B=M),M=M.sibling;M=B,M===null?(B=y.child,y.child=null):(B=M.sibling,M.sibling=null),OC(y,!1,B,M,H);break;case"backwards":for(M=null,B=y.child,y.child=null;B!==null;){if(p=B.alternate,p!==null&&tl(p)===null){y.child=B;break}p=B.sibling,B.sibling=M,M=B,B=p}OC(y,!0,M,null,H);break;case"together":OC(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function ES(p,y){(y.mode&1)===0&&p!==null&&(p.alternate=null,y.alternate=null,y.flags|=2)}function Bh(p,y,M){if(p!==null&&(y.dependencies=p.dependencies),wm|=y.lanes,(M&y.childLanes)===0)return null;if(p!==null&&y.child!==p.child)throw Error(i(153));if(y.child!==null){for(p=y.child,M=xf(p,p.pendingProps),y.child=M,M.return=y;p.sibling!==null;)p=p.sibling,M=M.sibling=xf(p,p.pendingProps),M.return=y;M.sibling=null}return y.child}function yJ(p,y,M){switch(y.tag){case 3:Li(y),hu();break;case 5:Ih(y);break;case 1:Rs(y.type)&&Sh(y);break;case 4:dm(y,y.stateNode.containerInfo);break;case 10:var R=y.type._context,B=y.memoizedProps.value;Ar(Th,R._currentValue),R._currentValue=B;break;case 13:if(R=y.memoizedState,R!==null)return R.dehydrated!==null?(Ar(Wr,Wr.current&1),y.flags|=128,null):(M&y.child.childLanes)!==0?pc(p,y,M):(Ar(Wr,Wr.current&1),p=Bh(p,y,M),p!==null?p.sibling:null);Ar(Wr,Wr.current&1);break;case 19:if(R=(M&y.childLanes)!==0,(p.flags&128)!==0){if(R)return fU(p,y,M);y.flags|=128}if(B=y.memoizedState,B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),Ar(Wr,Wr.current),R)break;return null;case 22:case 23:return y.lanes=0,He(p,y,M)}return Bh(p,y,M)}var pU,zC,mU,gU;pU=function(p,y){for(var M=y.child;M!==null;){if(M.tag===5||M.tag===6)p.appendChild(M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===y)break;for(;M.sibling===null;){if(M.return===null||M.return===y)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},zC=function(){},mU=function(p,y,M,R){var B=p.memoizedProps;if(B!==R){p=y.stateNode,_n(Wa.current);var H=null;switch(M){case"input":B=Ie(p,B),R=Ie(p,R),H=[];break;case"select":B=K({},B,{value:void 0}),R=K({},R,{value:void 0}),H=[];break;case"textarea":B=de(p,B),R=de(p,R),H=[];break;default:typeof B.onClick!="function"&&typeof R.onClick=="function"&&(p.onclick=tm)}ge(M,R);var ne;M=null;for(st in B)if(!R.hasOwnProperty(st)&&B.hasOwnProperty(st)&&B[st]!=null)if(st==="style"){var Ae=B[st];for(ne in Ae)Ae.hasOwnProperty(ne)&&(M||(M={}),M[ne]="")}else st!=="dangerouslySetInnerHTML"&&st!=="children"&&st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(n.hasOwnProperty(st)?H||(H=[]):(H=H||[]).push(st,null));for(st in R){var Re=R[st];if(Ae=B!=null?B[st]:void 0,R.hasOwnProperty(st)&&Re!==Ae&&(Re!=null||Ae!=null))if(st==="style")if(Ae){for(ne in Ae)!Ae.hasOwnProperty(ne)||Re&&Re.hasOwnProperty(ne)||(M||(M={}),M[ne]="");for(ne in Re)Re.hasOwnProperty(ne)&&Ae[ne]!==Re[ne]&&(M||(M={}),M[ne]=Re[ne])}else M||(H||(H=[]),H.push(st,M)),M=Re;else st==="dangerouslySetInnerHTML"?(Re=Re?Re.__html:void 0,Ae=Ae?Ae.__html:void 0,Re!=null&&Ae!==Re&&(H=H||[]).push(st,Re)):st==="children"?typeof Re!="string"&&typeof Re!="number"||(H=H||[]).push(st,""+Re):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&(n.hasOwnProperty(st)?(Re!=null&&st==="onScroll"&&zr("scroll",p),H||Ae===Re||(H=[])):(H=H||[]).push(st,Re))}M&&(H=H||[]).push("style",M);var st=H;(y.updateQueue=st)&&(y.flags|=4)}},gU=function(p,y,M,R){M!==R&&(y.flags|=4)};function P1(p,y){if(!jr)switch(p.tailMode){case"hidden":y=p.tail;for(var M=null;y!==null;)y.alternate!==null&&(M=y),y=y.sibling;M===null?p.tail=null:M.sibling=null;break;case"collapsed":M=p.tail;for(var R=null;M!==null;)M.alternate!==null&&(R=M),M=M.sibling;R===null?y||p.tail===null?p.tail=null:p.tail.sibling=null:R.sibling=null}}function Ma(p){var y=p.alternate!==null&&p.alternate.child===p.child,M=0,R=0;if(y)for(var B=p.child;B!==null;)M|=B.lanes|B.childLanes,R|=B.subtreeFlags&14680064,R|=B.flags&14680064,B.return=p,B=B.sibling;else for(B=p.child;B!==null;)M|=B.lanes|B.childLanes,R|=B.subtreeFlags,R|=B.flags,B.return=p,B=B.sibling;return p.subtreeFlags|=R,p.childLanes=M,y}function xJ(p,y,M){var R=y.pendingProps;switch(oc(y),y.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ma(y),null;case 1:return Rs(y.type)&&im(),Ma(y),null;case 3:return R=y.stateNode,fu(),Br($s),Br(hs),_l(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(p===null||p.child===null)&&(of(y)?y.flags|=4:p===null||p.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,Ao!==null&&(XC(Ao),Ao=null))),zC(p,y),Ma(y),null;case 5:hf(y);var B=_n(uc.current);if(M=y.type,p!==null&&y.stateNode!=null)mU(p,y,M,R,B),p.ref!==y.ref&&(y.flags|=512,y.flags|=2097152);else{if(!R){if(y.stateNode===null)throw Error(i(166));return Ma(y),null}if(p=_n(Wa.current),of(y)){R=y.stateNode,M=y.type;var H=y.memoizedProps;switch(R[Ln]=y,R[af]=H,p=(y.mode&1)!==0,M){case"dialog":zr("cancel",R),zr("close",R);break;case"iframe":case"object":case"embed":zr("load",R);break;case"video":case"audio":for(B=0;B<cu.length;B++)zr(cu[B],R);break;case"source":zr("error",R);break;case"img":case"image":case"link":zr("error",R),zr("load",R);break;case"details":zr("toggle",R);break;case"input":Be(R,H),zr("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!H.multiple},zr("invalid",R);break;case"textarea":V(R,H),zr("invalid",R)}ge(M,H),B=null;for(var ne in H)if(H.hasOwnProperty(ne)){var Ae=H[ne];ne==="children"?typeof Ae=="string"?R.textContent!==Ae&&(H.suppressHydrationWarning!==!0&&em(R.textContent,Ae,p),B=["children",Ae]):typeof Ae=="number"&&R.textContent!==""+Ae&&(H.suppressHydrationWarning!==!0&&em(R.textContent,Ae,p),B=["children",""+Ae]):n.hasOwnProperty(ne)&&Ae!=null&&ne==="onScroll"&&zr("scroll",R)}switch(M){case"input":Te(R),We(R,H,!0);break;case"textarea":Te(R),we(R);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(R.onclick=tm)}R=B,y.updateQueue=R,R!==null&&(y.flags|=4)}else{ne=B.nodeType===9?B:B.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=J(M)),p==="http://www.w3.org/1999/xhtml"?M==="script"?(p=ne.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof R.is=="string"?p=ne.createElement(M,{is:R.is}):(p=ne.createElement(M),M==="select"&&(ne=p,R.multiple?ne.multiple=!0:R.size&&(ne.size=R.size))):p=ne.createElementNS(p,M),p[Ln]=y,p[af]=R,pU(p,y,!1,!1),y.stateNode=p;e:{switch(ne=$e(M,R),M){case"dialog":zr("cancel",p),zr("close",p),B=R;break;case"iframe":case"object":case"embed":zr("load",p),B=R;break;case"video":case"audio":for(B=0;B<cu.length;B++)zr(cu[B],p);B=R;break;case"source":zr("error",p),B=R;break;case"img":case"image":case"link":zr("error",p),zr("load",p),B=R;break;case"details":zr("toggle",p),B=R;break;case"input":Be(p,R),B=Ie(p,R),zr("invalid",p);break;case"option":B=R;break;case"select":p._wrapperState={wasMultiple:!!R.multiple},B=K({},R,{value:void 0}),zr("invalid",p);break;case"textarea":V(p,R),B=de(p,R),zr("invalid",p);break;default:B=R}ge(M,B),Ae=B;for(H in Ae)if(Ae.hasOwnProperty(H)){var Re=Ae[H];H==="style"?rt(p,Re):H==="dangerouslySetInnerHTML"?(Re=Re?Re.__html:void 0,Re!=null&&ct(p,Re)):H==="children"?typeof Re=="string"?(M!=="textarea"||Re!=="")&&Pe(p,Re):typeof Re=="number"&&Pe(p,""+Re):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(n.hasOwnProperty(H)?Re!=null&&H==="onScroll"&&zr("scroll",p):Re!=null&&_(p,H,Re,ne))}switch(M){case"input":Te(p),We(p,R,!1);break;case"textarea":Te(p),we(p);break;case"option":R.value!=null&&p.setAttribute("value",""+xe(R.value));break;case"select":p.multiple=!!R.multiple,H=R.value,H!=null?Mt(p,!!R.multiple,H,!1):R.defaultValue!=null&&Mt(p,!!R.multiple,R.defaultValue,!0);break;default:typeof B.onClick=="function"&&(p.onclick=tm)}switch(M){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(y.flags|=4)}y.ref!==null&&(y.flags|=512,y.flags|=2097152)}return Ma(y),null;case 6:if(p&&y.stateNode!=null)gU(p,y,p.memoizedProps,R);else{if(typeof R!="string"&&y.stateNode===null)throw Error(i(166));if(M=_n(uc.current),_n(Wa.current),of(y)){if(R=y.stateNode,M=y.memoizedProps,R[Ln]=y,(H=R.nodeValue!==M)&&(p=ds,p!==null))switch(p.tag){case 3:em(R.nodeValue,M,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&em(R.nodeValue,M,(p.mode&1)!==0)}H&&(y.flags|=4)}else R=(M.nodeType===9?M:M.ownerDocument).createTextNode(R),R[Ln]=y,y.stateNode=R}return Ma(y),null;case 13:if(Br(Wr),R=y.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(jr&&ta!==null&&(y.mode&1)!==0&&(y.flags&128)===0)g1(),hu(),y.flags|=98560,H=!1;else if(H=of(y),R!==null&&R.dehydrated!==null){if(p===null){if(!H)throw Error(i(318));if(H=y.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[Ln]=y}else hu(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;Ma(y),H=!1}else Ao!==null&&(XC(Ao),Ao=null),H=!0;if(!H)return y.flags&65536?y:null}return(y.flags&128)!==0?(y.lanes=M,y):(R=R!==null,R!==(p!==null&&p.memoizedState!==null)&&R&&(y.child.flags|=8192,(y.mode&1)!==0&&(p===null||(Wr.current&1)!==0?gs===0&&(gs=3):QC())),y.updateQueue!==null&&(y.flags|=4),Ma(y),null);case 4:return fu(),zC(p,y),p===null&&rf(y.stateNode.containerInfo),Ma(y),null;case 10:return cm(y.type._context),Ma(y),null;case 17:return Rs(y.type)&&im(),Ma(y),null;case 19:if(Br(Wr),H=y.memoizedState,H===null)return Ma(y),null;if(R=(y.flags&128)!==0,ne=H.rendering,ne===null)if(R)P1(H,!1);else{if(gs!==0||p!==null&&(p.flags&128)!==0)for(p=y.child;p!==null;){if(ne=tl(p),ne!==null){for(y.flags|=128,P1(H,!1),R=ne.updateQueue,R!==null&&(y.updateQueue=R,y.flags|=4),y.subtreeFlags=0,R=M,M=y.child;M!==null;)H=M,p=R,H.flags&=14680066,ne=H.alternate,ne===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ne.childLanes,H.lanes=ne.lanes,H.child=ne.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ne.memoizedProps,H.memoizedState=ne.memoizedState,H.updateQueue=ne.updateQueue,H.type=ne.type,p=ne.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),M=M.sibling;return Ar(Wr,Wr.current&1|2),y.child}p=p.sibling}H.tail!==null&&Pt()>a0&&(y.flags|=128,R=!0,P1(H,!1),y.lanes=4194304)}else{if(!R)if(p=tl(ne),p!==null){if(y.flags|=128,R=!0,M=p.updateQueue,M!==null&&(y.updateQueue=M,y.flags|=4),P1(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ne.alternate&&!jr)return Ma(y),null}else 2*Pt()-H.renderingStartTime>a0&&M!==1073741824&&(y.flags|=128,R=!0,P1(H,!1),y.lanes=4194304);H.isBackwards?(ne.sibling=y.child,y.child=ne):(M=H.last,M!==null?M.sibling=ne:y.child=ne,H.last=ne)}return H.tail!==null?(y=H.tail,H.rendering=y,H.tail=y.sibling,H.renderingStartTime=Pt(),y.sibling=null,M=Wr.current,Ar(Wr,R?M&1|2:M&1),y):(Ma(y),null);case 22:case 23:return YC(),R=y.memoizedState!==null,p!==null&&p.memoizedState!==null!==R&&(y.flags|=8192),R&&(y.mode&1)!==0?(nl&1073741824)!==0&&(Ma(y),y.subtreeFlags&6&&(y.flags|=8192)):Ma(y),null;case 24:return null;case 25:return null}throw Error(i(156,y.tag))}function wJ(p,y){switch(oc(y),y.tag){case 1:return Rs(y.type)&&im(),p=y.flags,p&65536?(y.flags=p&-65537|128,y):null;case 3:return fu(),Br($s),Br(hs),_l(),p=y.flags,(p&65536)!==0&&(p&128)===0?(y.flags=p&-65537|128,y):null;case 5:return hf(y),null;case 13:if(Br(Wr),p=y.memoizedState,p!==null&&p.dehydrated!==null){if(y.alternate===null)throw Error(i(340));hu()}return p=y.flags,p&65536?(y.flags=p&-65537|128,y):null;case 19:return Br(Wr),null;case 4:return fu(),null;case 10:return cm(y.type._context),null;case 22:case 23:return YC(),null;case 24:return null;default:return null}}var TS=!1,Aa=!1,bJ=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function n0(p,y){var M=p.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(R){Mn(p,y,R)}else M.current=null}function BC(p,y,M){try{M()}catch(R){Mn(p,y,R)}}var vU=!1;function _J(p,y){if(sf=yo,p=tn(),Wn(p)){if("selectionStart"in p)var M={start:p.selectionStart,end:p.selectionEnd};else e:{M=(M=p.ownerDocument)&&M.defaultView||window;var R=M.getSelection&&M.getSelection();if(R&&R.rangeCount!==0){M=R.anchorNode;var B=R.anchorOffset,H=R.focusNode;R=R.focusOffset;try{M.nodeType,H.nodeType}catch{M=null;break e}var ne=0,Ae=-1,Re=-1,st=0,Et=0,Ct=p,At=null;t:for(;;){for(var Qt;Ct!==M||B!==0&&Ct.nodeType!==3||(Ae=ne+B),Ct!==H||R!==0&&Ct.nodeType!==3||(Re=ne+R),Ct.nodeType===3&&(ne+=Ct.nodeValue.length),(Qt=Ct.firstChild)!==null;)At=Ct,Ct=Qt;for(;;){if(Ct===p)break t;if(At===M&&++st===B&&(Ae=ne),At===H&&++Et===R&&(Re=ne),(Qt=Ct.nextSibling)!==null)break;Ct=At,At=Ct.parentNode}Ct=Qt}M=Ae===-1||Re===-1?null:{start:Ae,end:Re}}else M=null}M=M||{start:0,end:0}}else M=null;for(n1={focusedElem:p,selectionRange:M},yo=!1,Jt=y;Jt!==null;)if(y=Jt,p=y.child,(y.subtreeFlags&1028)!==0&&p!==null)p.return=y,Jt=p;else for(;Jt!==null;){y=Jt;try{var ei=y.alternate;if((y.flags&1024)!==0)switch(y.tag){case 0:case 11:case 15:break;case 1:if(ei!==null){var si=ei.memoizedProps,On=ei.memoizedState,Ke=y.stateNode,ze=Ke.getSnapshotBeforeUpdate(y.elementType===y.type?si:Eo(y.type,si),On);Ke.__reactInternalSnapshotBeforeUpdate=ze}break;case 3:var tt=y.stateNode.containerInfo;tt.nodeType===1?tt.textContent="":tt.nodeType===9&&tt.documentElement&&tt.removeChild(tt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Ot){Mn(y,y.return,Ot)}if(p=y.sibling,p!==null){p.return=y.return,Jt=p;break}Jt=y.return}return ei=vU,vU=!1,ei}function D1(p,y,M){var R=y.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var B=R=R.next;do{if((B.tag&p)===p){var H=B.destroy;B.destroy=void 0,H!==void 0&&BC(y,M,H)}B=B.next}while(B!==R)}}function CS(p,y){if(y=y.updateQueue,y=y!==null?y.lastEffect:null,y!==null){var M=y=y.next;do{if((M.tag&p)===p){var R=M.create;M.destroy=R()}M=M.next}while(M!==y)}}function NC(p){var y=p.ref;if(y!==null){var M=p.stateNode;switch(p.tag){case 5:p=M;break;default:p=M}typeof y=="function"?y(p):y.current=p}}function yU(p){var y=p.alternate;y!==null&&(p.alternate=null,yU(y)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(y=p.stateNode,y!==null&&(delete y[Ln],delete y[af],delete y[bh],delete y[Vv],delete y[Hv])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function xU(p){return p.tag===5||p.tag===3||p.tag===4}function wU(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||xU(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function UC(p,y,M){var R=p.tag;if(R===5||R===6)p=p.stateNode,y?M.nodeType===8?M.parentNode.insertBefore(p,y):M.insertBefore(p,y):(M.nodeType===8?(y=M.parentNode,y.insertBefore(p,M)):(y=M,y.appendChild(p)),M=M._reactRootContainer,M!=null||y.onclick!==null||(y.onclick=tm));else if(R!==4&&(p=p.child,p!==null))for(UC(p,y,M),p=p.sibling;p!==null;)UC(p,y,M),p=p.sibling}function FC(p,y,M){var R=p.tag;if(R===5||R===6)p=p.stateNode,y?M.insertBefore(p,y):M.appendChild(p);else if(R!==4&&(p=p.child,p!==null))for(FC(p,y,M),p=p.sibling;p!==null;)FC(p,y,M),p=p.sibling}var ra=null,mc=!1;function pf(p,y,M){for(M=M.child;M!==null;)bU(p,y,M),M=M.sibling}function bU(p,y,M){if(Z&&typeof Z.onCommitFiberUnmount=="function")try{Z.onCommitFiberUnmount(lr,M)}catch{}switch(M.tag){case 5:Aa||n0(M,y);case 6:var R=ra,B=mc;ra=null,pf(p,y,M),ra=R,mc=B,ra!==null&&(mc?(p=ra,M=M.stateNode,p.nodeType===8?p.parentNode.removeChild(M):p.removeChild(M)):ra.removeChild(M.stateNode));break;case 18:ra!==null&&(mc?(p=ra,M=M.stateNode,p.nodeType===8?kv(p.parentNode,M):p.nodeType===1&&kv(p,M),Gp(p)):kv(ra,M.stateNode));break;case 4:R=ra,B=mc,ra=M.stateNode.containerInfo,mc=!0,pf(p,y,M),ra=R,mc=B;break;case 0:case 11:case 14:case 15:if(!Aa&&(R=M.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){B=R=R.next;do{var H=B,ne=H.destroy;H=H.tag,ne!==void 0&&((H&2)!==0||(H&4)!==0)&&BC(M,y,ne),B=B.next}while(B!==R)}pf(p,y,M);break;case 1:if(!Aa&&(n0(M,y),R=M.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=M.memoizedProps,R.state=M.memoizedState,R.componentWillUnmount()}catch(Ae){Mn(M,y,Ae)}pf(p,y,M);break;case 21:pf(p,y,M);break;case 22:M.mode&1?(Aa=(R=Aa)||M.memoizedState!==null,pf(p,y,M),Aa=R):pf(p,y,M);break;default:pf(p,y,M)}}function _U(p){var y=p.updateQueue;if(y!==null){p.updateQueue=null;var M=p.stateNode;M===null&&(M=p.stateNode=new bJ),y.forEach(function(R){var B=RJ.bind(null,p,R);M.has(R)||(M.add(R),R.then(B,B))})}}function gc(p,y){var M=y.deletions;if(M!==null)for(var R=0;R<M.length;R++){var B=M[R];try{var H=p,ne=y,Ae=ne;e:for(;Ae!==null;){switch(Ae.tag){case 5:ra=Ae.stateNode,mc=!1;break e;case 3:ra=Ae.stateNode.containerInfo,mc=!0;break e;case 4:ra=Ae.stateNode.containerInfo,mc=!0;break e}Ae=Ae.return}if(ra===null)throw Error(i(160));bU(H,ne,B),ra=null,mc=!1;var Re=B.alternate;Re!==null&&(Re.return=null),B.return=null}catch(st){Mn(B,y,st)}}if(y.subtreeFlags&12854)for(y=y.child;y!==null;)SU(y,p),y=y.sibling}function SU(p,y){var M=p.alternate,R=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(gc(y,p),mu(p),R&4){try{D1(3,p,p.return),CS(3,p)}catch(si){Mn(p,p.return,si)}try{D1(5,p,p.return)}catch(si){Mn(p,p.return,si)}}break;case 1:gc(y,p),mu(p),R&512&&M!==null&&n0(M,M.return);break;case 5:if(gc(y,p),mu(p),R&512&&M!==null&&n0(M,M.return),p.flags&32){var B=p.stateNode;try{Pe(B,"")}catch(si){Mn(p,p.return,si)}}if(R&4&&(B=p.stateNode,B!=null)){var H=p.memoizedProps,ne=M!==null?M.memoizedProps:H,Ae=p.type,Re=p.updateQueue;if(p.updateQueue=null,Re!==null)try{Ae==="input"&&H.type==="radio"&&H.name!=null&&Ve(B,H),$e(Ae,ne);var st=$e(Ae,H);for(ne=0;ne<Re.length;ne+=2){var Et=Re[ne],Ct=Re[ne+1];Et==="style"?rt(B,Ct):Et==="dangerouslySetInnerHTML"?ct(B,Ct):Et==="children"?Pe(B,Ct):_(B,Et,Ct,st)}switch(Ae){case"input":lt(B,H);break;case"textarea":X(B,H);break;case"select":var At=B._wrapperState.wasMultiple;B._wrapperState.wasMultiple=!!H.multiple;var Qt=H.value;Qt!=null?Mt(B,!!H.multiple,Qt,!1):At!==!!H.multiple&&(H.defaultValue!=null?Mt(B,!!H.multiple,H.defaultValue,!0):Mt(B,!!H.multiple,H.multiple?[]:"",!1))}B[af]=H}catch(si){Mn(p,p.return,si)}}break;case 6:if(gc(y,p),mu(p),R&4){if(p.stateNode===null)throw Error(i(162));B=p.stateNode,H=p.memoizedProps;try{B.nodeValue=H}catch(si){Mn(p,p.return,si)}}break;case 3:if(gc(y,p),mu(p),R&4&&M!==null&&M.memoizedState.isDehydrated)try{Gp(y.containerInfo)}catch(si){Mn(p,p.return,si)}break;case 4:gc(y,p),mu(p);break;case 13:gc(y,p),mu(p),B=p.child,B.flags&8192&&(H=B.memoizedState!==null,B.stateNode.isHidden=H,!H||B.alternate!==null&&B.alternate.memoizedState!==null||(HC=Pt())),R&4&&_U(p);break;case 22:if(Et=M!==null&&M.memoizedState!==null,p.mode&1?(Aa=(st=Aa)||Et,gc(y,p),Aa=st):gc(y,p),mu(p),R&8192){if(st=p.memoizedState!==null,(p.stateNode.isHidden=st)&&!Et&&(p.mode&1)!==0)for(Jt=p,Et=p.child;Et!==null;){for(Ct=Jt=Et;Jt!==null;){switch(At=Jt,Qt=At.child,At.tag){case 0:case 11:case 14:case 15:D1(4,At,At.return);break;case 1:n0(At,At.return);var ei=At.stateNode;if(typeof ei.componentWillUnmount=="function"){R=At,M=At.return;try{y=R,ei.props=y.memoizedProps,ei.state=y.memoizedState,ei.componentWillUnmount()}catch(si){Mn(R,M,si)}}break;case 5:n0(At,At.return);break;case 22:if(At.memoizedState!==null){EU(Ct);continue}}Qt!==null?(Qt.return=At,Jt=Qt):EU(Ct)}Et=Et.sibling}e:for(Et=null,Ct=p;;){if(Ct.tag===5){if(Et===null){Et=Ct;try{B=Ct.stateNode,st?(H=B.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ae=Ct.stateNode,Re=Ct.memoizedProps.style,ne=Re!=null&&Re.hasOwnProperty("display")?Re.display:null,Ae.style.display=Tt("display",ne))}catch(si){Mn(p,p.return,si)}}}else if(Ct.tag===6){if(Et===null)try{Ct.stateNode.nodeValue=st?"":Ct.memoizedProps}catch(si){Mn(p,p.return,si)}}else if((Ct.tag!==22&&Ct.tag!==23||Ct.memoizedState===null||Ct===p)&&Ct.child!==null){Ct.child.return=Ct,Ct=Ct.child;continue}if(Ct===p)break e;for(;Ct.sibling===null;){if(Ct.return===null||Ct.return===p)break e;Et===Ct&&(Et=null),Ct=Ct.return}Et===Ct&&(Et=null),Ct.sibling.return=Ct.return,Ct=Ct.sibling}}break;case 19:gc(y,p),mu(p),R&4&&_U(p);break;case 21:break;default:gc(y,p),mu(p)}}function mu(p){var y=p.flags;if(y&2){try{e:{for(var M=p.return;M!==null;){if(xU(M)){var R=M;break e}M=M.return}throw Error(i(160))}switch(R.tag){case 5:var B=R.stateNode;R.flags&32&&(Pe(B,""),R.flags&=-33);var H=wU(p);FC(p,H,B);break;case 3:case 4:var ne=R.stateNode.containerInfo,Ae=wU(p);UC(p,Ae,ne);break;default:throw Error(i(161))}}catch(Re){Mn(p,p.return,Re)}p.flags&=-3}y&4096&&(p.flags&=-4097)}function SJ(p,y,M){Jt=p,MU(p)}function MU(p,y,M){for(var R=(p.mode&1)!==0;Jt!==null;){var B=Jt,H=B.child;if(B.tag===22&&R){var ne=B.memoizedState!==null||TS;if(!ne){var Ae=B.alternate,Re=Ae!==null&&Ae.memoizedState!==null||Aa;Ae=TS;var st=Aa;if(TS=ne,(Aa=Re)&&!st)for(Jt=B;Jt!==null;)ne=Jt,Re=ne.child,ne.tag===22&&ne.memoizedState!==null?TU(B):Re!==null?(Re.return=ne,Jt=Re):TU(B);for(;H!==null;)Jt=H,MU(H),H=H.sibling;Jt=B,TS=Ae,Aa=st}AU(p)}else(B.subtreeFlags&8772)!==0&&H!==null?(H.return=B,Jt=H):AU(p)}}function AU(p){for(;Jt!==null;){var y=Jt;if((y.flags&8772)!==0){var M=y.alternate;try{if((y.flags&8772)!==0)switch(y.tag){case 0:case 11:case 15:Aa||CS(5,y);break;case 1:var R=y.stateNode;if(y.flags&4&&!Aa)if(M===null)R.componentDidMount();else{var B=y.elementType===y.type?M.memoizedProps:Eo(y.type,M.memoizedProps);R.componentDidUpdate(B,M.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var H=y.updateQueue;H!==null&&uf(y,H,R);break;case 3:var ne=y.updateQueue;if(ne!==null){if(M=null,y.child!==null)switch(y.child.tag){case 5:M=y.child.stateNode;break;case 1:M=y.child.stateNode}uf(y,ne,M)}break;case 5:var Ae=y.stateNode;if(M===null&&y.flags&4){M=Ae;var Re=y.memoizedProps;switch(y.type){case"button":case"input":case"select":case"textarea":Re.autoFocus&&M.focus();break;case"img":Re.src&&(M.src=Re.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(y.memoizedState===null){var st=y.alternate;if(st!==null){var Et=st.memoizedState;if(Et!==null){var Ct=Et.dehydrated;Ct!==null&&Gp(Ct)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Aa||y.flags&512&&NC(y)}catch(At){Mn(y,y.return,At)}}if(y===p){Jt=null;break}if(M=y.sibling,M!==null){M.return=y.return,Jt=M;break}Jt=y.return}}function EU(p){for(;Jt!==null;){var y=Jt;if(y===p){Jt=null;break}var M=y.sibling;if(M!==null){M.return=y.return,Jt=M;break}Jt=y.return}}function TU(p){for(;Jt!==null;){var y=Jt;try{switch(y.tag){case 0:case 11:case 15:var M=y.return;try{CS(4,y)}catch(Re){Mn(y,M,Re)}break;case 1:var R=y.stateNode;if(typeof R.componentDidMount=="function"){var B=y.return;try{R.componentDidMount()}catch(Re){Mn(y,B,Re)}}var H=y.return;try{NC(y)}catch(Re){Mn(y,H,Re)}break;case 5:var ne=y.return;try{NC(y)}catch(Re){Mn(y,ne,Re)}}}catch(Re){Mn(y,y.return,Re)}if(y===p){Jt=null;break}var Ae=y.sibling;if(Ae!==null){Ae.return=y.return,Jt=Ae;break}Jt=y.return}}var MJ=Math.ceil,PS=A.ReactCurrentDispatcher,kC=A.ReactCurrentOwner,Ml=A.ReactCurrentBatchConfig,fr=0,Os=null,Zn=null,na=0,nl=0,s0=an(0),gs=0,R1=null,wm=0,DS=0,VC=0,I1=null,To=null,HC=0,a0=1/0,Nh=null,RS=!1,GC=null,mf=null,IS=!1,gf=null,LS=0,L1=0,jC=null,OS=-1,zS=0;function Qa(){return(fr&6)!==0?Pt():OS!==-1?OS:OS=Pt()}function vf(p){return(p.mode&1)===0?1:(fr&2)!==0&&na!==0?na&-na:IC.transition!==null?(zS===0&&(zS=ya()),zS):(p=cr,p!==0||(p=window.event,p=p===void 0?16:eS(p.type)),p)}function vc(p,y,M,R){if(50<L1)throw L1=0,jC=null,Error(i(185));Fp(p,M,R),((fr&2)===0||p!==Os)&&(p===Os&&((fr&2)===0&&(DS|=M),gs===4&&yf(p,na)),Co(p,R),M===1&&fr===0&&(y.mode&1)===0&&(a0=Pt()+500,nm&&wl()))}function Co(p,y){var M=p.callbackNode;fn(p,y);var R=cs(p,p===Os?na:0);if(R===0)M!==null&&Rt(M),p.callbackNode=null,p.callbackPriority=0;else if(y=R&-R,p.callbackPriority!==y){if(M!=null&&Rt(M),y===1)p.tag===0?pS(PU.bind(null,p)):sm(PU.bind(null,p)),RC(function(){(fr&6)===0&&wl()}),M=null;else{switch(Gd(R)){case 1:M=ni;break;case 4:M=Lt;break;case 16:M=Zi;break;case 536870912:M=$i;break;default:M=Zi}M=NU(M,CU.bind(null,p))}p.callbackPriority=y,p.callbackNode=M}}function CU(p,y){if(OS=-1,zS=0,(fr&6)!==0)throw Error(i(327));var M=p.callbackNode;if(o0()&&p.callbackNode!==M)return null;var R=cs(p,p===Os?na:0);if(R===0)return null;if((R&30)!==0||(R&p.expiredLanes)!==0||y)y=BS(p,R);else{y=R;var B=fr;fr|=2;var H=RU();(Os!==p||na!==y)&&(Nh=null,a0=Pt()+500,_m(p,y));do try{TJ();break}catch(Ae){DU(p,Ae)}while(!0);Ph(),PS.current=H,fr=B,Zn!==null?y=0:(Os=null,na=0,y=gs)}if(y!==0){if(y===2&&(B=iu(p),B!==0&&(R=B,y=WC(p,B))),y===1)throw M=R1,_m(p,0),yf(p,R),Co(p,Pt()),M;if(y===6)yf(p,R);else{if(B=p.current.alternate,(R&30)===0&&!AJ(B)&&(y=BS(p,R),y===2&&(H=iu(p),H!==0&&(R=H,y=WC(p,H))),y===1))throw M=R1,_m(p,0),yf(p,R),Co(p,Pt()),M;switch(p.finishedWork=B,p.finishedLanes=R,y){case 0:case 1:throw Error(i(345));case 2:Sm(p,To,Nh);break;case 3:if(yf(p,R),(R&130023424)===R&&(y=HC+500-Pt(),10<y)){if(cs(p,0)!==0)break;if(B=p.suspendedLanes,(B&R)!==R){Qa(),p.pingedLanes|=p.suspendedLanes&B;break}p.timeoutHandle=a1(Sm.bind(null,p,To,Nh),y);break}Sm(p,To,Nh);break;case 4:if(yf(p,R),(R&4194240)===R)break;for(y=p.eventTimes,B=-1;0<R;){var ne=31-_e(R);H=1<<ne,ne=y[ne],ne>B&&(B=ne),R&=~H}if(R=B,R=Pt()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*MJ(R/1960))-R,10<R){p.timeoutHandle=a1(Sm.bind(null,p,To,Nh),R);break}Sm(p,To,Nh);break;case 5:Sm(p,To,Nh);break;default:throw Error(i(329))}}}return Co(p,Pt()),p.callbackNode===M?CU.bind(null,p):null}function WC(p,y){var M=I1;return p.current.memoizedState.isDehydrated&&(_m(p,y).flags|=256),p=BS(p,y),p!==2&&(y=To,To=M,y!==null&&XC(y)),p}function XC(p){To===null?To=p:To.push.apply(To,p)}function AJ(p){for(var y=p;;){if(y.flags&16384){var M=y.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var R=0;R<M.length;R++){var B=M[R],H=B.getSnapshot;B=B.value;try{if(!Va(H(),B))return!1}catch{return!1}}}if(M=y.child,y.subtreeFlags&16384&&M!==null)M.return=y,y=M;else{if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function yf(p,y){for(y&=~VC,y&=~DS,p.suspendedLanes|=y,p.pingedLanes&=~y,p=p.expirationTimes;0<y;){var M=31-_e(y),R=1<<M;p[M]=-1,y&=~R}}function PU(p){if((fr&6)!==0)throw Error(i(327));o0();var y=cs(p,0);if((y&1)===0)return Co(p,Pt()),null;var M=BS(p,y);if(p.tag!==0&&M===2){var R=iu(p);R!==0&&(y=R,M=WC(p,R))}if(M===1)throw M=R1,_m(p,0),yf(p,y),Co(p,Pt()),M;if(M===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=y,Sm(p,To,Nh),Co(p,Pt()),null}function qC(p,y){var M=fr;fr|=1;try{return p(y)}finally{fr=M,fr===0&&(a0=Pt()+500,nm&&wl())}}function bm(p){gf!==null&&gf.tag===0&&(fr&6)===0&&o0();var y=fr;fr|=1;var M=Ml.transition,R=cr;try{if(Ml.transition=null,cr=1,p)return p()}finally{cr=R,Ml.transition=M,fr=y,(fr&6)===0&&wl()}}function YC(){nl=s0.current,Br(s0)}function _m(p,y){p.finishedWork=null,p.finishedLanes=0;var M=p.timeoutHandle;if(M!==-1&&(p.timeoutHandle=-1,o1(M)),Zn!==null)for(M=Zn.return;M!==null;){var R=M;switch(oc(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&im();break;case 3:fu(),Br($s),Br(hs),_l();break;case 5:hf(R);break;case 4:fu();break;case 13:Br(Wr);break;case 19:Br(Wr);break;case 10:cm(R.type._context);break;case 22:case 23:YC()}M=M.return}if(Os=p,Zn=p=xf(p.current,null),na=nl=y,gs=0,R1=null,VC=DS=wm=0,To=I1=null,cc!==null){for(y=0;y<cc.length;y++)if(M=cc[y],R=M.interleaved,R!==null){M.interleaved=null;var B=R.next,H=M.pending;if(H!==null){var ne=H.next;H.next=B,R.next=ne}M.pending=R}cc=null}return p}function DU(p,y){do{var M=Zn;try{if(Ph(),Lh.current=i0,il){for(var R=Nr.memoizedState;R!==null;){var B=R.queue;B!==null&&(B.pending=null),R=R.next}il=!1}if(hc=0,ur=ln=Nr=null,Ls=!1,pu=0,kC.current=null,M===null||M.return===null){gs=1,R1=y,Zn=null;break}e:{var H=p,ne=M.return,Ae=M,Re=y;if(y=na,Ae.flags|=32768,Re!==null&&typeof Re=="object"&&typeof Re.then=="function"){var st=Re,Et=Ae,Ct=Et.tag;if((Et.mode&1)===0&&(Ct===0||Ct===11||Ct===15)){var At=Et.alternate;At?(Et.updateQueue=At.updateQueue,Et.memoizedState=At.memoizedState,Et.lanes=At.lanes):(Et.updateQueue=null,Et.memoizedState=null)}var Qt=Kt(ne);if(Qt!==null){Qt.flags&=-257,Ii(Qt,ne,Ae,H,y),Qt.mode&1&&It(H,st,y),y=Qt,Re=st;var ei=y.updateQueue;if(ei===null){var si=new Set;si.add(Re),y.updateQueue=si}else ei.add(Re);break e}else{if((y&1)===0){It(H,st,y),QC();break e}Re=Error(i(426))}}else if(jr&&Ae.mode&1){var On=Kt(ne);if(On!==null){(On.flags&65536)===0&&(On.flags|=256),Ii(On,ne,Ae,H,y),lf(O(Re,Ae));break e}}H=Re=O(Re,Ae),gs!==4&&(gs=2),I1===null?I1=[H]:I1.push(H),H=ne;do{switch(H.tag){case 3:H.flags|=65536,y&=-y,H.lanes|=y;var Ke=Fe(H,Re,y);Dh(H,Ke);break e;case 1:Ae=Re;var ze=H.type,tt=H.stateNode;if((H.flags&128)===0&&(typeof ze.getDerivedStateFromError=="function"||tt!==null&&typeof tt.componentDidCatch=="function"&&(mf===null||!mf.has(tt)))){H.flags|=65536,y&=-y,H.lanes|=y;var Ot=pt(H,Ae,y);Dh(H,Ot);break e}}H=H.return}while(H!==null)}LU(M)}catch(li){y=li,Zn===M&&M!==null&&(Zn=M=M.return);continue}break}while(!0)}function RU(){var p=PS.current;return PS.current=i0,p===null?i0:p}function QC(){(gs===0||gs===3||gs===2)&&(gs=4),Os===null||(wm&268435455)===0&&(DS&268435455)===0||yf(Os,na)}function BS(p,y){var M=fr;fr|=2;var R=RU();(Os!==p||na!==y)&&(Nh=null,_m(p,y));do try{EJ();break}catch(B){DU(p,B)}while(!0);if(Ph(),fr=M,PS.current=R,Zn!==null)throw Error(i(261));return Os=null,na=0,gs}function EJ(){for(;Zn!==null;)IU(Zn)}function TJ(){for(;Zn!==null&&!Xt();)IU(Zn)}function IU(p){var y=BU(p.alternate,p,nl);p.memoizedProps=p.pendingProps,y===null?LU(p):Zn=y,kC.current=null}function LU(p){var y=p;do{var M=y.alternate;if(p=y.return,(y.flags&32768)===0){if(M=xJ(M,y,nl),M!==null){Zn=M;return}}else{if(M=wJ(M,y),M!==null){M.flags&=32767,Zn=M;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{gs=6,Zn=null;return}}if(y=y.sibling,y!==null){Zn=y;return}Zn=y=p}while(y!==null);gs===0&&(gs=5)}function Sm(p,y,M){var R=cr,B=Ml.transition;try{Ml.transition=null,cr=1,CJ(p,y,M,R)}finally{Ml.transition=B,cr=R}return null}function CJ(p,y,M,R){do o0();while(gf!==null);if((fr&6)!==0)throw Error(i(327));M=p.finishedWork;var B=p.finishedLanes;if(M===null)return null;if(p.finishedWork=null,p.finishedLanes=0,M===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var H=M.lanes|M.childLanes;if(TC(p,H),p===Os&&(Zn=Os=null,na=0),(M.subtreeFlags&2064)===0&&(M.flags&2064)===0||IS||(IS=!0,NU(Zi,function(){return o0(),null})),H=(M.flags&15990)!==0,(M.subtreeFlags&15990)!==0||H){H=Ml.transition,Ml.transition=null;var ne=cr;cr=1;var Ae=fr;fr|=4,kC.current=null,_J(p,M),SU(M,p),Xn(n1),yo=!!sf,n1=sf=null,p.current=M,SJ(M),ri(),fr=Ae,cr=ne,Ml.transition=H}else p.current=M;if(IS&&(IS=!1,gf=p,LS=B),H=p.pendingLanes,H===0&&(mf=null),te(M.stateNode),Co(p,Pt()),y!==null)for(R=p.onRecoverableError,M=0;M<y.length;M++)B=y[M],R(B.value,{componentStack:B.stack,digest:B.digest});if(RS)throw RS=!1,p=GC,GC=null,p;return(LS&1)!==0&&p.tag!==0&&o0(),H=p.pendingLanes,(H&1)!==0?p===jC?L1++:(L1=0,jC=p):L1=0,wl(),null}function o0(){if(gf!==null){var p=Gd(LS),y=Ml.transition,M=cr;try{if(Ml.transition=null,cr=16>p?16:p,gf===null)var R=!1;else{if(p=gf,gf=null,LS=0,(fr&6)!==0)throw Error(i(331));var B=fr;for(fr|=4,Jt=p.current;Jt!==null;){var H=Jt,ne=H.child;if((Jt.flags&16)!==0){var Ae=H.deletions;if(Ae!==null){for(var Re=0;Re<Ae.length;Re++){var st=Ae[Re];for(Jt=st;Jt!==null;){var Et=Jt;switch(Et.tag){case 0:case 11:case 15:D1(8,Et,H)}var Ct=Et.child;if(Ct!==null)Ct.return=Et,Jt=Ct;else for(;Jt!==null;){Et=Jt;var At=Et.sibling,Qt=Et.return;if(yU(Et),Et===st){Jt=null;break}if(At!==null){At.return=Qt,Jt=At;break}Jt=Qt}}}var ei=H.alternate;if(ei!==null){var si=ei.child;if(si!==null){ei.child=null;do{var On=si.sibling;si.sibling=null,si=On}while(si!==null)}}Jt=H}}if((H.subtreeFlags&2064)!==0&&ne!==null)ne.return=H,Jt=ne;else e:for(;Jt!==null;){if(H=Jt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:D1(9,H,H.return)}var Ke=H.sibling;if(Ke!==null){Ke.return=H.return,Jt=Ke;break e}Jt=H.return}}var ze=p.current;for(Jt=ze;Jt!==null;){ne=Jt;var tt=ne.child;if((ne.subtreeFlags&2064)!==0&&tt!==null)tt.return=ne,Jt=tt;else e:for(ne=ze;Jt!==null;){if(Ae=Jt,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:CS(9,Ae)}}catch(li){Mn(Ae,Ae.return,li)}if(Ae===ne){Jt=null;break e}var Ot=Ae.sibling;if(Ot!==null){Ot.return=Ae.return,Jt=Ot;break e}Jt=Ae.return}}if(fr=B,wl(),Z&&typeof Z.onPostCommitFiberRoot=="function")try{Z.onPostCommitFiberRoot(lr,p)}catch{}R=!0}return R}finally{cr=M,Ml.transition=y}}return!1}function OU(p,y,M){y=O(M,y),y=Fe(p,y,1),p=Qr(p,y,1),y=Qa(),p!==null&&(Fp(p,1,y),Co(p,y))}function Mn(p,y,M){if(p.tag===3)OU(p,p,M);else for(;y!==null;){if(y.tag===3){OU(y,p,M);break}else if(y.tag===1){var R=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(mf===null||!mf.has(R))){p=O(M,p),p=pt(y,p,1),y=Qr(y,p,1),p=Qa(),y!==null&&(Fp(y,1,p),Co(y,p));break}}y=y.return}}function PJ(p,y,M){var R=p.pingCache;R!==null&&R.delete(y),y=Qa(),p.pingedLanes|=p.suspendedLanes&M,Os===p&&(na&M)===M&&(gs===4||gs===3&&(na&130023424)===na&&500>Pt()-HC?_m(p,0):VC|=M),Co(p,y)}function zU(p,y){y===0&&((p.mode&1)===0?y=1:(y=Gr,Gr<<=1,(Gr&130023424)===0&&(Gr=4194304)));var M=Qa();p=el(p,y),p!==null&&(Fp(p,y,M),Co(p,M))}function DJ(p){var y=p.memoizedState,M=0;y!==null&&(M=y.retryLane),zU(p,M)}function RJ(p,y){var M=0;switch(p.tag){case 13:var R=p.stateNode,B=p.memoizedState;B!==null&&(M=B.retryLane);break;case 19:R=p.stateNode;break;default:throw Error(i(314))}R!==null&&R.delete(y),zU(p,M)}var BU;BU=function(p,y,M){if(p!==null)if(p.memoizedProps!==y.pendingProps||$s.current)Hi=!0;else{if((p.lanes&M)===0&&(y.flags&128)===0)return Hi=!1,yJ(p,y,M);Hi=(p.flags&131072)!==0}else Hi=!1,jr&&(y.flags&1048576)!==0&&d1(y,Xv,y.index);switch(y.lanes=0,y.tag){case 2:var R=y.type;ES(p,y),p=y.pendingProps;var B=_h(y,hs.current);du(y,M),B=pm(null,y,R,p,B,M);var H=w1();return y.flags|=1,typeof B=="object"&&B!==null&&typeof B.render=="function"&&B.$$typeof===void 0?(y.tag=1,y.memoizedState=null,y.updateQueue=null,Rs(R)?(H=!0,Sh(y)):H=!1,y.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,ki(y),B.updater=r0,y.stateNode=B,B._reactInternals=y,D(y,R,p,M),y=Ni(null,y,R,!0,H,M)):(y.tag=0,jr&&H&&f1(y),jt(null,y,B,M),y=y.child),y;case 16:R=y.elementType;e:{switch(ES(p,y),p=y.pendingProps,B=R._init,R=B(R._payload),y.type=R,B=y.tag=LJ(R),p=Eo(R,p),B){case 0:y=Ht(null,y,R,p,M);break e;case 1:y=ai(null,y,R,p,M);break e;case 11:y=ms(null,y,R,p,M);break e;case 14:y=Ya(null,y,R,Eo(R.type,p),M);break e}throw Error(i(306,R,""))}return y;case 0:return R=y.type,B=y.pendingProps,B=y.elementType===R?B:Eo(R,B),Ht(p,y,R,B,M);case 1:return R=y.type,B=y.pendingProps,B=y.elementType===R?B:Eo(R,B),ai(p,y,R,B,M);case 3:e:{if(Li(y),p===null)throw Error(i(387));R=y.pendingProps,H=y.memoizedState,B=H.element,mn(p,y),on(y,R,null,M);var ne=y.memoizedState;if(R=ne.element,H.isDehydrated)if(H={element:R,isDehydrated:!1,cache:ne.cache,pendingSuspenseBoundaries:ne.pendingSuspenseBoundaries,transitions:ne.transitions},y.updateQueue.baseState=H,y.memoizedState=H,y.flags&256){B=O(Error(i(423)),y),y=sr(p,y,R,M,B);break e}else if(R!==B){B=O(Error(i(424)),y),y=sr(p,y,R,M,B);break e}else for(ta=ic(y.stateNode.containerInfo.firstChild),ds=y,jr=!0,Ao=null,M=lm(y,null,R,M),y.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(hu(),R===B){y=Bh(p,y,M);break e}jt(p,y,R,M)}y=y.child}return y;case 5:return Ih(y),p===null&&Yv(y),R=y.type,B=y.pendingProps,H=p!==null?p.memoizedProps:null,ne=B.children,s1(R,B)?ne=null:H!==null&&s1(R,H)&&(y.flags|=32),ht(p,y),jt(p,y,ne,M),y.child;case 6:return p===null&&Yv(y),null;case 13:return pc(p,y,M);case 4:return dm(y,y.stateNode.containerInfo),R=y.pendingProps,p===null?y.child=Eh(y,null,R,M):jt(p,y,R,M),y.child;case 11:return R=y.type,B=y.pendingProps,B=y.elementType===R?B:Eo(R,B),ms(p,y,R,B,M);case 7:return jt(p,y,y.pendingProps,M),y.child;case 8:return jt(p,y,y.pendingProps.children,M),y.child;case 12:return jt(p,y,y.pendingProps.children,M),y.child;case 10:e:{if(R=y.type._context,B=y.pendingProps,H=y.memoizedProps,ne=B.value,Ar(Th,R._currentValue),R._currentValue=ne,H!==null)if(Va(H.value,ne)){if(H.children===B.children&&!$s.current){y=Bh(p,y,M);break e}}else for(H=y.child,H!==null&&(H.return=y);H!==null;){var Ae=H.dependencies;if(Ae!==null){ne=H.child;for(var Re=Ae.firstContext;Re!==null;){if(Re.context===R){if(H.tag===1){Re=_r(-1,M&-M),Re.tag=2;var st=H.updateQueue;if(st!==null){st=st.shared;var Et=st.pending;Et===null?Re.next=Re:(Re.next=Et.next,Et.next=Re),st.pending=Re}}H.lanes|=M,Re=H.alternate,Re!==null&&(Re.lanes|=M),um(H.return,M,y),Ae.lanes|=M;break}Re=Re.next}}else if(H.tag===10)ne=H.type===y.type?null:H.child;else if(H.tag===18){if(ne=H.return,ne===null)throw Error(i(341));ne.lanes|=M,Ae=ne.alternate,Ae!==null&&(Ae.lanes|=M),um(ne,M,y),ne=H.sibling}else ne=H.child;if(ne!==null)ne.return=H;else for(ne=H;ne!==null;){if(ne===y){ne=null;break}if(H=ne.sibling,H!==null){H.return=ne.return,ne=H;break}ne=ne.return}H=ne}jt(p,y,B.children,M),y=y.child}return y;case 9:return B=y.type,R=y.pendingProps.children,du(y,M),B=ja(B),R=R(B),y.flags|=1,jt(p,y,R,M),y.child;case 14:return R=y.type,B=Eo(R,y.pendingProps),B=Eo(R.type,B),Ya(p,y,R,B,M);case 15:return it(p,y,y.type,y.pendingProps,M);case 17:return R=y.type,B=y.pendingProps,B=y.elementType===R?B:Eo(R,B),ES(p,y),y.tag=1,Rs(R)?(p=!0,Sh(y)):p=!1,du(y,M),w(y,R,B),D(y,R,B,M),Ni(null,y,R,!0,p,M);case 19:return fU(p,y,M);case 22:return He(p,y,M)}throw Error(i(156,y.tag))};function NU(p,y){return Ue(p,y)}function IJ(p,y,M,R){this.tag=p,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Al(p,y,M,R){return new IJ(p,y,M,R)}function ZC(p){return p=p.prototype,!(!p||!p.isReactComponent)}function LJ(p){if(typeof p=="function")return ZC(p)?1:0;if(p!=null){if(p=p.$$typeof,p===F)return 11;if(p===q)return 14}return 2}function xf(p,y){var M=p.alternate;return M===null?(M=Al(p.tag,y,p.key,p.mode),M.elementType=p.elementType,M.type=p.type,M.stateNode=p.stateNode,M.alternate=p,p.alternate=M):(M.pendingProps=y,M.type=p.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=p.flags&14680064,M.childLanes=p.childLanes,M.lanes=p.lanes,M.child=p.child,M.memoizedProps=p.memoizedProps,M.memoizedState=p.memoizedState,M.updateQueue=p.updateQueue,y=p.dependencies,M.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},M.sibling=p.sibling,M.index=p.index,M.ref=p.ref,M}function NS(p,y,M,R,B,H){var ne=2;if(R=p,typeof p=="function")ZC(p)&&(ne=1);else if(typeof p=="string")ne=5;else e:switch(p){case I:return Mm(M.children,B,H,y);case P:ne=8,B|=8;break;case C:return p=Al(12,M,y,B|2),p.elementType=C,p.lanes=H,p;case G:return p=Al(13,M,y,B),p.elementType=G,p.lanes=H,p;case N:return p=Al(19,M,y,B),p.elementType=N,p.lanes=H,p;case Q:return US(M,B,H,y);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case L:ne=10;break e;case z:ne=9;break e;case F:ne=11;break e;case q:ne=14;break e;case ie:ne=16,R=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return y=Al(ne,M,y,B),y.elementType=p,y.type=R,y.lanes=H,y}function Mm(p,y,M,R){return p=Al(7,p,R,y),p.lanes=M,p}function US(p,y,M,R){return p=Al(22,p,R,y),p.elementType=Q,p.lanes=M,p.stateNode={isHidden:!1},p}function KC(p,y,M){return p=Al(6,p,null,y),p.lanes=M,p}function JC(p,y,M){return y=Al(4,p.children!==null?p.children:[],p.key,y),y.lanes=M,y.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},y}function OJ(p,y,M,R,B){this.tag=y,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vd(0),this.expirationTimes=Vd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vd(0),this.identifierPrefix=R,this.onRecoverableError=B,this.mutableSourceEagerHydrationData=null}function $C(p,y,M,R,B,H,ne,Ae,Re){return p=new OJ(p,y,M,Ae,Re),y===1?(y=1,H===!0&&(y|=8)):y=0,H=Al(3,null,null,y),p.current=H,H.stateNode=p,H.memoizedState={element:R,isDehydrated:M,cache:null,transitions:null,pendingSuspenseBoundaries:null},ki(H),p}function zJ(p,y,M){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:R==null?null:""+R,children:p,containerInfo:y,implementation:M}}function UU(p){if(!p)return nc;p=p._reactInternals;e:{if(oi(p)!==p||p.tag!==1)throw Error(i(170));var y=p;do{switch(y.tag){case 3:y=y.stateNode.context;break e;case 1:if(Rs(y.type)){y=y.stateNode.__reactInternalMemoizedMergedChildContext;break e}}y=y.return}while(y!==null);throw Error(i(171))}if(p.tag===1){var M=p.type;if(Rs(M))return rm(p,M,y)}return y}function FU(p,y,M,R,B,H,ne,Ae,Re){return p=$C(M,R,!0,p,B,H,ne,Ae,Re),p.context=UU(null),M=p.current,R=Qa(),B=vf(M),H=_r(R,B),H.callback=y??null,Qr(M,H,B),p.current.lanes=B,Fp(p,B,R),Co(p,R),p}function FS(p,y,M,R){var B=y.current,H=Qa(),ne=vf(B);return M=UU(M),y.context===null?y.context=M:y.pendingContext=M,y=_r(H,ne),y.payload={element:p},R=R===void 0?null:R,R!==null&&(y.callback=R),p=Qr(B,y,ne),p!==null&&(vc(p,B,ne,H),Is(p,B,ne)),ne}function kS(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function kU(p,y){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var M=p.retryLane;p.retryLane=M!==0&&M<y?M:y}}function eP(p,y){kU(p,y),(p=p.alternate)&&kU(p,y)}function BJ(){return null}var VU=typeof reportError=="function"?reportError:function(p){console.error(p)};function tP(p){this._internalRoot=p}VS.prototype.render=tP.prototype.render=function(p){var y=this._internalRoot;if(y===null)throw Error(i(409));FS(p,y,null,null)},VS.prototype.unmount=tP.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var y=p.containerInfo;bm(function(){FS(null,p,null,null)}),y[Ga]=null}};function VS(p){this._internalRoot=p}VS.prototype.unstable_scheduleHydration=function(p){if(p){var y=hv();p={blockedOn:null,target:p,priority:y};for(var M=0;M<ru.length&&y!==0&&y<ru[M].priority;M++);ru.splice(M,0,p),M===0&&pv(p)}};function iP(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function HS(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function HU(){}function NJ(p,y,M,R,B){if(B){if(typeof R=="function"){var H=R;R=function(){var st=kS(ne);H.call(st)}}var ne=FU(y,R,p,0,null,!1,!1,"",HU);return p._reactRootContainer=ne,p[Ga]=ne.current,rf(p.nodeType===8?p.parentNode:p),bm(),ne}for(;B=p.lastChild;)p.removeChild(B);if(typeof R=="function"){var Ae=R;R=function(){var st=kS(Re);Ae.call(st)}}var Re=$C(p,0,!1,null,null,!1,!1,"",HU);return p._reactRootContainer=Re,p[Ga]=Re.current,rf(p.nodeType===8?p.parentNode:p),bm(function(){FS(y,Re,M,R)}),Re}function GS(p,y,M,R,B){var H=M._reactRootContainer;if(H){var ne=H;if(typeof B=="function"){var Ae=B;B=function(){var Re=kS(ne);Ae.call(Re)}}FS(y,ne,p,B)}else ne=NJ(M,y,p,B,R);return kS(ne)}kp=function(p){switch(p.tag){case 3:var y=p.stateNode;if(y.current.memoizedState.isDehydrated){var M=gr(y.pendingLanes);M!==0&&(Hd(y,M|1),Co(y,Pt()),(fr&6)===0&&(a0=Pt()+500,wl()))}break;case 13:bm(function(){var R=el(p,1);if(R!==null){var B=Qa();vc(R,p,1,B)}}),eP(p,1)}},Vx=function(p){if(p.tag===13){var y=el(p,134217728);if(y!==null){var M=Qa();vc(y,p,134217728,M)}eP(p,134217728)}},$_=function(p){if(p.tag===13){var y=vf(p),M=el(p,y);if(M!==null){var R=Qa();vc(M,p,y,R)}eP(p,y)}},hv=function(){return cr},dv=function(p,y){var M=cr;try{return cr=p,y()}finally{cr=M}},Ne=function(p,y,M){switch(y){case"input":if(lt(p,M),y=M.name,M.type==="radio"&&y!=null){for(M=p;M.parentNode;)M=M.parentNode;for(M=M.querySelectorAll("input[name="+JSON.stringify(""+y)+'][type="radio"]'),y=0;y<M.length;y++){var R=M[y];if(R!==p&&R.form===p.form){var B=Gv(R);if(!B)throw Error(i(90));ae(R),lt(R,B)}}}break;case"textarea":X(p,M);break;case"select":y=M.value,y!=null&&Mt(p,!!M.multiple,y,!1)}},Ft=qC,ui=bm;var UJ={usingClientEntryPoint:!1,Events:[rc,pn,Gv,Ze,bt,qC]},O1={findFiberByHostInstance:uu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FJ={bundleType:O1.bundleType,version:O1.version,rendererPackageName:O1.rendererPackageName,rendererConfig:O1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:A.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=ke(p),p===null?null:p.stateNode},findFiberByHostInstance:O1.findFiberByHostInstance||BJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jS.isDisabled&&jS.supportsFiber)try{lr=jS.inject(FJ),Z=jS}catch{}}return Po.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=UJ,Po.createPortal=function(p,y){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iP(y))throw Error(i(200));return zJ(p,y,null,M)},Po.createRoot=function(p,y){if(!iP(p))throw Error(i(299));var M=!1,R="",B=VU;return y!=null&&(y.unstable_strictMode===!0&&(M=!0),y.identifierPrefix!==void 0&&(R=y.identifierPrefix),y.onRecoverableError!==void 0&&(B=y.onRecoverableError)),y=$C(p,1,!1,null,null,M,!1,R,B),p[Ga]=y.current,rf(p.nodeType===8?p.parentNode:p),new tP(y)},Po.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var y=p._reactInternals;if(y===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=ke(y),p=p===null?null:p.stateNode,p},Po.flushSync=function(p){return bm(p)},Po.hydrate=function(p,y,M){if(!HS(y))throw Error(i(200));return GS(null,p,y,!0,M)},Po.hydrateRoot=function(p,y,M){if(!iP(p))throw Error(i(405));var R=M!=null&&M.hydratedSources||null,B=!1,H="",ne=VU;if(M!=null&&(M.unstable_strictMode===!0&&(B=!0),M.identifierPrefix!==void 0&&(H=M.identifierPrefix),M.onRecoverableError!==void 0&&(ne=M.onRecoverableError)),y=FU(y,null,p,1,M??null,B,!1,H,ne),p[Ga]=y.current,rf(p),R)for(p=0;p<R.length;p++)M=R[p],B=M._getVersion,B=B(M._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[M,B]:y.mutableSourceEagerHydrationData.push(M,B);return new VS(y)},Po.render=function(p,y,M){if(!HS(y))throw Error(i(200));return GS(null,p,y,!1,M)},Po.unmountComponentAtNode=function(p){if(!HS(p))throw Error(i(40));return p._reactRootContainer?(bm(function(){GS(null,null,p,!1,function(){p._reactRootContainer=null,p[Ga]=null})}),!0):!1},Po.unstable_batchedUpdates=qC,Po.unstable_renderSubtreeIntoContainer=function(p,y,M,R){if(!HS(M))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return GS(p,y,M,!1,R)},Po.version="18.3.1-next-f1338f8080-20240426",Po}var ZU;function ZJ(){if(ZU)return sP.exports;ZU=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),sP.exports=QJ(),sP.exports}var KU;function KJ(){if(KU)return XS;KU=1;var e=ZJ();return XS.createRoot=e.createRoot,XS.hydrateRoot=e.hydrateRoot,XS}var ZW=KJ();const JJ=Cp(ZW);/**
 * @remix-run/router v1.7.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wb(){return wb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},wb.apply(this,arguments)}var cg;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(cg||(cg={}));const JU="popstate";function $J(e){e===void 0&&(e={});function t(r,n){let{pathname:s,search:a,hash:o}=r.location;return zR("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:HE(n)}return t$(t,i,null,e)}function jc(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function e$(){return Math.random().toString(36).substr(2,8)}function $U(e,t){return{usr:e.state,key:e.key,idx:t}}function zR(e,t,i,r){return i===void 0&&(i=null),wb({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?d2(t):t,{state:i,key:t&&t.key||r||e$()})}function HE(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function d2(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function t$(e,t,i,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o=cg.Pop,l=null,c=u();c==null&&(c=0,a.replaceState(wb({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function h(){o=cg.Pop;let g=u(),x=g==null?null:g-c;c=g,l&&l({action:o,location:v.location,delta:x})}function d(g,x){o=cg.Push;let S=zR(v.location,g,x);c=u()+1;let _=$U(S,c),A=v.createHref(S);try{a.pushState(_,"",A)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;n.location.assign(A)}s&&l&&l({action:o,location:v.location,delta:1})}function f(g,x){o=cg.Replace;let S=zR(v.location,g,x);c=u();let _=$U(S,c),A=v.createHref(S);a.replaceState(_,"",A),s&&l&&l({action:o,location:v.location,delta:0})}function m(g){let x=n.location.origin!=="null"?n.location.origin:n.location.href,S=typeof g=="string"?g:HE(g);return jc(x,"No window.location.(origin|href) available to create URL for href: "+S),new URL(S,x)}let v={get action(){return o},get location(){return e(n,a)},listen(g){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(JU,h),l=g,()=>{n.removeEventListener(JU,h),l=null}},createHref(g){return t(n,g)},createURL:m,encodeLocation(g){let x=m(g);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:d,replace:f,go(g){return a.go(g)}};return v}var eF;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(eF||(eF={}));function KW(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}function i$(e,t){t===void 0&&(t="/");let{pathname:i,search:r="",hash:n=""}=typeof e=="string"?d2(e):e;return{pathname:i?i.startsWith("/")?i:r$(i,t):t,search:n$(r),hash:s$(n)}}function r$(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function lP(e,t,i,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function JW(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function $W(e,t,i,r){r===void 0&&(r=!1);let n;typeof e=="string"?n=d2(e):(n=wb({},e),jc(!n.pathname||!n.pathname.includes("?"),lP("?","pathname","search",n)),jc(!n.pathname||!n.pathname.includes("#"),lP("#","pathname","hash",n)),jc(!n.search||!n.search.includes("#"),lP("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(r||a==null)o=i;else{let h=t.length-1;if(a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;n.pathname=d.join("/")}o=h>=0?t[h]:"/"}let l=i$(n,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const e8=e=>e.join("/").replace(/\/\/+/g,"/"),n$=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,s$=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,t8=["post","put","patch","delete"];new Set(t8);const a$=["get",...t8];new Set(a$);/**
 * React Router v6.14.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function BR(){return BR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},BR.apply(this,arguments)}const i8=Se.createContext(null),y_=Se.createContext(null),sz=Se.createContext(null),f2=Se.createContext({outlet:null,matches:[],isDataRoute:!1});function o$(e,t){let{relative:i}=t===void 0?{}:t;p2()||jc(!1);let{basename:r,navigator:n}=Se.useContext(y_),{hash:s,pathname:a,search:o}=n8(e,{relative:i}),l=a;return r!=="/"&&(l=a==="/"?r:e8([r,a])),n.createHref({pathname:l,search:o,hash:s})}function p2(){return Se.useContext(sz)!=null}function az(){return p2()||jc(!1),Se.useContext(sz).location}function r8(e){Se.useContext(y_).static||Se.useLayoutEffect(e)}function l$(){let{isDataRoute:e}=Se.useContext(f2);return e?f$():c$()}function c$(){p2()||jc(!1);let e=Se.useContext(i8),{basename:t,navigator:i}=Se.useContext(y_),{matches:r}=Se.useContext(f2),{pathname:n}=az(),s=JSON.stringify(JW(r).map(l=>l.pathnameBase)),a=Se.useRef(!1);return r8(()=>{a.current=!0}),Se.useCallback(function(l,c){if(c===void 0&&(c={}),!a.current)return;if(typeof l=="number"){i.go(l);return}let u=$W(l,JSON.parse(s),n,c.relative==="path");e==null&&t!=="/"&&(u.pathname=u.pathname==="/"?t:e8([t,u.pathname])),(c.replace?i.replace:i.push)(u,c.state,c)},[t,i,s,n,e])}function n8(e,t){let{relative:i}=t===void 0?{}:t,{matches:r}=Se.useContext(f2),{pathname:n}=az(),s=JSON.stringify(JW(r).map(a=>a.pathnameBase));return Se.useMemo(()=>$W(e,JSON.parse(s),n,i==="path"),[e,s,n,i])}var NR;(function(e){e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate"})(NR||(NR={}));var UR;(function(e){e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId"})(UR||(UR={}));function u$(e){let t=Se.useContext(i8);return t||jc(!1),t}function h$(e){let t=Se.useContext(f2);return t||jc(!1),t}function d$(e){let t=h$(),i=t.matches[t.matches.length-1];return i.route.id||jc(!1),i.route.id}function f$(){let{router:e}=u$(NR.UseNavigateStable),t=d$(UR.UseNavigateStable),i=Se.useRef(!1);return r8(()=>{i.current=!0}),Se.useCallback(function(n,s){s===void 0&&(s={}),i.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,BR({fromRouteId:t},s)))},[e,t])}function p$(e){let{basename:t="/",children:i=null,location:r,navigationType:n=cg.Pop,navigator:s,static:a=!1}=e;p2()&&jc(!1);let o=t.replace(/^\/*/,"/"),l=Se.useMemo(()=>({basename:o,navigator:s,static:a}),[o,s,a]);typeof r=="string"&&(r=d2(r));let{pathname:c="/",search:u="",hash:h="",state:d=null,key:f="default"}=r,m=Se.useMemo(()=>{let v=KW(c,o);return v==null?null:{location:{pathname:v,search:u,hash:h,state:d,key:f},navigationType:n}},[o,c,u,h,d,f,n]);return m==null?null:Se.createElement(y_.Provider,{value:l},Se.createElement(sz.Provider,{children:i,value:m}))}var tF;(function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"})(tF||(tF={}));new Promise(()=>{});/**
 * React Router DOM v6.14.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function FR(){return FR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},FR.apply(this,arguments)}function m$(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function g$(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function v$(e,t){return e.button===0&&(!t||t==="_self")&&!g$(e)}const y$=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],x$="startTransition",iF=XJ[x$];function w$(e){let{basename:t,children:i,future:r,window:n}=e,s=Se.useRef();s.current==null&&(s.current=$J({window:n,v5Compat:!0}));let a=s.current,[o,l]=Se.useState({action:a.action,location:a.location}),{v7_startTransition:c}=r||{},u=Se.useCallback(h=>{c&&iF?iF(()=>l(h)):l(h)},[l,c]);return Se.useLayoutEffect(()=>a.listen(u),[a,u]),Se.createElement(p$,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:a})}const b$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",_$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,S$=Se.forwardRef(function(t,i){let{onClick:r,relative:n,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u}=t,h=m$(t,y$),{basename:d}=Se.useContext(y_),f,m=!1;if(typeof c=="string"&&_$.test(c)&&(f=c,b$))try{let S=new URL(window.location.href),_=c.startsWith("//")?new URL(S.protocol+c):new URL(c),A=KW(_.pathname,d);_.origin===S.origin&&A!=null?c=A+_.search+_.hash:m=!0}catch{}let v=o$(c,{relative:n}),g=M$(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:n});function x(S){r&&r(S),S.defaultPrevented||g(S)}return Se.createElement("a",FR({},h,{href:f||v,onClick:m||s?r:x,ref:i,target:l}))});var rF;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher"})(rF||(rF={}));var nF;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(nF||(nF={}));function M$(e,t){let{target:i,replace:r,state:n,preventScrollReset:s,relative:a}=t===void 0?{}:t,o=l$(),l=az(),c=n8(e,{relative:a});return Se.useCallback(u=>{if(v$(u,i)){u.preventDefault();let h=r!==void 0?r:HE(l)===HE(c);o(e,{replace:h,state:n,preventScrollReset:s,relative:a})}},[l,o,c,r,n,i,e,s,a])}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const x_="159",Xm={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},qm={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s8=0,kR=1,a8=2,A$=3,o8=0,m2=1,Xw=2,Ic=3,Pd=0,uo=1,Oc=2,E$=2,Md=0,Mg=1,VR=2,HR=3,GR=4,l8=5,Yf=100,c8=101,u8=102,jR=103,WR=104,h8=200,d8=201,f8=202,p8=203,GE=204,jE=205,m8=206,g8=207,v8=208,y8=209,x8=210,w8=211,b8=212,_8=213,S8=214,M8=0,A8=1,E8=2,bb=3,T8=4,C8=5,P8=6,D8=7,w_=0,R8=1,I8=2,ku=0,L8=1,O8=2,z8=3,oz=4,B8=5,XR="attached",N8="detached",g2=300,Dd=301,xp=302,_b=303,Sb=304,yx=306,Mb=1e3,Ia=1001,Ab=1002,Fn=1003,WE=1004,T$=1004,qw=1005,C$=1005,kn=1006,lz=1007,P$=1007,wp=1008,D$=1008,Vu=1009,U8=1010,F8=1011,v2=1012,cz=1013,gd=1014,Nc=1015,Qy=1016,uz=1017,hz=1018,up=1020,k8=1021,so=1023,V8=1024,H8=1025,hp=1026,Ug=1027,G8=1028,dz=1029,j8=1030,fz=1031,pz=1033,mE=33776,gE=33777,vE=33778,yE=33779,qR=35840,YR=35841,QR=35842,ZR=35843,mz=36196,KR=37492,JR=37496,$R=37808,eI=37809,tI=37810,iI=37811,rI=37812,nI=37813,sI=37814,aI=37815,oI=37816,lI=37817,cI=37818,uI=37819,hI=37820,dI=37821,xE=36492,fI=36494,pI=36495,W8=36283,mI=36284,gI=36285,vI=36286,X8=2200,q8=2201,Y8=2202,Eb=2300,Tb=2301,wE=2302,ug=2400,hg=2401,Cb=2402,y2=2500,gz=2501,R$=0,I$=1,L$=2,vz=3e3,dp=3001,Q8=3200,Z8=3201,Pp=0,K8=1,hl="",bs="srgb",Qu="srgb-linear",x2="display-p3",b_="display-p3-linear",Pb="linear",Kr="srgb",Db="rec709",Rb="p3",O$=0,Ym=7680,z$=7681,B$=7682,N$=7683,U$=34055,F$=34056,k$=5386,V$=512,H$=513,G$=514,j$=515,W$=516,X$=517,q$=518,yI=519,J8=512,$8=513,e9=514,yz=515,t9=516,i9=517,r9=518,n9=519,Ib=35044,Ag=35048,Y$=35040,Q$=35045,Z$=35049,K$=35041,J$=35046,$$=35050,eee=35042,tee="100",xI="300 es",XE=1035,Uc=2e3,Zy=2001;let Ud=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}};const Ea=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let sF=1234567;const Eg=Math.PI/180,Ky=180/Math.PI;function fl(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ea[e&255]+Ea[e>>8&255]+Ea[e>>16&255]+Ea[e>>24&255]+"-"+Ea[t&255]+Ea[t>>8&255]+"-"+Ea[t>>16&15|64]+Ea[t>>24&255]+"-"+Ea[i&63|128]+Ea[i>>8&255]+"-"+Ea[i>>16&255]+Ea[i>>24&255]+Ea[r&255]+Ea[r>>8&255]+Ea[r>>16&255]+Ea[r>>24&255]).toLowerCase()}function Cn(e,t,i){return Math.max(t,Math.min(i,e))}function xz(e,t){return(e%t+t)%t}function iee(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function ree(e,t,i){return e!==t?(i-e)/(t-e):0}function Yw(e,t,i){return(1-i)*e+i*t}function nee(e,t,i,r){return Yw(e,t,1-Math.exp(-i*r))}function see(e,t=1){return t-Math.abs(xz(e,t*2)-t)}function aee(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function oee(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function lee(e,t){return e+Math.floor(Math.random()*(t-e+1))}function cee(e,t){return e+Math.random()*(t-e)}function uee(e){return e*(.5-Math.random())}function hee(e){e!==void 0&&(sF=e);let t=sF+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function dee(e){return e*Eg}function fee(e){return e*Ky}function wI(e){return(e&e-1)===0&&e!==0}function pee(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function qE(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function mee(e,t,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),f=s((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*m,l*f,o*c);break;case"YXY":e.set(l*f,o*u,l*m,o*c);break;case"ZYZ":e.set(l*m,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function No(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Xi(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const s9={DEG2RAD:Eg,RAD2DEG:Ky,generateUUID:fl,clamp:Cn,euclideanModulo:xz,mapLinear:iee,inverseLerp:ree,lerp:Yw,damp:nee,pingpong:see,smoothstep:aee,smootherstep:oee,randInt:lee,randFloat:cee,randFloatSpread:uee,seededRandom:hee,degToRad:dee,radToDeg:fee,isPowerOfTwo:wI,ceilPowerOfTwo:pee,floorPowerOfTwo:qE,setQuaternionFromProperEuler:mee,normalize:Xi,denormalize:No};class yt{constructor(t=0,i=0){yt.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Cn(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Yi{constructor(t,i,r,n,s,a,o,l,c){Yi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c)}set(t,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],f=r[5],m=r[8],v=n[0],g=n[3],x=n[6],S=n[1],_=n[4],A=n[7],T=n[2],E=n[5],I=n[8];return s[0]=a*v+o*S+l*T,s[3]=a*g+o*_+l*E,s[6]=a*x+o*A+l*I,s[1]=c*v+u*S+h*T,s[4]=c*g+u*_+h*E,s[7]=c*x+u*A+h*I,s[2]=d*v+f*S+m*T,s[5]=d*g+f*_+m*E,s[8]=d*x+f*A+m*I,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,d=o*l-u*s,f=c*s-a*l,m=i*h+r*d+n*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return t[0]=h*v,t[1]=(n*c-u*r)*v,t[2]=(o*r-n*a)*v,t[3]=d*v,t[4]=(u*i-n*l)*v,t[5]=(n*s-o*i)*v,t[6]=f*v,t[7]=(r*l-c*i)*v,t[8]=(a*i-r*s)*v,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+t,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(cP.makeScale(t,i)),this}rotate(t){return this.premultiply(cP.makeRotation(-t)),this}translate(t,i){return this.premultiply(cP.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const cP=new Yi;function a9(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const gee={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function vy(e,t){return new gee[e](t)}function Lb(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function o9(){const e=Lb("canvas");return e.style.display="block",e}const aF={};function Qw(e){e in aF||(aF[e]=!0,console.warn(e))}const oF=new Yi().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),lF=new Yi().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),qS={[Qu]:{transfer:Pb,primaries:Db,toReference:e=>e,fromReference:e=>e},[bs]:{transfer:Kr,primaries:Db,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[b_]:{transfer:Pb,primaries:Rb,toReference:e=>e.applyMatrix3(lF),fromReference:e=>e.applyMatrix3(oF)},[x2]:{transfer:Kr,primaries:Rb,toReference:e=>e.convertSRGBToLinear().applyMatrix3(lF),fromReference:e=>e.applyMatrix3(oF).convertLinearToSRGB()}},vee=new Set([Qu,b_]),Tr={enabled:!0,_workingColorSpace:Qu,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!vee.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,i){if(this.enabled===!1||t===i||!t||!i)return e;const r=qS[t].toReference,n=qS[i].fromReference;return n(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return qS[e].primaries},getTransfer:function(e){return e===hl?Pb:qS[e].transfer}};function Ly(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function uP(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}let l0;class wz{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{l0===void 0&&(l0=Lb("canvas")),l0.width=t.width,l0.height=t.height;const r=l0.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),i=l0}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=Lb("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Ly(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(t.data){const i=t.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Ly(i[r]/255)*255):i[r]=Ly(i[r]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let yee=0;class dg{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:yee++}),this.uuid=fl(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(hP(n[a].image)):s.push(hP(n[a]))}else s=hP(n);r.url=s}return i||(t.images[this.uuid]=r),r}}function hP(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?wz.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let xee=0;class dn extends Ud{constructor(t=dn.DEFAULT_IMAGE,i=dn.DEFAULT_MAPPING,r=Ia,n=Ia,s=kn,a=wp,o=so,l=Vu,c=dn.DEFAULT_ANISOTROPY,u=hl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xee++}),this.uuid=fl(),this.name="",this.source=new dg(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new yt(0,0),this.repeat=new yt(1,1),this.center=new yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Yi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Qw("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===dp?bs:hl),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==g2)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Mb:t.x=t.x-Math.floor(t.x);break;case Ia:t.x=t.x<0?0:1;break;case Ab:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Mb:t.y=t.y-Math.floor(t.y);break;case Ia:t.y=t.y<0?0:1;break;case Ab:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Qw("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===bs?dp:vz}set encoding(t){Qw("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===dp?bs:hl}}dn.DEFAULT_IMAGE=null;dn.DEFAULT_MAPPING=g2;dn.DEFAULT_ANISOTROPY=1;class Pr{constructor(t=0,i=0,r=0,n=1){Pr.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s;const l=t.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],m=l[9],v=l[2],g=l[6],x=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(m+g)<.1&&Math.abs(c+f+x-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const _=(c+1)/2,A=(f+1)/2,T=(x+1)/2,E=(u+d)/4,I=(h+v)/4,P=(m+g)/4;return _>A&&_>T?_<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(_),n=E/r,s=I/r):A>T?A<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(A),r=E/n,s=P/n):T<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(T),r=I/s,n=P/s),this.set(r,n,s,i),this}let S=Math.sqrt((g-m)*(g-m)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(S)<.001&&(S=1),this.x=(g-m)/S,this.y=(h-v)/S,this.z=(d-u)/S,this.w=Math.acos((c+f+x-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class l9 extends Ud{constructor(t=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new Pr(0,0,t,i),this.scissorTest=!1,this.viewport=new Pr(0,0,t,i);const n={width:t,height:i,depth:1};r.encoding!==void 0&&(Qw("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===dp?bs:hl),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:kn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new dn(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(t,i,r=1){(this.width!==t||this.height!==i||this.depth!==r)&&(this.width=t,this.height=i,this.depth=r,this.texture.image.width=t,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new dg(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class qc extends l9{constructor(t=1,i=1,r={}){super(t,i,r),this.isWebGLRenderTarget=!0}}class w2 extends dn{constructor(t=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Fn,this.minFilter=Fn,this.wrapR=Ia,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class wee extends qc{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new w2(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class bz extends dn{constructor(t=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=Fn,this.minFilter=Fn,this.wrapR=Ia,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bee extends qc{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new bz(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class _ee extends qc{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let a=0;a<r;a++)this.texture[a]=s.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(t,i,r=1){if(this.width!==t||this.height!==i||this.depth!==r){this.width=t,this.height=i,this.depth=r;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=t,this.texture[n].image.height=i,this.texture[n].image.depth=r;this.dispose()}this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let i=0,r=t.texture.length;i<r;i++)this.texture[i]=t.texture[i].clone(),this.texture[i].isRenderTargetTexture=!0;return this}}class za{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],f=s[a+1],m=s[a+2],v=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=f,t[i+2]=m,t[i+3]=v;return}if(h!==v||l!==d||c!==f||u!==m){let g=1-o;const x=l*d+c*f+u*m+h*v,S=x>=0?1:-1,_=1-x*x;if(_>Number.EPSILON){const T=Math.sqrt(_),E=Math.atan2(T,x*S);g=Math.sin(g*E)/T,o=Math.sin(o*E)/T}const A=o*S;if(l=l*g+d*A,c=c*g+f*A,u=u*g+m*A,h=h*g+v*A,g===1-o){const T=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=T,c*=T,u*=T,h*=T}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],f=s[a+2],m=s[a+3];return t[i]=o*m+u*h+l*f-c*d,t[i+1]=l*m+u*d+c*h-o*f,t[i+2]=c*m+u*f+o*d-l*h,t[i+3]=u*m-o*h-l*d-c*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){const r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),f=l(n/2),m=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"YXZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"ZXY":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"ZYX":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"YZX":this._x=d*u*h+c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h-d*f*m;break;case"XZY":this._x=d*u*h-c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(a-n)*f}else if(r>o&&r>h){const f=2*Math.sqrt(1+r-o-h);this._w=(u-l)/f,this._x=.25*f,this._y=(n+a)/f,this._z=(s+c)/f}else if(o>h){const f=2*Math.sqrt(1+o-r-h);this._w=(s-c)/f,this._x=(n+a)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-r-o);this._w=(a-n)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Cn(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-i;return this._w=f*a+i*this._w,this._x=f*r+i*this._x,this._y=f*n+i*this._y,this._z=f*s+i*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){const t=Math.random(),i=Math.sqrt(1-t),r=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(i*Math.cos(n),r*Math.sin(s),r*Math.cos(s),i*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pe{constructor(t=0,i=0,r=0){pe.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(cF.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(cF.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){const i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=2*(a*n-o*r),u=2*(o*i-s*n),h=2*(s*r-a*i);return this.x=i+l*c+a*h-o*u,this.y=r+l*u+o*c-s*h,this.z=n+l*h+s*u-a*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return dP.copy(this).projectOnVector(t),this.sub(dP)}reflect(t){return this.sub(dP.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Cn(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const dP=new pe,cF=new za;class ho{constructor(t=new pe(1/0,1/0,1/0),i=new pe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i+=3)this.expandByPoint(yc.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,r=t.count;i<r;i++)this.expandByPoint(yc.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=yc.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0){const s=r.getAttribute("position");if(i===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,yc):yc.fromBufferAttribute(s,a),yc.applyMatrix4(t.matrixWorld),this.expandByPoint(yc);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),YS.copy(t.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),YS.copy(r.boundingBox)),YS.applyMatrix4(t.matrixWorld),this.union(YS)}const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,yc),yc.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(B1),QS.subVectors(this.max,B1),c0.subVectors(t.a,B1),u0.subVectors(t.b,B1),h0.subVectors(t.c,B1),bf.subVectors(u0,c0),_f.subVectors(h0,u0),Am.subVectors(c0,h0);let i=[0,-bf.z,bf.y,0,-_f.z,_f.y,0,-Am.z,Am.y,bf.z,0,-bf.x,_f.z,0,-_f.x,Am.z,0,-Am.x,-bf.y,bf.x,0,-_f.y,_f.x,0,-Am.y,Am.x,0];return!fP(i,c0,u0,h0,QS)||(i=[1,0,0,0,1,0,0,0,1],!fP(i,c0,u0,h0,QS))?!1:(ZS.crossVectors(bf,_f),i=[ZS.x,ZS.y,ZS.z],fP(i,c0,u0,h0,QS))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,yc).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(yc).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Uh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Uh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Uh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Uh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Uh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Uh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Uh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Uh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Uh),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Uh=[new pe,new pe,new pe,new pe,new pe,new pe,new pe,new pe],yc=new pe,YS=new ho,c0=new pe,u0=new pe,h0=new pe,bf=new pe,_f=new pe,Am=new pe,B1=new pe,QS=new pe,ZS=new pe,Em=new pe;function fP(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Em.fromArray(e,s);const o=n.x*Math.abs(Em.x)+n.y*Math.abs(Em.y)+n.z*Math.abs(Em.z),l=t.dot(Em),c=i.dot(Em),u=r.dot(Em);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const See=new ho,N1=new pe,pP=new pe;class Ba{constructor(t=new pe,i=-1){this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):See.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;N1.subVectors(t,this.center);const i=N1.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(N1,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(pP.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(N1.copy(t.center).add(pP)),this.expandByPoint(N1.copy(t.center).sub(pP))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Fh=new pe,mP=new pe,KS=new pe,Sf=new pe,gP=new pe,JS=new pe,vP=new pe;class Jg{constructor(t=new pe,i=new pe(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Fh)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=Fh.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(Fh.copy(this.origin).addScaledVector(this.direction,i),Fh.distanceToSquared(t))}distanceSqToSegment(t,i,r,n){mP.copy(t).add(i).multiplyScalar(.5),KS.copy(i).sub(t).normalize(),Sf.copy(this.origin).sub(mP);const s=t.distanceTo(i)*.5,a=-this.direction.dot(KS),o=Sf.dot(this.direction),l=-Sf.dot(KS),c=Sf.lengthSq(),u=Math.abs(1-a*a);let h,d,f,m;if(u>0)if(h=a*l-o,d=a*o-l,m=s*u,h>=0)if(d>=-m)if(d<=m){const v=1/u;h*=v,d*=v,f=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d<=-m?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(mP).addScaledVector(KS,d),f}intersectSphere(t,i){Fh.subVectors(t.center,this.origin);const r=Fh.dot(this.direction),n=Fh.dot(Fh)-r*r,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(t.min.x-d.x)*c,n=(t.max.x-d.x)*c):(r=(t.max.x-d.x)*c,n=(t.min.x-d.x)*c),u>=0?(s=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(s=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(t){return this.intersectBox(t,Fh)!==null}intersectTriangle(t,i,r,n,s){gP.subVectors(i,t),JS.subVectors(r,t),vP.crossVectors(gP,JS);let a=this.direction.dot(vP),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Sf.subVectors(this.origin,t);const l=o*this.direction.dot(JS.crossVectors(Sf,JS));if(l<0)return null;const c=o*this.direction.dot(gP.cross(Sf));if(c<0||l+c>a)return null;const u=-o*Sf.dot(vP);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ci{constructor(t,i,r,n,s,a,o,l,c,u,h,d,f,m,v,g){Ci.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c,u,h,d,f,m,v,g)}set(t,i,r,n,s,a,o,l,c,u,h,d,f,m,v,g){const x=this.elements;return x[0]=t,x[4]=i,x[8]=r,x[12]=n,x[1]=s,x[5]=a,x[9]=o,x[13]=l,x[2]=c,x[6]=u,x[10]=h,x[14]=d,x[3]=f,x[7]=m,x[11]=v,x[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ci().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,n=1/d0.setFromMatrixColumn(t,0).length(),s=1/d0.setFromMatrixColumn(t,1).length(),a=1/d0.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*u,f=a*h,m=o*u,v=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=f+m*c,i[5]=d-v*c,i[9]=-o*l,i[2]=v-d*c,i[6]=m+f*c,i[10]=a*l}else if(t.order==="YXZ"){const d=l*u,f=l*h,m=c*u,v=c*h;i[0]=d+v*o,i[4]=m*o-f,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=f*o-m,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*u,f=l*h,m=c*u,v=c*h;i[0]=d-v*o,i[4]=-a*h,i[8]=m+f*o,i[1]=f+m*o,i[5]=a*u,i[9]=v-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*u,f=a*h,m=o*u,v=o*h;i[0]=l*u,i[4]=m*c-f,i[8]=d*c+v,i[1]=l*h,i[5]=v*c+d,i[9]=f*c-m,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,f=a*c,m=o*l,v=o*c;i[0]=l*u,i[4]=v-d*h,i[8]=m*h+f,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=f*h+m,i[10]=d-v*h}else if(t.order==="XZY"){const d=a*l,f=a*c,m=o*l,v=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+v,i[5]=a*u,i[9]=f*h-m,i[2]=m*h-f,i[6]=o*u,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Mee,t,Aee)}lookAt(t,i,r){const n=this.elements;return sl.subVectors(t,i),sl.lengthSq()===0&&(sl.z=1),sl.normalize(),Mf.crossVectors(r,sl),Mf.lengthSq()===0&&(Math.abs(r.z)===1?sl.x+=1e-4:sl.z+=1e-4,sl.normalize(),Mf.crossVectors(r,sl)),Mf.normalize(),$S.crossVectors(sl,Mf),n[0]=Mf.x,n[4]=$S.x,n[8]=sl.x,n[1]=Mf.y,n[5]=$S.y,n[9]=sl.y,n[2]=Mf.z,n[6]=$S.z,n[10]=sl.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],f=r[13],m=r[2],v=r[6],g=r[10],x=r[14],S=r[3],_=r[7],A=r[11],T=r[15],E=n[0],I=n[4],P=n[8],C=n[12],L=n[1],z=n[5],F=n[9],G=n[13],N=n[2],q=n[6],ie=n[10],Q=n[14],W=n[3],ee=n[7],K=n[11],j=n[15];return s[0]=a*E+o*L+l*N+c*W,s[4]=a*I+o*z+l*q+c*ee,s[8]=a*P+o*F+l*ie+c*K,s[12]=a*C+o*G+l*Q+c*j,s[1]=u*E+h*L+d*N+f*W,s[5]=u*I+h*z+d*q+f*ee,s[9]=u*P+h*F+d*ie+f*K,s[13]=u*C+h*G+d*Q+f*j,s[2]=m*E+v*L+g*N+x*W,s[6]=m*I+v*z+g*q+x*ee,s[10]=m*P+v*F+g*ie+x*K,s[14]=m*C+v*G+g*Q+x*j,s[3]=S*E+_*L+A*N+T*W,s[7]=S*I+_*z+A*q+T*ee,s[11]=S*P+_*F+A*ie+T*K,s[15]=S*C+_*G+A*Q+T*j,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],f=t[14],m=t[3],v=t[7],g=t[11],x=t[15];return m*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*f-r*l*f)+v*(+i*l*f-i*c*d+s*a*d-n*a*f+n*c*u-s*l*u)+g*(+i*c*h-i*o*f-s*a*h+r*a*f+s*o*u-r*c*u)+x*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],m=t[12],v=t[13],g=t[14],x=t[15],S=h*g*c-v*d*c+v*l*f-o*g*f-h*l*x+o*d*x,_=m*d*c-u*g*c-m*l*f+a*g*f+u*l*x-a*d*x,A=u*v*c-m*h*c+m*o*f-a*v*f-u*o*x+a*h*x,T=m*h*l-u*v*l-m*o*d+a*v*d+u*o*g-a*h*g,E=i*S+r*_+n*A+s*T;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/E;return t[0]=S*I,t[1]=(v*d*s-h*g*s-v*n*f+r*g*f+h*n*x-r*d*x)*I,t[2]=(o*g*s-v*l*s+v*n*c-r*g*c-o*n*x+r*l*x)*I,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*f-r*l*f)*I,t[4]=_*I,t[5]=(u*g*s-m*d*s+m*n*f-i*g*f-u*n*x+i*d*x)*I,t[6]=(m*l*s-a*g*s-m*n*c+i*g*c+a*n*x-i*l*x)*I,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*f+i*l*f)*I,t[8]=A*I,t[9]=(m*h*s-u*v*s-m*r*f+i*v*f+u*r*x-i*h*x)*I,t[10]=(a*v*s-m*o*s+m*r*c-i*v*c-a*r*x+i*o*x)*I,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*f-i*o*f)*I,t[12]=T*I,t[13]=(u*v*n-m*h*n+m*r*d-i*v*d-u*r*g+i*h*g)*I,t[14]=(m*o*n-a*v*n-m*r*l+i*v*l+a*r*g-i*o*g)*I,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*I,this}scale(t){const i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,f=s*u,m=s*h,v=a*u,g=a*h,x=o*h,S=l*c,_=l*u,A=l*h,T=r.x,E=r.y,I=r.z;return n[0]=(1-(v+x))*T,n[1]=(f+A)*T,n[2]=(m-_)*T,n[3]=0,n[4]=(f-A)*E,n[5]=(1-(d+x))*E,n[6]=(g+S)*E,n[7]=0,n[8]=(m+_)*I,n[9]=(g-S)*I,n[10]=(1-(d+v))*I,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){const n=this.elements;let s=d0.set(n[0],n[1],n[2]).length();const a=d0.set(n[4],n[5],n[6]).length(),o=d0.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],xc.copy(this);const c=1/s,u=1/a,h=1/o;return xc.elements[0]*=c,xc.elements[1]*=c,xc.elements[2]*=c,xc.elements[4]*=u,xc.elements[5]*=u,xc.elements[6]*=u,xc.elements[8]*=h,xc.elements[9]*=h,xc.elements[10]*=h,i.setFromRotationMatrix(xc),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a,o=Uc){const l=this.elements,c=2*s/(i-t),u=2*s/(r-n),h=(i+t)/(i-t),d=(r+n)/(r-n);let f,m;if(o===Uc)f=-(a+s)/(a-s),m=-2*a*s/(a-s);else if(o===Zy)f=-a/(a-s),m=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,r,n,s,a,o=Uc){const l=this.elements,c=1/(i-t),u=1/(r-n),h=1/(a-s),d=(i+t)*c,f=(r+n)*u;let m,v;if(o===Uc)m=(a+s)*h,v=-2*h;else if(o===Zy)m=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=v,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const d0=new pe,xc=new Ci,Mee=new pe(0,0,0),Aee=new pe(1,1,1),Mf=new pe,$S=new pe,sl=new pe,uF=new Ci,hF=new za;class $g{constructor(t=0,i=0,r=0,n=$g.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,n=this._order){return this._x=t,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],f=n[10];switch(i){case"XYZ":this._y=Math.asin(Cn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Cn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Cn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Cn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Cn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Cn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return uF.makeRotationFromQuaternion(t),this.setFromRotationMatrix(uF,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return hF.setFromEuler(this),this.setFromQuaternion(hF,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}$g.DEFAULT_ORDER="XYZ";class Tg{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Eee=0;const dF=new pe,f0=new za,kh=new Ci,eM=new pe,U1=new pe,Tee=new pe,Cee=new za,fF=new pe(1,0,0),pF=new pe(0,1,0),mF=new pe(0,0,1),Pee={type:"added"},Dee={type:"removed"};class mr extends Ud{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Eee++}),this.uuid=fl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mr.DEFAULT_UP.clone();const t=new pe,i=new $g,r=new za,n=new pe(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ci},normalMatrix:{value:new Yi}}),this.matrix=new Ci,this.matrixWorld=new Ci,this.matrixAutoUpdate=mr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=mr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Tg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return f0.setFromAxisAngle(t,i),this.quaternion.multiply(f0),this}rotateOnWorldAxis(t,i){return f0.setFromAxisAngle(t,i),this.quaternion.premultiply(f0),this}rotateX(t){return this.rotateOnAxis(fF,t)}rotateY(t){return this.rotateOnAxis(pF,t)}rotateZ(t){return this.rotateOnAxis(mF,t)}translateOnAxis(t,i){return dF.copy(t).applyQuaternion(this.quaternion),this.position.add(dF.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(fF,t)}translateY(t){return this.translateOnAxis(pF,t)}translateZ(t){return this.translateOnAxis(mF,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(kh.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?eM.copy(t):eM.set(t,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),U1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?kh.lookAt(U1,eM,this.up):kh.lookAt(eM,U1,this.up),this.quaternion.setFromRotationMatrix(kh),n&&(kh.extractRotation(n.matrixWorld),f0.setFromRotationMatrix(kh),this.quaternion.premultiply(f0.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Pee)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(Dee)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),kh.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),kh.multiply(t.parent.matrixWorld)),t.applyMatrix4(kh),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(U1,t,Tee),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(U1,Cee,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++){const s=i[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),c=a(t.textures),u=a(t.images),h=a(t.shapes),d=a(t.skeletons),f=a(t.animations),m=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f),m.length>0&&(r.nodes=m)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){const n=t.children[r];this.add(n.clone())}return this}}mr.DEFAULT_UP=new pe(0,1,0);mr.DEFAULT_MATRIX_AUTO_UPDATE=!0;mr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wc=new pe,Vh=new pe,yP=new pe,Hh=new pe,p0=new pe,m0=new pe,gF=new pe,xP=new pe,wP=new pe,bP=new pe;let tM=!1;class Oo{constructor(t=new pe,i=new pe,r=new pe){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),wc.subVectors(t,i),n.cross(wc);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){wc.subVectors(n,i),Vh.subVectors(r,i),yP.subVectors(t,i);const a=wc.dot(wc),o=wc.dot(Vh),l=wc.dot(yP),c=Vh.dot(Vh),u=Vh.dot(yP),h=a*c-o*o;if(h===0)return s.set(-2,-1,-1);const d=1/h,f=(c*l-o*u)*d,m=(a*u-o*l)*d;return s.set(1-f-m,m,f)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,Hh),Hh.x>=0&&Hh.y>=0&&Hh.x+Hh.y<=1}static getUV(t,i,r,n,s,a,o,l){return tM===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),tM=!0),this.getInterpolation(t,i,r,n,s,a,o,l)}static getInterpolation(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,Hh),l.setScalar(0),l.addScaledVector(s,Hh.x),l.addScaledVector(a,Hh.y),l.addScaledVector(o,Hh.z),l}static isFrontFacing(t,i,r,n){return wc.subVectors(r,i),Vh.subVectors(t,i),wc.cross(Vh).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return wc.subVectors(this.c,this.b),Vh.subVectors(this.a,this.b),wc.cross(Vh).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Oo.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return Oo.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,r,n,s){return tM===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),tM=!0),Oo.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}getInterpolation(t,i,r,n,s){return Oo.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return Oo.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Oo.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const r=this.a,n=this.b,s=this.c;let a,o;p0.subVectors(n,r),m0.subVectors(s,r),xP.subVectors(t,r);const l=p0.dot(xP),c=m0.dot(xP);if(l<=0&&c<=0)return i.copy(r);wP.subVectors(t,n);const u=p0.dot(wP),h=m0.dot(wP);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(p0,a);bP.subVectors(t,s);const f=p0.dot(bP),m=m0.dot(bP);if(m>=0&&f<=m)return i.copy(s);const v=f*c-l*m;if(v<=0&&c>=0&&m<=0)return o=c/(c-m),i.copy(r).addScaledVector(m0,o);const g=u*m-f*h;if(g<=0&&h-u>=0&&f-m>=0)return gF.subVectors(s,n),o=(h-u)/(h-u+(f-m)),i.copy(n).addScaledVector(gF,o);const x=1/(g+v+d);return a=v*x,o=d*x,i.copy(r).addScaledVector(p0,a).addScaledVector(m0,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const c9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Af={h:0,s:0,l:0},iM={h:0,s:0,l:0};function _P(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class Zt{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,r)}set(t,i,r){if(i===void 0&&r===void 0){const n=t;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(t,i,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=bs){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Tr.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=Tr.workingColorSpace){return this.r=t,this.g=i,this.b=r,Tr.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=Tr.workingColorSpace){if(t=xz(t,1),i=Cn(i,0,1),r=Cn(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=_P(a,s,t+1/3),this.g=_P(a,s,t),this.b=_P(a,s,t-1/3)}return Tr.toWorkingColorSpace(this,n),this}setStyle(t,i=bs){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=bs){const r=c9[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ly(t.r),this.g=Ly(t.g),this.b=Ly(t.b),this}copyLinearToSRGB(t){return this.r=uP(t.r),this.g=uP(t.g),this.b=uP(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=bs){return Tr.fromWorkingColorSpace(Ta.copy(this),t),Math.round(Cn(Ta.r*255,0,255))*65536+Math.round(Cn(Ta.g*255,0,255))*256+Math.round(Cn(Ta.b*255,0,255))}getHexString(t=bs){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Tr.workingColorSpace){Tr.fromWorkingColorSpace(Ta.copy(this),i);const r=Ta.r,n=Ta.g,s=Ta.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=Tr.workingColorSpace){return Tr.fromWorkingColorSpace(Ta.copy(this),i),t.r=Ta.r,t.g=Ta.g,t.b=Ta.b,t}getStyle(t=bs){Tr.fromWorkingColorSpace(Ta.copy(this),t);const i=Ta.r,r=Ta.g,n=Ta.b;return t!==bs?`color(${t} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(t,i,r){return this.getHSL(Af),this.setHSL(Af.h+t,Af.s+i,Af.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(Af),t.getHSL(iM);const r=Yw(Af.h,iM.h,i),n=Yw(Af.s,iM.s,i),s=Yw(Af.l,iM.l,i);return this.setHSL(r,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,r=this.g,n=this.b,s=t.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ta=new Zt;Zt.NAMES=c9;let Ree=0;class ga extends Ud{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ree++}),this.uuid=fl(),this.name="",this.type="Material",this.blending=Mg,this.side=Pd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=GE,this.blendDst=jE,this.blendEquation=Yf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Zt(0,0,0),this.blendAlpha=0,this.depthFunc=bb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=yI,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ym,this.stencilZFail=Ym,this.stencilZPass=Ym,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const r=t[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Mg&&(r.blending=this.blending),this.side!==Pd&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==GE&&(r.blendSrc=this.blendSrc),this.blendDst!==jE&&(r.blendDst=this.blendDst),this.blendEquation!==Yf&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==bb&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==yI&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ym&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Ym&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Ym&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(t.textures),a=n(t.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Dp extends ga{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=w_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const fd=Iee();function Iee(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Ro(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Cn(e,-65504,65504),fd.floatView[0]=e;const t=fd.uint32View[0],i=t>>23&511;return fd.baseTable[i]+((t&8388607)>>fd.shiftTable[i])}function Iw(e){const t=e>>10;return fd.uint32View[0]=fd.mantissaTable[fd.offsetTable[t]+(e&1023)]+fd.exponentTable[t],fd.floatView[0]}const Lee={toHalfFloat:Ro,fromHalfFloat:Iw},Kn=new pe,rM=new yt;class Ir{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=Ib,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Nc,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return console.warn('THREE.BufferAttribute: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)rM.fromBufferAttribute(this,i),rM.applyMatrix3(t),this.setXY(i,rM.x,rM.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Kn.fromBufferAttribute(this,i),Kn.applyMatrix3(t),this.setXYZ(i,Kn.x,Kn.y,Kn.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)Kn.fromBufferAttribute(this,i),Kn.applyMatrix4(t),this.setXYZ(i,Kn.x,Kn.y,Kn.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)Kn.fromBufferAttribute(this,i),Kn.applyNormalMatrix(t),this.setXYZ(i,Kn.x,Kn.y,Kn.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)Kn.fromBufferAttribute(this,i),Kn.transformDirection(t),this.setXYZ(i,Kn.x,Kn.y,Kn.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let r=this.array[t*this.itemSize+i];return this.normalized&&(r=No(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=Xi(r,this.array)),this.array[t*this.itemSize+i]=r,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=No(i,this.array)),i}setX(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=No(i,this.array)),i}setY(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=No(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=No(i,this.array)),i}setW(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array),n=Xi(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array),n=Xi(n,this.array),s=Xi(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Ib&&(t.usage=this.usage),t}}class Oee extends Ir{constructor(t,i,r){super(new Int8Array(t),i,r)}}class zee extends Ir{constructor(t,i,r){super(new Uint8Array(t),i,r)}}class Bee extends Ir{constructor(t,i,r){super(new Uint8ClampedArray(t),i,r)}}class Nee extends Ir{constructor(t,i,r){super(new Int16Array(t),i,r)}}class _z extends Ir{constructor(t,i,r){super(new Uint16Array(t),i,r)}}class Uee extends Ir{constructor(t,i,r){super(new Int32Array(t),i,r)}}class Sz extends Ir{constructor(t,i,r){super(new Uint32Array(t),i,r)}}class Fee extends Ir{constructor(t,i,r){super(new Uint16Array(t),i,r),this.isFloat16BufferAttribute=!0}getX(t){let i=Iw(this.array[t*this.itemSize]);return this.normalized&&(i=No(i,this.array)),i}setX(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize]=Ro(i),this}getY(t){let i=Iw(this.array[t*this.itemSize+1]);return this.normalized&&(i=No(i,this.array)),i}setY(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize+1]=Ro(i),this}getZ(t){let i=Iw(this.array[t*this.itemSize+2]);return this.normalized&&(i=No(i,this.array)),i}setZ(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize+2]=Ro(i),this}getW(t){let i=Iw(this.array[t*this.itemSize+3]);return this.normalized&&(i=No(i,this.array)),i}setW(t,i){return this.normalized&&(i=Xi(i,this.array)),this.array[t*this.itemSize+3]=Ro(i),this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array)),this.array[t+0]=Ro(i),this.array[t+1]=Ro(r),this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array),n=Xi(n,this.array)),this.array[t+0]=Ro(i),this.array[t+1]=Ro(r),this.array[t+2]=Ro(n),this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array),n=Xi(n,this.array),s=Xi(s,this.array)),this.array[t+0]=Ro(i),this.array[t+1]=Ro(r),this.array[t+2]=Ro(n),this.array[t+3]=Ro(s),this}}class ii extends Ir{constructor(t,i,r){super(new Float32Array(t),i,r)}}class kee extends Ir{constructor(t,i,r){super(new Float64Array(t),i,r)}}let Vee=0;const El=new Ci,SP=new mr,g0=new pe,al=new ho,F1=new ho,Bs=new pe;class Gi extends Ud{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Vee++}),this.uuid=fl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(a9(t)?Sz:_z)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Yi().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return El.makeRotationFromQuaternion(t),this.applyMatrix4(El),this}rotateX(t){return El.makeRotationX(t),this.applyMatrix4(El),this}rotateY(t){return El.makeRotationY(t),this.applyMatrix4(El),this}rotateZ(t){return El.makeRotationZ(t),this.applyMatrix4(El),this}translate(t,i,r){return El.makeTranslation(t,i,r),this.applyMatrix4(El),this}scale(t,i,r){return El.makeScale(t,i,r),this.applyMatrix4(El),this}lookAt(t){return SP.lookAt(t),SP.updateMatrix(),this.applyMatrix4(SP.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(g0).negate(),this.translate(g0.x,g0.y,g0.z),this}setFromPoints(t){const i=[];for(let r=0,n=t.length;r<n;r++){const s=t[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ii(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ho);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new pe(-1/0,-1/0,-1/0),new pe(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];al.setFromBufferAttribute(s),this.morphTargetsRelative?(Bs.addVectors(this.boundingBox.min,al.min),this.boundingBox.expandByPoint(Bs),Bs.addVectors(this.boundingBox.max,al.max),this.boundingBox.expandByPoint(Bs)):(this.boundingBox.expandByPoint(al.min),this.boundingBox.expandByPoint(al.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ba);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new pe,1/0);return}if(t){const r=this.boundingSphere.center;if(al.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];F1.setFromBufferAttribute(o),this.morphTargetsRelative?(Bs.addVectors(al.min,F1.min),al.expandByPoint(Bs),Bs.addVectors(al.max,F1.max),al.expandByPoint(Bs)):(al.expandByPoint(F1.min),al.expandByPoint(F1.max))}al.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)Bs.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared(Bs));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Bs.fromBufferAttribute(o,c),l&&(g0.fromBufferAttribute(t,c),Bs.add(g0)),n=Math.max(n,r.distanceToSquared(Bs))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.array,n=i.position.array,s=i.normal.array,a=i.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ir(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let L=0;L<o;L++)c[L]=new pe,u[L]=new pe;const h=new pe,d=new pe,f=new pe,m=new yt,v=new yt,g=new yt,x=new pe,S=new pe;function _(L,z,F){h.fromArray(n,L*3),d.fromArray(n,z*3),f.fromArray(n,F*3),m.fromArray(a,L*2),v.fromArray(a,z*2),g.fromArray(a,F*2),d.sub(h),f.sub(h),v.sub(m),g.sub(m);const G=1/(v.x*g.y-g.x*v.y);isFinite(G)&&(x.copy(d).multiplyScalar(g.y).addScaledVector(f,-v.y).multiplyScalar(G),S.copy(f).multiplyScalar(v.x).addScaledVector(d,-g.x).multiplyScalar(G),c[L].add(x),c[z].add(x),c[F].add(x),u[L].add(S),u[z].add(S),u[F].add(S))}let A=this.groups;A.length===0&&(A=[{start:0,count:r.length}]);for(let L=0,z=A.length;L<z;++L){const F=A[L],G=F.start,N=F.count;for(let q=G,ie=G+N;q<ie;q+=3)_(r[q+0],r[q+1],r[q+2])}const T=new pe,E=new pe,I=new pe,P=new pe;function C(L){I.fromArray(s,L*3),P.copy(I);const z=c[L];T.copy(z),T.sub(I.multiplyScalar(I.dot(z))).normalize(),E.crossVectors(P,z);const G=E.dot(u[L])<0?-1:1;l[L*4]=T.x,l[L*4+1]=T.y,l[L*4+2]=T.z,l[L*4+3]=G}for(let L=0,z=A.length;L<z;++L){const F=A[L],G=F.start,N=F.count;for(let q=G,ie=G+N;q<ie;q+=3)C(r[q+0]),C(r[q+1]),C(r[q+2])}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Ir(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const n=new pe,s=new pe,a=new pe,o=new pe,l=new pe,c=new pe,u=new pe,h=new pe;if(t)for(let d=0,f=t.count;d<f;d+=3){const m=t.getX(d+0),v=t.getX(d+1),g=t.getX(d+2);n.fromBufferAttribute(i,m),s.fromBufferAttribute(i,v),a.fromBufferAttribute(i,g),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,m),l.fromBufferAttribute(r,v),c.fromBufferAttribute(r,g),o.add(u),l.add(u),c.add(u),r.setXYZ(m,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let d=0,f=i.count;d<f;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)Bs.fromBufferAttribute(t,i),Bs.normalize(),t.setXYZ(i,Bs.x,Bs.y,Bs.z)}toNonIndexed(){function t(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let f=0,m=0;for(let v=0,g=l.length;v<g;v++){o.isInterleavedBufferAttribute?f=l[v]*o.data.stride+o.offset:f=l[v]*u;for(let x=0;x<u;x++)d[m++]=c[f++]}return new Ir(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Gi,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=t(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=t(d,r);l.push(f)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];t.data.attributes[l]=c.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(i));const n=t.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=t.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const vF=new Ci,Tm=new Jg,nM=new Ba,yF=new pe,v0=new pe,y0=new pe,x0=new pe,MP=new pe,sM=new pe,aM=new yt,oM=new yt,lM=new yt,xF=new pe,wF=new pe,bF=new pe,cM=new pe,uM=new pe;class rs extends mr{constructor(t=new Gi,i=new Dp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){sM.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(MP.fromBufferAttribute(h,t),a?sM.addScaledVector(MP,u):sM.addScaledVector(MP.sub(i),u))}i.add(sM)}return i}raycast(t,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),nM.copy(r.boundingSphere),nM.applyMatrix4(s),Tm.copy(t.ray).recast(t.near),!(nM.containsPoint(Tm.origin)===!1&&(Tm.intersectSphere(nM,yF)===null||Tm.origin.distanceToSquared(yF)>(t.far-t.near)**2))&&(vF.copy(s).invert(),Tm.copy(t.ray).applyMatrix4(vF),!(r.boundingBox!==null&&Tm.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(t,i,Tm)))}_computeIntersections(t,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(o!==null)if(Array.isArray(a))for(let m=0,v=d.length;m<v;m++){const g=d[m],x=a[g.materialIndex],S=Math.max(g.start,f.start),_=Math.min(o.count,Math.min(g.start+g.count,f.start+f.count));for(let A=S,T=_;A<T;A+=3){const E=o.getX(A),I=o.getX(A+1),P=o.getX(A+2);n=hM(this,x,t,r,c,u,h,E,I,P),n&&(n.faceIndex=Math.floor(A/3),n.face.materialIndex=g.materialIndex,i.push(n))}}else{const m=Math.max(0,f.start),v=Math.min(o.count,f.start+f.count);for(let g=m,x=v;g<x;g+=3){const S=o.getX(g),_=o.getX(g+1),A=o.getX(g+2);n=hM(this,a,t,r,c,u,h,S,_,A),n&&(n.faceIndex=Math.floor(g/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let m=0,v=d.length;m<v;m++){const g=d[m],x=a[g.materialIndex],S=Math.max(g.start,f.start),_=Math.min(l.count,Math.min(g.start+g.count,f.start+f.count));for(let A=S,T=_;A<T;A+=3){const E=A,I=A+1,P=A+2;n=hM(this,x,t,r,c,u,h,E,I,P),n&&(n.faceIndex=Math.floor(A/3),n.face.materialIndex=g.materialIndex,i.push(n))}}else{const m=Math.max(0,f.start),v=Math.min(l.count,f.start+f.count);for(let g=m,x=v;g<x;g+=3){const S=g,_=g+1,A=g+2;n=hM(this,a,t,r,c,u,h,S,_,A),n&&(n.faceIndex=Math.floor(g/3),i.push(n))}}}}function Hee(e,t,i,r,n,s,a,o){let l;if(t.side===uo?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Pd,o),l===null)return null;uM.copy(o),uM.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(uM);return c<i.near||c>i.far?null:{distance:c,point:uM.clone(),object:e}}function hM(e,t,i,r,n,s,a,o,l,c){e.getVertexPosition(o,v0),e.getVertexPosition(l,y0),e.getVertexPosition(c,x0);const u=Hee(e,t,i,r,v0,y0,x0,cM);if(u){n&&(aM.fromBufferAttribute(n,o),oM.fromBufferAttribute(n,l),lM.fromBufferAttribute(n,c),u.uv=Oo.getInterpolation(cM,v0,y0,x0,aM,oM,lM,new yt)),s&&(aM.fromBufferAttribute(s,o),oM.fromBufferAttribute(s,l),lM.fromBufferAttribute(s,c),u.uv1=Oo.getInterpolation(cM,v0,y0,x0,aM,oM,lM,new yt),u.uv2=u.uv1),a&&(xF.fromBufferAttribute(a,o),wF.fromBufferAttribute(a,l),bF.fromBufferAttribute(a,c),u.normal=Oo.getInterpolation(cM,v0,y0,x0,xF,wF,bF,new pe),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a:o,b:l,c,normal:new pe,materialIndex:0};Oo.getNormal(v0,y0,x0,h.normal),u.face=h}return u}class ev extends Gi{constructor(t=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,r,i,t,a,s,0),m("z","y","x",1,-1,r,i,-t,a,s,1),m("x","z","y",1,1,t,r,i,n,a,2),m("x","z","y",1,-1,t,r,-i,n,a,3),m("x","y","z",1,-1,t,i,r,n,s,4),m("x","y","z",-1,-1,t,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new ii(c,3)),this.setAttribute("normal",new ii(u,3)),this.setAttribute("uv",new ii(h,2));function m(v,g,x,S,_,A,T,E,I,P,C){const L=A/I,z=T/P,F=A/2,G=T/2,N=E/2,q=I+1,ie=P+1;let Q=0,W=0;const ee=new pe;for(let K=0;K<ie;K++){const j=K*z-G;for(let $=0;$<q;$++){const se=$*L-F;ee[v]=se*S,ee[g]=j*_,ee[x]=N,c.push(ee.x,ee.y,ee.z),ee[v]=0,ee[g]=0,ee[x]=E>0?1:-1,u.push(ee.x,ee.y,ee.z),h.push($/I),h.push(1-K/P),Q+=1}}for(let K=0;K<P;K++)for(let j=0;j<I;j++){const $=d+j+q*K,se=d+j+q*(K+1),re=d+(j+1)+q*(K+1),he=d+(j+1)+q*K;l.push($,se,he),l.push(se,re,he),W+=6}o.addGroup(f,W,C),f+=W,d+=Q}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ev(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Jy(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][r]=null):t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function to(e){const t={};for(let i=0;i<e.length;i++){const r=Jy(e[i]);for(const n in r)t[n]=r[n]}return t}function Gee(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function u9(e){return e.getRenderTarget()===null?e.outputColorSpace:Tr.workingColorSpace}const h9={clone:Jy,merge:to};var jee=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Wee=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Zu extends ga{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=jee,this.fragmentShader=Wee,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Jy(t.uniforms),this.uniformsGroups=Gee(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class __ extends mr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ci,this.projectionMatrix=new Ci,this.projectionMatrixInverse=new Ci,this.coordinateSystem=Uc}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class gn extends __{constructor(t=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=Ky*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Eg*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Ky*2*Math.atan(Math.tan(Eg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,i,r,n,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(Eg*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const w0=-90,b0=1;class Mz extends mr{constructor(t,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new gn(w0,b0,t,i);n.layers=this.layers,this.add(n);const s=new gn(w0,b0,t,i);s.layers=this.layers,this.add(s);const a=new gn(w0,b0,t,i);a.layers=this.layers,this.add(a);const o=new gn(w0,b0,t,i);o.layers=this.layers,this.add(o);const l=new gn(w0,b0,t,i);l.layers=this.layers,this.add(l);const c=new gn(w0,b0,t,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(t===Uc)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===Zy)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of i)this.add(c),c.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=t.getRenderTarget(),d=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),m=t.xr.enabled;t.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0,n),t.render(i,s),t.setRenderTarget(r,1,n),t.render(i,a),t.setRenderTarget(r,2,n),t.render(i,o),t.setRenderTarget(r,3,n),t.render(i,l),t.setRenderTarget(r,4,n),t.render(i,c),r.texture.generateMipmaps=v,t.setRenderTarget(r,5,n),t.render(i,u),t.setRenderTarget(h,d,f),t.xr.enabled=m,r.texture.needsPMREMUpdate=!0}}class S_ extends dn{constructor(t,i,r,n,s,a,o,l,c,u){t=t!==void 0?t:[],i=i!==void 0?i:Dd,super(t,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Az extends qc{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},n=[r,r,r,r,r,r];i.encoding!==void 0&&(Qw("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===dp?bs:hl),this.texture=new S_(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:kn}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new ev(5,5,5),s=new Zu({name:"CubemapFromEquirect",uniforms:Jy(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:uo,blending:Md});s.uniforms.tEquirect.value=i;const a=new rs(n,s),o=i.minFilter;return i.minFilter===wp&&(i.minFilter=kn),new Mz(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i,r,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,r,n);t.setRenderTarget(s)}}const AP=new pe,Xee=new pe,qee=new Yi;class od{constructor(t=new pe(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,n){return this.normal.set(t,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const n=AP.subVectors(r,i).cross(Xee.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const r=t.delta(AP),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||qee.getNormalMatrix(t),n=this.coplanarPoint(AP).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Cm=new Ba,dM=new pe;class M_{constructor(t=new od,i=new od,r=new od,n=new od,s=new od,a=new od){this.planes=[t,i,r,n,s,a]}set(t,i,r,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,i=Uc){const r=this.planes,n=t.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],f=n[8],m=n[9],v=n[10],g=n[11],x=n[12],S=n[13],_=n[14],A=n[15];if(r[0].setComponents(l-s,d-c,g-f,A-x).normalize(),r[1].setComponents(l+s,d+c,g+f,A+x).normalize(),r[2].setComponents(l+a,d+u,g+m,A+S).normalize(),r[3].setComponents(l-a,d-u,g-m,A-S).normalize(),r[4].setComponents(l-o,d-h,g-v,A-_).normalize(),i===Uc)r[5].setComponents(l+o,d+h,g+v,A+_).normalize();else if(i===Zy)r[5].setComponents(o,h,v,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Cm.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Cm.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Cm)}intersectsSprite(t){return Cm.center.set(0,0,0),Cm.radius=.7071067811865476,Cm.applyMatrix4(t.matrixWorld),this.intersectsSphere(Cm)}intersectsSphere(t){const i=this.planes,r=t.center,n=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(dM.x=n.normal.x>0?t.max.x:t.min.x,dM.y=n.normal.y>0?t.max.y:t.min.y,dM.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(dM)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function d9(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Yee(e,t){const i=t.isWebGL2,r=new WeakMap;function n(c,u){const h=c.array,d=c.usage,f=h.byteLength,m=e.createBuffer();e.bindBuffer(u,m),e.bufferData(u,h,d),c.onUploadCallback();let v;if(h instanceof Float32Array)v=e.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)v=e.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=e.UNSIGNED_SHORT;else if(h instanceof Int16Array)v=e.SHORT;else if(h instanceof Uint32Array)v=e.UNSIGNED_INT;else if(h instanceof Int32Array)v=e.INT;else if(h instanceof Int8Array)v=e.BYTE;else if(h instanceof Uint8Array)v=e.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)v=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:m,type:v,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:f}}function s(c,u,h){const d=u.array,f=u._updateRange,m=u.updateRanges;if(e.bindBuffer(h,c),f.count===-1&&m.length===0&&e.bufferSubData(h,0,d),m.length!==0){for(let v=0,g=m.length;v<g;v++){const x=m[v];i?e.bufferSubData(h,x.start*d.BYTES_PER_ELEMENT,d,x.start,x.count):e.bufferSubData(h,x.start*d.BYTES_PER_ELEMENT,d.subarray(x.start,x.start+x.count))}u.clearUpdateRanges()}f.count!==-1&&(i?e.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):e.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=r.get(c);if(h===void 0)r.set(c,n(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:a,remove:o,update:l}}class A_ extends Gi{constructor(t=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};const s=t/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=t/o,d=i/l,f=[],m=[],v=[],g=[];for(let x=0;x<u;x++){const S=x*d-a;for(let _=0;_<c;_++){const A=_*h-s;m.push(A,-S,0),v.push(0,0,1),g.push(_/o),g.push(1-x/l)}}for(let x=0;x<l;x++)for(let S=0;S<o;S++){const _=S+c*x,A=S+c*(x+1),T=S+1+c*(x+1),E=S+1+c*x;f.push(_,A,E),f.push(A,T,E)}this.setIndex(f),this.setAttribute("position",new ii(m,3)),this.setAttribute("normal",new ii(v,3)),this.setAttribute("uv",new ii(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new A_(t.width,t.height,t.widthSegments,t.heightSegments)}}var Qee=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Zee=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Kee=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Jee=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$ee=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,ete=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,tte=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ite=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,rte=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,nte=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,ste=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,ate=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ote=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,lte=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,cte=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,ute=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,hte=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,dte=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fte=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,pte=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,mte=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gte=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,vte=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,yte=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,xte=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,wte=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,bte=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_te=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Ste=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Mte=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Ate="gl_FragColor = linearToOutputTexel( gl_FragColor );",Ete=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Tte=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Cte=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Pte=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Dte=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Rte=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ite=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lte=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ote=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,zte=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Bte=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Nte=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Ute=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Fte=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,kte=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Vte=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Hte=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Gte=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,jte=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Wte=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Xte=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,qte=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Yte=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Qte=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Zte=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Kte=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Jte=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$te=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,eie=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,tie=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,iie=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,rie=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nie=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,sie=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aie=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oie=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,lie=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,cie=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,uie=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,hie=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,die=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,fie=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,pie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gie=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,vie=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,yie=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,xie=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,wie=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,bie=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_ie=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Sie=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Mie=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Aie=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Eie=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Tie=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Cie=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Pie=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Die=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Rie=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Iie=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Lie=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Oie=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,zie=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Bie=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Nie=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Uie=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Fie=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,kie=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Vie=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Hie=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Gie=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,jie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Wie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Xie=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,qie=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Yie=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Qie=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Zie=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Kie=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Jie=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$ie=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ere=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,tre=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,ire=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,rre=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,nre=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,sre=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,are=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ore=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lre=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,cre=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ure=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hre=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dre=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fre=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pre=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,mre=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,gre=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vre=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yre=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,xre=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wre=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bre=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_re=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Sre=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Mre=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Are=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ere=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Tre=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Wi={alphahash_fragment:Qee,alphahash_pars_fragment:Zee,alphamap_fragment:Kee,alphamap_pars_fragment:Jee,alphatest_fragment:$ee,alphatest_pars_fragment:ete,aomap_fragment:tte,aomap_pars_fragment:ite,batching_pars_vertex:rte,batching_vertex:nte,begin_vertex:ste,beginnormal_vertex:ate,bsdfs:ote,iridescence_fragment:lte,bumpmap_pars_fragment:cte,clipping_planes_fragment:ute,clipping_planes_pars_fragment:hte,clipping_planes_pars_vertex:dte,clipping_planes_vertex:fte,color_fragment:pte,color_pars_fragment:mte,color_pars_vertex:gte,color_vertex:vte,common:yte,cube_uv_reflection_fragment:xte,defaultnormal_vertex:wte,displacementmap_pars_vertex:bte,displacementmap_vertex:_te,emissivemap_fragment:Ste,emissivemap_pars_fragment:Mte,colorspace_fragment:Ate,colorspace_pars_fragment:Ete,envmap_fragment:Tte,envmap_common_pars_fragment:Cte,envmap_pars_fragment:Pte,envmap_pars_vertex:Dte,envmap_physical_pars_fragment:Hte,envmap_vertex:Rte,fog_vertex:Ite,fog_pars_vertex:Lte,fog_fragment:Ote,fog_pars_fragment:zte,gradientmap_pars_fragment:Bte,lightmap_fragment:Nte,lightmap_pars_fragment:Ute,lights_lambert_fragment:Fte,lights_lambert_pars_fragment:kte,lights_pars_begin:Vte,lights_toon_fragment:Gte,lights_toon_pars_fragment:jte,lights_phong_fragment:Wte,lights_phong_pars_fragment:Xte,lights_physical_fragment:qte,lights_physical_pars_fragment:Yte,lights_fragment_begin:Qte,lights_fragment_maps:Zte,lights_fragment_end:Kte,logdepthbuf_fragment:Jte,logdepthbuf_pars_fragment:$te,logdepthbuf_pars_vertex:eie,logdepthbuf_vertex:tie,map_fragment:iie,map_pars_fragment:rie,map_particle_fragment:nie,map_particle_pars_fragment:sie,metalnessmap_fragment:aie,metalnessmap_pars_fragment:oie,morphcolor_vertex:lie,morphnormal_vertex:cie,morphtarget_pars_vertex:uie,morphtarget_vertex:hie,normal_fragment_begin:die,normal_fragment_maps:fie,normal_pars_fragment:pie,normal_pars_vertex:mie,normal_vertex:gie,normalmap_pars_fragment:vie,clearcoat_normal_fragment_begin:yie,clearcoat_normal_fragment_maps:xie,clearcoat_pars_fragment:wie,iridescence_pars_fragment:bie,opaque_fragment:_ie,packing:Sie,premultiplied_alpha_fragment:Mie,project_vertex:Aie,dithering_fragment:Eie,dithering_pars_fragment:Tie,roughnessmap_fragment:Cie,roughnessmap_pars_fragment:Pie,shadowmap_pars_fragment:Die,shadowmap_pars_vertex:Rie,shadowmap_vertex:Iie,shadowmask_pars_fragment:Lie,skinbase_vertex:Oie,skinning_pars_vertex:zie,skinning_vertex:Bie,skinnormal_vertex:Nie,specularmap_fragment:Uie,specularmap_pars_fragment:Fie,tonemapping_fragment:kie,tonemapping_pars_fragment:Vie,transmission_fragment:Hie,transmission_pars_fragment:Gie,uv_pars_fragment:jie,uv_pars_vertex:Wie,uv_vertex:Xie,worldpos_vertex:qie,background_vert:Yie,background_frag:Qie,backgroundCube_vert:Zie,backgroundCube_frag:Kie,cube_vert:Jie,cube_frag:$ie,depth_vert:ere,depth_frag:tre,distanceRGBA_vert:ire,distanceRGBA_frag:rre,equirect_vert:nre,equirect_frag:sre,linedashed_vert:are,linedashed_frag:ore,meshbasic_vert:lre,meshbasic_frag:cre,meshlambert_vert:ure,meshlambert_frag:hre,meshmatcap_vert:dre,meshmatcap_frag:fre,meshnormal_vert:pre,meshnormal_frag:mre,meshphong_vert:gre,meshphong_frag:vre,meshphysical_vert:yre,meshphysical_frag:xre,meshtoon_vert:wre,meshtoon_frag:bre,points_vert:_re,points_frag:Sre,shadow_vert:Mre,shadow_frag:Are,sprite_vert:Ere,sprite_frag:Tre},Vt={common:{diffuse:{value:new Zt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Yi},alphaMap:{value:null},alphaMapTransform:{value:new Yi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Yi}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Yi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Yi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Yi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Yi},normalScale:{value:new yt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Yi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Yi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Yi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Yi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Zt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Zt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Yi},alphaTest:{value:0},uvTransform:{value:new Yi}},sprite:{diffuse:{value:new Zt(16777215)},opacity:{value:1},center:{value:new yt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Yi},alphaMap:{value:null},alphaMapTransform:{value:new Yi},alphaTest:{value:0}}},Lc={basic:{uniforms:to([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.fog]),vertexShader:Wi.meshbasic_vert,fragmentShader:Wi.meshbasic_frag},lambert:{uniforms:to([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new Zt(0)}}]),vertexShader:Wi.meshlambert_vert,fragmentShader:Wi.meshlambert_frag},phong:{uniforms:to([Vt.common,Vt.specularmap,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,Vt.lights,{emissive:{value:new Zt(0)},specular:{value:new Zt(1118481)},shininess:{value:30}}]),vertexShader:Wi.meshphong_vert,fragmentShader:Wi.meshphong_frag},standard:{uniforms:to([Vt.common,Vt.envmap,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.roughnessmap,Vt.metalnessmap,Vt.fog,Vt.lights,{emissive:{value:new Zt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wi.meshphysical_vert,fragmentShader:Wi.meshphysical_frag},toon:{uniforms:to([Vt.common,Vt.aomap,Vt.lightmap,Vt.emissivemap,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.gradientmap,Vt.fog,Vt.lights,{emissive:{value:new Zt(0)}}]),vertexShader:Wi.meshtoon_vert,fragmentShader:Wi.meshtoon_frag},matcap:{uniforms:to([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,Vt.fog,{matcap:{value:null}}]),vertexShader:Wi.meshmatcap_vert,fragmentShader:Wi.meshmatcap_frag},points:{uniforms:to([Vt.points,Vt.fog]),vertexShader:Wi.points_vert,fragmentShader:Wi.points_frag},dashed:{uniforms:to([Vt.common,Vt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wi.linedashed_vert,fragmentShader:Wi.linedashed_frag},depth:{uniforms:to([Vt.common,Vt.displacementmap]),vertexShader:Wi.depth_vert,fragmentShader:Wi.depth_frag},normal:{uniforms:to([Vt.common,Vt.bumpmap,Vt.normalmap,Vt.displacementmap,{opacity:{value:1}}]),vertexShader:Wi.meshnormal_vert,fragmentShader:Wi.meshnormal_frag},sprite:{uniforms:to([Vt.sprite,Vt.fog]),vertexShader:Wi.sprite_vert,fragmentShader:Wi.sprite_frag},background:{uniforms:{uvTransform:{value:new Yi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Wi.background_vert,fragmentShader:Wi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Wi.backgroundCube_vert,fragmentShader:Wi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Wi.cube_vert,fragmentShader:Wi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Wi.equirect_vert,fragmentShader:Wi.equirect_frag},distanceRGBA:{uniforms:to([Vt.common,Vt.displacementmap,{referencePosition:{value:new pe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Wi.distanceRGBA_vert,fragmentShader:Wi.distanceRGBA_frag},shadow:{uniforms:to([Vt.lights,Vt.fog,{color:{value:new Zt(0)},opacity:{value:1}}]),vertexShader:Wi.shadow_vert,fragmentShader:Wi.shadow_frag}};Lc.physical={uniforms:to([Lc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Yi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Yi},clearcoatNormalScale:{value:new yt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Yi},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Yi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Yi},sheen:{value:0},sheenColor:{value:new Zt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Yi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Yi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Yi},transmissionSamplerSize:{value:new yt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Yi},attenuationDistance:{value:0},attenuationColor:{value:new Zt(0)},specularColor:{value:new Zt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Yi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Yi},anisotropyVector:{value:new yt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Yi}}]),vertexShader:Wi.meshphysical_vert,fragmentShader:Wi.meshphysical_frag};const fM={r:0,b:0,g:0};function Cre(e,t,i,r,n,s,a){const o=new Zt(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function m(g,x){let S=!1,_=x.isScene===!0?x.background:null;_&&_.isTexture&&(_=(x.backgroundBlurriness>0?i:t).get(_)),_===null?v(o,l):_&&_.isColor&&(v(_,1),S=!0);const A=e.xr.getEnvironmentBlendMode();A==="additive"?r.buffers.color.setClear(0,0,0,1,a):A==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||S)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===yx)?(u===void 0&&(u=new rs(new ev(1,1,1),new Zu({name:"BackgroundCubeMaterial",uniforms:Jy(Lc.backgroundCube.uniforms),vertexShader:Lc.backgroundCube.vertexShader,fragmentShader:Lc.backgroundCube.fragmentShader,side:uo,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,E,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=Tr.getTransfer(_.colorSpace)!==Kr,(h!==_||d!==_.version||f!==e.toneMapping)&&(u.material.needsUpdate=!0,h=_,d=_.version,f=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new rs(new A_(2,2),new Zu({name:"BackgroundMaterial",uniforms:Jy(Lc.background.uniforms),vertexShader:Lc.background.vertexShader,fragmentShader:Lc.background.fragmentShader,side:Pd,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=Tr.getTransfer(_.colorSpace)!==Kr,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(h!==_||d!==_.version||f!==e.toneMapping)&&(c.material.needsUpdate=!0,h=_,d=_.version,f=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function v(g,x){g.getRGB(fM,u9(e)),r.buffers.color.setClear(fM.r,fM.g,fM.b,x,a)}return{getClearColor:function(){return o},setClearColor:function(g,x=1){o.set(g),l=x,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(o,l)},render:m}}function Pre(e,t,i,r){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null);let c=l,u=!1;function h(N,q,ie,Q,W){let ee=!1;if(a){const K=v(Q,ie,q);c!==K&&(c=K,f(c.object)),ee=x(N,Q,ie,W),ee&&S(N,Q,ie,W)}else{const K=q.wireframe===!0;(c.geometry!==Q.id||c.program!==ie.id||c.wireframe!==K)&&(c.geometry=Q.id,c.program=ie.id,c.wireframe=K,ee=!0)}W!==null&&i.update(W,e.ELEMENT_ARRAY_BUFFER),(ee||u)&&(u=!1,P(N,q,ie,Q),W!==null&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(W).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function f(N){return r.isWebGL2?e.bindVertexArray(N):s.bindVertexArrayOES(N)}function m(N){return r.isWebGL2?e.deleteVertexArray(N):s.deleteVertexArrayOES(N)}function v(N,q,ie){const Q=ie.wireframe===!0;let W=o[N.id];W===void 0&&(W={},o[N.id]=W);let ee=W[q.id];ee===void 0&&(ee={},W[q.id]=ee);let K=ee[Q];return K===void 0&&(K=g(d()),ee[Q]=K),K}function g(N){const q=[],ie=[],Q=[];for(let W=0;W<n;W++)q[W]=0,ie[W]=0,Q[W]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:q,enabledAttributes:ie,attributeDivisors:Q,object:N,attributes:{},index:null}}function x(N,q,ie,Q){const W=c.attributes,ee=q.attributes;let K=0;const j=ie.getAttributes();for(const $ in j)if(j[$].location>=0){const re=W[$];let he=ee[$];if(he===void 0&&($==="instanceMatrix"&&N.instanceMatrix&&(he=N.instanceMatrix),$==="instanceColor"&&N.instanceColor&&(he=N.instanceColor)),re===void 0||re.attribute!==he||he&&re.data!==he.data)return!0;K++}return c.attributesNum!==K||c.index!==Q}function S(N,q,ie,Q){const W={},ee=q.attributes;let K=0;const j=ie.getAttributes();for(const $ in j)if(j[$].location>=0){let re=ee[$];re===void 0&&($==="instanceMatrix"&&N.instanceMatrix&&(re=N.instanceMatrix),$==="instanceColor"&&N.instanceColor&&(re=N.instanceColor));const he={};he.attribute=re,re&&re.data&&(he.data=re.data),W[$]=he,K++}c.attributes=W,c.attributesNum=K,c.index=Q}function _(){const N=c.newAttributes;for(let q=0,ie=N.length;q<ie;q++)N[q]=0}function A(N){T(N,0)}function T(N,q){const ie=c.newAttributes,Q=c.enabledAttributes,W=c.attributeDivisors;ie[N]=1,Q[N]===0&&(e.enableVertexAttribArray(N),Q[N]=1),W[N]!==q&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](N,q),W[N]=q)}function E(){const N=c.newAttributes,q=c.enabledAttributes;for(let ie=0,Q=q.length;ie<Q;ie++)q[ie]!==N[ie]&&(e.disableVertexAttribArray(ie),q[ie]=0)}function I(N,q,ie,Q,W,ee,K){K===!0?e.vertexAttribIPointer(N,q,ie,W,ee):e.vertexAttribPointer(N,q,ie,Q,W,ee)}function P(N,q,ie,Q){if(r.isWebGL2===!1&&(N.isInstancedMesh||Q.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();const W=Q.attributes,ee=ie.getAttributes(),K=q.defaultAttributeValues;for(const j in ee){const $=ee[j];if($.location>=0){let se=W[j];if(se===void 0&&(j==="instanceMatrix"&&N.instanceMatrix&&(se=N.instanceMatrix),j==="instanceColor"&&N.instanceColor&&(se=N.instanceColor)),se!==void 0){const re=se.normalized,he=se.itemSize,oe=i.get(se);if(oe===void 0)continue;const ve=oe.buffer,xe=oe.type,be=oe.bytesPerElement,Me=r.isWebGL2===!0&&(xe===e.INT||xe===e.UNSIGNED_INT||se.gpuType===cz);if(se.isInterleavedBufferAttribute){const Te=se.data,ae=Te.stride,Ce=se.offset;if(Te.isInstancedInterleavedBuffer){for(let Ie=0;Ie<$.locationSize;Ie++)T($.location+Ie,Te.meshPerAttribute);N.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=Te.meshPerAttribute*Te.count)}else for(let Ie=0;Ie<$.locationSize;Ie++)A($.location+Ie);e.bindBuffer(e.ARRAY_BUFFER,ve);for(let Ie=0;Ie<$.locationSize;Ie++)I($.location+Ie,he/$.locationSize,xe,re,ae*be,(Ce+he/$.locationSize*Ie)*be,Me)}else{if(se.isInstancedBufferAttribute){for(let Te=0;Te<$.locationSize;Te++)T($.location+Te,se.meshPerAttribute);N.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let Te=0;Te<$.locationSize;Te++)A($.location+Te);e.bindBuffer(e.ARRAY_BUFFER,ve);for(let Te=0;Te<$.locationSize;Te++)I($.location+Te,he/$.locationSize,xe,re,he*be,he/$.locationSize*Te*be,Me)}}else if(K!==void 0){const re=K[j];if(re!==void 0)switch(re.length){case 2:e.vertexAttrib2fv($.location,re);break;case 3:e.vertexAttrib3fv($.location,re);break;case 4:e.vertexAttrib4fv($.location,re);break;default:e.vertexAttrib1fv($.location,re)}}}}E()}function C(){F();for(const N in o){const q=o[N];for(const ie in q){const Q=q[ie];for(const W in Q)m(Q[W].object),delete Q[W];delete q[ie]}delete o[N]}}function L(N){if(o[N.id]===void 0)return;const q=o[N.id];for(const ie in q){const Q=q[ie];for(const W in Q)m(Q[W].object),delete Q[W];delete q[ie]}delete o[N.id]}function z(N){for(const q in o){const ie=o[q];if(ie[N.id]===void 0)continue;const Q=ie[N.id];for(const W in Q)m(Q[W].object),delete Q[W];delete ie[N.id]}}function F(){G(),u=!0,c!==l&&(c=l,f(c.object))}function G(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:F,resetDefaultState:G,dispose:C,releaseStatesOfGeometry:L,releaseStatesOfProgram:z,initAttributes:_,enableAttribute:A,disableUnusedAttributes:E}}function Dre(e,t,i,r){const n=r.isWebGL2;let s;function a(u){s=u}function o(u,h){e.drawArrays(s,u,h),i.update(h,s,1)}function l(u,h,d){if(d===0)return;let f,m;if(n)f=e,m="drawArraysInstanced";else if(f=t.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[m](s,u,h,d),i.update(h,s,d)}function c(u,h,d){if(d===0)return;const f=t.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<d;m++)this.render(u[m],h[m]);else{f.multiDrawArraysWEBGL(s,u,0,h,0,d);let m=0;for(let v=0;v<d;v++)m+=h[v];i.update(m,s,1)}}this.setMode=a,this.render=o,this.renderInstances=l,this.renderMultiDraw=c}function Rre(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){const I=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(I){if(I==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&e.constructor.name==="WebGL2RenderingContext";let o=i.precision!==void 0?i.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=e.getParameter(e.MAX_TEXTURE_SIZE),m=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),v=e.getParameter(e.MAX_VERTEX_ATTRIBS),g=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),x=e.getParameter(e.MAX_VARYING_VECTORS),S=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),_=d>0,A=a||t.has("OES_texture_float"),T=_&&A,E=a?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:g,maxVaryings:x,maxFragmentUniforms:S,vertexTextures:_,floatFragmentTextures:A,floatVertexTextures:T,maxSamples:E}}function Ire(e){const t=this;let i=null,r=0,n=!1,s=!1;const a=new od,o=new Yi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||r!==0||n;return n=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,f){const m=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,x=e.get(h);if(!n||m===null||m.length===0||s&&!g)s?u(null):c();else{const S=s?0:r,_=S*4;let A=x.clippingState||null;l.value=A,A=u(m,d,_,f);for(let T=0;T!==_;++T)A[T]=i[T];x.clippingState=A,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=S}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,f,m){const v=h!==null?h.length:0;let g=null;if(v!==0){if(g=l.value,m!==!0||g===null){const x=f+v*4,S=d.matrixWorldInverse;o.getNormalMatrix(S),(g===null||g.length<x)&&(g=new Float32Array(x));for(let _=0,A=f;_!==v;++_,A+=4)a.copy(h[_]).applyMatrix4(S,o),a.normal.toArray(g,A),g[A+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,g}}function Lre(e){let t=new WeakMap;function i(a,o){return o===_b?a.mapping=Dd:o===Sb&&(a.mapping=xp),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===_b||o===Sb)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new Az(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}class Hu extends __{constructor(t=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-t,a=r+t,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const yy=4,_F=[.125,.215,.35,.446,.526,.582],ig=20,EP=new Hu,SF=new Zt;let TP=null,CP=0,PP=0;const Qm=(1+Math.sqrt(5))/2,_0=1/Qm,MF=[new pe(1,1,1),new pe(-1,1,1),new pe(1,1,-1),new pe(-1,1,-1),new pe(0,Qm,_0),new pe(0,Qm,-_0),new pe(_0,0,Qm),new pe(-_0,0,Qm),new pe(Qm,_0,0),new pe(-Qm,_0,0)];class bI{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,r=.1,n=100){TP=this._renderer.getRenderTarget(),CP=this._renderer.getActiveCubeFace(),PP=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,r,n,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=TF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=EF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(TP,CP,PP),t.scissorTest=!1,pM(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===Dd||t.mapping===xp?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),TP=this._renderer.getRenderTarget(),CP=this._renderer.getActiveCubeFace(),PP=this._renderer.getActiveMipmapLevel();const r=i||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:kn,minFilter:kn,generateMipmaps:!1,type:Qy,format:so,colorSpace:Qu,depthBuffer:!1},n=AF(t,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=AF(t,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Ore(s)),this._blurMaterial=zre(s,t,i)}return n}_compileMaterial(t){const i=new rs(this._lodPlanes[0],t);this._renderer.compile(i,EP)}_sceneToCubeUV(t,i,r,n){const o=new gn(90,1,i,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(SF),u.toneMapping=ku,u.autoClear=!1;const f=new Dp({name:"PMREM.Background",side:uo,depthWrite:!1,depthTest:!1}),m=new rs(new ev,f);let v=!1;const g=t.background;g?g.isColor&&(f.color.copy(g),t.background=null,v=!0):(f.color.copy(SF),v=!0);for(let x=0;x<6;x++){const S=x%3;S===0?(o.up.set(0,l[x],0),o.lookAt(c[x],0,0)):S===1?(o.up.set(0,0,l[x]),o.lookAt(0,c[x],0)):(o.up.set(0,l[x],0),o.lookAt(0,0,c[x]));const _=this._cubeSize;pM(n,S*_,x>2?_:0,_,_),u.setRenderTarget(n),v&&u.render(m,o),u.render(t,o)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=d,u.autoClear=h,t.background=g}_textureToCubeUV(t,i){const r=this._renderer,n=t.mapping===Dd||t.mapping===xp;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=TF()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=EF());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new rs(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;pM(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,EP)}_applyPMREM(t){const i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=MF[(n-1)%MF.length];this._blur(t,n-1,n,s,a)}i.autoClear=r}_blur(t,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,r,n,"latitudinal",s),this._halfBlur(a,t,r,r,n,"longitudinal",s)}_halfBlur(t,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new rs(this._lodPlanes[n],c),d=c.uniforms,f=this._sizeLods[r]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*ig-1),v=s/m,g=isFinite(s)?1+Math.floor(u*v):ig;g>ig&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${ig}`);const x=[];let S=0;for(let I=0;I<ig;++I){const P=I/v,C=Math.exp(-P*P/2);x.push(C),I===0?S+=C:I<g&&(S+=2*C)}for(let I=0;I<x.length;I++)x[I]=x[I]/S;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=x,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:_}=this;d.dTheta.value=m,d.mipInt.value=_-r;const A=this._sizeLods[n],T=3*A*(n>_-yy?n-_+yy:0),E=4*(this._cubeSize-A);pM(i,T,E,3*A,2*A),l.setRenderTarget(i),l.render(h,EP)}}function Ore(e){const t=[],i=[],r=[];let n=e;const s=e-yy+1+_F.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>e-yy?l=_F[a-e+yy-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,m=6,v=3,g=2,x=1,S=new Float32Array(v*m*f),_=new Float32Array(g*m*f),A=new Float32Array(x*m*f);for(let E=0;E<f;E++){const I=E%3*2/3-1,P=E>2?0:-1,C=[I,P,0,I+2/3,P,0,I+2/3,P+1,0,I,P,0,I+2/3,P+1,0,I,P+1,0];S.set(C,v*m*E),_.set(d,g*m*E);const L=[E,E,E,E,E,E];A.set(L,x*m*E)}const T=new Gi;T.setAttribute("position",new Ir(S,v)),T.setAttribute("uv",new Ir(_,g)),T.setAttribute("faceIndex",new Ir(A,x)),t.push(T),n>yy&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function AF(e,t,i){const r=new qc(e,t,i);return r.texture.mapping=yx,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function pM(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function zre(e,t,i){const r=new Float32Array(ig),n=new pe(0,1,0);return new Zu({name:"SphericalGaussianBlur",defines:{n:ig,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Ez(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Md,depthTest:!1,depthWrite:!1})}function EF(){return new Zu({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ez(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Md,depthTest:!1,depthWrite:!1})}function TF(){return new Zu({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ez(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Md,depthTest:!1,depthWrite:!1})}function Ez(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Bre(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===_b||l===Sb,u=l===Dd||l===xp;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new bI(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{const h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new bI(e));const d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Nre(e){const t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){const n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Ure(e,t,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const m in d.attributes)t.remove(d.attributes[m]);for(const m in d.morphAttributes){const v=d.morphAttributes[m];for(let g=0,x=v.length;g<x;g++)t.remove(v[g])}d.removeEventListener("dispose",a),delete n[d.id];const f=s.get(d);f&&(t.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const m in d)t.update(d[m],e.ARRAY_BUFFER);const f=h.morphAttributes;for(const m in f){const v=f[m];for(let g=0,x=v.length;g<x;g++)t.update(v[g],e.ARRAY_BUFFER)}}function c(h){const d=[],f=h.index,m=h.attributes.position;let v=0;if(f!==null){const S=f.array;v=f.version;for(let _=0,A=S.length;_<A;_+=3){const T=S[_+0],E=S[_+1],I=S[_+2];d.push(T,E,E,I,I,T)}}else if(m!==void 0){const S=m.array;v=m.version;for(let _=0,A=S.length/3-1;_<A;_+=3){const T=_+0,E=_+1,I=_+2;d.push(T,E,E,I,I,T)}}else return;const g=new(a9(d)?Sz:_z)(d,1);g.version=v;const x=s.get(h);x&&t.remove(x),s.set(h,g)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function Fre(e,t,i,r){const n=r.isWebGL2;let s;function a(f){s=f}let o,l;function c(f){o=f.type,l=f.bytesPerElement}function u(f,m){e.drawElements(s,m,o,f*l),i.update(m,s,1)}function h(f,m,v){if(v===0)return;let g,x;if(n)g=e,x="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),x="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[x](s,m,o,f*l,v),i.update(m,s,v)}function d(f,m,v){if(v===0)return;const g=t.get("WEBGL_multi_draw");if(g===null)for(let x=0;x<v;x++)this.render(f[x]/l,m[x]);else{g.multiDrawElementsWEBGL(s,m,0,o,f,0,v);let x=0;for(let S=0;S<v;S++)x+=m[S];i.update(x,s,1)}}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=d}function kre(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case e.TRIANGLES:i.triangles+=o*(s/3);break;case e.LINES:i.lines+=o*(s/2);break;case e.LINE_STRIP:i.lines+=o*(s-1);break;case e.LINE_LOOP:i.lines+=o*s;break;case e.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function Vre(e,t){return e[0]-t[0]}function Hre(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Gre(e,t,i){const r={},n=new Float32Array(8),s=new WeakMap,a=new Pr,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(t.isWebGL2===!0){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=f!==void 0?f.length:0;let v=s.get(u);if(v===void 0||v.count!==m){let N=function(){F.dispose(),s.delete(u),u.removeEventListener("dispose",N)};v!==void 0&&v.texture.dispose();const S=u.morphAttributes.position!==void 0,_=u.morphAttributes.normal!==void 0,A=u.morphAttributes.color!==void 0,T=u.morphAttributes.position||[],E=u.morphAttributes.normal||[],I=u.morphAttributes.color||[];let P=0;S===!0&&(P=1),_===!0&&(P=2),A===!0&&(P=3);let C=u.attributes.position.count*P,L=1;C>t.maxTextureSize&&(L=Math.ceil(C/t.maxTextureSize),C=t.maxTextureSize);const z=new Float32Array(C*L*4*m),F=new w2(z,C,L,m);F.type=Nc,F.needsUpdate=!0;const G=P*4;for(let q=0;q<m;q++){const ie=T[q],Q=E[q],W=I[q],ee=C*L*4*q;for(let K=0;K<ie.count;K++){const j=K*G;S===!0&&(a.fromBufferAttribute(ie,K),z[ee+j+0]=a.x,z[ee+j+1]=a.y,z[ee+j+2]=a.z,z[ee+j+3]=0),_===!0&&(a.fromBufferAttribute(Q,K),z[ee+j+4]=a.x,z[ee+j+5]=a.y,z[ee+j+6]=a.z,z[ee+j+7]=0),A===!0&&(a.fromBufferAttribute(W,K),z[ee+j+8]=a.x,z[ee+j+9]=a.y,z[ee+j+10]=a.z,z[ee+j+11]=W.itemSize===4?a.w:1)}}v={count:m,texture:F,size:new yt(C,L)},s.set(u,v),u.addEventListener("dispose",N)}let g=0;for(let S=0;S<d.length;S++)g+=d[S];const x=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(e,"morphTargetBaseInfluence",x),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",v.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{const f=d===void 0?0:d.length;let m=r[u.id];if(m===void 0||m.length!==f){m=[];for(let _=0;_<f;_++)m[_]=[_,0];r[u.id]=m}for(let _=0;_<f;_++){const A=m[_];A[0]=_,A[1]=d[_]}m.sort(Hre);for(let _=0;_<8;_++)_<f&&m[_][1]?(o[_][0]=m[_][0],o[_][1]=m[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(Vre);const v=u.morphAttributes.position,g=u.morphAttributes.normal;let x=0;for(let _=0;_<8;_++){const A=o[_],T=A[0],E=A[1];T!==Number.MAX_SAFE_INTEGER&&E?(v&&u.getAttribute("morphTarget"+_)!==v[T]&&u.setAttribute("morphTarget"+_,v[T]),g&&u.getAttribute("morphNormal"+_)!==g[T]&&u.setAttribute("morphNormal"+_,g[T]),n[_]=E,x+=E):(v&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),g&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),n[_]=0)}const S=u.morphTargetsRelative?1:1-x;h.getUniforms().setValue(e,"morphTargetBaseInfluence",S),h.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function jre(e,t,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=t.get(l,u);if(n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),n.get(l)!==c&&(i.update(l.instanceMatrix,e.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,e.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;n.get(d)!==c&&(d.update(),n.set(d,c))}return h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}class Tz extends dn{constructor(t,i,r,n,s,a,o,l,c,u){if(u=u!==void 0?u:hp,u!==hp&&u!==Ug)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===hp&&(r=gd),r===void 0&&u===Ug&&(r=up),super(null,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=o!==void 0?o:Fn,this.minFilter=l!==void 0?l:Fn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const f9=new dn,p9=new Tz(1,1);p9.compareFunction=yz;const m9=new w2,g9=new bz,v9=new S_,CF=[],PF=[],DF=new Float32Array(16),RF=new Float32Array(9),IF=new Float32Array(4);function xx(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let s=CF[n];if(s===void 0&&(s=new Float32Array(n),CF[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Es(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Ts(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function b2(e,t){let i=PF[t];i===void 0&&(i=new Int32Array(t),PF[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function Wre(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function Xre(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Es(i,t))return;e.uniform2fv(this.addr,t),Ts(i,t)}}function qre(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Es(i,t))return;e.uniform3fv(this.addr,t),Ts(i,t)}}function Yre(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Es(i,t))return;e.uniform4fv(this.addr,t),Ts(i,t)}}function Qre(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Es(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ts(i,t)}else{if(Es(i,r))return;IF.set(r),e.uniformMatrix2fv(this.addr,!1,IF),Ts(i,r)}}function Zre(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Es(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ts(i,t)}else{if(Es(i,r))return;RF.set(r),e.uniformMatrix3fv(this.addr,!1,RF),Ts(i,r)}}function Kre(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Es(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ts(i,t)}else{if(Es(i,r))return;DF.set(r),e.uniformMatrix4fv(this.addr,!1,DF),Ts(i,r)}}function Jre(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function $re(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Es(i,t))return;e.uniform2iv(this.addr,t),Ts(i,t)}}function ene(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Es(i,t))return;e.uniform3iv(this.addr,t),Ts(i,t)}}function tne(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Es(i,t))return;e.uniform4iv(this.addr,t),Ts(i,t)}}function ine(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function rne(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Es(i,t))return;e.uniform2uiv(this.addr,t),Ts(i,t)}}function nne(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Es(i,t))return;e.uniform3uiv(this.addr,t),Ts(i,t)}}function sne(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Es(i,t))return;e.uniform4uiv(this.addr,t),Ts(i,t)}}function ane(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n);const s=this.type===e.SAMPLER_2D_SHADOW?p9:f9;i.setTexture2D(t||s,n)}function one(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||g9,n)}function lne(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||v9,n)}function cne(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||m9,n)}function une(e){switch(e){case 5126:return Wre;case 35664:return Xre;case 35665:return qre;case 35666:return Yre;case 35674:return Qre;case 35675:return Zre;case 35676:return Kre;case 5124:case 35670:return Jre;case 35667:case 35671:return $re;case 35668:case 35672:return ene;case 35669:case 35673:return tne;case 5125:return ine;case 36294:return rne;case 36295:return nne;case 36296:return sne;case 35678:case 36198:case 36298:case 36306:case 35682:return ane;case 35679:case 36299:case 36307:return one;case 35680:case 36300:case 36308:case 36293:return lne;case 36289:case 36303:case 36311:case 36292:return cne}}function hne(e,t){e.uniform1fv(this.addr,t)}function dne(e,t){const i=xx(t,this.size,2);e.uniform2fv(this.addr,i)}function fne(e,t){const i=xx(t,this.size,3);e.uniform3fv(this.addr,i)}function pne(e,t){const i=xx(t,this.size,4);e.uniform4fv(this.addr,i)}function mne(e,t){const i=xx(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function gne(e,t){const i=xx(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function vne(e,t){const i=xx(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function yne(e,t){e.uniform1iv(this.addr,t)}function xne(e,t){e.uniform2iv(this.addr,t)}function wne(e,t){e.uniform3iv(this.addr,t)}function bne(e,t){e.uniform4iv(this.addr,t)}function _ne(e,t){e.uniform1uiv(this.addr,t)}function Sne(e,t){e.uniform2uiv(this.addr,t)}function Mne(e,t){e.uniform3uiv(this.addr,t)}function Ane(e,t){e.uniform4uiv(this.addr,t)}function Ene(e,t,i){const r=this.cache,n=t.length,s=b2(i,n);Es(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||f9,s[a])}function Tne(e,t,i){const r=this.cache,n=t.length,s=b2(i,n);Es(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||g9,s[a])}function Cne(e,t,i){const r=this.cache,n=t.length,s=b2(i,n);Es(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||v9,s[a])}function Pne(e,t,i){const r=this.cache,n=t.length,s=b2(i,n);Es(r,s)||(e.uniform1iv(this.addr,s),Ts(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||m9,s[a])}function Dne(e){switch(e){case 5126:return hne;case 35664:return dne;case 35665:return fne;case 35666:return pne;case 35674:return mne;case 35675:return gne;case 35676:return vne;case 5124:case 35670:return yne;case 35667:case 35671:return xne;case 35668:case 35672:return wne;case 35669:case 35673:return bne;case 5125:return _ne;case 36294:return Sne;case 36295:return Mne;case 36296:return Ane;case 35678:case 36198:case 36298:case 36306:case 35682:return Ene;case 35679:case 36299:case 36307:return Tne;case 35680:case 36300:case 36308:case 36293:return Cne;case 36289:case 36303:case 36311:case 36292:return Pne}}class Rne{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.setValue=une(i.type)}}class Ine{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=Dne(i.type)}}class Lne{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,i[o.id],r)}}}const DP=/(\w+)(\])?(\[|\.)?/g;function LF(e,t){e.seq.push(t),e.map[t.id]=t}function One(e,t,i){const r=e.name,n=r.length;for(DP.lastIndex=0;;){const s=DP.exec(r),a=DP.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){LF(i,c===void 0?new Rne(o,e,t):new Ine(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new Lne(o),LF(i,h)),i=h}}}class bE{constructor(t,i){this.seq=[],this.map={};const r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=t.getActiveUniform(i,n),a=t.getUniformLocation(i,s.name);One(s,a,this)}}setValue(t,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(t,r,n)}setOptional(t,i,r){const n=i[r];n!==void 0&&this.setValue(t,r,n)}static upload(t,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,i){const r=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in i&&r.push(a)}return r}}function OF(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}const zne=37297;let Bne=0;function Nne(e,t){const i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function Une(e){const t=Tr.getPrimaries(Tr.workingColorSpace),i=Tr.getPrimaries(e);let r;switch(t===i?r="":t===Rb&&i===Db?r="LinearDisplayP3ToLinearSRGB":t===Db&&i===Rb&&(r="LinearSRGBToLinearDisplayP3"),e){case Qu:case b_:return[r,"LinearTransferOETF"];case bs:case x2:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}function zF(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Nne(e.getShaderSource(t),a)}else return n}function Fne(e,t){const i=Une(t);return`vec4 ${e}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function kne(e,t){let i;switch(t){case L8:i="Linear";break;case O8:i="Reinhard";break;case z8:i="OptimizedCineon";break;case oz:i="ACESFilmic";break;case B8:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Vne(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Lw).join(`
`)}function Hne(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function Gne(e,t){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n),a=s.name;let o=1;s.type===e.FLOAT_MAT2&&(o=2),s.type===e.FLOAT_MAT3&&(o=3),s.type===e.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Lw(e){return e!==""}function BF(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function NF(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const jne=/^[ \t]*#include +<([\w\d./]+)>/gm;function _I(e){return e.replace(jne,Xne)}const Wne=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Xne(e,t){let i=Wi[t];if(i===void 0){const r=Wne.get(t);if(r!==void 0)i=Wi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,r);else throw new Error("Can not resolve #include <"+t+">")}return _I(i)}const qne=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function UF(e){return e.replace(qne,Yne)}function Yne(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function FF(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Qne(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===m2?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Xw?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Ic&&(t="SHADOWMAP_TYPE_VSM"),t}function Zne(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Dd:case xp:t="ENVMAP_TYPE_CUBE";break;case yx:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Kne(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case xp:t="ENVMAP_MODE_REFRACTION";break}return t}function Jne(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case w_:t="ENVMAP_BLENDING_MULTIPLY";break;case R8:t="ENVMAP_BLENDING_MIX";break;case I8:t="ENVMAP_BLENDING_ADD";break}return t}function $ne(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function ese(e,t,i,r){const n=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=Qne(i),c=Zne(i),u=Kne(i),h=Jne(i),d=$ne(i),f=i.isWebGL2?"":Vne(i),m=Hne(s),v=n.createProgram();let g,x,S=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,m].filter(Lw).join(`
`),g.length>0&&(g+=`
`),x=[f,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,m].filter(Lw).join(`
`),x.length>0&&(x+=`
`)):(g=[FF(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,m,i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Lw).join(`
`),x=[f,FF(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ku?"#define TONE_MAPPING":"",i.toneMapping!==ku?Wi.tonemapping_pars_fragment:"",i.toneMapping!==ku?kne("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Wi.colorspace_pars_fragment,Fne("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Lw).join(`
`)),a=_I(a),a=BF(a,i),a=NF(a,i),o=_I(o),o=BF(o,i),o=NF(o,i),a=UF(a),o=UF(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,x=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===xI?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===xI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const _=S+g+a,A=S+x+o,T=OF(n,n.VERTEX_SHADER,_),E=OF(n,n.FRAGMENT_SHADER,A);n.attachShader(v,T),n.attachShader(v,E),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v);function I(z){if(e.debug.checkShaderErrors){const F=n.getProgramInfoLog(v).trim(),G=n.getShaderInfoLog(T).trim(),N=n.getShaderInfoLog(E).trim();let q=!0,ie=!0;if(n.getProgramParameter(v,n.LINK_STATUS)===!1)if(q=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(n,v,T,E);else{const Q=zF(n,T,"vertex"),W=zF(n,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,n.VALIDATE_STATUS)+`

Program Info Log: `+F+`
`+Q+`
`+W)}else F!==""?console.warn("THREE.WebGLProgram: Program Info Log:",F):(G===""||N==="")&&(ie=!1);ie&&(z.diagnostics={runnable:q,programLog:F,vertexShader:{log:G,prefix:g},fragmentShader:{log:N,prefix:x}})}n.deleteShader(T),n.deleteShader(E),P=new bE(n,v),C=Gne(n,v)}let P;this.getUniforms=function(){return P===void 0&&I(this),P};let C;this.getAttributes=function(){return C===void 0&&I(this),C};let L=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return L===!1&&(L=n.getProgramParameter(v,zne)),L},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Bne++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=T,this.fragmentShader=E,this}let tse=0;class ise{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,r=t.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let r=i.get(t);return r===void 0&&(r=new Set,i.set(t,r)),r}_getShaderStage(t){const i=this.shaderCache;let r=i.get(t);return r===void 0&&(r=new rse(t),i.set(t,r)),r}}class rse{constructor(t){this.id=tse++,this.code=t,this.usedTimes=0}}function nse(e,t,i,r,n,s,a){const o=new Tg,l=new ise,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures;let f=n.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(C){return C===0?"uv":`uv${C}`}function g(C,L,z,F,G){const N=F.fog,q=G.geometry,ie=C.isMeshStandardMaterial?F.environment:null,Q=(C.isMeshStandardMaterial?i:t).get(C.envMap||ie),W=Q&&Q.mapping===yx?Q.image.height:null,ee=m[C.type];C.precision!==null&&(f=n.getMaxPrecision(C.precision),f!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",f,"instead."));const K=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,j=K!==void 0?K.length:0;let $=0;q.morphAttributes.position!==void 0&&($=1),q.morphAttributes.normal!==void 0&&($=2),q.morphAttributes.color!==void 0&&($=3);let se,re,he,oe;if(ee){const Qi=Lc[ee];se=Qi.vertexShader,re=Qi.fragmentShader}else se=C.vertexShader,re=C.fragmentShader,l.update(C),he=l.getVertexShaderID(C),oe=l.getFragmentShaderID(C);const ve=e.getRenderTarget(),xe=G.isInstancedMesh===!0,be=G.isBatchedMesh===!0,Me=!!C.map,Te=!!C.matcap,ae=!!Q,Ce=!!C.aoMap,Ie=!!C.lightMap,Be=!!C.bumpMap,Ve=!!C.normalMap,lt=!!C.displacementMap,We=!!C.emissiveMap,je=!!C.metalnessMap,xt=!!C.roughnessMap,Mt=C.anisotropy>0,de=C.clearcoat>0,V=C.iridescence>0,X=C.sheen>0,we=C.transmission>0,J=Mt&&!!C.anisotropyMap,Le=de&&!!C.clearcoatMap,qe=de&&!!C.clearcoatNormalMap,ct=de&&!!C.clearcoatRoughnessMap,Pe=V&&!!C.iridescenceMap,nt=V&&!!C.iridescenceThicknessMap,gt=X&&!!C.sheenColorMap,Tt=X&&!!C.sheenRoughnessMap,rt=!!C.specularMap,Dt=!!C.specularColorMap,ge=!!C.specularIntensityMap,$e=we&&!!C.transmissionMap,mt=we&&!!C.thicknessMap,me=!!C.gradientMap,Ne=!!C.alphaMap,ue=C.alphaTest>0,et=!!C.alphaHash,at=!!C.extensions,Ze=!!q.attributes.uv1,bt=!!q.attributes.uv2,Ft=!!q.attributes.uv3;let ui=ku;return C.toneMapped&&(ve===null||ve.isXRRenderTarget===!0)&&(ui=e.toneMapping),{isWebGL2:u,shaderID:ee,shaderType:C.type,shaderName:C.name,vertexShader:se,fragmentShader:re,defines:C.defines,customVertexShaderID:he,customFragmentShaderID:oe,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:f,batching:be,instancing:xe,instancingColor:xe&&G.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:ve===null?e.outputColorSpace:ve.isXRRenderTarget===!0?ve.texture.colorSpace:Qu,map:Me,matcap:Te,envMap:ae,envMapMode:ae&&Q.mapping,envMapCubeUVHeight:W,aoMap:Ce,lightMap:Ie,bumpMap:Be,normalMap:Ve,displacementMap:d&&lt,emissiveMap:We,normalMapObjectSpace:Ve&&C.normalMapType===K8,normalMapTangentSpace:Ve&&C.normalMapType===Pp,metalnessMap:je,roughnessMap:xt,anisotropy:Mt,anisotropyMap:J,clearcoat:de,clearcoatMap:Le,clearcoatNormalMap:qe,clearcoatRoughnessMap:ct,iridescence:V,iridescenceMap:Pe,iridescenceThicknessMap:nt,sheen:X,sheenColorMap:gt,sheenRoughnessMap:Tt,specularMap:rt,specularColorMap:Dt,specularIntensityMap:ge,transmission:we,transmissionMap:$e,thicknessMap:mt,gradientMap:me,opaque:C.transparent===!1&&C.blending===Mg,alphaMap:Ne,alphaTest:ue,alphaHash:et,combine:C.combine,mapUv:Me&&v(C.map.channel),aoMapUv:Ce&&v(C.aoMap.channel),lightMapUv:Ie&&v(C.lightMap.channel),bumpMapUv:Be&&v(C.bumpMap.channel),normalMapUv:Ve&&v(C.normalMap.channel),displacementMapUv:lt&&v(C.displacementMap.channel),emissiveMapUv:We&&v(C.emissiveMap.channel),metalnessMapUv:je&&v(C.metalnessMap.channel),roughnessMapUv:xt&&v(C.roughnessMap.channel),anisotropyMapUv:J&&v(C.anisotropyMap.channel),clearcoatMapUv:Le&&v(C.clearcoatMap.channel),clearcoatNormalMapUv:qe&&v(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ct&&v(C.clearcoatRoughnessMap.channel),iridescenceMapUv:Pe&&v(C.iridescenceMap.channel),iridescenceThicknessMapUv:nt&&v(C.iridescenceThicknessMap.channel),sheenColorMapUv:gt&&v(C.sheenColorMap.channel),sheenRoughnessMapUv:Tt&&v(C.sheenRoughnessMap.channel),specularMapUv:rt&&v(C.specularMap.channel),specularColorMapUv:Dt&&v(C.specularColorMap.channel),specularIntensityMapUv:ge&&v(C.specularIntensityMap.channel),transmissionMapUv:$e&&v(C.transmissionMap.channel),thicknessMapUv:mt&&v(C.thicknessMap.channel),alphaMapUv:Ne&&v(C.alphaMap.channel),vertexTangents:!!q.attributes.tangent&&(Ve||Mt),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,vertexUv1s:Ze,vertexUv2s:bt,vertexUv3s:Ft,pointsUvs:G.isPoints===!0&&!!q.attributes.uv&&(Me||Ne),fog:!!N,useFog:C.fog===!0,fogExp2:N&&N.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:G.isSkinnedMesh===!0,morphTargets:q.morphAttributes.position!==void 0,morphNormals:q.morphAttributes.normal!==void 0,morphColors:q.morphAttributes.color!==void 0,morphTargetsCount:j,morphTextureStride:$,numDirLights:L.directional.length,numPointLights:L.point.length,numSpotLights:L.spot.length,numSpotLightMaps:L.spotLightMap.length,numRectAreaLights:L.rectArea.length,numHemiLights:L.hemi.length,numDirLightShadows:L.directionalShadowMap.length,numPointLightShadows:L.pointShadowMap.length,numSpotLightShadows:L.spotShadowMap.length,numSpotLightShadowsWithMaps:L.numSpotLightShadowsWithMaps,numLightProbes:L.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:e.shadowMap.enabled&&z.length>0,shadowMapType:e.shadowMap.type,toneMapping:ui,useLegacyLights:e._useLegacyLights,decodeVideoTexture:Me&&C.map.isVideoTexture===!0&&Tr.getTransfer(C.map.colorSpace)===Kr,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===Oc,flipSided:C.side===uo,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:at&&C.extensions.derivatives===!0,extensionFragDepth:at&&C.extensions.fragDepth===!0,extensionDrawBuffers:at&&C.extensions.drawBuffers===!0,extensionShaderTextureLOD:at&&C.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:C.customProgramCacheKey()}}function x(C){const L=[];if(C.shaderID?L.push(C.shaderID):(L.push(C.customVertexShaderID),L.push(C.customFragmentShaderID)),C.defines!==void 0)for(const z in C.defines)L.push(z),L.push(C.defines[z]);return C.isRawShaderMaterial===!1&&(S(L,C),_(L,C),L.push(e.outputColorSpace)),L.push(C.customProgramCacheKey),L.join()}function S(C,L){C.push(L.precision),C.push(L.outputColorSpace),C.push(L.envMapMode),C.push(L.envMapCubeUVHeight),C.push(L.mapUv),C.push(L.alphaMapUv),C.push(L.lightMapUv),C.push(L.aoMapUv),C.push(L.bumpMapUv),C.push(L.normalMapUv),C.push(L.displacementMapUv),C.push(L.emissiveMapUv),C.push(L.metalnessMapUv),C.push(L.roughnessMapUv),C.push(L.anisotropyMapUv),C.push(L.clearcoatMapUv),C.push(L.clearcoatNormalMapUv),C.push(L.clearcoatRoughnessMapUv),C.push(L.iridescenceMapUv),C.push(L.iridescenceThicknessMapUv),C.push(L.sheenColorMapUv),C.push(L.sheenRoughnessMapUv),C.push(L.specularMapUv),C.push(L.specularColorMapUv),C.push(L.specularIntensityMapUv),C.push(L.transmissionMapUv),C.push(L.thicknessMapUv),C.push(L.combine),C.push(L.fogExp2),C.push(L.sizeAttenuation),C.push(L.morphTargetsCount),C.push(L.morphAttributeCount),C.push(L.numDirLights),C.push(L.numPointLights),C.push(L.numSpotLights),C.push(L.numSpotLightMaps),C.push(L.numHemiLights),C.push(L.numRectAreaLights),C.push(L.numDirLightShadows),C.push(L.numPointLightShadows),C.push(L.numSpotLightShadows),C.push(L.numSpotLightShadowsWithMaps),C.push(L.numLightProbes),C.push(L.shadowMapType),C.push(L.toneMapping),C.push(L.numClippingPlanes),C.push(L.numClipIntersection),C.push(L.depthPacking)}function _(C,L){o.disableAll(),L.isWebGL2&&o.enable(0),L.supportsVertexTextures&&o.enable(1),L.instancing&&o.enable(2),L.instancingColor&&o.enable(3),L.matcap&&o.enable(4),L.envMap&&o.enable(5),L.normalMapObjectSpace&&o.enable(6),L.normalMapTangentSpace&&o.enable(7),L.clearcoat&&o.enable(8),L.iridescence&&o.enable(9),L.alphaTest&&o.enable(10),L.vertexColors&&o.enable(11),L.vertexAlphas&&o.enable(12),L.vertexUv1s&&o.enable(13),L.vertexUv2s&&o.enable(14),L.vertexUv3s&&o.enable(15),L.vertexTangents&&o.enable(16),L.anisotropy&&o.enable(17),L.alphaHash&&o.enable(18),L.batching&&o.enable(19),C.push(o.mask),o.disableAll(),L.fog&&o.enable(0),L.useFog&&o.enable(1),L.flatShading&&o.enable(2),L.logarithmicDepthBuffer&&o.enable(3),L.skinning&&o.enable(4),L.morphTargets&&o.enable(5),L.morphNormals&&o.enable(6),L.morphColors&&o.enable(7),L.premultipliedAlpha&&o.enable(8),L.shadowMapEnabled&&o.enable(9),L.useLegacyLights&&o.enable(10),L.doubleSided&&o.enable(11),L.flipSided&&o.enable(12),L.useDepthPacking&&o.enable(13),L.dithering&&o.enable(14),L.transmission&&o.enable(15),L.sheen&&o.enable(16),L.opaque&&o.enable(17),L.pointsUvs&&o.enable(18),L.decodeVideoTexture&&o.enable(19),C.push(o.mask)}function A(C){const L=m[C.type];let z;if(L){const F=Lc[L];z=h9.clone(F.uniforms)}else z=C.uniforms;return z}function T(C,L){let z;for(let F=0,G=c.length;F<G;F++){const N=c[F];if(N.cacheKey===L){z=N,++z.usedTimes;break}}return z===void 0&&(z=new ese(e,L,C,s),c.push(z)),z}function E(C){if(--C.usedTimes===0){const L=c.indexOf(C);c[L]=c[c.length-1],c.pop(),C.destroy()}}function I(C){l.remove(C)}function P(){l.dispose()}return{getParameters:g,getProgramCacheKey:x,getUniforms:A,acquireProgram:T,releaseProgram:E,releaseShaderCache:I,programs:c,dispose:P}}function sse(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function ase(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function kF(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function VF(){const e=[];let t=0;const i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,f,m,v,g){let x=e[t];return x===void 0?(x={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:v,group:g},e[t]=x):(x.id=h.id,x.object=h,x.geometry=d,x.material=f,x.groupOrder=m,x.renderOrder=h.renderOrder,x.z=v,x.group=g),t++,x}function o(h,d,f,m,v,g){const x=a(h,d,f,m,v,g);f.transmission>0?r.push(x):f.transparent===!0?n.push(x):i.push(x)}function l(h,d,f,m,v,g){const x=a(h,d,f,m,v,g);f.transmission>0?r.unshift(x):f.transparent===!0?n.unshift(x):i.unshift(x)}function c(h,d){i.length>1&&i.sort(h||ase),r.length>1&&r.sort(d||kF),n.length>1&&n.sort(d||kF)}function u(){for(let h=t,d=e.length;h<d;h++){const f=e[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function ose(){let e=new WeakMap;function t(r,n){const s=e.get(r);let a;return s===void 0?(a=new VF,e.set(r,[a])):n>=s.length?(a=new VF,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function lse(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new pe,color:new Zt};break;case"SpotLight":i={position:new pe,direction:new pe,color:new Zt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new pe,color:new Zt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new pe,skyColor:new Zt,groundColor:new Zt};break;case"RectAreaLight":i={color:new Zt,position:new pe,halfWidth:new pe,halfHeight:new pe};break}return e[t.id]=i,i}}}function cse(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let use=0;function hse(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function dse(e,t){const i=new lse,r=cse(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new pe);const s=new pe,a=new Ci,o=new Ci;function l(u,h){let d=0,f=0,m=0;for(let F=0;F<9;F++)n.probe[F].set(0,0,0);let v=0,g=0,x=0,S=0,_=0,A=0,T=0,E=0,I=0,P=0,C=0;u.sort(hse);const L=h===!0?Math.PI:1;for(let F=0,G=u.length;F<G;F++){const N=u[F],q=N.color,ie=N.intensity,Q=N.distance,W=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)d+=q.r*ie*L,f+=q.g*ie*L,m+=q.b*ie*L;else if(N.isLightProbe){for(let ee=0;ee<9;ee++)n.probe[ee].addScaledVector(N.sh.coefficients[ee],ie);C++}else if(N.isDirectionalLight){const ee=i.get(N);if(ee.color.copy(N.color).multiplyScalar(N.intensity*L),N.castShadow){const K=N.shadow,j=r.get(N);j.shadowBias=K.bias,j.shadowNormalBias=K.normalBias,j.shadowRadius=K.radius,j.shadowMapSize=K.mapSize,n.directionalShadow[v]=j,n.directionalShadowMap[v]=W,n.directionalShadowMatrix[v]=N.shadow.matrix,A++}n.directional[v]=ee,v++}else if(N.isSpotLight){const ee=i.get(N);ee.position.setFromMatrixPosition(N.matrixWorld),ee.color.copy(q).multiplyScalar(ie*L),ee.distance=Q,ee.coneCos=Math.cos(N.angle),ee.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),ee.decay=N.decay,n.spot[x]=ee;const K=N.shadow;if(N.map&&(n.spotLightMap[I]=N.map,I++,K.updateMatrices(N),N.castShadow&&P++),n.spotLightMatrix[x]=K.matrix,N.castShadow){const j=r.get(N);j.shadowBias=K.bias,j.shadowNormalBias=K.normalBias,j.shadowRadius=K.radius,j.shadowMapSize=K.mapSize,n.spotShadow[x]=j,n.spotShadowMap[x]=W,E++}x++}else if(N.isRectAreaLight){const ee=i.get(N);ee.color.copy(q).multiplyScalar(ie),ee.halfWidth.set(N.width*.5,0,0),ee.halfHeight.set(0,N.height*.5,0),n.rectArea[S]=ee,S++}else if(N.isPointLight){const ee=i.get(N);if(ee.color.copy(N.color).multiplyScalar(N.intensity*L),ee.distance=N.distance,ee.decay=N.decay,N.castShadow){const K=N.shadow,j=r.get(N);j.shadowBias=K.bias,j.shadowNormalBias=K.normalBias,j.shadowRadius=K.radius,j.shadowMapSize=K.mapSize,j.shadowCameraNear=K.camera.near,j.shadowCameraFar=K.camera.far,n.pointShadow[g]=j,n.pointShadowMap[g]=W,n.pointShadowMatrix[g]=N.shadow.matrix,T++}n.point[g]=ee,g++}else if(N.isHemisphereLight){const ee=i.get(N);ee.skyColor.copy(N.color).multiplyScalar(ie*L),ee.groundColor.copy(N.groundColor).multiplyScalar(ie*L),n.hemi[_]=ee,_++}}S>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Vt.LTC_FLOAT_1,n.rectAreaLTC2=Vt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Vt.LTC_HALF_1,n.rectAreaLTC2=Vt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=m;const z=n.hash;(z.directionalLength!==v||z.pointLength!==g||z.spotLength!==x||z.rectAreaLength!==S||z.hemiLength!==_||z.numDirectionalShadows!==A||z.numPointShadows!==T||z.numSpotShadows!==E||z.numSpotMaps!==I||z.numLightProbes!==C)&&(n.directional.length=v,n.spot.length=x,n.rectArea.length=S,n.point.length=g,n.hemi.length=_,n.directionalShadow.length=A,n.directionalShadowMap.length=A,n.pointShadow.length=T,n.pointShadowMap.length=T,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=A,n.pointShadowMatrix.length=T,n.spotLightMatrix.length=E+I-P,n.spotLightMap.length=I,n.numSpotLightShadowsWithMaps=P,n.numLightProbes=C,z.directionalLength=v,z.pointLength=g,z.spotLength=x,z.rectAreaLength=S,z.hemiLength=_,z.numDirectionalShadows=A,z.numPointShadows=T,z.numSpotShadows=E,z.numSpotMaps=I,z.numLightProbes=C,n.version=use++)}function c(u,h){let d=0,f=0,m=0,v=0,g=0;const x=h.matrixWorldInverse;for(let S=0,_=u.length;S<_;S++){const A=u[S];if(A.isDirectionalLight){const T=n.directional[d];T.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(x),d++}else if(A.isSpotLight){const T=n.spot[m];T.position.setFromMatrixPosition(A.matrixWorld),T.position.applyMatrix4(x),T.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(x),m++}else if(A.isRectAreaLight){const T=n.rectArea[v];T.position.setFromMatrixPosition(A.matrixWorld),T.position.applyMatrix4(x),o.identity(),a.copy(A.matrixWorld),a.premultiply(x),o.extractRotation(a),T.halfWidth.set(A.width*.5,0,0),T.halfHeight.set(0,A.height*.5,0),T.halfWidth.applyMatrix4(o),T.halfHeight.applyMatrix4(o),v++}else if(A.isPointLight){const T=n.point[f];T.position.setFromMatrixPosition(A.matrixWorld),T.position.applyMatrix4(x),f++}else if(A.isHemisphereLight){const T=n.hemi[g];T.direction.setFromMatrixPosition(A.matrixWorld),T.direction.transformDirection(x),g++}}}return{setup:l,setupView:c,state:n}}function HF(e,t){const i=new dse(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(h){r.push(h)}function o(h){n.push(h)}function l(h){i.setup(r,h)}function c(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function fse(e,t){let i=new WeakMap;function r(s,a=0){const o=i.get(s);let l;return o===void 0?(l=new HF(e,t),i.set(s,[l])):a>=o.length?(l=new HF(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}class Cz extends ga{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Q8,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Pz extends ga{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const pse=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,mse=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function gse(e,t,i){let r=new M_;const n=new yt,s=new yt,a=new Pr,o=new Cz({depthPacking:Z8}),l=new Pz,c={},u=i.maxTextureSize,h={[Pd]:uo,[uo]:Pd,[Oc]:Oc},d=new Zu({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yt},radius:{value:4}},vertexShader:pse,fragmentShader:mse}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new Gi;m.setAttribute("position",new Ir(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new rs(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=m2;let x=this.type;this.render=function(T,E,I){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||T.length===0)return;const P=e.getRenderTarget(),C=e.getActiveCubeFace(),L=e.getActiveMipmapLevel(),z=e.state;z.setBlending(Md),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);const F=x!==Ic&&this.type===Ic,G=x===Ic&&this.type!==Ic;for(let N=0,q=T.length;N<q;N++){const ie=T[N],Q=ie.shadow;if(Q===void 0){console.warn("THREE.WebGLShadowMap:",ie,"has no shadow.");continue}if(Q.autoUpdate===!1&&Q.needsUpdate===!1)continue;n.copy(Q.mapSize);const W=Q.getFrameExtents();if(n.multiply(W),s.copy(Q.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/W.x),n.x=s.x*W.x,Q.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/W.y),n.y=s.y*W.y,Q.mapSize.y=s.y)),Q.map===null||F===!0||G===!0){const K=this.type!==Ic?{minFilter:Fn,magFilter:Fn}:{};Q.map!==null&&Q.map.dispose(),Q.map=new qc(n.x,n.y,K),Q.map.texture.name=ie.name+".shadowMap",Q.camera.updateProjectionMatrix()}e.setRenderTarget(Q.map),e.clear();const ee=Q.getViewportCount();for(let K=0;K<ee;K++){const j=Q.getViewport(K);a.set(s.x*j.x,s.y*j.y,s.x*j.z,s.y*j.w),z.viewport(a),Q.updateMatrices(ie,K),r=Q.getFrustum(),A(E,I,Q.camera,ie,this.type)}Q.isPointLightShadow!==!0&&this.type===Ic&&S(Q,I),Q.needsUpdate=!1}x=this.type,g.needsUpdate=!1,e.setRenderTarget(P,C,L)};function S(T,E){const I=t.update(v);d.defines.VSM_SAMPLES!==T.blurSamples&&(d.defines.VSM_SAMPLES=T.blurSamples,f.defines.VSM_SAMPLES=T.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new qc(n.x,n.y)),d.uniforms.shadow_pass.value=T.map.texture,d.uniforms.resolution.value=T.mapSize,d.uniforms.radius.value=T.radius,e.setRenderTarget(T.mapPass),e.clear(),e.renderBufferDirect(E,null,I,d,v,null),f.uniforms.shadow_pass.value=T.mapPass.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,e.setRenderTarget(T.map),e.clear(),e.renderBufferDirect(E,null,I,f,v,null)}function _(T,E,I,P){let C=null;const L=I.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(L!==void 0)C=L;else if(C=I.isPointLight===!0?l:o,e.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const z=C.uuid,F=E.uuid;let G=c[z];G===void 0&&(G={},c[z]=G);let N=G[F];N===void 0&&(N=C.clone(),G[F]=N),C=N}if(C.visible=E.visible,C.wireframe=E.wireframe,P===Ic?C.side=E.shadowSide!==null?E.shadowSide:E.side:C.side=E.shadowSide!==null?E.shadowSide:h[E.side],C.alphaMap=E.alphaMap,C.alphaTest=E.alphaTest,C.map=E.map,C.clipShadows=E.clipShadows,C.clippingPlanes=E.clippingPlanes,C.clipIntersection=E.clipIntersection,C.displacementMap=E.displacementMap,C.displacementScale=E.displacementScale,C.displacementBias=E.displacementBias,C.wireframeLinewidth=E.wireframeLinewidth,C.linewidth=E.linewidth,I.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const z=e.properties.get(C);z.light=I}return C}function A(T,E,I,P,C){if(T.visible===!1)return;if(T.layers.test(E.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&C===Ic)&&(!T.frustumCulled||r.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,T.matrixWorld);const F=t.update(T),G=T.material;if(Array.isArray(G)){const N=F.groups;for(let q=0,ie=N.length;q<ie;q++){const Q=N[q],W=G[Q.materialIndex];if(W&&W.visible){const ee=_(T,W,P,C);T.onBeforeShadow(e,T,E,I,F,ee,Q),e.renderBufferDirect(I,null,F,ee,T,Q),T.onAfterShadow(e,T,E,I,F,ee,Q)}}}else if(G.visible){const N=_(T,G,P,C);T.onBeforeShadow(e,T,E,I,F,N,null),e.renderBufferDirect(I,null,F,N,T,null),T.onAfterShadow(e,T,E,I,F,N,null)}}const z=T.children;for(let F=0,G=z.length;F<G;F++)A(z[F],E,I,P,C)}}function vse(e,t,i){const r=i.isWebGL2;function n(){let ue=!1;const et=new Pr;let at=null;const Ze=new Pr(0,0,0,0);return{setMask:function(bt){at!==bt&&!ue&&(e.colorMask(bt,bt,bt,bt),at=bt)},setLocked:function(bt){ue=bt},setClear:function(bt,Ft,ui,ci,Qi){Qi===!0&&(bt*=ci,Ft*=ci,ui*=ci),et.set(bt,Ft,ui,ci),Ze.equals(et)===!1&&(e.clearColor(bt,Ft,ui,ci),Ze.copy(et))},reset:function(){ue=!1,at=null,Ze.set(-1,0,0,0)}}}function s(){let ue=!1,et=null,at=null,Ze=null;return{setTest:function(bt){bt?be(e.DEPTH_TEST):Me(e.DEPTH_TEST)},setMask:function(bt){et!==bt&&!ue&&(e.depthMask(bt),et=bt)},setFunc:function(bt){if(at!==bt){switch(bt){case M8:e.depthFunc(e.NEVER);break;case A8:e.depthFunc(e.ALWAYS);break;case E8:e.depthFunc(e.LESS);break;case bb:e.depthFunc(e.LEQUAL);break;case T8:e.depthFunc(e.EQUAL);break;case C8:e.depthFunc(e.GEQUAL);break;case P8:e.depthFunc(e.GREATER);break;case D8:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}at=bt}},setLocked:function(bt){ue=bt},setClear:function(bt){Ze!==bt&&(e.clearDepth(bt),Ze=bt)},reset:function(){ue=!1,et=null,at=null,Ze=null}}}function a(){let ue=!1,et=null,at=null,Ze=null,bt=null,Ft=null,ui=null,ci=null,Qi=null;return{setTest:function(mi){ue||(mi?be(e.STENCIL_TEST):Me(e.STENCIL_TEST))},setMask:function(mi){et!==mi&&!ue&&(e.stencilMask(mi),et=mi)},setFunc:function(mi,Or,bn){(at!==mi||Ze!==Or||bt!==bn)&&(e.stencilFunc(mi,Or,bn),at=mi,Ze=Or,bt=bn)},setOp:function(mi,Or,bn){(Ft!==mi||ui!==Or||ci!==bn)&&(e.stencilOp(mi,Or,bn),Ft=mi,ui=Or,ci=bn)},setLocked:function(mi){ue=mi},setClear:function(mi){Qi!==mi&&(e.clearStencil(mi),Qi=mi)},reset:function(){ue=!1,et=null,at=null,Ze=null,bt=null,Ft=null,ui=null,ci=null,Qi=null}}}const o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap;let d={},f={},m=new WeakMap,v=[],g=null,x=!1,S=null,_=null,A=null,T=null,E=null,I=null,P=null,C=new Zt(0,0,0),L=0,z=!1,F=null,G=null,N=null,q=null,ie=null;const Q=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let W=!1,ee=0;const K=e.getParameter(e.VERSION);K.indexOf("WebGL")!==-1?(ee=parseFloat(/^WebGL (\d)/.exec(K)[1]),W=ee>=1):K.indexOf("OpenGL ES")!==-1&&(ee=parseFloat(/^OpenGL ES (\d)/.exec(K)[1]),W=ee>=2);let j=null,$={};const se=e.getParameter(e.SCISSOR_BOX),re=e.getParameter(e.VIEWPORT),he=new Pr().fromArray(se),oe=new Pr().fromArray(re);function ve(ue,et,at,Ze){const bt=new Uint8Array(4),Ft=e.createTexture();e.bindTexture(ue,Ft),e.texParameteri(ue,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(ue,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let ui=0;ui<at;ui++)r&&(ue===e.TEXTURE_3D||ue===e.TEXTURE_2D_ARRAY)?e.texImage3D(et,0,e.RGBA,1,1,Ze,0,e.RGBA,e.UNSIGNED_BYTE,bt):e.texImage2D(et+ui,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,bt);return Ft}const xe={};xe[e.TEXTURE_2D]=ve(e.TEXTURE_2D,e.TEXTURE_2D,1),xe[e.TEXTURE_CUBE_MAP]=ve(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(xe[e.TEXTURE_2D_ARRAY]=ve(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),xe[e.TEXTURE_3D]=ve(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),be(e.DEPTH_TEST),l.setFunc(bb),We(!1),je(kR),be(e.CULL_FACE),Ve(Md);function be(ue){d[ue]!==!0&&(e.enable(ue),d[ue]=!0)}function Me(ue){d[ue]!==!1&&(e.disable(ue),d[ue]=!1)}function Te(ue,et){return f[ue]!==et?(e.bindFramebuffer(ue,et),f[ue]=et,r&&(ue===e.DRAW_FRAMEBUFFER&&(f[e.FRAMEBUFFER]=et),ue===e.FRAMEBUFFER&&(f[e.DRAW_FRAMEBUFFER]=et)),!0):!1}function ae(ue,et){let at=v,Ze=!1;if(ue)if(at=m.get(et),at===void 0&&(at=[],m.set(et,at)),ue.isWebGLMultipleRenderTargets){const bt=ue.texture;if(at.length!==bt.length||at[0]!==e.COLOR_ATTACHMENT0){for(let Ft=0,ui=bt.length;Ft<ui;Ft++)at[Ft]=e.COLOR_ATTACHMENT0+Ft;at.length=bt.length,Ze=!0}}else at[0]!==e.COLOR_ATTACHMENT0&&(at[0]=e.COLOR_ATTACHMENT0,Ze=!0);else at[0]!==e.BACK&&(at[0]=e.BACK,Ze=!0);Ze&&(i.isWebGL2?e.drawBuffers(at):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(at))}function Ce(ue){return g!==ue?(e.useProgram(ue),g=ue,!0):!1}const Ie={[Yf]:e.FUNC_ADD,[c8]:e.FUNC_SUBTRACT,[u8]:e.FUNC_REVERSE_SUBTRACT};if(r)Ie[jR]=e.MIN,Ie[WR]=e.MAX;else{const ue=t.get("EXT_blend_minmax");ue!==null&&(Ie[jR]=ue.MIN_EXT,Ie[WR]=ue.MAX_EXT)}const Be={[h8]:e.ZERO,[d8]:e.ONE,[f8]:e.SRC_COLOR,[GE]:e.SRC_ALPHA,[x8]:e.SRC_ALPHA_SATURATE,[v8]:e.DST_COLOR,[m8]:e.DST_ALPHA,[p8]:e.ONE_MINUS_SRC_COLOR,[jE]:e.ONE_MINUS_SRC_ALPHA,[y8]:e.ONE_MINUS_DST_COLOR,[g8]:e.ONE_MINUS_DST_ALPHA,[w8]:e.CONSTANT_COLOR,[b8]:e.ONE_MINUS_CONSTANT_COLOR,[_8]:e.CONSTANT_ALPHA,[S8]:e.ONE_MINUS_CONSTANT_ALPHA};function Ve(ue,et,at,Ze,bt,Ft,ui,ci,Qi,mi){if(ue===Md){x===!0&&(Me(e.BLEND),x=!1);return}if(x===!1&&(be(e.BLEND),x=!0),ue!==l8){if(ue!==S||mi!==z){if((_!==Yf||E!==Yf)&&(e.blendEquation(e.FUNC_ADD),_=Yf,E=Yf),mi)switch(ue){case Mg:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case VR:e.blendFunc(e.ONE,e.ONE);break;case HR:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case GR:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ue);break}else switch(ue){case Mg:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case VR:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case HR:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case GR:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ue);break}A=null,T=null,I=null,P=null,C.set(0,0,0),L=0,S=ue,z=mi}return}bt=bt||et,Ft=Ft||at,ui=ui||Ze,(et!==_||bt!==E)&&(e.blendEquationSeparate(Ie[et],Ie[bt]),_=et,E=bt),(at!==A||Ze!==T||Ft!==I||ui!==P)&&(e.blendFuncSeparate(Be[at],Be[Ze],Be[Ft],Be[ui]),A=at,T=Ze,I=Ft,P=ui),(ci.equals(C)===!1||Qi!==L)&&(e.blendColor(ci.r,ci.g,ci.b,Qi),C.copy(ci),L=Qi),S=ue,z=!1}function lt(ue,et){ue.side===Oc?Me(e.CULL_FACE):be(e.CULL_FACE);let at=ue.side===uo;et&&(at=!at),We(at),ue.blending===Mg&&ue.transparent===!1?Ve(Md):Ve(ue.blending,ue.blendEquation,ue.blendSrc,ue.blendDst,ue.blendEquationAlpha,ue.blendSrcAlpha,ue.blendDstAlpha,ue.blendColor,ue.blendAlpha,ue.premultipliedAlpha),l.setFunc(ue.depthFunc),l.setTest(ue.depthTest),l.setMask(ue.depthWrite),o.setMask(ue.colorWrite);const Ze=ue.stencilWrite;c.setTest(Ze),Ze&&(c.setMask(ue.stencilWriteMask),c.setFunc(ue.stencilFunc,ue.stencilRef,ue.stencilFuncMask),c.setOp(ue.stencilFail,ue.stencilZFail,ue.stencilZPass)),Mt(ue.polygonOffset,ue.polygonOffsetFactor,ue.polygonOffsetUnits),ue.alphaToCoverage===!0?be(e.SAMPLE_ALPHA_TO_COVERAGE):Me(e.SAMPLE_ALPHA_TO_COVERAGE)}function We(ue){F!==ue&&(ue?e.frontFace(e.CW):e.frontFace(e.CCW),F=ue)}function je(ue){ue!==s8?(be(e.CULL_FACE),ue!==G&&(ue===kR?e.cullFace(e.BACK):ue===a8?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):Me(e.CULL_FACE),G=ue}function xt(ue){ue!==N&&(W&&e.lineWidth(ue),N=ue)}function Mt(ue,et,at){ue?(be(e.POLYGON_OFFSET_FILL),(q!==et||ie!==at)&&(e.polygonOffset(et,at),q=et,ie=at)):Me(e.POLYGON_OFFSET_FILL)}function de(ue){ue?be(e.SCISSOR_TEST):Me(e.SCISSOR_TEST)}function V(ue){ue===void 0&&(ue=e.TEXTURE0+Q-1),j!==ue&&(e.activeTexture(ue),j=ue)}function X(ue,et,at){at===void 0&&(j===null?at=e.TEXTURE0+Q-1:at=j);let Ze=$[at];Ze===void 0&&(Ze={type:void 0,texture:void 0},$[at]=Ze),(Ze.type!==ue||Ze.texture!==et)&&(j!==at&&(e.activeTexture(at),j=at),e.bindTexture(ue,et||xe[ue]),Ze.type=ue,Ze.texture=et)}function we(){const ue=$[j];ue!==void 0&&ue.type!==void 0&&(e.bindTexture(ue.type,null),ue.type=void 0,ue.texture=void 0)}function J(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Le(){try{e.compressedTexImage3D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function qe(){try{e.texSubImage2D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function ct(){try{e.texSubImage3D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Pe(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function nt(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function gt(){try{e.texStorage2D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Tt(){try{e.texStorage3D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function rt(){try{e.texImage2D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function Dt(){try{e.texImage3D.apply(e,arguments)}catch(ue){console.error("THREE.WebGLState:",ue)}}function ge(ue){he.equals(ue)===!1&&(e.scissor(ue.x,ue.y,ue.z,ue.w),he.copy(ue))}function $e(ue){oe.equals(ue)===!1&&(e.viewport(ue.x,ue.y,ue.z,ue.w),oe.copy(ue))}function mt(ue,et){let at=h.get(et);at===void 0&&(at=new WeakMap,h.set(et,at));let Ze=at.get(ue);Ze===void 0&&(Ze=e.getUniformBlockIndex(et,ue.name),at.set(ue,Ze))}function me(ue,et){const Ze=h.get(et).get(ue);u.get(et)!==Ze&&(e.uniformBlockBinding(et,Ze,ue.__bindingPointIndex),u.set(et,Ze))}function Ne(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),r===!0&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},j=null,$={},f={},m=new WeakMap,v=[],g=null,x=!1,S=null,_=null,A=null,T=null,E=null,I=null,P=null,C=new Zt(0,0,0),L=0,z=!1,F=null,G=null,N=null,q=null,ie=null,he.set(0,0,e.canvas.width,e.canvas.height),oe.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:be,disable:Me,bindFramebuffer:Te,drawBuffers:ae,useProgram:Ce,setBlending:Ve,setMaterial:lt,setFlipSided:We,setCullFace:je,setLineWidth:xt,setPolygonOffset:Mt,setScissorTest:de,activeTexture:V,bindTexture:X,unbindTexture:we,compressedTexImage2D:J,compressedTexImage3D:Le,texImage2D:rt,texImage3D:Dt,updateUBOMapping:mt,uniformBlockBinding:me,texStorage2D:gt,texStorage3D:Tt,texSubImage2D:qe,texSubImage3D:ct,compressedTexSubImage2D:Pe,compressedTexSubImage3D:nt,scissor:ge,viewport:$e,reset:Ne}}function yse(e,t,i,r,n,s,a){const o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let v;const g=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(V,X){return x?new OffscreenCanvas(V,X):Lb("canvas")}function _(V,X,we,J){let Le=1;if((V.width>J||V.height>J)&&(Le=J/Math.max(V.width,V.height)),Le<1||X===!0)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap){const qe=X?qE:Math.floor,ct=qe(Le*V.width),Pe=qe(Le*V.height);v===void 0&&(v=S(ct,Pe));const nt=we?S(ct,Pe):v;return nt.width=ct,nt.height=Pe,nt.getContext("2d").drawImage(V,0,0,ct,Pe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+V.width+"x"+V.height+") to ("+ct+"x"+Pe+")."),nt}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+V.width+"x"+V.height+")."),V;return V}function A(V){return wI(V.width)&&wI(V.height)}function T(V){return o?!1:V.wrapS!==Ia||V.wrapT!==Ia||V.minFilter!==Fn&&V.minFilter!==kn}function E(V,X){return V.generateMipmaps&&X&&V.minFilter!==Fn&&V.minFilter!==kn}function I(V){e.generateMipmap(V)}function P(V,X,we,J,Le=!1){if(o===!1)return X;if(V!==null){if(e[V]!==void 0)return e[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let qe=X;if(X===e.RED&&(we===e.FLOAT&&(qe=e.R32F),we===e.HALF_FLOAT&&(qe=e.R16F),we===e.UNSIGNED_BYTE&&(qe=e.R8)),X===e.RED_INTEGER&&(we===e.UNSIGNED_BYTE&&(qe=e.R8UI),we===e.UNSIGNED_SHORT&&(qe=e.R16UI),we===e.UNSIGNED_INT&&(qe=e.R32UI),we===e.BYTE&&(qe=e.R8I),we===e.SHORT&&(qe=e.R16I),we===e.INT&&(qe=e.R32I)),X===e.RG&&(we===e.FLOAT&&(qe=e.RG32F),we===e.HALF_FLOAT&&(qe=e.RG16F),we===e.UNSIGNED_BYTE&&(qe=e.RG8)),X===e.RGBA){const ct=Le?Pb:Tr.getTransfer(J);we===e.FLOAT&&(qe=e.RGBA32F),we===e.HALF_FLOAT&&(qe=e.RGBA16F),we===e.UNSIGNED_BYTE&&(qe=ct===Kr?e.SRGB8_ALPHA8:e.RGBA8),we===e.UNSIGNED_SHORT_4_4_4_4&&(qe=e.RGBA4),we===e.UNSIGNED_SHORT_5_5_5_1&&(qe=e.RGB5_A1)}return(qe===e.R16F||qe===e.R32F||qe===e.RG16F||qe===e.RG32F||qe===e.RGBA16F||qe===e.RGBA32F)&&t.get("EXT_color_buffer_float"),qe}function C(V,X,we){return E(V,we)===!0||V.isFramebufferTexture&&V.minFilter!==Fn&&V.minFilter!==kn?Math.log2(Math.max(X.width,X.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?X.mipmaps.length:1}function L(V){return V===Fn||V===WE||V===qw?e.NEAREST:e.LINEAR}function z(V){const X=V.target;X.removeEventListener("dispose",z),G(X),X.isVideoTexture&&m.delete(X)}function F(V){const X=V.target;X.removeEventListener("dispose",F),q(X)}function G(V){const X=r.get(V);if(X.__webglInit===void 0)return;const we=V.source,J=g.get(we);if(J){const Le=J[X.__cacheKey];Le.usedTimes--,Le.usedTimes===0&&N(V),Object.keys(J).length===0&&g.delete(we)}r.remove(V)}function N(V){const X=r.get(V);e.deleteTexture(X.__webglTexture);const we=V.source,J=g.get(we);delete J[X.__cacheKey],a.memory.textures--}function q(V){const X=V.texture,we=r.get(V),J=r.get(X);if(J.__webglTexture!==void 0&&(e.deleteTexture(J.__webglTexture),a.memory.textures--),V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let Le=0;Le<6;Le++){if(Array.isArray(we.__webglFramebuffer[Le]))for(let qe=0;qe<we.__webglFramebuffer[Le].length;qe++)e.deleteFramebuffer(we.__webglFramebuffer[Le][qe]);else e.deleteFramebuffer(we.__webglFramebuffer[Le]);we.__webglDepthbuffer&&e.deleteRenderbuffer(we.__webglDepthbuffer[Le])}else{if(Array.isArray(we.__webglFramebuffer))for(let Le=0;Le<we.__webglFramebuffer.length;Le++)e.deleteFramebuffer(we.__webglFramebuffer[Le]);else e.deleteFramebuffer(we.__webglFramebuffer);if(we.__webglDepthbuffer&&e.deleteRenderbuffer(we.__webglDepthbuffer),we.__webglMultisampledFramebuffer&&e.deleteFramebuffer(we.__webglMultisampledFramebuffer),we.__webglColorRenderbuffer)for(let Le=0;Le<we.__webglColorRenderbuffer.length;Le++)we.__webglColorRenderbuffer[Le]&&e.deleteRenderbuffer(we.__webglColorRenderbuffer[Le]);we.__webglDepthRenderbuffer&&e.deleteRenderbuffer(we.__webglDepthRenderbuffer)}if(V.isWebGLMultipleRenderTargets)for(let Le=0,qe=X.length;Le<qe;Le++){const ct=r.get(X[Le]);ct.__webglTexture&&(e.deleteTexture(ct.__webglTexture),a.memory.textures--),r.remove(X[Le])}r.remove(X),r.remove(V)}let ie=0;function Q(){ie=0}function W(){const V=ie;return V>=l&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+l),ie+=1,V}function ee(V){const X=[];return X.push(V.wrapS),X.push(V.wrapT),X.push(V.wrapR||0),X.push(V.magFilter),X.push(V.minFilter),X.push(V.anisotropy),X.push(V.internalFormat),X.push(V.format),X.push(V.type),X.push(V.generateMipmaps),X.push(V.premultiplyAlpha),X.push(V.flipY),X.push(V.unpackAlignment),X.push(V.colorSpace),X.join()}function K(V,X){const we=r.get(V);if(V.isVideoTexture&&Mt(V),V.isRenderTargetTexture===!1&&V.version>0&&we.__version!==V.version){const J=V.image;if(J===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(J.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{be(we,V,X);return}}i.bindTexture(e.TEXTURE_2D,we.__webglTexture,e.TEXTURE0+X)}function j(V,X){const we=r.get(V);if(V.version>0&&we.__version!==V.version){be(we,V,X);return}i.bindTexture(e.TEXTURE_2D_ARRAY,we.__webglTexture,e.TEXTURE0+X)}function $(V,X){const we=r.get(V);if(V.version>0&&we.__version!==V.version){be(we,V,X);return}i.bindTexture(e.TEXTURE_3D,we.__webglTexture,e.TEXTURE0+X)}function se(V,X){const we=r.get(V);if(V.version>0&&we.__version!==V.version){Me(we,V,X);return}i.bindTexture(e.TEXTURE_CUBE_MAP,we.__webglTexture,e.TEXTURE0+X)}const re={[Mb]:e.REPEAT,[Ia]:e.CLAMP_TO_EDGE,[Ab]:e.MIRRORED_REPEAT},he={[Fn]:e.NEAREST,[WE]:e.NEAREST_MIPMAP_NEAREST,[qw]:e.NEAREST_MIPMAP_LINEAR,[kn]:e.LINEAR,[lz]:e.LINEAR_MIPMAP_NEAREST,[wp]:e.LINEAR_MIPMAP_LINEAR},oe={[J8]:e.NEVER,[n9]:e.ALWAYS,[$8]:e.LESS,[yz]:e.LEQUAL,[e9]:e.EQUAL,[r9]:e.GEQUAL,[t9]:e.GREATER,[i9]:e.NOTEQUAL};function ve(V,X,we){if(we?(e.texParameteri(V,e.TEXTURE_WRAP_S,re[X.wrapS]),e.texParameteri(V,e.TEXTURE_WRAP_T,re[X.wrapT]),(V===e.TEXTURE_3D||V===e.TEXTURE_2D_ARRAY)&&e.texParameteri(V,e.TEXTURE_WRAP_R,re[X.wrapR]),e.texParameteri(V,e.TEXTURE_MAG_FILTER,he[X.magFilter]),e.texParameteri(V,e.TEXTURE_MIN_FILTER,he[X.minFilter])):(e.texParameteri(V,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(V,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(V===e.TEXTURE_3D||V===e.TEXTURE_2D_ARRAY)&&e.texParameteri(V,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),(X.wrapS!==Ia||X.wrapT!==Ia)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(V,e.TEXTURE_MAG_FILTER,L(X.magFilter)),e.texParameteri(V,e.TEXTURE_MIN_FILTER,L(X.minFilter)),X.minFilter!==Fn&&X.minFilter!==kn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),X.compareFunction&&(e.texParameteri(V,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(V,e.TEXTURE_COMPARE_FUNC,oe[X.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){const J=t.get("EXT_texture_filter_anisotropic");if(X.magFilter===Fn||X.minFilter!==qw&&X.minFilter!==wp||X.type===Nc&&t.has("OES_texture_float_linear")===!1||o===!1&&X.type===Qy&&t.has("OES_texture_half_float_linear")===!1)return;(X.anisotropy>1||r.get(X).__currentAnisotropy)&&(e.texParameterf(V,J.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(X.anisotropy,n.getMaxAnisotropy())),r.get(X).__currentAnisotropy=X.anisotropy)}}function xe(V,X){let we=!1;V.__webglInit===void 0&&(V.__webglInit=!0,X.addEventListener("dispose",z));const J=X.source;let Le=g.get(J);Le===void 0&&(Le={},g.set(J,Le));const qe=ee(X);if(qe!==V.__cacheKey){Le[qe]===void 0&&(Le[qe]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,we=!0),Le[qe].usedTimes++;const ct=Le[V.__cacheKey];ct!==void 0&&(Le[V.__cacheKey].usedTimes--,ct.usedTimes===0&&N(X)),V.__cacheKey=qe,V.__webglTexture=Le[qe].texture}return we}function be(V,X,we){let J=e.TEXTURE_2D;(X.isDataArrayTexture||X.isCompressedArrayTexture)&&(J=e.TEXTURE_2D_ARRAY),X.isData3DTexture&&(J=e.TEXTURE_3D);const Le=xe(V,X),qe=X.source;i.bindTexture(J,V.__webglTexture,e.TEXTURE0+we);const ct=r.get(qe);if(qe.version!==ct.__version||Le===!0){i.activeTexture(e.TEXTURE0+we);const Pe=Tr.getPrimaries(Tr.workingColorSpace),nt=X.colorSpace===hl?null:Tr.getPrimaries(X.colorSpace),gt=X.colorSpace===hl||Pe===nt?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,X.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,X.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,X.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,gt);const Tt=T(X)&&A(X.image)===!1;let rt=_(X.image,Tt,!1,u);rt=de(X,rt);const Dt=A(rt)||o,ge=s.convert(X.format,X.colorSpace);let $e=s.convert(X.type),mt=P(X.internalFormat,ge,$e,X.colorSpace,X.isVideoTexture);ve(J,X,Dt);let me;const Ne=X.mipmaps,ue=o&&X.isVideoTexture!==!0&&mt!==mz,et=ct.__version===void 0||Le===!0,at=C(X,rt,Dt);if(X.isDepthTexture)mt=e.DEPTH_COMPONENT,o?X.type===Nc?mt=e.DEPTH_COMPONENT32F:X.type===gd?mt=e.DEPTH_COMPONENT24:X.type===up?mt=e.DEPTH24_STENCIL8:mt=e.DEPTH_COMPONENT16:X.type===Nc&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),X.format===hp&&mt===e.DEPTH_COMPONENT&&X.type!==v2&&X.type!==gd&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),X.type=gd,$e=s.convert(X.type)),X.format===Ug&&mt===e.DEPTH_COMPONENT&&(mt=e.DEPTH_STENCIL,X.type!==up&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),X.type=up,$e=s.convert(X.type))),et&&(ue?i.texStorage2D(e.TEXTURE_2D,1,mt,rt.width,rt.height):i.texImage2D(e.TEXTURE_2D,0,mt,rt.width,rt.height,0,ge,$e,null));else if(X.isDataTexture)if(Ne.length>0&&Dt){ue&&et&&i.texStorage2D(e.TEXTURE_2D,at,mt,Ne[0].width,Ne[0].height);for(let Ze=0,bt=Ne.length;Ze<bt;Ze++)me=Ne[Ze],ue?i.texSubImage2D(e.TEXTURE_2D,Ze,0,0,me.width,me.height,ge,$e,me.data):i.texImage2D(e.TEXTURE_2D,Ze,mt,me.width,me.height,0,ge,$e,me.data);X.generateMipmaps=!1}else ue?(et&&i.texStorage2D(e.TEXTURE_2D,at,mt,rt.width,rt.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,rt.width,rt.height,ge,$e,rt.data)):i.texImage2D(e.TEXTURE_2D,0,mt,rt.width,rt.height,0,ge,$e,rt.data);else if(X.isCompressedTexture)if(X.isCompressedArrayTexture){ue&&et&&i.texStorage3D(e.TEXTURE_2D_ARRAY,at,mt,Ne[0].width,Ne[0].height,rt.depth);for(let Ze=0,bt=Ne.length;Ze<bt;Ze++)me=Ne[Ze],X.format!==so?ge!==null?ue?i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,Ze,0,0,0,me.width,me.height,rt.depth,ge,me.data,0,0):i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,Ze,mt,me.width,me.height,rt.depth,0,me.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ue?i.texSubImage3D(e.TEXTURE_2D_ARRAY,Ze,0,0,0,me.width,me.height,rt.depth,ge,$e,me.data):i.texImage3D(e.TEXTURE_2D_ARRAY,Ze,mt,me.width,me.height,rt.depth,0,ge,$e,me.data)}else{ue&&et&&i.texStorage2D(e.TEXTURE_2D,at,mt,Ne[0].width,Ne[0].height);for(let Ze=0,bt=Ne.length;Ze<bt;Ze++)me=Ne[Ze],X.format!==so?ge!==null?ue?i.compressedTexSubImage2D(e.TEXTURE_2D,Ze,0,0,me.width,me.height,ge,me.data):i.compressedTexImage2D(e.TEXTURE_2D,Ze,mt,me.width,me.height,0,me.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ue?i.texSubImage2D(e.TEXTURE_2D,Ze,0,0,me.width,me.height,ge,$e,me.data):i.texImage2D(e.TEXTURE_2D,Ze,mt,me.width,me.height,0,ge,$e,me.data)}else if(X.isDataArrayTexture)ue?(et&&i.texStorage3D(e.TEXTURE_2D_ARRAY,at,mt,rt.width,rt.height,rt.depth),i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,rt.width,rt.height,rt.depth,ge,$e,rt.data)):i.texImage3D(e.TEXTURE_2D_ARRAY,0,mt,rt.width,rt.height,rt.depth,0,ge,$e,rt.data);else if(X.isData3DTexture)ue?(et&&i.texStorage3D(e.TEXTURE_3D,at,mt,rt.width,rt.height,rt.depth),i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,rt.width,rt.height,rt.depth,ge,$e,rt.data)):i.texImage3D(e.TEXTURE_3D,0,mt,rt.width,rt.height,rt.depth,0,ge,$e,rt.data);else if(X.isFramebufferTexture){if(et)if(ue)i.texStorage2D(e.TEXTURE_2D,at,mt,rt.width,rt.height);else{let Ze=rt.width,bt=rt.height;for(let Ft=0;Ft<at;Ft++)i.texImage2D(e.TEXTURE_2D,Ft,mt,Ze,bt,0,ge,$e,null),Ze>>=1,bt>>=1}}else if(Ne.length>0&&Dt){ue&&et&&i.texStorage2D(e.TEXTURE_2D,at,mt,Ne[0].width,Ne[0].height);for(let Ze=0,bt=Ne.length;Ze<bt;Ze++)me=Ne[Ze],ue?i.texSubImage2D(e.TEXTURE_2D,Ze,0,0,ge,$e,me):i.texImage2D(e.TEXTURE_2D,Ze,mt,ge,$e,me);X.generateMipmaps=!1}else ue?(et&&i.texStorage2D(e.TEXTURE_2D,at,mt,rt.width,rt.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,ge,$e,rt)):i.texImage2D(e.TEXTURE_2D,0,mt,ge,$e,rt);E(X,Dt)&&I(J),ct.__version=qe.version,X.onUpdate&&X.onUpdate(X)}V.__version=X.version}function Me(V,X,we){if(X.image.length!==6)return;const J=xe(V,X),Le=X.source;i.bindTexture(e.TEXTURE_CUBE_MAP,V.__webglTexture,e.TEXTURE0+we);const qe=r.get(Le);if(Le.version!==qe.__version||J===!0){i.activeTexture(e.TEXTURE0+we);const ct=Tr.getPrimaries(Tr.workingColorSpace),Pe=X.colorSpace===hl?null:Tr.getPrimaries(X.colorSpace),nt=X.colorSpace===hl||ct===Pe?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,X.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,X.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,X.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,nt);const gt=X.isCompressedTexture||X.image[0].isCompressedTexture,Tt=X.image[0]&&X.image[0].isDataTexture,rt=[];for(let Ze=0;Ze<6;Ze++)!gt&&!Tt?rt[Ze]=_(X.image[Ze],!1,!0,c):rt[Ze]=Tt?X.image[Ze].image:X.image[Ze],rt[Ze]=de(X,rt[Ze]);const Dt=rt[0],ge=A(Dt)||o,$e=s.convert(X.format,X.colorSpace),mt=s.convert(X.type),me=P(X.internalFormat,$e,mt,X.colorSpace),Ne=o&&X.isVideoTexture!==!0,ue=qe.__version===void 0||J===!0;let et=C(X,Dt,ge);ve(e.TEXTURE_CUBE_MAP,X,ge);let at;if(gt){Ne&&ue&&i.texStorage2D(e.TEXTURE_CUBE_MAP,et,me,Dt.width,Dt.height);for(let Ze=0;Ze<6;Ze++){at=rt[Ze].mipmaps;for(let bt=0;bt<at.length;bt++){const Ft=at[bt];X.format!==so?$e!==null?Ne?i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt,0,0,Ft.width,Ft.height,$e,Ft.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt,me,Ft.width,Ft.height,0,Ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ne?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt,0,0,Ft.width,Ft.height,$e,mt,Ft.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt,me,Ft.width,Ft.height,0,$e,mt,Ft.data)}}}else{at=X.mipmaps,Ne&&ue&&(at.length>0&&et++,i.texStorage2D(e.TEXTURE_CUBE_MAP,et,me,rt[0].width,rt[0].height));for(let Ze=0;Ze<6;Ze++)if(Tt){Ne?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,0,0,rt[Ze].width,rt[Ze].height,$e,mt,rt[Ze].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,me,rt[Ze].width,rt[Ze].height,0,$e,mt,rt[Ze].data);for(let bt=0;bt<at.length;bt++){const ui=at[bt].image[Ze].image;Ne?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt+1,0,0,ui.width,ui.height,$e,mt,ui.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt+1,me,ui.width,ui.height,0,$e,mt,ui.data)}}else{Ne?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,0,0,$e,mt,rt[Ze]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,0,me,$e,mt,rt[Ze]);for(let bt=0;bt<at.length;bt++){const Ft=at[bt];Ne?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt+1,0,0,$e,mt,Ft.image[Ze]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ze,bt+1,me,$e,mt,Ft.image[Ze])}}}E(X,ge)&&I(e.TEXTURE_CUBE_MAP),qe.__version=Le.version,X.onUpdate&&X.onUpdate(X)}V.__version=X.version}function Te(V,X,we,J,Le,qe){const ct=s.convert(we.format,we.colorSpace),Pe=s.convert(we.type),nt=P(we.internalFormat,ct,Pe,we.colorSpace);if(!r.get(X).__hasExternalTextures){const Tt=Math.max(1,X.width>>qe),rt=Math.max(1,X.height>>qe);Le===e.TEXTURE_3D||Le===e.TEXTURE_2D_ARRAY?i.texImage3D(Le,qe,nt,Tt,rt,X.depth,0,ct,Pe,null):i.texImage2D(Le,qe,nt,Tt,rt,0,ct,Pe,null)}i.bindFramebuffer(e.FRAMEBUFFER,V),xt(X)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,J,Le,r.get(we).__webglTexture,0,je(X)):(Le===e.TEXTURE_2D||Le>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&Le<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,J,Le,r.get(we).__webglTexture,qe),i.bindFramebuffer(e.FRAMEBUFFER,null)}function ae(V,X,we){if(e.bindRenderbuffer(e.RENDERBUFFER,V),X.depthBuffer&&!X.stencilBuffer){let J=o===!0?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(we||xt(X)){const Le=X.depthTexture;Le&&Le.isDepthTexture&&(Le.type===Nc?J=e.DEPTH_COMPONENT32F:Le.type===gd&&(J=e.DEPTH_COMPONENT24));const qe=je(X);xt(X)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,qe,J,X.width,X.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,qe,J,X.width,X.height)}else e.renderbufferStorage(e.RENDERBUFFER,J,X.width,X.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,V)}else if(X.depthBuffer&&X.stencilBuffer){const J=je(X);we&&xt(X)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,J,e.DEPTH24_STENCIL8,X.width,X.height):xt(X)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,J,e.DEPTH24_STENCIL8,X.width,X.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,X.width,X.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,V)}else{const J=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let Le=0;Le<J.length;Le++){const qe=J[Le],ct=s.convert(qe.format,qe.colorSpace),Pe=s.convert(qe.type),nt=P(qe.internalFormat,ct,Pe,qe.colorSpace),gt=je(X);we&&xt(X)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,gt,nt,X.width,X.height):xt(X)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,gt,nt,X.width,X.height):e.renderbufferStorage(e.RENDERBUFFER,nt,X.width,X.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function Ce(V,X){if(X&&X.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,V),!(X.depthTexture&&X.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(X.depthTexture).__webglTexture||X.depthTexture.image.width!==X.width||X.depthTexture.image.height!==X.height)&&(X.depthTexture.image.width=X.width,X.depthTexture.image.height=X.height,X.depthTexture.needsUpdate=!0),K(X.depthTexture,0);const J=r.get(X.depthTexture).__webglTexture,Le=je(X);if(X.depthTexture.format===hp)xt(X)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,J,0,Le):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,J,0);else if(X.depthTexture.format===Ug)xt(X)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,J,0,Le):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,J,0);else throw new Error("Unknown depthTexture format")}function Ie(V){const X=r.get(V),we=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!X.__autoAllocateDepthBuffer){if(we)throw new Error("target.depthTexture not supported in Cube render targets");Ce(X.__webglFramebuffer,V)}else if(we){X.__webglDepthbuffer=[];for(let J=0;J<6;J++)i.bindFramebuffer(e.FRAMEBUFFER,X.__webglFramebuffer[J]),X.__webglDepthbuffer[J]=e.createRenderbuffer(),ae(X.__webglDepthbuffer[J],V,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,X.__webglFramebuffer),X.__webglDepthbuffer=e.createRenderbuffer(),ae(X.__webglDepthbuffer,V,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function Be(V,X,we){const J=r.get(V);X!==void 0&&Te(J.__webglFramebuffer,V,V.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),we!==void 0&&Ie(V)}function Ve(V){const X=V.texture,we=r.get(V),J=r.get(X);V.addEventListener("dispose",F),V.isWebGLMultipleRenderTargets!==!0&&(J.__webglTexture===void 0&&(J.__webglTexture=e.createTexture()),J.__version=X.version,a.memory.textures++);const Le=V.isWebGLCubeRenderTarget===!0,qe=V.isWebGLMultipleRenderTargets===!0,ct=A(V)||o;if(Le){we.__webglFramebuffer=[];for(let Pe=0;Pe<6;Pe++)if(o&&X.mipmaps&&X.mipmaps.length>0){we.__webglFramebuffer[Pe]=[];for(let nt=0;nt<X.mipmaps.length;nt++)we.__webglFramebuffer[Pe][nt]=e.createFramebuffer()}else we.__webglFramebuffer[Pe]=e.createFramebuffer()}else{if(o&&X.mipmaps&&X.mipmaps.length>0){we.__webglFramebuffer=[];for(let Pe=0;Pe<X.mipmaps.length;Pe++)we.__webglFramebuffer[Pe]=e.createFramebuffer()}else we.__webglFramebuffer=e.createFramebuffer();if(qe)if(n.drawBuffers){const Pe=V.texture;for(let nt=0,gt=Pe.length;nt<gt;nt++){const Tt=r.get(Pe[nt]);Tt.__webglTexture===void 0&&(Tt.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&V.samples>0&&xt(V)===!1){const Pe=qe?X:[X];we.__webglMultisampledFramebuffer=e.createFramebuffer(),we.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,we.__webglMultisampledFramebuffer);for(let nt=0;nt<Pe.length;nt++){const gt=Pe[nt];we.__webglColorRenderbuffer[nt]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,we.__webglColorRenderbuffer[nt]);const Tt=s.convert(gt.format,gt.colorSpace),rt=s.convert(gt.type),Dt=P(gt.internalFormat,Tt,rt,gt.colorSpace,V.isXRRenderTarget===!0),ge=je(V);e.renderbufferStorageMultisample(e.RENDERBUFFER,ge,Dt,V.width,V.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+nt,e.RENDERBUFFER,we.__webglColorRenderbuffer[nt])}e.bindRenderbuffer(e.RENDERBUFFER,null),V.depthBuffer&&(we.__webglDepthRenderbuffer=e.createRenderbuffer(),ae(we.__webglDepthRenderbuffer,V,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(Le){i.bindTexture(e.TEXTURE_CUBE_MAP,J.__webglTexture),ve(e.TEXTURE_CUBE_MAP,X,ct);for(let Pe=0;Pe<6;Pe++)if(o&&X.mipmaps&&X.mipmaps.length>0)for(let nt=0;nt<X.mipmaps.length;nt++)Te(we.__webglFramebuffer[Pe][nt],V,X,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,nt);else Te(we.__webglFramebuffer[Pe],V,X,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,0);E(X,ct)&&I(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(qe){const Pe=V.texture;for(let nt=0,gt=Pe.length;nt<gt;nt++){const Tt=Pe[nt],rt=r.get(Tt);i.bindTexture(e.TEXTURE_2D,rt.__webglTexture),ve(e.TEXTURE_2D,Tt,ct),Te(we.__webglFramebuffer,V,Tt,e.COLOR_ATTACHMENT0+nt,e.TEXTURE_2D,0),E(Tt,ct)&&I(e.TEXTURE_2D)}i.unbindTexture()}else{let Pe=e.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(o?Pe=V.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Pe,J.__webglTexture),ve(Pe,X,ct),o&&X.mipmaps&&X.mipmaps.length>0)for(let nt=0;nt<X.mipmaps.length;nt++)Te(we.__webglFramebuffer[nt],V,X,e.COLOR_ATTACHMENT0,Pe,nt);else Te(we.__webglFramebuffer,V,X,e.COLOR_ATTACHMENT0,Pe,0);E(X,ct)&&I(Pe),i.unbindTexture()}V.depthBuffer&&Ie(V)}function lt(V){const X=A(V)||o,we=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let J=0,Le=we.length;J<Le;J++){const qe=we[J];if(E(qe,X)){const ct=V.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,Pe=r.get(qe).__webglTexture;i.bindTexture(ct,Pe),I(ct),i.unbindTexture()}}}function We(V){if(o&&V.samples>0&&xt(V)===!1){const X=V.isWebGLMultipleRenderTargets?V.texture:[V.texture],we=V.width,J=V.height;let Le=e.COLOR_BUFFER_BIT;const qe=[],ct=V.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,Pe=r.get(V),nt=V.isWebGLMultipleRenderTargets===!0;if(nt)for(let gt=0;gt<X.length;gt++)i.bindFramebuffer(e.FRAMEBUFFER,Pe.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+gt,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,Pe.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+gt,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,Pe.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,Pe.__webglFramebuffer);for(let gt=0;gt<X.length;gt++){qe.push(e.COLOR_ATTACHMENT0+gt),V.depthBuffer&&qe.push(ct);const Tt=Pe.__ignoreDepthValues!==void 0?Pe.__ignoreDepthValues:!1;if(Tt===!1&&(V.depthBuffer&&(Le|=e.DEPTH_BUFFER_BIT),V.stencilBuffer&&(Le|=e.STENCIL_BUFFER_BIT)),nt&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,Pe.__webglColorRenderbuffer[gt]),Tt===!0&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[ct]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[ct])),nt){const rt=r.get(X[gt]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,rt,0)}e.blitFramebuffer(0,0,we,J,0,0,we,J,Le,e.NEAREST),f&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,qe)}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),nt)for(let gt=0;gt<X.length;gt++){i.bindFramebuffer(e.FRAMEBUFFER,Pe.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+gt,e.RENDERBUFFER,Pe.__webglColorRenderbuffer[gt]);const Tt=r.get(X[gt]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,Pe.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+gt,e.TEXTURE_2D,Tt,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,Pe.__webglMultisampledFramebuffer)}}function je(V){return Math.min(h,V.samples)}function xt(V){const X=r.get(V);return o&&V.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&X.__useRenderToTexture!==!1}function Mt(V){const X=a.render.frame;m.get(V)!==X&&(m.set(V,X),V.update())}function de(V,X){const we=V.colorSpace,J=V.format,Le=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===XE||we!==Qu&&we!==hl&&(Tr.getTransfer(we)===Kr?o===!1?t.has("EXT_sRGB")===!0&&J===so?(V.format=XE,V.minFilter=kn,V.generateMipmaps=!1):X=wz.sRGBToLinear(X):(J!==so||Le!==Vu)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",we)),X}this.allocateTextureUnit=W,this.resetTextureUnits=Q,this.setTexture2D=K,this.setTexture2DArray=j,this.setTexture3D=$,this.setTextureCube=se,this.rebindTextures=Be,this.setupRenderTarget=Ve,this.updateRenderTargetMipmap=lt,this.updateMultisampleRenderTarget=We,this.setupDepthRenderbuffer=Ie,this.setupFrameBufferTexture=Te,this.useMultisampledRTT=xt}function y9(e,t,i){const r=i.isWebGL2;function n(s,a=hl){let o;const l=Tr.getTransfer(a);if(s===Vu)return e.UNSIGNED_BYTE;if(s===uz)return e.UNSIGNED_SHORT_4_4_4_4;if(s===hz)return e.UNSIGNED_SHORT_5_5_5_1;if(s===U8)return e.BYTE;if(s===F8)return e.SHORT;if(s===v2)return e.UNSIGNED_SHORT;if(s===cz)return e.INT;if(s===gd)return e.UNSIGNED_INT;if(s===Nc)return e.FLOAT;if(s===Qy)return r?e.HALF_FLOAT:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===k8)return e.ALPHA;if(s===so)return e.RGBA;if(s===V8)return e.LUMINANCE;if(s===H8)return e.LUMINANCE_ALPHA;if(s===hp)return e.DEPTH_COMPONENT;if(s===Ug)return e.DEPTH_STENCIL;if(s===XE)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===G8)return e.RED;if(s===dz)return e.RED_INTEGER;if(s===j8)return e.RG;if(s===fz)return e.RG_INTEGER;if(s===pz)return e.RGBA_INTEGER;if(s===mE||s===gE||s===vE||s===yE)if(l===Kr)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===mE)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===gE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===vE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===yE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===mE)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===gE)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===vE)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===yE)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===qR||s===YR||s===QR||s===ZR)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===qR)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===YR)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===QR)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===ZR)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===mz)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===KR||s===JR)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===KR)return l===Kr?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===JR)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===$R||s===eI||s===tI||s===iI||s===rI||s===nI||s===sI||s===aI||s===oI||s===lI||s===cI||s===uI||s===hI||s===dI)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===$R)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===eI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===tI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===iI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===rI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===nI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===sI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===aI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===oI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===lI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===cI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===uI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===hI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===dI)return l===Kr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===xE||s===fI||s===pI)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===xE)return l===Kr?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===fI)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===pI)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===W8||s===mI||s===gI||s===vI)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===xE)return o.COMPRESSED_RED_RGTC1_EXT;if(s===mI)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===gI)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===vI)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===up?r?e.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}class x9 extends gn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class xy extends mr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const xse={type:"move"};class RP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new xy,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new xy,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new pe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new pe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new xy,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new pe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new pe),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const r of t.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(c&&t.hand){a=!0;for(const v of t.hand.values()){const g=i.getJointPose(v,r),x=this._getHandJoint(c,v);g!==null&&(x.matrix.fromArray(g.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=g.radius),x.visible=g!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,m=.005;c.inputState.pinching&&d>f+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=f-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(t.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(xse)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const r=new xy;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[i.jointName]=r,t.add(r)}return t.joints[i.jointName]}}class wse extends Ud{constructor(t,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,m=null;const v=i.getContextAttributes();let g=null,x=null;const S=[],_=[],A=new yt;let T=null;const E=new gn;E.layers.enable(1),E.viewport=new Pr;const I=new gn;I.layers.enable(2),I.viewport=new Pr;const P=[E,I],C=new x9;C.layers.enable(1),C.layers.enable(2);let L=null,z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(se){let re=S[se];return re===void 0&&(re=new RP,S[se]=re),re.getTargetRaySpace()},this.getControllerGrip=function(se){let re=S[se];return re===void 0&&(re=new RP,S[se]=re),re.getGripSpace()},this.getHand=function(se){let re=S[se];return re===void 0&&(re=new RP,S[se]=re),re.getHandSpace()};function F(se){const re=_.indexOf(se.inputSource);if(re===-1)return;const he=S[re];he!==void 0&&(he.update(se.inputSource,se.frame,c||a),he.dispatchEvent({type:se.type,data:se.inputSource}))}function G(){n.removeEventListener("select",F),n.removeEventListener("selectstart",F),n.removeEventListener("selectend",F),n.removeEventListener("squeeze",F),n.removeEventListener("squeezestart",F),n.removeEventListener("squeezeend",F),n.removeEventListener("end",G),n.removeEventListener("inputsourceschange",N);for(let se=0;se<S.length;se++){const re=_[se];re!==null&&(_[se]=null,S[se].disconnect(re))}L=null,z=null,t.setRenderTarget(g),f=null,d=null,h=null,n=null,x=null,$.stop(),r.isPresenting=!1,t.setPixelRatio(T),t.setSize(A.width,A.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(se){s=se,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(se){o=se,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(se){c=se},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return n},this.setSession=async function(se){if(n=se,n!==null){if(g=t.getRenderTarget(),n.addEventListener("select",F),n.addEventListener("selectstart",F),n.addEventListener("selectend",F),n.addEventListener("squeeze",F),n.addEventListener("squeezestart",F),n.addEventListener("squeezeend",F),n.addEventListener("end",G),n.addEventListener("inputsourceschange",N),v.xrCompatible!==!0&&await i.makeXRCompatible(),T=t.getPixelRatio(),t.getSize(A),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const re={antialias:n.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(n,i,re),n.updateRenderState({baseLayer:f}),t.setPixelRatio(1),t.setSize(f.framebufferWidth,f.framebufferHeight,!1),x=new qc(f.framebufferWidth,f.framebufferHeight,{format:so,type:Vu,colorSpace:t.outputColorSpace,stencilBuffer:v.stencil})}else{let re=null,he=null,oe=null;v.depth&&(oe=v.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,re=v.stencil?Ug:hp,he=v.stencil?up:gd);const ve={colorFormat:i.RGBA8,depthFormat:oe,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(ve),n.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),x=new qc(d.textureWidth,d.textureHeight,{format:so,type:Vu,depthTexture:new Tz(d.textureWidth,d.textureHeight,he,void 0,void 0,void 0,void 0,void 0,void 0,re),stencilBuffer:v.stencil,colorSpace:t.outputColorSpace,samples:v.antialias?4:0});const xe=t.properties.get(x);xe.__ignoreDepthValues=d.ignoreDepthValues}x.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),$.setContext(n),$.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function N(se){for(let re=0;re<se.removed.length;re++){const he=se.removed[re],oe=_.indexOf(he);oe>=0&&(_[oe]=null,S[oe].disconnect(he))}for(let re=0;re<se.added.length;re++){const he=se.added[re];let oe=_.indexOf(he);if(oe===-1){for(let xe=0;xe<S.length;xe++)if(xe>=_.length){_.push(he),oe=xe;break}else if(_[xe]===null){_[xe]=he,oe=xe;break}if(oe===-1)break}const ve=S[oe];ve&&ve.connect(he)}}const q=new pe,ie=new pe;function Q(se,re,he){q.setFromMatrixPosition(re.matrixWorld),ie.setFromMatrixPosition(he.matrixWorld);const oe=q.distanceTo(ie),ve=re.projectionMatrix.elements,xe=he.projectionMatrix.elements,be=ve[14]/(ve[10]-1),Me=ve[14]/(ve[10]+1),Te=(ve[9]+1)/ve[5],ae=(ve[9]-1)/ve[5],Ce=(ve[8]-1)/ve[0],Ie=(xe[8]+1)/xe[0],Be=be*Ce,Ve=be*Ie,lt=oe/(-Ce+Ie),We=lt*-Ce;re.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(We),se.translateZ(lt),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.copy(se.matrixWorld).invert();const je=be+lt,xt=Me+lt,Mt=Be-We,de=Ve+(oe-We),V=Te*Me/xt*je,X=ae*Me/xt*je;se.projectionMatrix.makePerspective(Mt,de,V,X,je,xt),se.projectionMatrixInverse.copy(se.projectionMatrix).invert()}function W(se,re){re===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(re.matrixWorld,se.matrix),se.matrixWorldInverse.copy(se.matrixWorld).invert()}this.updateCamera=function(se){if(n===null)return;C.near=I.near=E.near=se.near,C.far=I.far=E.far=se.far,(L!==C.near||z!==C.far)&&(n.updateRenderState({depthNear:C.near,depthFar:C.far}),L=C.near,z=C.far);const re=se.parent,he=C.cameras;W(C,re);for(let oe=0;oe<he.length;oe++)W(he[oe],re);he.length===2?Q(C,E,I):C.projectionMatrix.copy(E.projectionMatrix),ee(se,C,re)};function ee(se,re,he){he===null?se.matrix.copy(re.matrixWorld):(se.matrix.copy(he.matrixWorld),se.matrix.invert(),se.matrix.multiply(re.matrixWorld)),se.matrix.decompose(se.position,se.quaternion,se.scale),se.updateMatrixWorld(!0),se.projectionMatrix.copy(re.projectionMatrix),se.projectionMatrixInverse.copy(re.projectionMatrixInverse),se.isPerspectiveCamera&&(se.fov=Ky*2*Math.atan(1/se.projectionMatrix.elements[5]),se.zoom=1)}this.getCamera=function(){return C},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(se){l=se,d!==null&&(d.fixedFoveation=se),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=se)};let K=null;function j(se,re){if(u=re.getViewerPose(c||a),m=re,u!==null){const he=u.views;f!==null&&(t.setRenderTargetFramebuffer(x,f.framebuffer),t.setRenderTarget(x));let oe=!1;he.length!==C.cameras.length&&(C.cameras.length=0,oe=!0);for(let ve=0;ve<he.length;ve++){const xe=he[ve];let be=null;if(f!==null)be=f.getViewport(xe);else{const Te=h.getViewSubImage(d,xe);be=Te.viewport,ve===0&&(t.setRenderTargetTextures(x,Te.colorTexture,d.ignoreDepthValues?void 0:Te.depthStencilTexture),t.setRenderTarget(x))}let Me=P[ve];Me===void 0&&(Me=new gn,Me.layers.enable(ve),Me.viewport=new Pr,P[ve]=Me),Me.matrix.fromArray(xe.transform.matrix),Me.matrix.decompose(Me.position,Me.quaternion,Me.scale),Me.projectionMatrix.fromArray(xe.projectionMatrix),Me.projectionMatrixInverse.copy(Me.projectionMatrix).invert(),Me.viewport.set(be.x,be.y,be.width,be.height),ve===0&&(C.matrix.copy(Me.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),oe===!0&&C.cameras.push(Me)}}for(let he=0;he<S.length;he++){const oe=_[he],ve=S[he];oe!==null&&ve!==void 0&&ve.update(oe,re,c||a)}K&&K(se,re),re.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:re}),m=null}const $=new d9;$.setAnimationLoop(j),this.setAnimationLoop=function(se){K=se},this.dispose=function(){}}}function bse(e,t){function i(g,x){g.matrixAutoUpdate===!0&&g.updateMatrix(),x.value.copy(g.matrix)}function r(g,x){x.color.getRGB(g.fogColor.value,u9(e)),x.isFog?(g.fogNear.value=x.near,g.fogFar.value=x.far):x.isFogExp2&&(g.fogDensity.value=x.density)}function n(g,x,S,_,A){x.isMeshBasicMaterial||x.isMeshLambertMaterial?s(g,x):x.isMeshToonMaterial?(s(g,x),h(g,x)):x.isMeshPhongMaterial?(s(g,x),u(g,x)):x.isMeshStandardMaterial?(s(g,x),d(g,x),x.isMeshPhysicalMaterial&&f(g,x,A)):x.isMeshMatcapMaterial?(s(g,x),m(g,x)):x.isMeshDepthMaterial?s(g,x):x.isMeshDistanceMaterial?(s(g,x),v(g,x)):x.isMeshNormalMaterial?s(g,x):x.isLineBasicMaterial?(a(g,x),x.isLineDashedMaterial&&o(g,x)):x.isPointsMaterial?l(g,x,S,_):x.isSpriteMaterial?c(g,x):x.isShadowMaterial?(g.color.value.copy(x.color),g.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function s(g,x){g.opacity.value=x.opacity,x.color&&g.diffuse.value.copy(x.color),x.emissive&&g.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(g.map.value=x.map,i(x.map,g.mapTransform)),x.alphaMap&&(g.alphaMap.value=x.alphaMap,i(x.alphaMap,g.alphaMapTransform)),x.bumpMap&&(g.bumpMap.value=x.bumpMap,i(x.bumpMap,g.bumpMapTransform),g.bumpScale.value=x.bumpScale,x.side===uo&&(g.bumpScale.value*=-1)),x.normalMap&&(g.normalMap.value=x.normalMap,i(x.normalMap,g.normalMapTransform),g.normalScale.value.copy(x.normalScale),x.side===uo&&g.normalScale.value.negate()),x.displacementMap&&(g.displacementMap.value=x.displacementMap,i(x.displacementMap,g.displacementMapTransform),g.displacementScale.value=x.displacementScale,g.displacementBias.value=x.displacementBias),x.emissiveMap&&(g.emissiveMap.value=x.emissiveMap,i(x.emissiveMap,g.emissiveMapTransform)),x.specularMap&&(g.specularMap.value=x.specularMap,i(x.specularMap,g.specularMapTransform)),x.alphaTest>0&&(g.alphaTest.value=x.alphaTest);const S=t.get(x).envMap;if(S&&(g.envMap.value=S,g.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=x.reflectivity,g.ior.value=x.ior,g.refractionRatio.value=x.refractionRatio),x.lightMap){g.lightMap.value=x.lightMap;const _=e._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=x.lightMapIntensity*_,i(x.lightMap,g.lightMapTransform)}x.aoMap&&(g.aoMap.value=x.aoMap,g.aoMapIntensity.value=x.aoMapIntensity,i(x.aoMap,g.aoMapTransform))}function a(g,x){g.diffuse.value.copy(x.color),g.opacity.value=x.opacity,x.map&&(g.map.value=x.map,i(x.map,g.mapTransform))}function o(g,x){g.dashSize.value=x.dashSize,g.totalSize.value=x.dashSize+x.gapSize,g.scale.value=x.scale}function l(g,x,S,_){g.diffuse.value.copy(x.color),g.opacity.value=x.opacity,g.size.value=x.size*S,g.scale.value=_*.5,x.map&&(g.map.value=x.map,i(x.map,g.uvTransform)),x.alphaMap&&(g.alphaMap.value=x.alphaMap,i(x.alphaMap,g.alphaMapTransform)),x.alphaTest>0&&(g.alphaTest.value=x.alphaTest)}function c(g,x){g.diffuse.value.copy(x.color),g.opacity.value=x.opacity,g.rotation.value=x.rotation,x.map&&(g.map.value=x.map,i(x.map,g.mapTransform)),x.alphaMap&&(g.alphaMap.value=x.alphaMap,i(x.alphaMap,g.alphaMapTransform)),x.alphaTest>0&&(g.alphaTest.value=x.alphaTest)}function u(g,x){g.specular.value.copy(x.specular),g.shininess.value=Math.max(x.shininess,1e-4)}function h(g,x){x.gradientMap&&(g.gradientMap.value=x.gradientMap)}function d(g,x){g.metalness.value=x.metalness,x.metalnessMap&&(g.metalnessMap.value=x.metalnessMap,i(x.metalnessMap,g.metalnessMapTransform)),g.roughness.value=x.roughness,x.roughnessMap&&(g.roughnessMap.value=x.roughnessMap,i(x.roughnessMap,g.roughnessMapTransform)),t.get(x).envMap&&(g.envMapIntensity.value=x.envMapIntensity)}function f(g,x,S){g.ior.value=x.ior,x.sheen>0&&(g.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),g.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(g.sheenColorMap.value=x.sheenColorMap,i(x.sheenColorMap,g.sheenColorMapTransform)),x.sheenRoughnessMap&&(g.sheenRoughnessMap.value=x.sheenRoughnessMap,i(x.sheenRoughnessMap,g.sheenRoughnessMapTransform))),x.clearcoat>0&&(g.clearcoat.value=x.clearcoat,g.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(g.clearcoatMap.value=x.clearcoatMap,i(x.clearcoatMap,g.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,i(x.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(g.clearcoatNormalMap.value=x.clearcoatNormalMap,i(x.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===uo&&g.clearcoatNormalScale.value.negate())),x.iridescence>0&&(g.iridescence.value=x.iridescence,g.iridescenceIOR.value=x.iridescenceIOR,g.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(g.iridescenceMap.value=x.iridescenceMap,i(x.iridescenceMap,g.iridescenceMapTransform)),x.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=x.iridescenceThicknessMap,i(x.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),x.transmission>0&&(g.transmission.value=x.transmission,g.transmissionSamplerMap.value=S.texture,g.transmissionSamplerSize.value.set(S.width,S.height),x.transmissionMap&&(g.transmissionMap.value=x.transmissionMap,i(x.transmissionMap,g.transmissionMapTransform)),g.thickness.value=x.thickness,x.thicknessMap&&(g.thicknessMap.value=x.thicknessMap,i(x.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=x.attenuationDistance,g.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(g.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(g.anisotropyMap.value=x.anisotropyMap,i(x.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=x.specularIntensity,g.specularColor.value.copy(x.specularColor),x.specularColorMap&&(g.specularColorMap.value=x.specularColorMap,i(x.specularColorMap,g.specularColorMapTransform)),x.specularIntensityMap&&(g.specularIntensityMap.value=x.specularIntensityMap,i(x.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,x){x.matcap&&(g.matcap.value=x.matcap)}function v(g,x){const S=t.get(x).light;g.referencePosition.value.setFromMatrixPosition(S.matrixWorld),g.nearDistance.value=S.shadow.camera.near,g.farDistance.value=S.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function _se(e,t,i,r){let n={},s={},a=[];const o=i.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(S,_){const A=_.program;r.uniformBlockBinding(S,A)}function c(S,_){let A=n[S.id];A===void 0&&(m(S),A=u(S),n[S.id]=A,S.addEventListener("dispose",g));const T=_.program;r.updateUBOMapping(S,T);const E=t.render.frame;s[S.id]!==E&&(d(S),s[S.id]=E)}function u(S){const _=h();S.__bindingPointIndex=_;const A=e.createBuffer(),T=S.__size,E=S.usage;return e.bindBuffer(e.UNIFORM_BUFFER,A),e.bufferData(e.UNIFORM_BUFFER,T,E),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,_,A),A}function h(){for(let S=0;S<o;S++)if(a.indexOf(S)===-1)return a.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(S){const _=n[S.id],A=S.uniforms,T=S.__cache;e.bindBuffer(e.UNIFORM_BUFFER,_);for(let E=0,I=A.length;E<I;E++){const P=A[E];if(f(P,E,T)===!0){const C=P.__offset,L=Array.isArray(P.value)?P.value:[P.value];let z=0;for(let F=0;F<L.length;F++){const G=L[F],N=v(G);typeof G=="number"?(P.__data[0]=G,e.bufferSubData(e.UNIFORM_BUFFER,C+z,P.__data)):G.isMatrix3?(P.__data[0]=G.elements[0],P.__data[1]=G.elements[1],P.__data[2]=G.elements[2],P.__data[3]=G.elements[0],P.__data[4]=G.elements[3],P.__data[5]=G.elements[4],P.__data[6]=G.elements[5],P.__data[7]=G.elements[0],P.__data[8]=G.elements[6],P.__data[9]=G.elements[7],P.__data[10]=G.elements[8],P.__data[11]=G.elements[0]):(G.toArray(P.__data,z),z+=N.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,C,P.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function f(S,_,A){const T=S.value;if(A[_]===void 0){if(typeof T=="number")A[_]=T;else{const E=Array.isArray(T)?T:[T],I=[];for(let P=0;P<E.length;P++)I.push(E[P].clone());A[_]=I}return!0}else if(typeof T=="number"){if(A[_]!==T)return A[_]=T,!0}else{const E=Array.isArray(A[_])?A[_]:[A[_]],I=Array.isArray(T)?T:[T];for(let P=0;P<E.length;P++){const C=E[P];if(C.equals(I[P])===!1)return C.copy(I[P]),!0}}return!1}function m(S){const _=S.uniforms;let A=0;const T=16;let E=0;for(let I=0,P=_.length;I<P;I++){const C=_[I],L={boundary:0,storage:0},z=Array.isArray(C.value)?C.value:[C.value];for(let F=0,G=z.length;F<G;F++){const N=z[F],q=v(N);L.boundary+=q.boundary,L.storage+=q.storage}if(C.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),C.__offset=A,I>0){E=A%T;const F=T-E;E!==0&&F-L.boundary<0&&(A+=T-E,C.__offset=A)}A+=L.storage}return E=A%T,E>0&&(A+=T-E),S.__size=A,S.__cache={},this}function v(S){const _={boundary:0,storage:0};return typeof S=="number"?(_.boundary=4,_.storage=4):S.isVector2?(_.boundary=8,_.storage=8):S.isVector3||S.isColor?(_.boundary=16,_.storage=12):S.isVector4?(_.boundary=16,_.storage=16):S.isMatrix3?(_.boundary=48,_.storage=48):S.isMatrix4?(_.boundary=64,_.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),_}function g(S){const _=S.target;_.removeEventListener("dispose",g);const A=a.indexOf(_.__bindingPointIndex);a.splice(A,1),e.deleteBuffer(n[_.id]),delete n[_.id],delete s[_.id]}function x(){for(const S in n)e.deleteBuffer(n[S]);a=[],n={},s={}}return{bind:l,update:c,dispose:x}}class Dz{constructor(t={}){const{canvas:i=o9(),context:r=null,depth:n=!0,stencil:s=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=t;this.isWebGLRenderer=!0;let d;r!==null?d=r.getContextAttributes().alpha:d=a;const f=new Uint32Array(4),m=new Int32Array(4);let v=null,g=null;const x=[],S=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=bs,this._useLegacyLights=!1,this.toneMapping=ku,this.toneMappingExposure=1;const _=this;let A=!1,T=0,E=0,I=null,P=-1,C=null;const L=new Pr,z=new Pr;let F=null;const G=new Zt(0);let N=0,q=i.width,ie=i.height,Q=1,W=null,ee=null;const K=new Pr(0,0,q,ie),j=new Pr(0,0,q,ie);let $=!1;const se=new M_;let re=!1,he=!1,oe=null;const ve=new Ci,xe=new yt,be=new pe,Me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Te(){return I===null?Q:1}let ae=r;function Ce(le,Oe){for(let ke=0;ke<le.length;ke++){const Ge=le[ke],Ue=i.getContext(Ge,Oe);if(Ue!==null)return Ue}return null}try{const le={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${x_}`),i.addEventListener("webglcontextlost",Ne,!1),i.addEventListener("webglcontextrestored",ue,!1),i.addEventListener("webglcontextcreationerror",et,!1),ae===null){const Oe=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&Oe.shift(),ae=Ce(Oe,le),ae===null)throw Ce(Oe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&ae instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),ae.getShaderPrecisionFormat===void 0&&(ae.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(le){throw console.error("THREE.WebGLRenderer: "+le.message),le}let Ie,Be,Ve,lt,We,je,xt,Mt,de,V,X,we,J,Le,qe,ct,Pe,nt,gt,Tt,rt,Dt,ge,$e;function mt(){Ie=new Nre(ae),Be=new Rre(ae,Ie,t),Ie.init(Be),Dt=new y9(ae,Ie,Be),Ve=new vse(ae,Ie,Be),lt=new kre(ae),We=new sse,je=new yse(ae,Ie,Ve,We,Be,Dt,lt),xt=new Lre(_),Mt=new Bre(_),de=new Yee(ae,Be),ge=new Pre(ae,Ie,de,Be),V=new Ure(ae,de,lt,ge),X=new jre(ae,V,de,lt),gt=new Gre(ae,Be,je),ct=new Ire(We),we=new nse(_,xt,Mt,Ie,Be,ge,ct),J=new bse(_,We),Le=new ose,qe=new fse(Ie,Be),nt=new Cre(_,xt,Mt,Ve,X,d,l),Pe=new gse(_,X,Be),$e=new _se(ae,lt,Be,Ve),Tt=new Dre(ae,Ie,lt,Be),rt=new Fre(ae,Ie,lt,Be),lt.programs=we.programs,_.capabilities=Be,_.extensions=Ie,_.properties=We,_.renderLists=Le,_.shadowMap=Pe,_.state=Ve,_.info=lt}mt();const me=new wse(_,ae);this.xr=me,this.getContext=function(){return ae},this.getContextAttributes=function(){return ae.getContextAttributes()},this.forceContextLoss=function(){const le=Ie.get("WEBGL_lose_context");le&&le.loseContext()},this.forceContextRestore=function(){const le=Ie.get("WEBGL_lose_context");le&&le.restoreContext()},this.getPixelRatio=function(){return Q},this.setPixelRatio=function(le){le!==void 0&&(Q=le,this.setSize(q,ie,!1))},this.getSize=function(le){return le.set(q,ie)},this.setSize=function(le,Oe,ke=!0){if(me.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}q=le,ie=Oe,i.width=Math.floor(le*Q),i.height=Math.floor(Oe*Q),ke===!0&&(i.style.width=le+"px",i.style.height=Oe+"px"),this.setViewport(0,0,le,Oe)},this.getDrawingBufferSize=function(le){return le.set(q*Q,ie*Q).floor()},this.setDrawingBufferSize=function(le,Oe,ke){q=le,ie=Oe,Q=ke,i.width=Math.floor(le*ke),i.height=Math.floor(Oe*ke),this.setViewport(0,0,le,Oe)},this.getCurrentViewport=function(le){return le.copy(L)},this.getViewport=function(le){return le.copy(K)},this.setViewport=function(le,Oe,ke,Ge){le.isVector4?K.set(le.x,le.y,le.z,le.w):K.set(le,Oe,ke,Ge),Ve.viewport(L.copy(K).multiplyScalar(Q).floor())},this.getScissor=function(le){return le.copy(j)},this.setScissor=function(le,Oe,ke,Ge){le.isVector4?j.set(le.x,le.y,le.z,le.w):j.set(le,Oe,ke,Ge),Ve.scissor(z.copy(j).multiplyScalar(Q).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(le){Ve.setScissorTest($=le)},this.setOpaqueSort=function(le){W=le},this.setTransparentSort=function(le){ee=le},this.getClearColor=function(le){return le.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(le=!0,Oe=!0,ke=!0){let Ge=0;if(le){let Ue=!1;if(I!==null){const Rt=I.texture.format;Ue=Rt===pz||Rt===fz||Rt===dz}if(Ue){const Rt=I.texture.type,Xt=Rt===Vu||Rt===gd||Rt===v2||Rt===up||Rt===uz||Rt===hz,ri=nt.getClearColor(),Pt=nt.getClearAlpha(),zt=ri.r,ni=ri.g,Lt=ri.b;Xt?(f[0]=zt,f[1]=ni,f[2]=Lt,f[3]=Pt,ae.clearBufferuiv(ae.COLOR,0,f)):(m[0]=zt,m[1]=ni,m[2]=Lt,m[3]=Pt,ae.clearBufferiv(ae.COLOR,0,m))}else Ge|=ae.COLOR_BUFFER_BIT}Oe&&(Ge|=ae.DEPTH_BUFFER_BIT),ke&&(Ge|=ae.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ae.clear(Ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Ne,!1),i.removeEventListener("webglcontextrestored",ue,!1),i.removeEventListener("webglcontextcreationerror",et,!1),Le.dispose(),qe.dispose(),We.dispose(),xt.dispose(),Mt.dispose(),X.dispose(),ge.dispose(),$e.dispose(),we.dispose(),me.dispose(),me.removeEventListener("sessionstart",Qi),me.removeEventListener("sessionend",mi),oe&&(oe.dispose(),oe=null),Or.stop()};function Ne(le){le.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function ue(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const le=lt.autoReset,Oe=Pe.enabled,ke=Pe.autoUpdate,Ge=Pe.needsUpdate,Ue=Pe.type;mt(),lt.autoReset=le,Pe.enabled=Oe,Pe.autoUpdate=ke,Pe.needsUpdate=Ge,Pe.type=Ue}function et(le){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",le.statusMessage)}function at(le){const Oe=le.target;Oe.removeEventListener("dispose",at),Ze(Oe)}function Ze(le){bt(le),We.remove(le)}function bt(le){const Oe=We.get(le).programs;Oe!==void 0&&(Oe.forEach(function(ke){we.releaseProgram(ke)}),le.isShaderMaterial&&we.releaseShaderCache(le))}this.renderBufferDirect=function(le,Oe,ke,Ge,Ue,Rt){Oe===null&&(Oe=Me);const Xt=Ue.isMesh&&Ue.matrixWorld.determinant()<0,ri=Yt(le,Oe,ke,Ge,Ue);Ve.setMaterial(Ge,Xt);let Pt=ke.index,zt=1;if(Ge.wireframe===!0){if(Pt=V.getWireframeAttribute(ke),Pt===void 0)return;zt=2}const ni=ke.drawRange,Lt=ke.attributes.position;let Zi=ni.start*zt,Vr=(ni.start+ni.count)*zt;Rt!==null&&(Zi=Math.max(Zi,Rt.start*zt),Vr=Math.min(Vr,(Rt.start+Rt.count)*zt)),Pt!==null?(Zi=Math.max(Zi,0),Vr=Math.min(Vr,Pt.count)):Lt!=null&&(Zi=Math.max(Zi,0),Vr=Math.min(Vr,Lt.count));const $i=Vr-Zi;if($i<0||$i===1/0)return;ge.setup(Ue,Ge,ri,ke,Pt);let lr,Z=Tt;if(Pt!==null&&(lr=de.get(Pt),Z=rt,Z.setIndex(lr)),Ue.isMesh)Ge.wireframe===!0?(Ve.setLineWidth(Ge.wireframeLinewidth*Te()),Z.setMode(ae.LINES)):Z.setMode(ae.TRIANGLES);else if(Ue.isLine){let te=Ge.linewidth;te===void 0&&(te=1),Ve.setLineWidth(te*Te()),Ue.isLineSegments?Z.setMode(ae.LINES):Ue.isLineLoop?Z.setMode(ae.LINE_LOOP):Z.setMode(ae.LINE_STRIP)}else Ue.isPoints?Z.setMode(ae.POINTS):Ue.isSprite&&Z.setMode(ae.TRIANGLES);if(Ue.isBatchedMesh)Z.renderMultiDraw(Ue._multiDrawStarts,Ue._multiDrawCounts,Ue._multiDrawCount);else if(Ue.isInstancedMesh)Z.renderInstances(Zi,$i,Ue.count);else if(ke.isInstancedBufferGeometry){const te=ke._maxInstanceCount!==void 0?ke._maxInstanceCount:1/0,_e=Math.min(ke.instanceCount,te);Z.renderInstances(Zi,$i,_e)}else Z.render(Zi,$i)};function Ft(le,Oe,ke){le.transparent===!0&&le.side===Oc&&le.forceSinglePass===!1?(le.side=uo,le.needsUpdate=!0,ut(le,Oe,ke),le.side=Pd,le.needsUpdate=!0,ut(le,Oe,ke),le.side=Oc):ut(le,Oe,ke)}this.compile=function(le,Oe,ke=null){ke===null&&(ke=le),g=qe.get(ke),g.init(),S.push(g),ke.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(Oe.layers)&&(g.pushLight(Ue),Ue.castShadow&&g.pushShadow(Ue))}),le!==ke&&le.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(Oe.layers)&&(g.pushLight(Ue),Ue.castShadow&&g.pushShadow(Ue))}),g.setupLights(_._useLegacyLights);const Ge=new Set;return le.traverse(function(Ue){const Rt=Ue.material;if(Rt)if(Array.isArray(Rt))for(let Xt=0;Xt<Rt.length;Xt++){const ri=Rt[Xt];Ft(ri,ke,Ue),Ge.add(ri)}else Ft(Rt,ke,Ue),Ge.add(Rt)}),S.pop(),g=null,Ge},this.compileAsync=function(le,Oe,ke=null){const Ge=this.compile(le,Oe,ke);return new Promise(Ue=>{function Rt(){if(Ge.forEach(function(Xt){We.get(Xt).currentProgram.isReady()&&Ge.delete(Xt)}),Ge.size===0){Ue(le);return}setTimeout(Rt,10)}Ie.get("KHR_parallel_shader_compile")!==null?Rt():setTimeout(Rt,10)})};let ui=null;function ci(le){ui&&ui(le)}function Qi(){Or.stop()}function mi(){Or.start()}const Or=new d9;Or.setAnimationLoop(ci),typeof self<"u"&&Or.setContext(self),this.setAnimationLoop=function(le){ui=le,me.setAnimationLoop(le),le===null?Or.stop():Or.start()},me.addEventListener("sessionstart",Qi),me.addEventListener("sessionend",mi),this.render=function(le,Oe){if(Oe!==void 0&&Oe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(A===!0)return;le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),Oe.parent===null&&Oe.matrixWorldAutoUpdate===!0&&Oe.updateMatrixWorld(),me.enabled===!0&&me.isPresenting===!0&&(me.cameraAutoUpdate===!0&&me.updateCamera(Oe),Oe=me.getCamera()),le.isScene===!0&&le.onBeforeRender(_,le,Oe,I),g=qe.get(le,S.length),g.init(),S.push(g),ve.multiplyMatrices(Oe.projectionMatrix,Oe.matrixWorldInverse),se.setFromProjectionMatrix(ve),he=this.localClippingEnabled,re=ct.init(this.clippingPlanes,he),v=Le.get(le,x.length),v.init(),x.push(v),bn(le,Oe,0,_.sortObjects),v.finish(),_.sortObjects===!0&&v.sort(W,ee),this.info.render.frame++,re===!0&&ct.beginShadows();const ke=g.state.shadowsArray;if(Pe.render(ke,le,Oe),re===!0&&ct.endShadows(),this.info.autoReset===!0&&this.info.reset(),nt.render(v,le),g.setupLights(_._useLegacyLights),Oe.isArrayCamera){const Ge=Oe.cameras;for(let Ue=0,Rt=Ge.length;Ue<Rt;Ue++){const Xt=Ge[Ue];Yl(v,le,Xt,Xt.viewport)}}else Yl(v,le,Oe);I!==null&&(je.updateMultisampleRenderTarget(I),je.updateRenderTargetMipmap(I)),le.isScene===!0&&le.onAfterRender(_,le,Oe),ge.resetDefaultState(),P=-1,C=null,S.pop(),S.length>0?g=S[S.length-1]:g=null,x.pop(),x.length>0?v=x[x.length-1]:v=null};function bn(le,Oe,ke,Ge){if(le.visible===!1)return;if(le.layers.test(Oe.layers)){if(le.isGroup)ke=le.renderOrder;else if(le.isLOD)le.autoUpdate===!0&&le.update(Oe);else if(le.isLight)g.pushLight(le),le.castShadow&&g.pushShadow(le);else if(le.isSprite){if(!le.frustumCulled||se.intersectsSprite(le)){Ge&&be.setFromMatrixPosition(le.matrixWorld).applyMatrix4(ve);const Xt=X.update(le),ri=le.material;ri.visible&&v.push(le,Xt,ri,ke,be.z,null)}}else if((le.isMesh||le.isLine||le.isPoints)&&(!le.frustumCulled||se.intersectsObject(le))){const Xt=X.update(le),ri=le.material;if(Ge&&(le.boundingSphere!==void 0?(le.boundingSphere===null&&le.computeBoundingSphere(),be.copy(le.boundingSphere.center)):(Xt.boundingSphere===null&&Xt.computeBoundingSphere(),be.copy(Xt.boundingSphere.center)),be.applyMatrix4(le.matrixWorld).applyMatrix4(ve)),Array.isArray(ri)){const Pt=Xt.groups;for(let zt=0,ni=Pt.length;zt<ni;zt++){const Lt=Pt[zt],Zi=ri[Lt.materialIndex];Zi&&Zi.visible&&v.push(le,Xt,Zi,ke,be.z,Lt)}}else ri.visible&&v.push(le,Xt,ri,ke,be.z,null)}}const Rt=le.children;for(let Xt=0,ri=Rt.length;Xt<ri;Xt++)bn(Rt[Xt],Oe,ke,Ge)}function Yl(le,Oe,ke,Ge){const Ue=le.opaque,Rt=le.transmissive,Xt=le.transparent;g.setupLightsView(ke),re===!0&&ct.setGlobalState(_.clippingPlanes,ke),Rt.length>0&&Qs(Ue,Rt,Oe,ke),Ge&&Ve.viewport(L.copy(Ge)),Ue.length>0&&fe(Ue,Oe,ke),Rt.length>0&&fe(Rt,Oe,ke),Xt.length>0&&fe(Xt,Oe,ke),Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1)}function Qs(le,Oe,ke,Ge){if((ke.isScene===!0?ke.overrideMaterial:null)!==null)return;const Rt=Be.isWebGL2;oe===null&&(oe=new qc(1,1,{generateMipmaps:!0,type:Ie.has("EXT_color_buffer_half_float")?Qy:Vu,minFilter:wp,samples:Rt?4:0})),_.getDrawingBufferSize(xe),Rt?oe.setSize(xe.x,xe.y):oe.setSize(qE(xe.x),qE(xe.y));const Xt=_.getRenderTarget();_.setRenderTarget(oe),_.getClearColor(G),N=_.getClearAlpha(),N<1&&_.setClearColor(16777215,.5),_.clear();const ri=_.toneMapping;_.toneMapping=ku,fe(le,ke,Ge),je.updateMultisampleRenderTarget(oe),je.updateRenderTargetMipmap(oe);let Pt=!1;for(let zt=0,ni=Oe.length;zt<ni;zt++){const Lt=Oe[zt],Zi=Lt.object,Vr=Lt.geometry,$i=Lt.material,lr=Lt.group;if($i.side===Oc&&Zi.layers.test(Ge.layers)){const Z=$i.side;$i.side=uo,$i.needsUpdate=!0,Ye(Zi,ke,Ge,Vr,$i,lr),$i.side=Z,$i.needsUpdate=!0,Pt=!0}}Pt===!0&&(je.updateMultisampleRenderTarget(oe),je.updateRenderTargetMipmap(oe)),_.setRenderTarget(Xt),_.setClearColor(G,N),_.toneMapping=ri}function fe(le,Oe,ke){const Ge=Oe.isScene===!0?Oe.overrideMaterial:null;for(let Ue=0,Rt=le.length;Ue<Rt;Ue++){const Xt=le[Ue],ri=Xt.object,Pt=Xt.geometry,zt=Ge===null?Xt.material:Ge,ni=Xt.group;ri.layers.test(ke.layers)&&Ye(ri,Oe,ke,Pt,zt,ni)}}function Ye(le,Oe,ke,Ge,Ue,Rt){le.onBeforeRender(_,Oe,ke,Ge,Ue,Rt),le.modelViewMatrix.multiplyMatrices(ke.matrixWorldInverse,le.matrixWorld),le.normalMatrix.getNormalMatrix(le.modelViewMatrix),Ue.onBeforeRender(_,Oe,ke,Ge,le,Rt),Ue.transparent===!0&&Ue.side===Oc&&Ue.forceSinglePass===!1?(Ue.side=uo,Ue.needsUpdate=!0,_.renderBufferDirect(ke,Oe,Ge,Ue,le,Rt),Ue.side=Pd,Ue.needsUpdate=!0,_.renderBufferDirect(ke,Oe,Ge,Ue,le,Rt),Ue.side=Oc):_.renderBufferDirect(ke,Oe,Ge,Ue,le,Rt),le.onAfterRender(_,Oe,ke,Ge,Ue,Rt)}function ut(le,Oe,ke){Oe.isScene!==!0&&(Oe=Me);const Ge=We.get(le),Ue=g.state.lights,Rt=g.state.shadowsArray,Xt=Ue.state.version,ri=we.getParameters(le,Ue.state,Rt,Oe,ke),Pt=we.getProgramCacheKey(ri);let zt=Ge.programs;Ge.environment=le.isMeshStandardMaterial?Oe.environment:null,Ge.fog=Oe.fog,Ge.envMap=(le.isMeshStandardMaterial?Mt:xt).get(le.envMap||Ge.environment),zt===void 0&&(le.addEventListener("dispose",at),zt=new Map,Ge.programs=zt);let ni=zt.get(Pt);if(ni!==void 0){if(Ge.currentProgram===ni&&Ge.lightsStateVersion===Xt)return ft(le,ri),ni}else ri.uniforms=we.getUniforms(le),le.onBuild(ke,ri,_),le.onBeforeCompile(ri,_),ni=we.acquireProgram(ri,Pt),zt.set(Pt,ni),Ge.uniforms=ri.uniforms;const Lt=Ge.uniforms;return(!le.isShaderMaterial&&!le.isRawShaderMaterial||le.clipping===!0)&&(Lt.clippingPlanes=ct.uniform),ft(le,ri),Ge.needsLights=gi(le),Ge.lightsStateVersion=Xt,Ge.needsLights&&(Lt.ambientLightColor.value=Ue.state.ambient,Lt.lightProbe.value=Ue.state.probe,Lt.directionalLights.value=Ue.state.directional,Lt.directionalLightShadows.value=Ue.state.directionalShadow,Lt.spotLights.value=Ue.state.spot,Lt.spotLightShadows.value=Ue.state.spotShadow,Lt.rectAreaLights.value=Ue.state.rectArea,Lt.ltc_1.value=Ue.state.rectAreaLTC1,Lt.ltc_2.value=Ue.state.rectAreaLTC2,Lt.pointLights.value=Ue.state.point,Lt.pointLightShadows.value=Ue.state.pointShadow,Lt.hemisphereLights.value=Ue.state.hemi,Lt.directionalShadowMap.value=Ue.state.directionalShadowMap,Lt.directionalShadowMatrix.value=Ue.state.directionalShadowMatrix,Lt.spotShadowMap.value=Ue.state.spotShadowMap,Lt.spotLightMatrix.value=Ue.state.spotLightMatrix,Lt.spotLightMap.value=Ue.state.spotLightMap,Lt.pointShadowMap.value=Ue.state.pointShadowMap,Lt.pointShadowMatrix.value=Ue.state.pointShadowMatrix),Ge.currentProgram=ni,Ge.uniformsList=null,ni}function Xe(le){if(le.uniformsList===null){const Oe=le.currentProgram.getUniforms();le.uniformsList=bE.seqWithValue(Oe.seq,le.uniforms)}return le.uniformsList}function ft(le,Oe){const ke=We.get(le);ke.outputColorSpace=Oe.outputColorSpace,ke.batching=Oe.batching,ke.instancing=Oe.instancing,ke.instancingColor=Oe.instancingColor,ke.skinning=Oe.skinning,ke.morphTargets=Oe.morphTargets,ke.morphNormals=Oe.morphNormals,ke.morphColors=Oe.morphColors,ke.morphTargetsCount=Oe.morphTargetsCount,ke.numClippingPlanes=Oe.numClippingPlanes,ke.numIntersection=Oe.numClipIntersection,ke.vertexAlphas=Oe.vertexAlphas,ke.vertexTangents=Oe.vertexTangents,ke.toneMapping=Oe.toneMapping}function Yt(le,Oe,ke,Ge,Ue){Oe.isScene!==!0&&(Oe=Me),je.resetTextureUnits();const Rt=Oe.fog,Xt=Ge.isMeshStandardMaterial?Oe.environment:null,ri=I===null?_.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:Qu,Pt=(Ge.isMeshStandardMaterial?Mt:xt).get(Ge.envMap||Xt),zt=Ge.vertexColors===!0&&!!ke.attributes.color&&ke.attributes.color.itemSize===4,ni=!!ke.attributes.tangent&&(!!Ge.normalMap||Ge.anisotropy>0),Lt=!!ke.morphAttributes.position,Zi=!!ke.morphAttributes.normal,Vr=!!ke.morphAttributes.color;let $i=ku;Ge.toneMapped&&(I===null||I.isXRRenderTarget===!0)&&($i=_.toneMapping);const lr=ke.morphAttributes.position||ke.morphAttributes.normal||ke.morphAttributes.color,Z=lr!==void 0?lr.length:0,te=We.get(Ge),_e=g.state.lights;if(re===!0&&(he===!0||le!==C)){const fn=le===C&&Ge.id===P;ct.setState(Ge,le,fn)}let ce=!1;Ge.version===te.__version?(te.needsLights&&te.lightsStateVersion!==_e.state.version||te.outputColorSpace!==ri||Ue.isBatchedMesh&&te.batching===!1||!Ue.isBatchedMesh&&te.batching===!0||Ue.isInstancedMesh&&te.instancing===!1||!Ue.isInstancedMesh&&te.instancing===!0||Ue.isSkinnedMesh&&te.skinning===!1||!Ue.isSkinnedMesh&&te.skinning===!0||Ue.isInstancedMesh&&te.instancingColor===!0&&Ue.instanceColor===null||Ue.isInstancedMesh&&te.instancingColor===!1&&Ue.instanceColor!==null||te.envMap!==Pt||Ge.fog===!0&&te.fog!==Rt||te.numClippingPlanes!==void 0&&(te.numClippingPlanes!==ct.numPlanes||te.numIntersection!==ct.numIntersection)||te.vertexAlphas!==zt||te.vertexTangents!==ni||te.morphTargets!==Lt||te.morphNormals!==Zi||te.morphColors!==Vr||te.toneMapping!==$i||Be.isWebGL2===!0&&te.morphTargetsCount!==Z)&&(ce=!0):(ce=!0,te.__version=Ge.version);let De=te.currentProgram;ce===!0&&(De=ut(Ge,Oe,Ue));let _t=!1,Hr=!1,Gr=!1;const gr=De.getUniforms(),cs=te.uniforms;if(Ve.useProgram(De.program)&&(_t=!0,Hr=!0,Gr=!0),Ge.id!==P&&(P=Ge.id,Hr=!0),_t||C!==le){gr.setValue(ae,"projectionMatrix",le.projectionMatrix),gr.setValue(ae,"viewMatrix",le.matrixWorldInverse);const fn=gr.map.cameraPosition;fn!==void 0&&fn.setValue(ae,be.setFromMatrixPosition(le.matrixWorld)),Be.logarithmicDepthBuffer&&gr.setValue(ae,"logDepthBufFC",2/(Math.log(le.far+1)/Math.LN2)),(Ge.isMeshPhongMaterial||Ge.isMeshToonMaterial||Ge.isMeshLambertMaterial||Ge.isMeshBasicMaterial||Ge.isMeshStandardMaterial||Ge.isShaderMaterial)&&gr.setValue(ae,"isOrthographic",le.isOrthographicCamera===!0),C!==le&&(C=le,Hr=!0,Gr=!0)}if(Ue.isSkinnedMesh){gr.setOptional(ae,Ue,"bindMatrix"),gr.setOptional(ae,Ue,"bindMatrixInverse");const fn=Ue.skeleton;fn&&(Be.floatVertexTextures?(fn.boneTexture===null&&fn.computeBoneTexture(),gr.setValue(ae,"boneTexture",fn.boneTexture,je)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Ue.isBatchedMesh&&(gr.setOptional(ae,Ue,"batchingTexture"),gr.setValue(ae,"batchingTexture",Ue._matricesTexture,je));const Yo=ke.morphAttributes;if((Yo.position!==void 0||Yo.normal!==void 0||Yo.color!==void 0&&Be.isWebGL2===!0)&&gt.update(Ue,ke,De),(Hr||te.receiveShadow!==Ue.receiveShadow)&&(te.receiveShadow=Ue.receiveShadow,gr.setValue(ae,"receiveShadow",Ue.receiveShadow)),Ge.isMeshGouraudMaterial&&Ge.envMap!==null&&(cs.envMap.value=Pt,cs.flipEnvMap.value=Pt.isCubeTexture&&Pt.isRenderTargetTexture===!1?-1:1),Hr&&(gr.setValue(ae,"toneMappingExposure",_.toneMappingExposure),te.needsLights&&oi(cs,Gr),Rt&&Ge.fog===!0&&J.refreshFogUniforms(cs,Rt),J.refreshMaterialUniforms(cs,Ge,Q,ie,oe),bE.upload(ae,Xe(te),cs,je)),Ge.isShaderMaterial&&Ge.uniformsNeedUpdate===!0&&(bE.upload(ae,Xe(te),cs,je),Ge.uniformsNeedUpdate=!1),Ge.isSpriteMaterial&&gr.setValue(ae,"center",Ue.center),gr.setValue(ae,"modelViewMatrix",Ue.modelViewMatrix),gr.setValue(ae,"normalMatrix",Ue.normalMatrix),gr.setValue(ae,"modelMatrix",Ue.matrixWorld),Ge.isShaderMaterial||Ge.isRawShaderMaterial){const fn=Ge.uniformsGroups;for(let iu=0,ya=fn.length;iu<ya;iu++)if(Be.isWebGL2){const Vd=fn[iu];$e.update(Vd,De),$e.bind(Vd,De)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return De}function oi(le,Oe){le.ambientLightColor.needsUpdate=Oe,le.lightProbe.needsUpdate=Oe,le.directionalLights.needsUpdate=Oe,le.directionalLightShadows.needsUpdate=Oe,le.pointLights.needsUpdate=Oe,le.pointLightShadows.needsUpdate=Oe,le.spotLights.needsUpdate=Oe,le.spotLightShadows.needsUpdate=Oe,le.rectAreaLights.needsUpdate=Oe,le.hemisphereLights.needsUpdate=Oe}function gi(le){return le.isMeshLambertMaterial||le.isMeshToonMaterial||le.isMeshPhongMaterial||le.isMeshStandardMaterial||le.isShadowMaterial||le.isShaderMaterial&&le.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(le,Oe,ke){We.get(le.texture).__webglTexture=Oe,We.get(le.depthTexture).__webglTexture=ke;const Ge=We.get(le);Ge.__hasExternalTextures=!0,Ge.__hasExternalTextures&&(Ge.__autoAllocateDepthBuffer=ke===void 0,Ge.__autoAllocateDepthBuffer||Ie.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ge.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(le,Oe){const ke=We.get(le);ke.__webglFramebuffer=Oe,ke.__useDefaultFramebuffer=Oe===void 0},this.setRenderTarget=function(le,Oe=0,ke=0){I=le,T=Oe,E=ke;let Ge=!0,Ue=null,Rt=!1,Xt=!1;if(le){const Pt=We.get(le);Pt.__useDefaultFramebuffer!==void 0?(Ve.bindFramebuffer(ae.FRAMEBUFFER,null),Ge=!1):Pt.__webglFramebuffer===void 0?je.setupRenderTarget(le):Pt.__hasExternalTextures&&je.rebindTextures(le,We.get(le.texture).__webglTexture,We.get(le.depthTexture).__webglTexture);const zt=le.texture;(zt.isData3DTexture||zt.isDataArrayTexture||zt.isCompressedArrayTexture)&&(Xt=!0);const ni=We.get(le).__webglFramebuffer;le.isWebGLCubeRenderTarget?(Array.isArray(ni[Oe])?Ue=ni[Oe][ke]:Ue=ni[Oe],Rt=!0):Be.isWebGL2&&le.samples>0&&je.useMultisampledRTT(le)===!1?Ue=We.get(le).__webglMultisampledFramebuffer:Array.isArray(ni)?Ue=ni[ke]:Ue=ni,L.copy(le.viewport),z.copy(le.scissor),F=le.scissorTest}else L.copy(K).multiplyScalar(Q).floor(),z.copy(j).multiplyScalar(Q).floor(),F=$;if(Ve.bindFramebuffer(ae.FRAMEBUFFER,Ue)&&Be.drawBuffers&&Ge&&Ve.drawBuffers(le,Ue),Ve.viewport(L),Ve.scissor(z),Ve.setScissorTest(F),Rt){const Pt=We.get(le.texture);ae.framebufferTexture2D(ae.FRAMEBUFFER,ae.COLOR_ATTACHMENT0,ae.TEXTURE_CUBE_MAP_POSITIVE_X+Oe,Pt.__webglTexture,ke)}else if(Xt){const Pt=We.get(le.texture),zt=Oe||0;ae.framebufferTextureLayer(ae.FRAMEBUFFER,ae.COLOR_ATTACHMENT0,Pt.__webglTexture,ke||0,zt)}P=-1},this.readRenderTargetPixels=function(le,Oe,ke,Ge,Ue,Rt,Xt){if(!(le&&le.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ri=We.get(le).__webglFramebuffer;if(le.isWebGLCubeRenderTarget&&Xt!==void 0&&(ri=ri[Xt]),ri){Ve.bindFramebuffer(ae.FRAMEBUFFER,ri);try{const Pt=le.texture,zt=Pt.format,ni=Pt.type;if(zt!==so&&Dt.convert(zt)!==ae.getParameter(ae.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Lt=ni===Qy&&(Ie.has("EXT_color_buffer_half_float")||Be.isWebGL2&&Ie.has("EXT_color_buffer_float"));if(ni!==Vu&&Dt.convert(ni)!==ae.getParameter(ae.IMPLEMENTATION_COLOR_READ_TYPE)&&!(ni===Nc&&(Be.isWebGL2||Ie.has("OES_texture_float")||Ie.has("WEBGL_color_buffer_float")))&&!Lt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Oe>=0&&Oe<=le.width-Ge&&ke>=0&&ke<=le.height-Ue&&ae.readPixels(Oe,ke,Ge,Ue,Dt.convert(zt),Dt.convert(ni),Rt)}finally{const Pt=I!==null?We.get(I).__webglFramebuffer:null;Ve.bindFramebuffer(ae.FRAMEBUFFER,Pt)}}},this.copyFramebufferToTexture=function(le,Oe,ke=0){const Ge=Math.pow(2,-ke),Ue=Math.floor(Oe.image.width*Ge),Rt=Math.floor(Oe.image.height*Ge);je.setTexture2D(Oe,0),ae.copyTexSubImage2D(ae.TEXTURE_2D,ke,0,0,le.x,le.y,Ue,Rt),Ve.unbindTexture()},this.copyTextureToTexture=function(le,Oe,ke,Ge=0){const Ue=Oe.image.width,Rt=Oe.image.height,Xt=Dt.convert(ke.format),ri=Dt.convert(ke.type);je.setTexture2D(ke,0),ae.pixelStorei(ae.UNPACK_FLIP_Y_WEBGL,ke.flipY),ae.pixelStorei(ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ke.premultiplyAlpha),ae.pixelStorei(ae.UNPACK_ALIGNMENT,ke.unpackAlignment),Oe.isDataTexture?ae.texSubImage2D(ae.TEXTURE_2D,Ge,le.x,le.y,Ue,Rt,Xt,ri,Oe.image.data):Oe.isCompressedTexture?ae.compressedTexSubImage2D(ae.TEXTURE_2D,Ge,le.x,le.y,Oe.mipmaps[0].width,Oe.mipmaps[0].height,Xt,Oe.mipmaps[0].data):ae.texSubImage2D(ae.TEXTURE_2D,Ge,le.x,le.y,Xt,ri,Oe.image),Ge===0&&ke.generateMipmaps&&ae.generateMipmap(ae.TEXTURE_2D),Ve.unbindTexture()},this.copyTextureToTexture3D=function(le,Oe,ke,Ge,Ue=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Rt=le.max.x-le.min.x+1,Xt=le.max.y-le.min.y+1,ri=le.max.z-le.min.z+1,Pt=Dt.convert(Ge.format),zt=Dt.convert(Ge.type);let ni;if(Ge.isData3DTexture)je.setTexture3D(Ge,0),ni=ae.TEXTURE_3D;else if(Ge.isDataArrayTexture)je.setTexture2DArray(Ge,0),ni=ae.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ae.pixelStorei(ae.UNPACK_FLIP_Y_WEBGL,Ge.flipY),ae.pixelStorei(ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),ae.pixelStorei(ae.UNPACK_ALIGNMENT,Ge.unpackAlignment);const Lt=ae.getParameter(ae.UNPACK_ROW_LENGTH),Zi=ae.getParameter(ae.UNPACK_IMAGE_HEIGHT),Vr=ae.getParameter(ae.UNPACK_SKIP_PIXELS),$i=ae.getParameter(ae.UNPACK_SKIP_ROWS),lr=ae.getParameter(ae.UNPACK_SKIP_IMAGES),Z=ke.isCompressedTexture?ke.mipmaps[0]:ke.image;ae.pixelStorei(ae.UNPACK_ROW_LENGTH,Z.width),ae.pixelStorei(ae.UNPACK_IMAGE_HEIGHT,Z.height),ae.pixelStorei(ae.UNPACK_SKIP_PIXELS,le.min.x),ae.pixelStorei(ae.UNPACK_SKIP_ROWS,le.min.y),ae.pixelStorei(ae.UNPACK_SKIP_IMAGES,le.min.z),ke.isDataTexture||ke.isData3DTexture?ae.texSubImage3D(ni,Ue,Oe.x,Oe.y,Oe.z,Rt,Xt,ri,Pt,zt,Z.data):ke.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ae.compressedTexSubImage3D(ni,Ue,Oe.x,Oe.y,Oe.z,Rt,Xt,ri,Pt,Z.data)):ae.texSubImage3D(ni,Ue,Oe.x,Oe.y,Oe.z,Rt,Xt,ri,Pt,zt,Z),ae.pixelStorei(ae.UNPACK_ROW_LENGTH,Lt),ae.pixelStorei(ae.UNPACK_IMAGE_HEIGHT,Zi),ae.pixelStorei(ae.UNPACK_SKIP_PIXELS,Vr),ae.pixelStorei(ae.UNPACK_SKIP_ROWS,$i),ae.pixelStorei(ae.UNPACK_SKIP_IMAGES,lr),Ue===0&&Ge.generateMipmaps&&ae.generateMipmap(ni),Ve.unbindTexture()},this.initTexture=function(le){le.isCubeTexture?je.setTextureCube(le,0):le.isData3DTexture?je.setTexture3D(le,0):le.isDataArrayTexture||le.isCompressedArrayTexture?je.setTexture2DArray(le,0):je.setTexture2D(le,0),Ve.unbindTexture()},this.resetState=function(){T=0,E=0,I=null,Ve.reset(),ge.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Uc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const i=this.getContext();i.drawingBufferColorSpace=t===x2?"display-p3":"srgb",i.unpackColorSpace=Tr.workingColorSpace===b_?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===bs?dp:vz}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===dp?bs:Qu}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}class w9 extends Dz{}w9.prototype.isWebGL1Renderer=!0;class _2{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Zt(t),this.density=i}clone(){return new _2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class S2{constructor(t,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Zt(t),this.near=i,this.far=r}clone(){return new S2(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class YE extends mr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}}class M2{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=Ib,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=fl()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return console.warn('THREE.InterleavedBuffer: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,r){t*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=i.array[r+n];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fl()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fl()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Za=new pe;class Fg{constructor(t,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,r=this.data.count;i<r;i++)Za.fromBufferAttribute(this,i),Za.applyMatrix4(t),this.setXYZ(i,Za.x,Za.y,Za.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)Za.fromBufferAttribute(this,i),Za.applyNormalMatrix(t),this.setXYZ(i,Za.x,Za.y,Za.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)Za.fromBufferAttribute(this,i),Za.transformDirection(t),this.setXYZ(i,Za.x,Za.y,Za.z);return this}setX(t,i){return this.normalized&&(i=Xi(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=Xi(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=Xi(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=Xi(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=No(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=No(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=No(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=No(i,this.array)),i}setXY(t,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this}setXYZ(t,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array),n=Xi(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=Xi(i,this.array),r=Xi(r,this.array),n=Xi(n,this.array),s=Xi(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new Ir(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Fg(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Rz extends ga{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Zt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let S0;const k1=new pe,M0=new pe,A0=new pe,E0=new yt,V1=new yt,b9=new Ci,mM=new pe,H1=new pe,gM=new pe,GF=new yt,IP=new yt,jF=new yt;class _9 extends mr{constructor(t=new Rz){if(super(),this.isSprite=!0,this.type="Sprite",S0===void 0){S0=new Gi;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new M2(i,5);S0.setIndex([0,1,2,0,2,3]),S0.setAttribute("position",new Fg(r,3,0,!1)),S0.setAttribute("uv",new Fg(r,2,3,!1))}this.geometry=S0,this.material=t,this.center=new yt(.5,.5)}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),M0.setFromMatrixScale(this.matrixWorld),b9.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),A0.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&M0.multiplyScalar(-A0.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;vM(mM.set(-.5,-.5,0),A0,a,M0,n,s),vM(H1.set(.5,-.5,0),A0,a,M0,n,s),vM(gM.set(.5,.5,0),A0,a,M0,n,s),GF.set(0,0),IP.set(1,0),jF.set(1,1);let o=t.ray.intersectTriangle(mM,H1,gM,!1,k1);if(o===null&&(vM(H1.set(-.5,.5,0),A0,a,M0,n,s),IP.set(0,1),o=t.ray.intersectTriangle(mM,gM,H1,!1,k1),o===null))return;const l=t.ray.origin.distanceTo(k1);l<t.near||l>t.far||i.push({distance:l,point:k1.clone(),uv:Oo.getInterpolation(k1,mM,H1,gM,GF,IP,jF,new yt),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function vM(e,t,i,r,n,s){E0.subVectors(e,i).addScalar(.5).multiply(r),n!==void 0?(V1.x=s*E0.x-n*E0.y,V1.y=n*E0.x+s*E0.y):V1.copy(E0),e.copy(t),e.x+=V1.x,e.y+=V1.y,e.applyMatrix4(b9)}const yM=new pe,WF=new pe;class S9 extends mr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),t<s)break}return i[r-1].object}return null}raycast(t,i){if(this.levels.length>0){yM.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(yM);this.getObjectForDistance(n).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){yM.setFromMatrixPosition(t.matrixWorld),WF.setFromMatrixPosition(this.matrixWorld);const r=yM.distanceTo(WF)/t.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const XF=new pe,qF=new Pr,YF=new Pr,Sse=new pe,QF=new Ci,xM=new pe,LP=new Ba,ZF=new Ci,OP=new Jg;class M9 extends rs{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=XR,this.bindMatrix=new Ci,this.bindMatrixInverse=new Ci,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new ho),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,xM),this.boundingBox.expandByPoint(xM)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ba),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,xM),this.boundingSphere.expandByPoint(xM)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),LP.copy(this.boundingSphere),LP.applyMatrix4(n),t.ray.intersectsSphere(LP)!==!1&&(ZF.copy(n).invert(),OP.copy(t.ray).applyMatrix4(ZF),!(this.boundingBox!==null&&OP.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,i,OP)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Pr,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===XR?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===N8?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const r=this.skeleton,n=this.geometry;qF.fromBufferAttribute(n.attributes.skinIndex,t),YF.fromBufferAttribute(n.attributes.skinWeight,t),XF.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=YF.getComponent(s);if(a!==0){const o=qF.getComponent(s);QF.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(Sse.copy(XF).applyMatrix4(QF),a)}}return i.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,i){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,i)}}class Iz extends mr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Cg extends dn{constructor(t=null,i=1,r=1,n,s,a,o,l,c=Fn,u=Fn,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const KF=new Ci,Mse=new Ci;class A2{constructor(t=[],i=[]){this.uuid=fl(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Ci)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const r=new Ci;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:Mse;KF.multiplyMatrices(o,i[s]),KF.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new A2(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const r=new Cg(i,t,t,so,Nc);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(t){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===t)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const s=t.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new Iz),this.bones.push(a),this.boneInverses.push(new Ci().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.bones.push(a.uuid);const o=r[n];t.boneInverses.push(o.toArray())}return t}}class $y extends Ir{constructor(t,i,r,n=1){super(t,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const T0=new Ci,JF=new Ci,wM=[],$F=new ho,Ase=new Ci,G1=new rs,j1=new Ba;class A9 extends rs{constructor(t,i,r){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new $y(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,Ase)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new ho),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,T0),$F.copy(t.boundingBox).applyMatrix4(T0),this.boundingBox.union($F)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ba),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,T0),j1.copy(t.boundingSphere).applyMatrix4(T0),this.boundingSphere.union(j1)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}raycast(t,i){const r=this.matrixWorld,n=this.count;if(G1.geometry=this.geometry,G1.material=this.material,G1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),j1.copy(this.boundingSphere),j1.applyMatrix4(r),t.ray.intersectsSphere(j1)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,T0),JF.multiplyMatrices(r,T0),G1.matrixWorld=JF,G1.raycast(t,wM);for(let a=0,o=wM.length;a<o;a++){const l=wM[a];l.instanceId=s,l.object=this,i.push(l)}wM.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new $y(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function Ese(e,t){return e.z-t.z}function Tse(e,t){return t.z-e.z}class Cse{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,i){const r=this.pool,n=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const s=r[this.index];n.push(s),this.index++,s.start=t.start,s.count=t.count,s.z=i}reset(){this.list.length=0,this.index=0}}const C0="batchId",Ef=new Ci,ek=new Ci,Pse=new Ci,tk=new Ci,zP=new M_,bM=new ho,Pm=new Ba,W1=new pe,BP=new Cse,Ca=new rs,_M=[];function Dse(e,t,i=0){const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const n=e.count;for(let s=0;s<n;s++)for(let a=0;a<r;a++)t.setComponent(s+i,a,e.getComponent(s,a))}else t.array.set(e.array,i*r);t.needsUpdate=!0}class E9 extends rs{get maxGeometryCount(){return this._maxGeometryCount}constructor(t,i,r=i*2,n){super(new Gi,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=t,this._maxVertexCount=i,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let t=Math.sqrt(this._maxGeometryCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4),r=new Cg(i,t,t,so,Nc);this._matricesTexture=r}_initializeGeometry(t){const i=this.geometry,r=this._maxVertexCount,n=this._maxGeometryCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in t.attributes){const l=t.getAttribute(o),{array:c,itemSize:u,normalized:h}=l,d=new c.constructor(r*u),f=new l.constructor(d,u,h);f.setUsage(l.usage),i.setAttribute(o,f)}if(t.getIndex()!==null){const o=r>65536?new Uint32Array(s):new Uint16Array(s);i.setIndex(new Ir(o,1))}const a=n>65536?new Uint32Array(r):new Uint16Array(r);i.setAttribute(C0,new Ir(a,1)),this._geometryInitialized=!0}}_validateGeometry(t){if(t.getAttribute(C0))throw new Error(`BatchedMesh: Geometry cannot use attribute "${C0}"`);const i=this.geometry;if(!!t.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(r===C0)continue;if(!t.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=t.getAttribute(r),s=i.getAttribute(r);if(n.itemSize!==s.itemSize||n.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ho);const t=this._geometryCount,i=this.boundingBox,r=this._active;i.makeEmpty();for(let n=0;n<t;n++)r[n]!==!1&&(this.getMatrixAt(n,Ef),this.getBoundingBoxAt(n,bM).applyMatrix4(Ef),i.union(bM))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ba);const t=this._geometryCount,i=this.boundingSphere,r=this._active;i.makeEmpty();for(let n=0;n<t;n++)r[n]!==!1&&(this.getMatrixAt(n,Ef),this.getBoundingSphereAt(n,Pm).applyMatrix4(Ef),i.union(Pm))}addGeometry(t,i=-1,r=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const a=this._reservedRanges,o=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=a[a.length-1]),i===-1?n.vertexCount=t.getAttribute("position").count:n.vertexCount=i,s===null?n.vertexStart=0:n.vertexStart=s.vertexStart+s.vertexCount;const c=t.getIndex(),u=c!==null;if(u&&(r===-1?n.indexCount=c.count:n.indexCount=r,s===null?n.indexStart=0:n.indexStart=s.indexStart+s.indexCount),n.indexStart!==-1&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,d=this._active,f=this._matricesTexture,m=this._matricesTexture.image.data;h.push(!0),d.push(!0);const v=this._geometryCount;this._geometryCount++,Pse.toArray(m,v*16),f.needsUpdate=!0,a.push(n),o.push({start:u?n.indexStart:n.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new ho,sphereInitialized:!1,sphere:new Ba});const g=this.geometry.getAttribute(C0);for(let x=0;x<n.vertexCount;x++)g.setX(n.vertexStart+x,v);return g.needsUpdate=!0,this.setGeometryAt(v,t),v}setGeometryAt(t,i){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,n=r.getIndex()!==null,s=r.getIndex(),a=i.getIndex(),o=this._reservedRanges[t];if(n&&a.count>o.indexCount||i.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.vertexCount;for(const f in r.attributes){if(f===C0)continue;const m=i.getAttribute(f),v=r.getAttribute(f);Dse(m,v,l);const g=m.itemSize;for(let x=m.count,S=c;x<S;x++){const _=l+x;for(let A=0;A<g;A++)v.setComponent(_,A,0)}v.needsUpdate=!0}if(n){const f=o.indexStart;for(let m=0;m<a.count;m++)s.setX(f+m,l+a.getX(m));for(let m=a.count,v=o.indexCount;m<v;m++)s.setX(f+m,l);s.needsUpdate=!0}const u=this._bounds[t];i.boundingBox!==null?(u.box.copy(i.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,i.boundingSphere!==null?(u.sphere.copy(i.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[t],d=i.getAttribute("position");return h.count=n?a.count:d.count,this._visibilityChanged=!0,t}deleteGeometry(t){const i=this._active;return t>=i.length||i[t]===!1?this:(i[t]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(t,i){if(this._active[t]===!1)return this;const n=this._bounds[t],s=n.box,a=this.geometry;if(n.boxInitialized===!1){s.makeEmpty();const o=a.index,l=a.attributes.position,c=this._drawRanges[t];for(let u=c.start,h=c.start+c.count;u<h;u++){let d=u;o&&(d=o.getX(d)),s.expandByPoint(W1.fromBufferAttribute(l,d))}n.boxInitialized=!0}return i.copy(s),i}getBoundingSphereAt(t,i){if(this._active[t]===!1)return this;const n=this._bounds[t],s=n.sphere,a=this.geometry;if(n.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(t,bM),bM.getCenter(s.center);const o=a.index,l=a.attributes.position,c=this._drawRanges[t];let u=0;for(let h=c.start,d=c.start+c.count;h<d;h++){let f=h;o&&(f=o.getX(f)),W1.fromBufferAttribute(l,f),u=Math.max(u,s.center.distanceToSquared(W1))}s.radius=Math.sqrt(u),n.sphereInitialized=!0}return i.copy(s),i}setMatrixAt(t,i){const r=this._active,n=this._matricesTexture,s=this._matricesTexture.image.data,a=this._geometryCount;return t>=a||r[t]===!1?this:(i.toArray(s,t*16),n.needsUpdate=!0,this)}getMatrixAt(t,i){const r=this._active,n=this._matricesTexture.image.data,s=this._geometryCount;return t>=s||r[t]===!1?null:i.fromArray(n,t*16)}setVisibleAt(t,i){const r=this._visibility,n=this._active,s=this._geometryCount;return t>=s||n[t]===!1||r[t]===i?this:(r[t]=i,this._visibilityChanged=!0,this)}getVisibleAt(t){const i=this._visibility,r=this._active,n=this._geometryCount;return t>=n||r[t]===!1?!1:i[t]}raycast(t,i){const r=this._visibility,n=this._active,s=this._drawRanges,a=this._geometryCount,o=this.matrixWorld,l=this.geometry;Ca.material=this.material,Ca.geometry.index=l.index,Ca.geometry.attributes=l.attributes,Ca.geometry.boundingBox===null&&(Ca.geometry.boundingBox=new ho),Ca.geometry.boundingSphere===null&&(Ca.geometry.boundingSphere=new Ba);for(let c=0;c<a;c++){if(!r[c]||!n[c])continue;const u=s[c];Ca.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(c,Ca.matrixWorld).premultiply(o),this.getBoundingBoxAt(c,Ca.geometry.boundingBox),this.getBoundingSphereAt(c,Ca.geometry.boundingSphere),Ca.raycast(t,_M);for(let h=0,d=_M.length;h<d;h++){const f=_M[h];f.object=this,f.batchId=c,i.push(f)}_M.length=0}Ca.material=null,Ca.geometry.index=null,Ca.geometry.attributes={},Ca.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map(i=>({...i})),this._reservedRanges=t._reservedRanges.map(i=>({...i})),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(t,i,r,n,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=n.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,d=this.perObjectFrustumCulled;d&&(tk.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),zP.setFromProjectionMatrix(tk,t.isWebGPURenderer?Zy:Uc));let f=0;if(this.sortObjects){ek.copy(this.matrixWorld).invert(),W1.setFromMatrixPosition(r.matrixWorld).applyMatrix4(ek);for(let g=0,x=l.length;g<x;g++)if(l[g]){this.getMatrixAt(g,Ef),this.getBoundingSphereAt(g,Pm).applyMatrix4(Ef);let S=!1;if(d&&(S=!zP.intersectsSphere(Pm)),!S){const _=W1.distanceTo(Pm.center);BP.push(h[g],_)}}const m=BP.list,v=this.customSort;v===null?m.sort(s.transparent?Tse:Ese):v.call(this,m,r);for(let g=0,x=m.length;g<x;g++){const S=m[g];c[f]=S.start*o,u[f]=S.count,f++}BP.reset()}else for(let m=0,v=l.length;m<v;m++)if(l[m]){let g=!1;if(d&&(this.getMatrixAt(m,Ef),this.getBoundingSphereAt(m,Pm).applyMatrix4(Ef),g=!zP.intersectsSphere(Pm)),!g){const x=h[m];c[f]=x.start*o,u[f]=x.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(t,i,r,n,s,a){this.onBeforeRender(t,null,n,s,a)}}class go extends ga{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Zt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ik=new pe,rk=new pe,nk=new Ci,NP=new Jg,SM=new Ba;class bp extends mr{constructor(t=new Gi,i=new go){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)ik.fromBufferAttribute(i,n-1),rk.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=ik.distanceTo(rk);t.setAttribute("lineDistance",new ii(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),SM.copy(r.boundingSphere),SM.applyMatrix4(n),SM.radius+=s,t.ray.intersectsSphere(SM)===!1)return;nk.copy(n).invert(),NP.copy(t.ray).applyMatrix4(nk);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new pe,u=new pe,h=new pe,d=new pe,f=this.isLineSegments?2:1,m=r.index,g=r.attributes.position;if(m!==null){const x=Math.max(0,a.start),S=Math.min(m.count,a.start+a.count);for(let _=x,A=S-1;_<A;_+=f){const T=m.getX(_),E=m.getX(_+1);if(c.fromBufferAttribute(g,T),u.fromBufferAttribute(g,E),NP.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const P=t.ray.origin.distanceTo(d);P<t.near||P>t.far||i.push({distance:P,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const x=Math.max(0,a.start),S=Math.min(g.count,a.start+a.count);for(let _=x,A=S-1;_<A;_+=f){if(c.fromBufferAttribute(g,_),u.fromBufferAttribute(g,_+1),NP.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const E=t.ray.origin.distanceTo(d);E<t.near||E>t.far||i.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}const sk=new pe,ak=new pe;class ih extends bp{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)sk.fromBufferAttribute(i,n),ak.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+sk.distanceTo(ak);t.setAttribute("lineDistance",new ii(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class T9 extends bp{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class E2 extends ga{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Zt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const ok=new Ci,SI=new Jg,MM=new Ba,AM=new pe;let C9=class extends mr{constructor(t=new Gi,i=new E2){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),MM.copy(r.boundingSphere),MM.applyMatrix4(n),MM.radius+=s,t.ray.intersectsSphere(MM)===!1)return;ok.copy(n).invert(),SI.copy(t.ray).applyMatrix4(ok);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);for(let m=d,v=f;m<v;m++){const g=c.getX(m);AM.fromBufferAttribute(h,g),lk(AM,g,l,n,t,i,this)}}else{const d=Math.max(0,a.start),f=Math.min(h.count,a.start+a.count);for(let m=d,v=f;m<v;m++)AM.fromBufferAttribute(h,m),lk(AM,m,l,n,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function lk(e,t,i,r,n,s,a){const o=SI.distanceSqToPoint(e);if(o<i){const l=new pe;SI.closestPointToPoint(e,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}class Rse extends dn{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:kn,this.magFilter=s!==void 0?s:kn,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Ise extends dn{constructor(t,i){super({width:t,height:i}),this.isFramebufferTexture=!0,this.magFilter=Fn,this.minFilter=Fn,this.generateMipmaps=!1,this.needsUpdate=!0}}class T2 extends dn{constructor(t,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class Lse extends T2{constructor(t,i,r,n,s,a){super(t,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=Ia}}class Ose extends T2{constructor(t,i,r){super(void 0,t[0].width,t[0].height,i,r,Dd),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class zse extends dn{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Jc{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,i){const r=this.getUtoTmapping(t);return this.getPoint(r,i)}getPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return i}getSpacedPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPointAt(r/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=t*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,f=(a-u)/d;return(n+f)/(s-1)}getTangent(t,i){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new yt:new pe);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const r=this.getUtoTmapping(t);return this.getTangent(r,i)}computeFrenetFrames(t,i){const r=new pe,n=[],s=[],a=[],o=new pe,l=new Ci;for(let f=0;f<=t;f++){const m=f/t;n[f]=this.getTangentAt(m,new pe)}s[0]=new pe,a[0]=new pe;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let f=1;f<=t;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(n[f-1],n[f]),o.length()>Number.EPSILON){o.normalize();const m=Math.acos(Cn(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,m))}a[f].crossVectors(n[f],s[f])}if(i===!0){let f=Math.acos(Cn(s[0].dot(s[t]),-1,1));f/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(f=-f);for(let m=1;m<=t;m++)s[m].applyMatrix4(l.makeRotationAxis(n[m],f*m)),a[m].crossVectors(n[m],s[m])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class C2 extends Jc{constructor(t=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i){const r=i||new yt,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*u-f*h+this.aX,c=d*h+f*u+this.aY}return r.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class P9 extends C2{constructor(t,i,r,n,s,a){super(t,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Lz(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,n(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+r*o}}}const EM=new pe,UP=new Lz,FP=new Lz,kP=new Lz;class D9 extends Jc{constructor(t=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=r,this.tension=n}getPoint(t,i=new pe){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(EM.subVectors(n[0],n[1]).add(n[0]),c=EM);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(EM.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=EM),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(u),f);v<1e-4&&(v=1),m<1e-4&&(m=v),g<1e-4&&(g=v),UP.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,m,v,g),FP.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,m,v,g),kP.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,m,v,g)}else this.curveType==="catmullrom"&&(UP.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),FP.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),kP.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(UP.calc(l),FP.calc(l),kP.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new pe().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ck(e,t,i,r,n){const s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function Bse(e,t){const i=1-e;return i*i*t}function Nse(e,t){return 2*(1-e)*e*t}function Use(e,t){return e*e*t}function Zw(e,t,i,r){return Bse(e,t)+Nse(e,i)+Use(e,r)}function Fse(e,t){const i=1-e;return i*i*i*t}function kse(e,t){const i=1-e;return 3*i*i*e*t}function Vse(e,t){return 3*(1-e)*e*e*t}function Hse(e,t){return e*e*e*t}function Kw(e,t,i,r,n){return Fse(e,t)+kse(e,i)+Vse(e,r)+Hse(e,n)}class Oz extends Jc{constructor(t=new yt,i=new yt,r=new yt,n=new yt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new yt){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Kw(t,n.x,s.x,a.x,o.x),Kw(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class R9 extends Jc{constructor(t=new pe,i=new pe,r=new pe,n=new pe){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new pe){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(Kw(t,n.x,s.x,a.x,o.x),Kw(t,n.y,s.y,a.y,o.y),Kw(t,n.z,s.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class zz extends Jc{constructor(t=new yt,i=new yt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new yt){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new yt){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class I9 extends Jc{constructor(t=new pe,i=new pe){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new pe){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new pe){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Bz extends Jc{constructor(t=new yt,i=new yt,r=new yt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new yt){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(Zw(t,n.x,s.x,a.x),Zw(t,n.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Nz extends Jc{constructor(t=new pe,i=new pe,r=new pe){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new pe){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(Zw(t,n.x,s.x,a.x),Zw(t,n.y,s.y,a.y),Zw(t,n.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Uz extends Jc{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new yt){const r=i,n=this.points,s=(n.length-1)*t,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(ck(o,l.x,c.x,u.x,h.x),ck(o,l.y,c.y,u.y,h.y)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new yt().fromArray(n))}return this}}var QE=Object.freeze({__proto__:null,ArcCurve:P9,CatmullRomCurve3:D9,CubicBezierCurve:Oz,CubicBezierCurve3:R9,EllipseCurve:C2,LineCurve:zz,LineCurve3:I9,QuadraticBezierCurve:Bz,QuadraticBezierCurve3:Nz,SplineCurve:Uz});class L9 extends Jc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(i)){const r=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new QE[r](i,t))}return this}getPoint(t,i){const r=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(new QE[n.type]().fromJSON(n))}return this}}class Ob extends L9{constructor(t){super(),this.type="Path",this.currentPoint=new yt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,r=t.length;i<r;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const r=new zz(this.currentPoint.clone(),new yt(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,r,n){const s=new Bz(this.currentPoint.clone(),new yt(t,i),new yt(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(t,i,r,n,s,a){const o=new Oz(this.currentPoint.clone(),new yt(t,i),new yt(r,n),new yt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),r=new Uz(i);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,r,n,s,a),this}absarc(t,i,r,n,s,a){return this.absellipse(t,i,r,r,n,s,a),this}ellipse(t,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,i+u,r,n,s,a,o,l),this}absellipse(t,i,r,n,s,a,o,l){const c=new C2(t,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class E_ extends Gi{constructor(t=[new yt(0,-.5),new yt(.5,0),new yt(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=Cn(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new pe,d=new yt,f=new pe,m=new pe,v=new pe;let g=0,x=0;for(let S=0;S<=t.length-1;S++)switch(S){case 0:g=t[S+1].x-t[S].x,x=t[S+1].y-t[S].y,f.x=x*1,f.y=-g,f.z=x*0,v.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case t.length-1:l.push(v.x,v.y,v.z);break;default:g=t[S+1].x-t[S].x,x=t[S+1].y-t[S].y,f.x=x*1,f.y=-g,f.z=x*0,m.copy(f),f.x+=v.x,f.y+=v.y,f.z+=v.z,f.normalize(),l.push(f.x,f.y,f.z),v.copy(m)}for(let S=0;S<=i;S++){const _=r+S*u*n,A=Math.sin(_),T=Math.cos(_);for(let E=0;E<=t.length-1;E++){h.x=t[E].x*A,h.y=t[E].y,h.z=t[E].x*T,a.push(h.x,h.y,h.z),d.x=S/i,d.y=E/(t.length-1),o.push(d.x,d.y);const I=l[3*E+0]*A,P=l[3*E+1],C=l[3*E+0]*T;c.push(I,P,C)}}for(let S=0;S<i;S++)for(let _=0;_<t.length-1;_++){const A=_+S*t.length,T=A,E=A+t.length,I=A+t.length+1,P=A+1;s.push(T,E,P),s.push(I,P,E)}this.setIndex(s),this.setAttribute("position",new ii(a,3)),this.setAttribute("uv",new ii(o,2)),this.setAttribute("normal",new ii(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new E_(t.points,t.segments,t.phiStart,t.phiLength)}}class P2 extends E_{constructor(t=1,i=1,r=4,n=8){const s=new Ob;s.absarc(0,-i/2,t,Math.PI*1.5,0),s.absarc(0,i/2,t,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:t,length:i,capSegments:r,radialSegments:n}}static fromJSON(t){return new P2(t.radius,t.length,t.capSegments,t.radialSegments)}}class D2 extends Gi{constructor(t=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new pe,u=new yt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const f=r+h/i*n;c.x=t*Math.cos(f),c.y=t*Math.sin(f),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/t+1)/2,u.y=(a[d+1]/t+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new ii(a,3)),this.setAttribute("normal",new ii(o,3)),this.setAttribute("uv",new ii(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new D2(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class wx extends Gi{constructor(t=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],f=[];let m=0;const v=[],g=r/2;let x=0;S(),a===!1&&(t>0&&_(!0),i>0&&_(!1)),this.setIndex(u),this.setAttribute("position",new ii(h,3)),this.setAttribute("normal",new ii(d,3)),this.setAttribute("uv",new ii(f,2));function S(){const A=new pe,T=new pe;let E=0;const I=(i-t)/r;for(let P=0;P<=s;P++){const C=[],L=P/s,z=L*(i-t)+t;for(let F=0;F<=n;F++){const G=F/n,N=G*l+o,q=Math.sin(N),ie=Math.cos(N);T.x=z*q,T.y=-L*r+g,T.z=z*ie,h.push(T.x,T.y,T.z),A.set(q,I,ie).normalize(),d.push(A.x,A.y,A.z),f.push(G,1-L),C.push(m++)}v.push(C)}for(let P=0;P<n;P++)for(let C=0;C<s;C++){const L=v[C][P],z=v[C+1][P],F=v[C+1][P+1],G=v[C][P+1];u.push(L,z,G),u.push(z,F,G),E+=6}c.addGroup(x,E,0),x+=E}function _(A){const T=m,E=new yt,I=new pe;let P=0;const C=A===!0?t:i,L=A===!0?1:-1;for(let F=1;F<=n;F++)h.push(0,g*L,0),d.push(0,L,0),f.push(.5,.5),m++;const z=m;for(let F=0;F<=n;F++){const N=F/n*l+o,q=Math.cos(N),ie=Math.sin(N);I.x=C*ie,I.y=g*L,I.z=C*q,h.push(I.x,I.y,I.z),d.push(0,L,0),E.x=q*.5+.5,E.y=ie*.5*L+.5,f.push(E.x,E.y),m++}for(let F=0;F<n;F++){const G=T+F,N=z+F;A===!0?u.push(N,N+1,G):u.push(N+1,N,G),P+=3}c.addGroup(x,P,A===!0?1:2),x+=P}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wx(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class R2 extends wx{constructor(t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new R2(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Rp extends Gi{constructor(t=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new ii(s,3)),this.setAttribute("normal",new ii(s.slice(),3)),this.setAttribute("uv",new ii(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(S){const _=new pe,A=new pe,T=new pe;for(let E=0;E<i.length;E+=3)f(i[E+0],_),f(i[E+1],A),f(i[E+2],T),l(_,A,T,S)}function l(S,_,A,T){const E=T+1,I=[];for(let P=0;P<=E;P++){I[P]=[];const C=S.clone().lerp(A,P/E),L=_.clone().lerp(A,P/E),z=E-P;for(let F=0;F<=z;F++)F===0&&P===E?I[P][F]=C:I[P][F]=C.clone().lerp(L,F/z)}for(let P=0;P<E;P++)for(let C=0;C<2*(E-P)-1;C++){const L=Math.floor(C/2);C%2===0?(d(I[P][L+1]),d(I[P+1][L]),d(I[P][L])):(d(I[P][L+1]),d(I[P+1][L+1]),d(I[P+1][L]))}}function c(S){const _=new pe;for(let A=0;A<s.length;A+=3)_.x=s[A+0],_.y=s[A+1],_.z=s[A+2],_.normalize().multiplyScalar(S),s[A+0]=_.x,s[A+1]=_.y,s[A+2]=_.z}function u(){const S=new pe;for(let _=0;_<s.length;_+=3){S.x=s[_+0],S.y=s[_+1],S.z=s[_+2];const A=g(S)/2/Math.PI+.5,T=x(S)/Math.PI+.5;a.push(A,1-T)}m(),h()}function h(){for(let S=0;S<a.length;S+=6){const _=a[S+0],A=a[S+2],T=a[S+4],E=Math.max(_,A,T),I=Math.min(_,A,T);E>.9&&I<.1&&(_<.2&&(a[S+0]+=1),A<.2&&(a[S+2]+=1),T<.2&&(a[S+4]+=1))}}function d(S){s.push(S.x,S.y,S.z)}function f(S,_){const A=S*3;_.x=t[A+0],_.y=t[A+1],_.z=t[A+2]}function m(){const S=new pe,_=new pe,A=new pe,T=new pe,E=new yt,I=new yt,P=new yt;for(let C=0,L=0;C<s.length;C+=9,L+=6){S.set(s[C+0],s[C+1],s[C+2]),_.set(s[C+3],s[C+4],s[C+5]),A.set(s[C+6],s[C+7],s[C+8]),E.set(a[L+0],a[L+1]),I.set(a[L+2],a[L+3]),P.set(a[L+4],a[L+5]),T.copy(S).add(_).add(A).divideScalar(3);const z=g(T);v(E,L+0,S,z),v(I,L+2,_,z),v(P,L+4,A,z)}}function v(S,_,A,T){T<0&&S.x===1&&(a[_]=S.x-1),A.x===0&&A.z===0&&(a[_]=T/2/Math.PI+.5)}function g(S){return Math.atan2(S.z,-S.x)}function x(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Rp(t.vertices,t.indices,t.radius,t.details)}}class I2 extends Rp{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new I2(t.radius,t.detail)}}const TM=new pe,CM=new pe,VP=new pe,PM=new Oo;class O9 extends Gi{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const n=Math.pow(10,4),s=Math.cos(Eg*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let m=0;m<l;m+=3){a?(c[0]=a.getX(m),c[1]=a.getX(m+1),c[2]=a.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:v,b:g,c:x}=PM;if(v.fromBufferAttribute(o,c[0]),g.fromBufferAttribute(o,c[1]),x.fromBufferAttribute(o,c[2]),PM.getNormal(VP),h[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,h[1]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,h[2]=`${Math.round(x.x*n)},${Math.round(x.y*n)},${Math.round(x.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let S=0;S<3;S++){const _=(S+1)%3,A=h[S],T=h[_],E=PM[u[S]],I=PM[u[_]],P=`${A}_${T}`,C=`${T}_${A}`;C in d&&d[C]?(VP.dot(d[C].normal)<=s&&(f.push(E.x,E.y,E.z),f.push(I.x,I.y,I.z)),d[C]=null):P in d||(d[P]={index0:c[S],index1:c[_],normal:VP.clone()})}}for(const m in d)if(d[m]){const{index0:v,index1:g}=d[m];TM.fromBufferAttribute(o,v),CM.fromBufferAttribute(o,g),f.push(TM.x,TM.y,TM.z),f.push(CM.x,CM.y,CM.z)}this.setAttribute("position",new ii(f,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Pg extends Ob{constructor(t){super(t),this.uuid=fl(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(new Ob().fromJSON(n))}return this}}const Gse={triangulate:function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let s=z9(e,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=Yse(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let m=i;m<n;m+=i)h=e[m],d=e[m+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=f!==0?32767/f:0}return zb(s,a,i,o,l,f,0),a}};function z9(e,t,i,r,n){let s,a;if(n===sae(e,t,i,r)>0)for(s=t;s<i;s+=r)a=uk(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=uk(s,e[s],e[s+1],a);return a&&L2(a,a.next)&&(Nb(a),a=a.next),a}function kg(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(L2(i,i.next)||vn(i.prev,i,i.next)===0)){if(Nb(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function zb(e,t,i,r,n,s,a){if(!e)return;!a&&s&&$se(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?Wse(e,r,n,s):jse(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),Nb(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=Xse(kg(e),t,i),zb(e,t,i,r,n,s,2)):a===2&&qse(e,t,i,r,n,s):zb(kg(e),t,i,r,n,s,1);break}}}function jse(e){const t=e.prev,i=e,r=e.next;if(vn(t,i,r)>=0)return!1;const n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c;let m=r.next;for(;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=f&&wy(n,o,s,l,a,c,m.x,m.y)&&vn(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Wse(e,t,i,r){const n=e.prev,s=e,a=e.next;if(vn(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,m=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,x=MI(f,m,t,i,r),S=MI(v,g,t,i,r);let _=e.prevZ,A=e.nextZ;for(;_&&_.z>=x&&A&&A.z<=S;){if(_.x>=f&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&wy(o,u,l,h,c,d,_.x,_.y)&&vn(_.prev,_,_.next)>=0||(_=_.prevZ,A.x>=f&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&wy(o,u,l,h,c,d,A.x,A.y)&&vn(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;_&&_.z>=x;){if(_.x>=f&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&wy(o,u,l,h,c,d,_.x,_.y)&&vn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;A&&A.z<=S;){if(A.x>=f&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&wy(o,u,l,h,c,d,A.x,A.y)&&vn(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Xse(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!L2(n,s)&&B9(n,r,r.next,s)&&Bb(n,s)&&Bb(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Nb(r),Nb(r.next),r=e=s),r=r.next}while(r!==e);return kg(r)}function qse(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&iae(a,o)){let l=N9(a,o);a=kg(a,a.next),l=kg(l,l.next),zb(a,t,i,r,n,s,0),zb(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function Yse(e,t,i,r){const n=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=z9(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(tae(c));for(n.sort(Qse),s=0;s<n.length;s++)i=Zse(n[s],i);return i}function Qse(e,t){return e.x-t.x}function Zse(e,t){const i=Kse(e,t);if(!i)return t;const r=N9(i,e);return kg(r,r.next),kg(i,i.next)}function Kse(e,t){let i=t,r=-1/0,n;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&wy(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Bb(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Jse(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function Jse(e,t){return vn(e.prev,e,t.prev)<0&&vn(t.next,e,e.next)<0}function $se(e,t,i,r){let n=e;do n.z===0&&(n.z=MI(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,eae(n)}function eae(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function MI(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function tae(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function wy(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function iae(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!rae(e,t)&&(Bb(e,t)&&Bb(t,e)&&nae(e,t)&&(vn(e.prev,e,t.prev)||vn(e,t.prev,t))||L2(e,t)&&vn(e.prev,e,e.next)>0&&vn(t.prev,t,t.next)>0)}function vn(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function L2(e,t){return e.x===t.x&&e.y===t.y}function B9(e,t,i,r){const n=RM(vn(e,t,i)),s=RM(vn(e,t,r)),a=RM(vn(i,r,e)),o=RM(vn(i,r,t));return!!(n!==s&&a!==o||n===0&&DM(e,i,t)||s===0&&DM(e,r,t)||a===0&&DM(i,e,r)||o===0&&DM(i,t,r))}function DM(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function RM(e){return e>0?1:e<0?-1:0}function rae(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&B9(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Bb(e,t){return vn(e.prev,e,e.next)<0?vn(e,t,e.next)>=0&&vn(e,e.prev,t)>=0:vn(e,t,e.prev)<0||vn(e,e.next,t)<0}function nae(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function N9(e,t){const i=new AI(e.i,e.x,e.y),r=new AI(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function uk(e,t,i,r){const n=new AI(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Nb(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function AI(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sae(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}class Gu{static area(t){const i=t.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=t[n].x*t[s].y-t[s].x*t[n].y;return r*.5}static isClockWise(t){return Gu.area(t)<0}static triangulateShape(t,i){const r=[],n=[],s=[];hk(t),dk(r,t);let a=t.length;i.forEach(hk);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,dk(r,i[l]);const o=Gse.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function hk(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function dk(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class O2 extends Gi{constructor(t=new Pg([new yt(.5,.5),new yt(-.5,.5),new yt(-.5,-.5),new yt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,n=[],s=[];for(let o=0,l=t.length;o<l;o++){const c=t[o];a(c)}this.setAttribute("position",new ii(n,3)),this.setAttribute("uv",new ii(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,f=i.bevelThickness!==void 0?i.bevelThickness:.2,m=i.bevelSize!==void 0?i.bevelSize:f-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,g=i.bevelSegments!==void 0?i.bevelSegments:3;const x=i.extrudePath,S=i.UVGenerator!==void 0?i.UVGenerator:aae;let _,A=!1,T,E,I,P;x&&(_=x.getSpacedPoints(u),A=!0,d=!1,T=x.computeFrenetFrames(u,!1),E=new pe,I=new pe,P=new pe),d||(g=0,f=0,m=0,v=0);const C=o.extractPoints(c);let L=C.shape;const z=C.holes;if(!Gu.isClockWise(L)){L=L.reverse();for(let ae=0,Ce=z.length;ae<Ce;ae++){const Ie=z[ae];Gu.isClockWise(Ie)&&(z[ae]=Ie.reverse())}}const G=Gu.triangulateShape(L,z),N=L;for(let ae=0,Ce=z.length;ae<Ce;ae++){const Ie=z[ae];L=L.concat(Ie)}function q(ae,Ce,Ie){return Ce||console.error("THREE.ExtrudeGeometry: vec does not exist"),ae.clone().addScaledVector(Ce,Ie)}const ie=L.length,Q=G.length;function W(ae,Ce,Ie){let Be,Ve,lt;const We=ae.x-Ce.x,je=ae.y-Ce.y,xt=Ie.x-ae.x,Mt=Ie.y-ae.y,de=We*We+je*je,V=We*Mt-je*xt;if(Math.abs(V)>Number.EPSILON){const X=Math.sqrt(de),we=Math.sqrt(xt*xt+Mt*Mt),J=Ce.x-je/X,Le=Ce.y+We/X,qe=Ie.x-Mt/we,ct=Ie.y+xt/we,Pe=((qe-J)*Mt-(ct-Le)*xt)/(We*Mt-je*xt);Be=J+We*Pe-ae.x,Ve=Le+je*Pe-ae.y;const nt=Be*Be+Ve*Ve;if(nt<=2)return new yt(Be,Ve);lt=Math.sqrt(nt/2)}else{let X=!1;We>Number.EPSILON?xt>Number.EPSILON&&(X=!0):We<-Number.EPSILON?xt<-Number.EPSILON&&(X=!0):Math.sign(je)===Math.sign(Mt)&&(X=!0),X?(Be=-je,Ve=We,lt=Math.sqrt(de)):(Be=We,Ve=je,lt=Math.sqrt(de/2))}return new yt(Be/lt,Ve/lt)}const ee=[];for(let ae=0,Ce=N.length,Ie=Ce-1,Be=ae+1;ae<Ce;ae++,Ie++,Be++)Ie===Ce&&(Ie=0),Be===Ce&&(Be=0),ee[ae]=W(N[ae],N[Ie],N[Be]);const K=[];let j,$=ee.concat();for(let ae=0,Ce=z.length;ae<Ce;ae++){const Ie=z[ae];j=[];for(let Be=0,Ve=Ie.length,lt=Ve-1,We=Be+1;Be<Ve;Be++,lt++,We++)lt===Ve&&(lt=0),We===Ve&&(We=0),j[Be]=W(Ie[Be],Ie[lt],Ie[We]);K.push(j),$=$.concat(j)}for(let ae=0;ae<g;ae++){const Ce=ae/g,Ie=f*Math.cos(Ce*Math.PI/2),Be=m*Math.sin(Ce*Math.PI/2)+v;for(let Ve=0,lt=N.length;Ve<lt;Ve++){const We=q(N[Ve],ee[Ve],Be);ve(We.x,We.y,-Ie)}for(let Ve=0,lt=z.length;Ve<lt;Ve++){const We=z[Ve];j=K[Ve];for(let je=0,xt=We.length;je<xt;je++){const Mt=q(We[je],j[je],Be);ve(Mt.x,Mt.y,-Ie)}}}const se=m+v;for(let ae=0;ae<ie;ae++){const Ce=d?q(L[ae],$[ae],se):L[ae];A?(I.copy(T.normals[0]).multiplyScalar(Ce.x),E.copy(T.binormals[0]).multiplyScalar(Ce.y),P.copy(_[0]).add(I).add(E),ve(P.x,P.y,P.z)):ve(Ce.x,Ce.y,0)}for(let ae=1;ae<=u;ae++)for(let Ce=0;Ce<ie;Ce++){const Ie=d?q(L[Ce],$[Ce],se):L[Ce];A?(I.copy(T.normals[ae]).multiplyScalar(Ie.x),E.copy(T.binormals[ae]).multiplyScalar(Ie.y),P.copy(_[ae]).add(I).add(E),ve(P.x,P.y,P.z)):ve(Ie.x,Ie.y,h/u*ae)}for(let ae=g-1;ae>=0;ae--){const Ce=ae/g,Ie=f*Math.cos(Ce*Math.PI/2),Be=m*Math.sin(Ce*Math.PI/2)+v;for(let Ve=0,lt=N.length;Ve<lt;Ve++){const We=q(N[Ve],ee[Ve],Be);ve(We.x,We.y,h+Ie)}for(let Ve=0,lt=z.length;Ve<lt;Ve++){const We=z[Ve];j=K[Ve];for(let je=0,xt=We.length;je<xt;je++){const Mt=q(We[je],j[je],Be);A?ve(Mt.x,Mt.y+_[u-1].y,_[u-1].x+Ie):ve(Mt.x,Mt.y,h+Ie)}}}re(),he();function re(){const ae=n.length/3;if(d){let Ce=0,Ie=ie*Ce;for(let Be=0;Be<Q;Be++){const Ve=G[Be];xe(Ve[2]+Ie,Ve[1]+Ie,Ve[0]+Ie)}Ce=u+g*2,Ie=ie*Ce;for(let Be=0;Be<Q;Be++){const Ve=G[Be];xe(Ve[0]+Ie,Ve[1]+Ie,Ve[2]+Ie)}}else{for(let Ce=0;Ce<Q;Ce++){const Ie=G[Ce];xe(Ie[2],Ie[1],Ie[0])}for(let Ce=0;Ce<Q;Ce++){const Ie=G[Ce];xe(Ie[0]+ie*u,Ie[1]+ie*u,Ie[2]+ie*u)}}r.addGroup(ae,n.length/3-ae,0)}function he(){const ae=n.length/3;let Ce=0;oe(N,Ce),Ce+=N.length;for(let Ie=0,Be=z.length;Ie<Be;Ie++){const Ve=z[Ie];oe(Ve,Ce),Ce+=Ve.length}r.addGroup(ae,n.length/3-ae,1)}function oe(ae,Ce){let Ie=ae.length;for(;--Ie>=0;){const Be=Ie;let Ve=Ie-1;Ve<0&&(Ve=ae.length-1);for(let lt=0,We=u+g*2;lt<We;lt++){const je=ie*lt,xt=ie*(lt+1),Mt=Ce+Be+je,de=Ce+Ve+je,V=Ce+Ve+xt,X=Ce+Be+xt;be(Mt,de,V,X)}}}function ve(ae,Ce,Ie){l.push(ae),l.push(Ce),l.push(Ie)}function xe(ae,Ce,Ie){Me(ae),Me(Ce),Me(Ie);const Be=n.length/3,Ve=S.generateTopUV(r,n,Be-3,Be-2,Be-1);Te(Ve[0]),Te(Ve[1]),Te(Ve[2])}function be(ae,Ce,Ie,Be){Me(ae),Me(Ce),Me(Be),Me(Ce),Me(Ie),Me(Be);const Ve=n.length/3,lt=S.generateSideWallUV(r,n,Ve-6,Ve-3,Ve-2,Ve-1);Te(lt[0]),Te(lt[1]),Te(lt[3]),Te(lt[1]),Te(lt[2]),Te(lt[3])}function Me(ae){n.push(l[ae*3+0]),n.push(l[ae*3+1]),n.push(l[ae*3+2])}function Te(ae){s.push(ae.x),s.push(ae.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return oae(i,r,t)}static fromJSON(t,i){const r=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];r.push(o)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new QE[n.type]().fromJSON(n)),new O2(r,t.options)}}const aae={generateTopUV:function(e,t,i,r,n){const s=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],c=t[n*3],u=t[n*3+1];return[new yt(s,a),new yt(o,l),new yt(c,u)]},generateSideWallUV:function(e,t,i,r,n,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],c=t[r*3],u=t[r*3+1],h=t[r*3+2],d=t[n*3],f=t[n*3+1],m=t[n*3+2],v=t[s*3],g=t[s*3+1],x=t[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new yt(a,1-l),new yt(c,1-h),new yt(d,1-m),new yt(v,1-x)]:[new yt(o,1-l),new yt(u,1-h),new yt(f,1-m),new yt(g,1-x)]}};function oae(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const s=e[r];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class z2 extends Rp{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new z2(t.radius,t.detail)}}class T_ extends Rp{constructor(t=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new T_(t.radius,t.detail)}}class B2 extends Gi{constructor(t=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=t;const d=(i-t)/n,f=new pe,m=new yt;for(let v=0;v<=n;v++){for(let g=0;g<=r;g++){const x=s+g/r*a;f.x=h*Math.cos(x),f.y=h*Math.sin(x),l.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/i+1)/2,m.y=(f.y/i+1)/2,u.push(m.x,m.y)}h+=d}for(let v=0;v<n;v++){const g=v*(r+1);for(let x=0;x<r;x++){const S=x+g,_=S,A=S+r+1,T=S+r+2,E=S+1;o.push(_,A,E),o.push(A,T,E)}}this.setIndex(o),this.setAttribute("position",new ii(l,3)),this.setAttribute("normal",new ii(c,3)),this.setAttribute("uv",new ii(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new B2(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class N2 extends Gi{constructor(t=new Pg([new yt(0,.5),new yt(-.5,-.5),new yt(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let u=0;u<t.length;u++)c(t[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new ii(n,3)),this.setAttribute("normal",new ii(s,3)),this.setAttribute("uv",new ii(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let f=d.shape;const m=d.holes;Gu.isClockWise(f)===!1&&(f=f.reverse());for(let g=0,x=m.length;g<x;g++){const S=m[g];Gu.isClockWise(S)===!0&&(m[g]=S.reverse())}const v=Gu.triangulateShape(f,m);for(let g=0,x=m.length;g<x;g++){const S=m[g];f=f.concat(S)}for(let g=0,x=f.length;g<x;g++){const S=f[g];n.push(S.x,S.y,0),s.push(0,0,1),a.push(S.x,S.y)}for(let g=0,x=v.length;g<x;g++){const S=v[g],_=S[0]+h,A=S[1]+h,T=S[2]+h;r.push(_,A,T),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return lae(i,t)}static fromJSON(t,i){const r=[];for(let n=0,s=t.shapes.length;n<s;n++){const a=i[t.shapes[n]];r.push(a)}return new N2(r,t.curveSegments)}}function lae(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class C_ extends Gi{constructor(t=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new pe,d=new pe,f=[],m=[],v=[],g=[];for(let x=0;x<=r;x++){const S=[],_=x/r;let A=0;x===0&&a===0?A=.5/i:x===r&&l===Math.PI&&(A=-.5/i);for(let T=0;T<=i;T++){const E=T/i;h.x=-t*Math.cos(n+E*s)*Math.sin(a+_*o),h.y=t*Math.cos(a+_*o),h.z=t*Math.sin(n+E*s)*Math.sin(a+_*o),m.push(h.x,h.y,h.z),d.copy(h).normalize(),v.push(d.x,d.y,d.z),g.push(E+A,1-_),S.push(c++)}u.push(S)}for(let x=0;x<r;x++)for(let S=0;S<i;S++){const _=u[x][S+1],A=u[x][S],T=u[x+1][S],E=u[x+1][S+1];(x!==0||a>0)&&f.push(_,A,E),(x!==r-1||l<Math.PI)&&f.push(A,T,E)}this.setIndex(f),this.setAttribute("position",new ii(m,3)),this.setAttribute("normal",new ii(v,3)),this.setAttribute("uv",new ii(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new C_(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class U2 extends Rp{constructor(t=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new U2(t.radius,t.detail)}}class F2 extends Gi{constructor(t=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new pe,h=new pe,d=new pe;for(let f=0;f<=r;f++)for(let m=0;m<=n;m++){const v=m/n*s,g=f/r*Math.PI*2;h.x=(t+i*Math.cos(g))*Math.cos(v),h.y=(t+i*Math.cos(g))*Math.sin(v),h.z=i*Math.sin(g),o.push(h.x,h.y,h.z),u.x=t*Math.cos(v),u.y=t*Math.sin(v),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(m/n),c.push(f/r)}for(let f=1;f<=r;f++)for(let m=1;m<=n;m++){const v=(n+1)*f+m-1,g=(n+1)*(f-1)+m-1,x=(n+1)*(f-1)+m,S=(n+1)*f+m;a.push(v,g,S),a.push(g,x,S)}this.setIndex(a),this.setAttribute("position",new ii(o,3)),this.setAttribute("normal",new ii(l,3)),this.setAttribute("uv",new ii(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new F2(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class k2 extends Gi{constructor(t=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new pe,d=new pe,f=new pe,m=new pe,v=new pe,g=new pe,x=new pe;for(let _=0;_<=r;++_){const A=_/r*s*Math.PI*2;S(A,s,a,t,f),S(A+.01,s,a,t,m),g.subVectors(m,f),x.addVectors(m,f),v.crossVectors(g,x),x.crossVectors(v,g),v.normalize(),x.normalize();for(let T=0;T<=n;++T){const E=T/n*Math.PI*2,I=-i*Math.cos(E),P=i*Math.sin(E);h.x=f.x+(I*x.x+P*v.x),h.y=f.y+(I*x.y+P*v.y),h.z=f.z+(I*x.z+P*v.z),l.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),c.push(d.x,d.y,d.z),u.push(_/r),u.push(T/n)}}for(let _=1;_<=r;_++)for(let A=1;A<=n;A++){const T=(n+1)*(_-1)+(A-1),E=(n+1)*_+(A-1),I=(n+1)*_+A,P=(n+1)*(_-1)+A;o.push(T,E,P),o.push(E,I,P)}this.setIndex(o),this.setAttribute("position",new ii(l,3)),this.setAttribute("normal",new ii(c,3)),this.setAttribute("uv",new ii(u,2));function S(_,A,T,E,I){const P=Math.cos(_),C=Math.sin(_),L=T/A*_,z=Math.cos(L);I.x=E*(2+z)*.5*P,I.y=E*(2+z)*C*.5,I.z=E*Math.sin(L)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new k2(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class V2 extends Gi{constructor(t=new Nz(new pe(-1,-1,0),new pe(-1,1,0),new pe(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new pe,l=new pe,c=new yt;let u=new pe;const h=[],d=[],f=[],m=[];v(),this.setIndex(m),this.setAttribute("position",new ii(h,3)),this.setAttribute("normal",new ii(d,3)),this.setAttribute("uv",new ii(f,2));function v(){for(let _=0;_<i;_++)g(_);g(s===!1?i:0),S(),x()}function g(_){u=t.getPointAt(_/i,u);const A=a.normals[_],T=a.binormals[_];for(let E=0;E<=n;E++){const I=E/n*Math.PI*2,P=Math.sin(I),C=-Math.cos(I);l.x=C*A.x+P*T.x,l.y=C*A.y+P*T.y,l.z=C*A.z+P*T.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function x(){for(let _=1;_<=i;_++)for(let A=1;A<=n;A++){const T=(n+1)*(_-1)+(A-1),E=(n+1)*_+(A-1),I=(n+1)*_+A,P=(n+1)*(_-1)+A;m.push(T,E,P),m.push(E,I,P)}}function S(){for(let _=0;_<=i;_++)for(let A=0;A<=n;A++)c.x=_/i,c.y=A/n,f.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new V2(new QE[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class U9 extends Gi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],r=new Set,n=new pe,s=new pe;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,f=h.count;for(let m=d,v=d+f;m<v;m+=3)for(let g=0;g<3;g++){const x=o.getX(m+g),S=o.getX(m+(g+1)%3);n.fromBufferAttribute(a,x),s.fromBufferAttribute(a,S),fk(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),fk(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new ii(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function fk(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var pk=Object.freeze({__proto__:null,BoxGeometry:ev,CapsuleGeometry:P2,CircleGeometry:D2,ConeGeometry:R2,CylinderGeometry:wx,DodecahedronGeometry:I2,EdgesGeometry:O9,ExtrudeGeometry:O2,IcosahedronGeometry:z2,LatheGeometry:E_,OctahedronGeometry:T_,PlaneGeometry:A_,PolyhedronGeometry:Rp,RingGeometry:B2,ShapeGeometry:N2,SphereGeometry:C_,TetrahedronGeometry:U2,TorusGeometry:F2,TorusKnotGeometry:k2,TubeGeometry:V2,WireframeGeometry:U9});class F9 extends ga{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Zt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class k9 extends Zu{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Fz extends ga{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Zt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pp,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class V9 extends Fz{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Cn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Zt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Zt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Zt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class H9 extends ga{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Zt(16777215),this.specular=new Zt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pp,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=w_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class G9 extends ga{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Zt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pp,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class j9 extends ga{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pp,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class W9 extends ga{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pp,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=w_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class X9 extends ga{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Zt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Pp,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class q9 extends go{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function fg(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function Y9(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Q9(e){function t(n,s){return e[n]-e[s]}const i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function EI(e,t,i){const r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function kz(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}function cae(e,t,i,r,n=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const m=c.times[f]*n;if(!(m<i||m>=r)){h.push(c.times[f]);for(let v=0;v<u;++v)d.push(c.values[f*u+v])}}h.length!==0&&(c.times=fg(h,c.times.constructor),c.values=fg(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function uae(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,s=t/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=e.tracks.find(function(x){return x.name===o.name&&x.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const m=o.times.length-1;let v;if(s<=o.times[0]){const x=u,S=h-u;v=o.values.slice(x,S)}else if(s>=o.times[m]){const x=m*h+u,S=x+h-u;v=o.values.slice(x,S)}else{const x=o.createInterpolant(),S=u,_=h-u;x.evaluate(s),v=x.resultBuffer.slice(S,_)}l==="quaternion"&&new za().fromArray(v).normalize().conjugate().toArray(v);const g=c.times.length;for(let x=0;x<g;++x){const S=x*f+d;if(l==="quaternion")za.multiplyQuaternionsFlat(c.values,S,v,0,c.values,S);else{const _=f-d*2;for(let A=0;A<_;++A)c.values[S+A]-=v[A]}}}return e.blendMode=gz,e}const hae={convertArray:fg,isTypedArray:Y9,getKeyframeOrder:Q9,sortedArray:EI,flattenJSON:kz,subclip:cae,makeClipAdditive:uae};class P_{constructor(t,i,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(t<n)){for(let o=r+2;;){if(n===void 0){if(t<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],t<n)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],t>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;t<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Z9 extends P_{constructor(t,i,r,n){super(t,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ug,endingEnd:ug}}intervalChanged_(t,i,r){const n=this.parameterPositions;let s=t-2,a=t+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case hg:s=t,o=2*i-r;break;case Cb:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=t,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case hg:a=t,l=2*r-i;break;case Cb:a=1,l=r+n[1]-n[0];break;default:a=t-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,m=(r-i)/(n-i),v=m*m,g=v*m,x=-d*g+2*d*v-d*m,S=(1+d)*g+(-1.5-2*d)*v+(-.5+d)*m+1,_=(-1-f)*g+(1.5+f)*v+.5*m,A=f*g-f*v;for(let T=0;T!==o;++T)s[T]=x*a[u+T]+S*a[c+T]+_*a[l+T]+A*a[h+T];return s}}class Vz extends P_{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class K9 extends P_{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class $c{constructor(t,i,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=fg(i,this.TimeBufferType),this.values=fg(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(t);else{r={name:t.name,times:fg(t.times,Array),values:fg(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(r.interpolation=n)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new K9(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Vz(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Z9(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case Eb:i=this.InterpolantFactoryMethodDiscrete;break;case Tb:i=this.InterpolantFactoryMethodLinear;break;case wE:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Eb;case this.InterpolantFactoryMethodLinear:return Tb;case this.InterpolantFactoryMethodSmooth:return wE}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=t}return this}trim(t,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<t;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(n!==void 0&&Y9(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===wE,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=t[o],u=t[o+1];if(c!==u&&(o!==1||c!==t[0]))if(n)l=!0;else{const h=o*r,d=h-r,f=h+r;for(let m=0;m!==r;++m){const v=i[h+m];if(v!==i[d+m]||v!==i[f+m]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*r,d=a*r;for(let f=0;f!==r;++f)i[d+f]=i[h+f]}++a}}if(s>0){t[a]=t[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=i.slice(0,a*r)):(this.times=t,this.values=i),this}clone(){const t=this.times.slice(),i=this.values.slice(),r=this.constructor,n=new r(this.name,t,i);return n.createInterpolant=this.createInterpolant,n}}$c.prototype.TimeBufferType=Float32Array;$c.prototype.ValueBufferType=Float32Array;$c.prototype.DefaultInterpolation=Tb;class tv extends $c{}tv.prototype.ValueTypeName="bool";tv.prototype.ValueBufferType=Array;tv.prototype.DefaultInterpolation=Eb;tv.prototype.InterpolantFactoryMethodLinear=void 0;tv.prototype.InterpolantFactoryMethodSmooth=void 0;class Hz extends $c{}Hz.prototype.ValueTypeName="color";class Ub extends $c{}Ub.prototype.ValueTypeName="number";class J9 extends P_{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=t*o;for(let u=c+o;c!==u;c+=4)za.slerpFlat(s,0,a,c-o,a,c,l);return s}}class bx extends $c{InterpolantFactoryMethodLinear(t){return new J9(this.times,this.values,this.getValueSize(),t)}}bx.prototype.ValueTypeName="quaternion";bx.prototype.DefaultInterpolation=Tb;bx.prototype.InterpolantFactoryMethodSmooth=void 0;class iv extends $c{}iv.prototype.ValueTypeName="string";iv.prototype.ValueBufferType=Array;iv.prototype.DefaultInterpolation=Eb;iv.prototype.InterpolantFactoryMethodLinear=void 0;iv.prototype.InterpolantFactoryMethodSmooth=void 0;class Fb extends $c{}Fb.prototype.ValueTypeName="vector";class kb{constructor(t,i=-1,r,n=y2){this.name=t,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=fl(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],r=t.tracks,n=1/(t.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(fae(r[a]).scale(n));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push($c.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(t,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=Q9(l);l=EI(l,1,u),c=EI(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Ub(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(t,-1,a)}static findByName(t,i){let r=t;if(!Array.isArray(t)){const n=t;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(t,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const c=t[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,f,m,v){if(f.length!==0){const g=[],x=[];kz(f,g,x,m),g.length!==0&&v.push(new h(d,g,x))}},n=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let m;for(m=0;m<d.length;m++)if(d[m].morphTargets)for(let v=0;v<d[m].morphTargets.length;v++)f[d[m].morphTargets[v]]=-1;for(const v in f){const g=[],x=[];for(let S=0;S!==d[m].morphTargets.length;++S){const _=d[m];g.push(_.time),x.push(_.morphTarget===v?1:0)}n.push(new Ub(".morphTargetInfluence["+v+"]",g,x))}l=f.length*a}else{const f=".bones["+i[h].name+"]";r(Fb,f+".position",d,"pos",n),r(bx,f+".quaternion",d,"rot",n),r(Fb,f+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const t=this.tracks;let i=0;for(let r=0,n=t.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function dae(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ub;case"vector":case"vector2":case"vector3":case"vector4":return Fb;case"color":return Hz;case"quaternion":return bx;case"bool":case"boolean":return tv;case"string":return iv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function fae(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=dae(e.type);if(e.times===void 0){const i=[],r=[];kz(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Vg={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Gz{constructor(t,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const f=c[h],m=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return m}return null}}}const by=new Gz;let Xo=class{constructor(t){this.manager=t!==void 0?t:by,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(n,s){r.load(t,n,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};Xo.DEFAULT_MATERIAL_NAME="__DEFAULT";const Gh={};class pae extends Error{constructor(t,i){super(t),this.response=i}}class Rd extends Xo{constructor(t){super(t)}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Vg.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(Gh[t]!==void 0){Gh[t].push({onLoad:i,onProgress:r,onError:n});return}Gh[t]=[],Gh[t].push({onLoad:i,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Gh[t],h=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=d?parseInt(d):0,m=f!==0;let v=0;const g=new ReadableStream({start(x){S();function S(){h.read().then(({done:_,value:A})=>{if(_)x.close();else{v+=A.byteLength;const T=new ProgressEvent("progress",{lengthComputable:m,loaded:v,total:f});for(let E=0,I=u.length;E<I;E++){const P=u[E];P.onProgress&&P.onProgress(T)}x.enqueue(A),S()}})}}});return new Response(g)}else throw new pae(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(m=>f.decode(m))}}}).then(c=>{Vg.add(t,c);const u=Gh[t];delete Gh[t];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Gh[t];if(u===void 0)throw this.manager.itemError(t),c;delete Gh[t];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class mae extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Rd(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=[];for(let r=0;r<t.length;r++){const n=kb.parse(t[r]);i.push(n)}return i}}class gae extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=[],o=new T2,l=new Rd(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(t[h],function(d){const f=s.parse(d,!0);a[h]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(o.minFilter=kn),o.image=a,o.format=f.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)u(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let m=0;m<f;m++){a[m]={mipmaps:[]};for(let v=0;v<d.mipmapCount;v++)a[m].mipmaps.push(d.mipmaps[m*d.mipmapCount+v]),a[m].format=d.format,a[m].width=d.width,a[m].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=kn),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class Vb extends Xo{constructor(t){super(t)}load(t,i,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Vg.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=Lb("img");function l(){u(),Vg.add(t,this),i&&i(this),s.manager.itemEnd(t)}function c(h){u(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class vae extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=new S_;s.colorSpace=bs;const a=new Vb(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(t[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<t.length;++c)l(c);return s}}class yae extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Cg,o=new Rd(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){let c;try{c=s.parse(l)}catch(u){if(n!==void 0)n(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Ia,a.wrapT=c.wrapT!==void 0?c.wrapT:Ia,a.magFilter=c.magFilter!==void 0?c.magFilter:kn,a.minFilter=c.minFilter!==void 0?c.minFilter:kn,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?a.colorSpace=c.colorSpace:c.encoding!==void 0&&(a.encoding=c.encoding),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=wp),c.mipmapCount===1&&(a.minFilter=kn),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},r,n),a}}class H2 extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=new dn,a=new Vb(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class Ip extends mr{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Zt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class $9 extends Ip{constructor(t,i,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(mr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Zt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const HP=new Ci,mk=new pe,gk=new pe;class jz{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yt(512,512),this.map=null,this.mapPass=null,this.matrix=new Ci,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new M_,this._frameExtents=new yt(1,1),this._viewportCount=1,this._viewports=[new Pr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,r=this.matrix;mk.setFromMatrixPosition(t.matrixWorld),i.position.copy(mk),gk.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(gk),i.updateMatrixWorld(),HP.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(HP),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(HP)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class xae extends jz{constructor(){super(new gn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,r=Ky*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class e7 extends Ip{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(mr.DEFAULT_UP),this.updateMatrix(),this.target=new mr,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new xae}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const vk=new Ci,X1=new pe,GP=new pe;class wae extends jz{constructor(){super(new gn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new yt(4,2),this._viewportCount=6,this._viewports=[new Pr(2,1,1,1),new Pr(0,1,1,1),new Pr(3,1,1,1),new Pr(1,1,1,1),new Pr(3,0,1,1),new Pr(1,0,1,1)],this._cubeDirections=[new pe(1,0,0),new pe(-1,0,0),new pe(0,0,1),new pe(0,0,-1),new pe(0,1,0),new pe(0,-1,0)],this._cubeUps=[new pe(0,1,0),new pe(0,1,0),new pe(0,1,0),new pe(0,1,0),new pe(0,0,1),new pe(0,0,-1)]}updateMatrices(t,i=0){const r=this.camera,n=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),X1.setFromMatrixPosition(t.matrixWorld),r.position.copy(X1),GP.copy(r.position),GP.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(GP),r.updateMatrixWorld(),n.makeTranslation(-X1.x,-X1.y,-X1.z),vk.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vk)}}class t7 extends Ip{constructor(t,i,r=0,n=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new wae}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class bae extends jz{constructor(){super(new Hu(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class i7 extends Ip{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(mr.DEFAULT_UP),this.updateMatrix(),this.target=new mr,this.shadow=new bae}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class r7 extends Ip{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class n7 extends Ip{constructor(t,i,r=10,n=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class s7{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new pe)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,i+n*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,i+n*3);return t}static getBasisAt(t,i){const r=t.x,n=t.y,s=t.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class a7 extends Ip{constructor(t=new s7,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class G2 extends Xo{constructor(t){super(t),this.textures={}}load(t,i,r,n){const s=this,a=new Rd(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=G2.createMaterialFromType(t.type);if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=t.sheen),t.sheenColor!==void 0&&(n.sheenColor=new Zt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(n.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(t.specular),t.specularIntensity!==void 0&&(n.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(n.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(n.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(n.transmission=t.transmission),t.thickness!==void 0&&(n.thickness=t.thickness),t.attenuationDistance!==void 0&&(n.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(n.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(n.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.shadowSide!==void 0&&(n.shadowSide=t.shadowSide),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(n.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(n.depthFunc=t.depthFunc),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(n.blendSrc=t.blendSrc),t.blendDst!==void 0&&(n.blendDst=t.blendDst),t.blendEquation!==void 0&&(n.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(n.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(n.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==void 0&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(n.dithering=t.dithering),t.alphaToCoverage!==void 0&&(n.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(n.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new Zt().setHex(a.value);break;case"v2":n.uniforms[s].value=new yt().fromArray(a.value);break;case"v3":n.uniforms[s].value=new pe().fromArray(a.value);break;case"v4":n.uniforms[s].value=new Pr().fromArray(a.value);break;case"m3":n.uniforms[s].value=new Yi().fromArray(a.value);break;case"m4":n.uniforms[s].value=new Ci().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(n.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)n.extensions[s]=t.extensions[s];if(t.lights!==void 0&&(n.lights=t.lights),t.clipping!==void 0&&(n.clipping=t.clipping),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new yt().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(n.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new yt().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(n.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(n.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(n.thicknessMap=r(t.thicknessMap)),t.anisotropyMap!==void 0&&(n.anisotropyMap=r(t.anisotropyMap)),t.sheenColorMap!==void 0&&(n.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const i={ShadowMaterial:F9,SpriteMaterial:Rz,RawShaderMaterial:k9,ShaderMaterial:Zu,PointsMaterial:E2,MeshPhysicalMaterial:V9,MeshStandardMaterial:Fz,MeshPhongMaterial:H9,MeshToonMaterial:G9,MeshNormalMaterial:j9,MeshLambertMaterial:W9,MeshDepthMaterial:Cz,MeshDistanceMaterial:Pz,MeshBasicMaterial:Dp,MeshMatcapMaterial:X9,LineDashedMaterial:q9,LineBasicMaterial:go,Material:ga};return new i[t]}}class TI{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let r=0,n=t.length;r<n;r++)i+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class o7 extends Gi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class l7 extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Rd(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i={},r={};function n(f,m){if(i[m]!==void 0)return i[m];const g=f.interleavedBuffers[m],x=s(f,g.buffer),S=vy(g.type,x),_=new M2(S,g.stride);return _.uuid=g.uuid,i[m]=_,_}function s(f,m){if(r[m]!==void 0)return r[m];const g=f.arrayBuffers[m],x=new Uint32Array(g).buffer;return r[m]=x,x}const a=t.isInstancedBufferGeometry?new o7:new Gi,o=t.data.index;if(o!==void 0){const f=vy(o.type,o.array);a.setIndex(new Ir(f,1))}const l=t.data.attributes;for(const f in l){const m=l[f];let v;if(m.isInterleavedBufferAttribute){const g=n(t.data,m.data);v=new Fg(g,m.itemSize,m.offset,m.normalized)}else{const g=vy(m.type,m.array),x=m.isInstancedBufferAttribute?$y:Ir;v=new x(g,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),m.usage!==void 0&&v.setUsage(m.usage),a.setAttribute(f,v)}const c=t.data.morphAttributes;if(c)for(const f in c){const m=c[f],v=[];for(let g=0,x=m.length;g<x;g++){const S=m[g];let _;if(S.isInterleavedBufferAttribute){const A=n(t.data,S.data);_=new Fg(A,S.itemSize,S.offset,S.normalized)}else{const A=vy(S.type,S.array);_=new Ir(A,S.itemSize,S.normalized)}S.name!==void 0&&(_.name=S.name),v.push(_)}a.morphAttributes[f]=v}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let f=0,m=h.length;f!==m;++f){const v=h[f];a.addGroup(v.start,v.count,v.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const f=new pe;d.center!==void 0&&f.fromArray(d.center),a.boundingSphere=new Ba(f,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class _ae extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=this.path===""?TI.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new Rd(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(c,i)},r,n)}async loadAsync(t,i){const r=this,n=this.path===""?TI.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const s=new Rd(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(o)}parse(t,i){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,s,l,o,r),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(t){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,n,o,a,i),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(t){const i={};if(t!==void 0)for(let r=0,n=t.length;r<n;r++){const s=new Pg().fromJSON(t[r]);i[s.uuid]=s}return i}parseSkeletons(t,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new A2().fromJSON(t[s],n);r[o.uuid]=o}return r}parseGeometries(t,i){const r={};if(t!==void 0){const n=new l7;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in pk?o=pk[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(t,i){const r={},n={};if(t!==void 0){const s=new G2;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(t){const i={};if(t!==void 0)for(let r=0;r<t.length;r++){const n=t[r],s=kb.parse(n);i[s.uuid]=s}return i}parseImages(t,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:vy(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new Gz(i);s=new Vb(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.url;if(Array.isArray(d)){const f=[];for(let m=0,v=d.length;m<v;m++){const g=d[m],x=o(g);x!==null&&(x instanceof HTMLImageElement?f.push(x):f.push(new Cg(x.data,x.width,x.height)))}n[h.uuid]=new dg(f)}else{const f=o(h.url);n[h.uuid]=new dg(f)}}}return n}async parseImagesAsync(t){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:vy(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){n=new Vb(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h],m=await s(f);m!==null&&(m instanceof HTMLImageElement?u.push(m):u.push(new Cg(m.data,m.width,m.height)))}r[l.uuid]=new dg(u)}else{const u=await s(l.url);r[l.uuid]=new dg(u)}}}return r}parseTextures(t,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new S_,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Cg:u=new dn,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,Sae)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],yk),u.wrapT=r(o.wrap[1],yk)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.encoding!==void 0&&(u.encoding=o.encoding),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,xk)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,xk)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(t,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let m=0,v=d.length;m<v;m++){const g=d[m];r[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),f.push(r[g])}return f}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(t.type){case"Scene":a=new YE,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new Zt(t.background):a.background=c(t.background)),t.environment!==void 0&&(a.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new S2(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new _2(t.fog.color,t.fog.density)),t.fog.name!==""&&(a.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":a=new gn(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new Hu(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new r7(t.color,t.intensity);break;case"DirectionalLight":a=new i7(t.color,t.intensity);break;case"PointLight":a=new t7(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new n7(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new e7(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new $9(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new a7().fromJSON(t);break;case"SkinnedMesh":u=o(t.geometry),h=l(t.material),a=new M9(u,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),h=l(t.material),a=new rs(u,h);break;case"InstancedMesh":u=o(t.geometry),h=l(t.material);const d=t.count,f=t.instanceMatrix,m=t.instanceColor;a=new A9(u,h,d),a.instanceMatrix=new $y(new Float32Array(f.array),16),m!==void 0&&(a.instanceColor=new $y(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":u=o(t.geometry),h=l(t.material),a=new E9(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._visibility=t.visibility,a._active=t.active,a._bounds=t.bounds.map(v=>{const g=new ho;g.min.fromArray(v.boxMin),g.max.fromArray(v.boxMax);const x=new Ba;return x.radius=v.sphereRadius,x.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:g,sphereInitialized:v.sphereInitialized,sphere:x}}),a._maxGeometryCount=t.maxGeometryCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._geometryCount=t.geometryCount,a._matricesTexture=c(t.matricesTexture.uuid);break;case"LOD":a=new S9;break;case"Line":a=new bp(o(t.geometry),l(t.material));break;case"LineLoop":a=new T9(o(t.geometry),l(t.material));break;case"LineSegments":a=new ih(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new C9(o(t.geometry),l(t.material));break;case"Sprite":a=new _9(l(t.material));break;case"Group":a=new xy;break;case"Bone":a=new Iz;break;default:a=new mr}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let f=0;f<d.length;f++)a.add(this.parseObject(d[f],i,r,n,s))}if(t.animations!==void 0){const d=t.animations;for(let f=0;f<d.length;f++){const m=d[f];a.animations.push(s[m])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let f=0;f<d.length;f++){const m=d[f],v=a.getObjectByProperty("uuid",m.object);v!==void 0&&a.addLevel(v,m.distance,m.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}}const Sae={UVMapping:g2,CubeReflectionMapping:Dd,CubeRefractionMapping:xp,EquirectangularReflectionMapping:_b,EquirectangularRefractionMapping:Sb,CubeUVReflectionMapping:yx},yk={RepeatWrapping:Mb,ClampToEdgeWrapping:Ia,MirroredRepeatWrapping:Ab},xk={NearestFilter:Fn,NearestMipmapNearestFilter:WE,NearestMipmapLinearFilter:qw,LinearFilter:kn,LinearMipmapNearestFilter:lz,LinearMipmapLinearFilter:wp};class Mae extends Xo{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=Vg.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){Vg.add(t,l),i&&i(l),s.manager.itemEnd(t)}).catch(function(l){n&&n(l),s.manager.itemError(t),s.manager.itemEnd(t)}),s.manager.itemStart(t)}}let IM,Wz=class{static getContext(){return IM===void 0&&(IM=new(window.AudioContext||window.webkitAudioContext)),IM}static setContext(t){IM=t}};class Aae extends Xo{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Rd(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{const c=l.slice(0);Wz.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(t)}}}const wk=new Ci,bk=new Ci,Dm=new Ci;class Eae{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new gn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new gn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,Dm.copy(t.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(Eg*i.fov*.5)/i.zoom;let o,l;bk.elements[12]=-n,wk.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Dm.elements[0]=2*i.near/(l-o),Dm.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Dm),o=-a*i.aspect-s,l=a*i.aspect-s,Dm.elements[0]=2*i.near/(l-o),Dm.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Dm)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(bk),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(wk)}}class Xz{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=_k(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=_k();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function _k(){return(typeof performance>"u"?Date:performance).now()}const Rm=new pe,Sk=new za,Tae=new pe,Im=new pe;class Cae extends mr{constructor(){super(),this.type="AudioListener",this.context=Wz.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Xz}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Rm,Sk,Tae),Im.set(0,0,-1).applyQuaternion(Sk),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Rm.x,n),i.positionY.linearRampToValueAtTime(Rm.y,n),i.positionZ.linearRampToValueAtTime(Rm.z,n),i.forwardX.linearRampToValueAtTime(Im.x,n),i.forwardY.linearRampToValueAtTime(Im.y,n),i.forwardZ.linearRampToValueAtTime(Im.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Rm.x,Rm.y,Rm.z),i.setOrientation(Im.x,Im.y,Im.z,r.x,r.y,r.z)}}class c7 extends mr{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Lm=new pe,Mk=new za,Pae=new pe,Om=new pe;class Dae extends c7{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lm,Mk,Pae),Om.set(0,0,1).applyQuaternion(Mk);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Lm.x,r),i.positionY.linearRampToValueAtTime(Lm.y,r),i.positionZ.linearRampToValueAtTime(Lm.z,r),i.orientationX.linearRampToValueAtTime(Om.x,r),i.orientationY.linearRampToValueAtTime(Om.y,r),i.orientationZ.linearRampToValueAtTime(Om.z,r)}else i.setPosition(Lm.x,Lm.y,Lm.z),i.setOrientation(Om.x,Om.y,Om.z)}}class Rae{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)t+=i[r];return t/i.length}}class u7{constructor(t,i,r){this.binding=t,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const r=this.buffer,n=this.valueSize,s=t*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,r=this.buffer,n=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let r=t;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[t+r]}_select(t,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)t[i+a]=t[r+a]}_slerp(t,i,r,n){za.slerpFlat(t,i,t,i,t,r,n)}_slerpAdditive(t,i,r,n,s){const a=this._workIndex*s;za.multiplyQuaternionsFlat(t,a,t,i,t,r),za.slerpFlat(t,i,t,i,t,a,n)}_lerp(t,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[r+o]*n}}_lerpAdditive(t,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[r+a]*n}}}const qz="\\[\\]\\.:\\/",Iae=new RegExp("["+qz+"]","g"),Yz="[^"+qz+"]",Lae="[^"+qz.replace("\\.","")+"]",Oae=/((?:WC+[\/:])*)/.source.replace("WC",Yz),zae=/(WCOD+)?/.source.replace("WCOD",Lae),Bae=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Yz),Nae=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Yz),Uae=new RegExp("^"+Oae+zae+Bae+Nae+"$"),Fae=["material","materials","bones","map"];class kae{constructor(t,i,r){const n=r||pr.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,n)}getValue(t,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,i)}setValue(t,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].unbind()}}class pr{constructor(t,i,r){this.path=i,this.parsedPath=r||pr.parseTrackName(i),this.node=pr.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new pr.Composite(t,i,r):new pr(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Iae,"")}static parseTrackName(t){const i=Uae.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);Fae.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)t[i++]=r[n]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(t||(t=pr.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===c){c=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const a=t[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}pr.Composite=kae;pr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};pr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};pr.prototype.GetterByBindingType=[pr.prototype._getValue_direct,pr.prototype._getValue_array,pr.prototype._getValue_arrayElement,pr.prototype._getValue_toArray];pr.prototype.SetterByBindingTypeAndVersioning=[[pr.prototype._setValue_direct,pr.prototype._setValue_direct_setNeedsUpdate,pr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pr.prototype._setValue_array,pr.prototype._setValue_array_setNeedsUpdate,pr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pr.prototype._setValue_arrayElement,pr.prototype._setValue_arrayElement_setNeedsUpdate,pr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pr.prototype._setValue_fromArray,pr.prototype._setValue_fromArray_setNeedsUpdate,pr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Vae{constructor(){this.isAnimationObjectGroup=!0,this.uuid=fl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,n=arguments.length;r!==n;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],f=d.uuid;let m=i[f];if(m===void 0){m=l++,i[f]=m,t.push(d);for(let v=0,g=a;v!==g;++v)s[v].push(new pr(d,r[v],n[v]))}else if(m<c){o=t[m];const v=--c,g=t[v];i[g.uuid]=m,t[m]=g,i[f]=v,t[v]=d;for(let x=0,S=a;x!==S;++x){const _=s[x],A=_[v];let T=_[m];_[m]=A,T===void 0&&(T=new pr(d,r[x],n[x])),_[v]=T}}else t[m]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=t[h];i[d.uuid]=u,t[u]=d,i[c]=h,t[h]=l;for(let f=0,m=n;f!==m;++f){const v=r[f],g=v[h],x=v[u];v[u]=g,v[h]=x}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,f=t[d],m=--a,v=t[m];i[f.uuid]=h,t[h]=f,i[v.uuid]=d,t[d]=v,t.pop();for(let g=0,x=n;g!==x;++g){const S=r[g],_=S[d],A=S[m];S[h]=_,S[d]=A,S.pop()}}else{const d=--a,f=t[d];d>0&&(i[f.uuid]=h),t[h]=f,t.pop();for(let m=0,v=n;m!==v;++m){const g=r[m];g[h]=g[d],g.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const r=this._bindingsIndicesByPath;let n=r[t];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[t]=n,a.push(t),o.push(i),s.push(h);for(let d=u,f=l.length;d!==f;++d){const m=l[d];h[d]=new pr(m,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,r=i[t];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=t[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class h7{constructor(t,i,r=null,n=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:ug,endingEnd:ug};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=q8,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=t._clip.duration,a=s/n,o=n/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=t/a,c[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case gz:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case y2:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let n=this.time+t,s=this._loopCount;const a=r===Y8;if(t===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===X8){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(t,i,r){const n=this._interpolantSettings;r?(n.endingStart=hg,n.endingEnd=hg):(t?n.endingStart=this.zeroSlopeAtStart?hg:ug:n.endingStart=Cb,i?n.endingEnd=this.zeroSlopeAtEnd?hg:ug:n.endingEnd=Cb)}_scheduleFading(t,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=r,this}}const Hae=new Float32Array(1);class Gae extends Ud{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const r=t._localRoot||this._root,n=t._clip.tracks,s=n.length,a=t._propertyBindings,o=t._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],f=d.name;let m=u[f];if(m!==void 0)++m.referenceCount,a[h]=m;else{if(m=a[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,f));continue}const v=i&&i._propertyBindings[h].binding.parsedPath;m=new u7(pr.create(r,f,v),d.ValueTypeName,d.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,f),a[h]=m}o[h].resultBuffer=m.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,r)}const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackAction(t){const i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_addInactiveBinding(t,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,r=t.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=t._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(t){const i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackBinding(t){const i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=t[i];return r===void 0&&(r=new Vz(new Float32Array(2),new Float32Array(2),1,Hae),r.__cacheIndex=i,t[i]=r),r}_takeBackControlInterpolant(t){const i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];t.__cacheIndex=n,i[n]=t,s.__cacheIndex=r,i[r]=s}clipAction(t,i,r){const n=i||this._root,s=n.uuid;let a=typeof t=="string"?kb.findByName(n,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=y2),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new h7(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(t,i){const r=i||this._root,n=r.uuid,s=typeof t=="string"?kb.findByName(r,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,r=t.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(t){const i=t.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const r=this.existingAction(t,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Qz{constructor(t){this.value=t}clone(){return new Qz(this.value.clone===void 0?this.value:this.value.clone())}}let jae=0;class Wae extends Ud{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:jae++}),this.name="",this.usage=Ib,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++)this.uniforms.push(i[r].clone());return this}clone(){return new this.constructor().copy(this)}}class Xae extends M2{constructor(t,i,r=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class qae{constructor(t,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class d7{constructor(t,i,r=0,n=1/0){this.ray=new Jg(t,i),this.near=r,this.far=n,this.camera=null,this.layers=new Tg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(t,i=!0,r=[]){return CI(t,this,r,i),r.sort(Ak),r}intersectObjects(t,i=!0,r=[]){for(let n=0,s=t.length;n<s;n++)CI(t[n],this,r,i);return r.sort(Ak),r}}function Ak(e,t){return e.distance-t.distance}function CI(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){const n=e.children;for(let s=0,a=n.length;s<a;s++)CI(n[s],t,i,!0)}}class PI{constructor(t=1,i=0,r=0){return this.radius=t,this.phi=i,this.theta=r,this}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(Cn(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Yae{constructor(t=1,i=0,r=0){return this.radius=t,this.theta=i,this.y=r,this}set(t,i,r){return this.radius=t,this.theta=i,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const Ek=new yt;class Qae{constructor(t=new yt(1/0,1/0),i=new yt(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=Ek.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ek).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Tk=new pe,LM=new pe;class Zae{constructor(t=new pe,i=new pe){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){Tk.subVectors(t,this.start),LM.subVectors(this.end,this.start);const r=LM.dot(LM);let s=LM.dot(Tk)/r;return i&&(s=Cn(s,0,1)),s}closestPointToPoint(t,i,r){const n=this.closestPointToPointParameter(t,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Ck=new pe;class Kae extends mr{constructor(t,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new Gi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new ii(n,3));const s=new go({fog:!1,toneMapped:!1});this.cone=new ih(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),Ck.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ck),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Tf=new pe,OM=new Ci,jP=new Ci;class Jae extends ih{constructor(t){const i=f7(t),r=new Gi,n=[],s=[],a=new Zt(0,0,1),o=new Zt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new ii(n,3)),r.setAttribute("color",new ii(s,3));const l=new go({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,n=r.getAttribute("position");jP.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(OM.multiplyMatrices(jP,o.matrixWorld),Tf.setFromMatrixPosition(OM),n.setXYZ(a,Tf.x,Tf.y,Tf.z),OM.multiplyMatrices(jP,o.parent.matrixWorld),Tf.setFromMatrixPosition(OM),n.setXYZ(a+1,Tf.x,Tf.y,Tf.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function f7(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,f7(e.children[i]));return t}class $ae extends rs{constructor(t,i,r){const n=new C_(i,4,2),s=new Dp({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const eoe=new pe,Pk=new Zt,Dk=new Zt;class toe extends mr{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new T_(i);n.rotateY(Math.PI*.5),this.material=new Dp({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new Ir(a,3)),this.add(new rs(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");Pk.copy(this.light.color),Dk.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?Pk:Dk;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(eoe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ioe extends ih{constructor(t=10,i=10,r=4473924,n=8947848){r=new Zt(r),n=new Zt(n);const s=i/2,a=t/i,o=t/2,l=[],c=[];for(let d=0,f=0,m=-o;d<=i;d++,m+=a){l.push(-o,0,m,o,0,m),l.push(m,0,-o,m,0,o);const v=d===s?r:n;v.toArray(c,f),f+=3,v.toArray(c,f),f+=3,v.toArray(c,f),f+=3,v.toArray(c,f),f+=3}const u=new Gi;u.setAttribute("position",new ii(l,3)),u.setAttribute("color",new ii(c,3));const h=new go({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class roe extends ih{constructor(t=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new Zt(s),a=new Zt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),f=Math.sin(d)*t,m=Math.cos(d)*t;o.push(0,0,0),o.push(f,0,m);const v=h&1?s:a;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let h=0;h<r;h++){const d=h&1?s:a,f=t-t/r*h;for(let m=0;m<n;m++){let v=m/n*(Math.PI*2),g=Math.sin(v)*f,x=Math.cos(v)*f;o.push(g,0,x),l.push(d.r,d.g,d.b),v=(m+1)/n*(Math.PI*2),g=Math.sin(v)*f,x=Math.cos(v)*f,o.push(g,0,x),l.push(d.r,d.g,d.b)}}const c=new Gi;c.setAttribute("position",new ii(o,3)),c.setAttribute("color",new ii(l,3));const u=new go({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Rk=new pe,zM=new pe,Ik=new pe;class noe extends mr{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new Gi;n.setAttribute("position",new ii([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new go({fog:!1,toneMapped:!1});this.lightPlane=new bp(n,s),this.add(this.lightPlane),n=new Gi,n.setAttribute("position",new ii([0,0,0,0,0,1],3)),this.targetLine=new bp(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Rk.setFromMatrixPosition(this.light.matrixWorld),zM.setFromMatrixPosition(this.light.target.matrixWorld),Ik.subVectors(zM,Rk),this.lightPlane.lookAt(zM),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zM),this.targetLine.scale.z=Ik.length()}}const BM=new pe,An=new __;class soe extends ih{constructor(t){const i=new Gi,r=new go({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(m,v){l(m),l(v)}function l(m){n.push(0,0,0),s.push(0,0,0),a[m]===void 0&&(a[m]=[]),a[m].push(n.length/3-1)}i.setAttribute("position",new ii(n,3)),i.setAttribute("color",new ii(s,3)),super(i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Zt(16755200),u=new Zt(16711680),h=new Zt(43775),d=new Zt(16777215),f=new Zt(3355443);this.setColors(c,u,h,d,f)}setColors(t,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,r=1,n=1;An.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),zn("c",i,t,An,0,0,-1),zn("t",i,t,An,0,0,1),zn("n1",i,t,An,-1,-1,-1),zn("n2",i,t,An,r,-1,-1),zn("n3",i,t,An,-1,n,-1),zn("n4",i,t,An,r,n,-1),zn("f1",i,t,An,-1,-1,1),zn("f2",i,t,An,r,-1,1),zn("f3",i,t,An,-1,n,1),zn("f4",i,t,An,r,n,1),zn("u1",i,t,An,r*.7,n*1.1,-1),zn("u2",i,t,An,-1*.7,n*1.1,-1),zn("u3",i,t,An,0,n*2,-1),zn("cf1",i,t,An,-1,0,1),zn("cf2",i,t,An,r,0,1),zn("cf3",i,t,An,0,-1,1),zn("cf4",i,t,An,0,n,1),zn("cn1",i,t,An,-1,0,-1),zn("cn2",i,t,An,r,0,-1),zn("cn3",i,t,An,0,-1,-1),zn("cn4",i,t,An,0,n,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function zn(e,t,i,r,n,s,a){BM.set(n,s,a).unproject(r);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],BM.x,BM.y,BM.z)}}const NM=new ho;class aoe extends ih{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new Gi;s.setIndex(new Ir(r,1)),s.setAttribute("position",new Ir(n,3)),super(s,new go({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&NM.setFromObject(this.object),NM.isEmpty())return;const i=NM.min,r=NM.max,n=this.geometry.attributes.position,s=n.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=i.x,s[4]=r.y,s[5]=r.z,s[6]=i.x,s[7]=i.y,s[8]=r.z,s[9]=r.x,s[10]=i.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=i.z,s[15]=i.x,s[16]=r.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=r.x,s[22]=i.y,s[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ooe extends ih{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Gi;s.setIndex(new Ir(r,1)),s.setAttribute("position",new ii(n,3)),super(s,new go({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class loe extends bp{constructor(t,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Gi;a.setAttribute("position",new ii(s,3)),a.computeBoundingSphere(),super(a,new go({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Gi;l.setAttribute("position",new ii(o,3)),l.computeBoundingSphere(),this.add(new rs(l,new Dp({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Lk=new pe;let UM,WP;class coe extends mr{constructor(t=new pe(0,0,1),i=new pe(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",UM===void 0&&(UM=new Gi,UM.setAttribute("position",new ii([0,0,0,0,1,0],3)),WP=new wx(0,.5,1,5,1),WP.translate(0,-.5,0)),this.position.copy(i),this.line=new bp(UM,new go({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new rs(WP,new Dp({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Lk.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(Lk,i)}}setLength(t,i=t*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class uoe extends ih{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new Gi;n.setAttribute("position",new ii(i,3)),n.setAttribute("color",new ii(r,3));const s=new go({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(t,i,r){const n=new Zt,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hoe{constructor(){this.type="ShapePath",this.color=new Zt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new Ob,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,r,n){return this.currentPath.quadraticCurveTo(t,i,r,n),this}bezierCurveTo(t,i,r,n,s,a){return this.currentPath.bezierCurveTo(t,i,r,n,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(x){const S=[];for(let _=0,A=x.length;_<A;_++){const T=x[_],E=new Pg;E.curves=T.curves,S.push(E)}return S}function r(x,S){const _=S.length;let A=!1;for(let T=_-1,E=0;E<_;T=E++){let I=S[T],P=S[E],C=P.x-I.x,L=P.y-I.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(I=S[E],C=-C,P=S[T],L=-L),x.y<I.y||x.y>P.y)continue;if(x.y===I.y){if(x.x===I.x)return!0}else{const z=L*(x.x-I.x)-C*(x.y-I.y);if(z===0)return!0;if(z<0)continue;A=!A}}else{if(x.y!==I.y)continue;if(P.x<=x.x&&x.x<=I.x||I.x<=x.x&&x.x<=P.x)return!0}}return A}const n=Gu.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new Pg,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=t?!u:u;const h=[],d=[];let f=[],m=0,v;d[m]=void 0,f[m]=[];for(let x=0,S=s.length;x<S;x++)o=s[x],v=o.getPoints(),a=n(v),a=t?!a:a,a?(!u&&d[m]&&m++,d[m]={s:new Pg,p:v},d[m].s.curves=o.curves,u&&m++,f[m]=[]):f[m].push({h:o,p:v[0]});if(!d[0])return i(s);if(d.length>1){let x=!1,S=0;for(let _=0,A=d.length;_<A;_++)h[_]=[];for(let _=0,A=d.length;_<A;_++){const T=f[_];for(let E=0;E<T.length;E++){const I=T[E];let P=!0;for(let C=0;C<d.length;C++)r(I.p,d[C].p)&&(_!==C&&S++,P?(P=!1,h[C].push(I)):x=!0);P&&h[_].push(I)}}S>0&&x===!1&&(f=h)}let g;for(let x=0,S=d.length;x<S;x++){l=d[x].s,c.push(l),g=f[x];for(let _=0,A=g.length;_<A;_++)l.holes.push(g[_].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:x_}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=x_);const doe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:oz,AddEquation:Yf,AddOperation:I8,AdditiveAnimationBlendMode:gz,AdditiveBlending:VR,AlphaFormat:k8,AlwaysCompare:n9,AlwaysDepth:A8,AlwaysStencilFunc:yI,AmbientLight:r7,AnimationAction:h7,AnimationClip:kb,AnimationLoader:mae,AnimationMixer:Gae,AnimationObjectGroup:Vae,AnimationUtils:hae,ArcCurve:P9,ArrayCamera:x9,ArrowHelper:coe,AttachedBindMode:XR,Audio:c7,AudioAnalyser:Rae,AudioContext:Wz,AudioListener:Cae,AudioLoader:Aae,AxesHelper:uoe,BackSide:uo,BasicDepthPacking:Q8,BasicShadowMap:o8,BatchedMesh:E9,Bone:Iz,BooleanKeyframeTrack:tv,Box2:Qae,Box3:ho,Box3Helper:ooe,BoxGeometry:ev,BoxHelper:aoe,BufferAttribute:Ir,BufferGeometry:Gi,BufferGeometryLoader:l7,ByteType:U8,Cache:Vg,Camera:__,CameraHelper:soe,CanvasTexture:zse,CapsuleGeometry:P2,CatmullRomCurve3:D9,CineonToneMapping:z8,CircleGeometry:D2,ClampToEdgeWrapping:Ia,Clock:Xz,Color:Zt,ColorKeyframeTrack:Hz,ColorManagement:Tr,CompressedArrayTexture:Lse,CompressedCubeTexture:Ose,CompressedTexture:T2,CompressedTextureLoader:gae,ConeGeometry:R2,ConstantAlphaFactor:_8,ConstantColorFactor:w8,CubeCamera:Mz,CubeReflectionMapping:Dd,CubeRefractionMapping:xp,CubeTexture:S_,CubeTextureLoader:vae,CubeUVReflectionMapping:yx,CubicBezierCurve:Oz,CubicBezierCurve3:R9,CubicInterpolant:Z9,CullFaceBack:kR,CullFaceFront:a8,CullFaceFrontBack:A$,CullFaceNone:s8,Curve:Jc,CurvePath:L9,CustomBlending:l8,CustomToneMapping:B8,CylinderGeometry:wx,Cylindrical:Yae,Data3DTexture:bz,DataArrayTexture:w2,DataTexture:Cg,DataTextureLoader:yae,DataUtils:Lee,DecrementStencilOp:N$,DecrementWrapStencilOp:F$,DefaultLoadingManager:by,DepthFormat:hp,DepthStencilFormat:Ug,DepthTexture:Tz,DetachedBindMode:N8,DirectionalLight:i7,DirectionalLightHelper:noe,DiscreteInterpolant:K9,DisplayP3ColorSpace:x2,DodecahedronGeometry:I2,DoubleSide:Oc,DstAlphaFactor:m8,DstColorFactor:v8,DynamicCopyUsage:$$,DynamicDrawUsage:Ag,DynamicReadUsage:Z$,EdgesGeometry:O9,EllipseCurve:C2,EqualCompare:e9,EqualDepth:T8,EqualStencilFunc:G$,EquirectangularReflectionMapping:_b,EquirectangularRefractionMapping:Sb,Euler:$g,EventDispatcher:Ud,ExtrudeGeometry:O2,FileLoader:Rd,Float16BufferAttribute:Fee,Float32BufferAttribute:ii,Float64BufferAttribute:kee,FloatType:Nc,Fog:S2,FogExp2:_2,FramebufferTexture:Ise,FrontSide:Pd,Frustum:M_,GLBufferAttribute:qae,GLSL1:tee,GLSL3:xI,GreaterCompare:t9,GreaterDepth:P8,GreaterEqualCompare:r9,GreaterEqualDepth:C8,GreaterEqualStencilFunc:q$,GreaterStencilFunc:W$,GridHelper:ioe,Group:xy,HalfFloatType:Qy,HemisphereLight:$9,HemisphereLightHelper:toe,IcosahedronGeometry:z2,ImageBitmapLoader:Mae,ImageLoader:Vb,ImageUtils:wz,IncrementStencilOp:B$,IncrementWrapStencilOp:U$,InstancedBufferAttribute:$y,InstancedBufferGeometry:o7,InstancedInterleavedBuffer:Xae,InstancedMesh:A9,Int16BufferAttribute:Nee,Int32BufferAttribute:Uee,Int8BufferAttribute:Oee,IntType:cz,InterleavedBuffer:M2,InterleavedBufferAttribute:Fg,Interpolant:P_,InterpolateDiscrete:Eb,InterpolateLinear:Tb,InterpolateSmooth:wE,InvertStencilOp:k$,KeepStencilOp:Ym,KeyframeTrack:$c,LOD:S9,LatheGeometry:E_,Layers:Tg,LessCompare:$8,LessDepth:E8,LessEqualCompare:yz,LessEqualDepth:bb,LessEqualStencilFunc:j$,LessStencilFunc:H$,Light:Ip,LightProbe:a7,Line:bp,Line3:Zae,LineBasicMaterial:go,LineCurve:zz,LineCurve3:I9,LineDashedMaterial:q9,LineLoop:T9,LineSegments:ih,LinearDisplayP3ColorSpace:b_,LinearEncoding:vz,LinearFilter:kn,LinearInterpolant:Vz,LinearMipMapLinearFilter:D$,LinearMipMapNearestFilter:P$,LinearMipmapLinearFilter:wp,LinearMipmapNearestFilter:lz,LinearSRGBColorSpace:Qu,LinearToneMapping:L8,LinearTransfer:Pb,Loader:Xo,LoaderUtils:TI,LoadingManager:Gz,LoopOnce:X8,LoopPingPong:Y8,LoopRepeat:q8,LuminanceAlphaFormat:H8,LuminanceFormat:V8,MOUSE:Xm,Material:ga,MaterialLoader:G2,MathUtils:s9,Matrix3:Yi,Matrix4:Ci,MaxEquation:WR,Mesh:rs,MeshBasicMaterial:Dp,MeshDepthMaterial:Cz,MeshDistanceMaterial:Pz,MeshLambertMaterial:W9,MeshMatcapMaterial:X9,MeshNormalMaterial:j9,MeshPhongMaterial:H9,MeshPhysicalMaterial:V9,MeshStandardMaterial:Fz,MeshToonMaterial:G9,MinEquation:jR,MirroredRepeatWrapping:Ab,MixOperation:R8,MultiplyBlending:GR,MultiplyOperation:w_,NearestFilter:Fn,NearestMipMapLinearFilter:C$,NearestMipMapNearestFilter:T$,NearestMipmapLinearFilter:qw,NearestMipmapNearestFilter:WE,NeverCompare:J8,NeverDepth:M8,NeverStencilFunc:V$,NoBlending:Md,NoColorSpace:hl,NoToneMapping:ku,NormalAnimationBlendMode:y2,NormalBlending:Mg,NotEqualCompare:i9,NotEqualDepth:D8,NotEqualStencilFunc:X$,NumberKeyframeTrack:Ub,Object3D:mr,ObjectLoader:_ae,ObjectSpaceNormalMap:K8,OctahedronGeometry:T_,OneFactor:d8,OneMinusConstantAlphaFactor:S8,OneMinusConstantColorFactor:b8,OneMinusDstAlphaFactor:g8,OneMinusDstColorFactor:y8,OneMinusSrcAlphaFactor:jE,OneMinusSrcColorFactor:p8,OrthographicCamera:Hu,P3Primaries:Rb,PCFShadowMap:m2,PCFSoftShadowMap:Xw,PMREMGenerator:bI,Path:Ob,PerspectiveCamera:gn,Plane:od,PlaneGeometry:A_,PlaneHelper:loe,PointLight:t7,PointLightHelper:$ae,Points:C9,PointsMaterial:E2,PolarGridHelper:roe,PolyhedronGeometry:Rp,PositionalAudio:Dae,PropertyBinding:pr,PropertyMixer:u7,QuadraticBezierCurve:Bz,QuadraticBezierCurve3:Nz,Quaternion:za,QuaternionKeyframeTrack:bx,QuaternionLinearInterpolant:J9,RED_GREEN_RGTC2_Format:gI,RED_RGTC1_Format:W8,REVISION:x_,RGBADepthPacking:Z8,RGBAFormat:so,RGBAIntegerFormat:pz,RGBA_ASTC_10x10_Format:uI,RGBA_ASTC_10x5_Format:oI,RGBA_ASTC_10x6_Format:lI,RGBA_ASTC_10x8_Format:cI,RGBA_ASTC_12x10_Format:hI,RGBA_ASTC_12x12_Format:dI,RGBA_ASTC_4x4_Format:$R,RGBA_ASTC_5x4_Format:eI,RGBA_ASTC_5x5_Format:tI,RGBA_ASTC_6x5_Format:iI,RGBA_ASTC_6x6_Format:rI,RGBA_ASTC_8x5_Format:nI,RGBA_ASTC_8x6_Format:sI,RGBA_ASTC_8x8_Format:aI,RGBA_BPTC_Format:xE,RGBA_ETC2_EAC_Format:JR,RGBA_PVRTC_2BPPV1_Format:ZR,RGBA_PVRTC_4BPPV1_Format:QR,RGBA_S3TC_DXT1_Format:gE,RGBA_S3TC_DXT3_Format:vE,RGBA_S3TC_DXT5_Format:yE,RGB_BPTC_SIGNED_Format:fI,RGB_BPTC_UNSIGNED_Format:pI,RGB_ETC1_Format:mz,RGB_ETC2_Format:KR,RGB_PVRTC_2BPPV1_Format:YR,RGB_PVRTC_4BPPV1_Format:qR,RGB_S3TC_DXT1_Format:mE,RGFormat:j8,RGIntegerFormat:fz,RawShaderMaterial:k9,Ray:Jg,Raycaster:d7,Rec709Primaries:Db,RectAreaLight:n7,RedFormat:G8,RedIntegerFormat:dz,ReinhardToneMapping:O8,RenderTarget:l9,RepeatWrapping:Mb,ReplaceStencilOp:z$,ReverseSubtractEquation:u8,RingGeometry:B2,SIGNED_RED_GREEN_RGTC2_Format:vI,SIGNED_RED_RGTC1_Format:mI,SRGBColorSpace:bs,SRGBTransfer:Kr,Scene:YE,ShaderChunk:Wi,ShaderLib:Lc,ShaderMaterial:Zu,ShadowMaterial:F9,Shape:Pg,ShapeGeometry:N2,ShapePath:hoe,ShapeUtils:Gu,ShortType:F8,Skeleton:A2,SkeletonHelper:Jae,SkinnedMesh:M9,Source:dg,Sphere:Ba,SphereGeometry:C_,Spherical:PI,SphericalHarmonics3:s7,SplineCurve:Uz,SpotLight:e7,SpotLightHelper:Kae,Sprite:_9,SpriteMaterial:Rz,SrcAlphaFactor:GE,SrcAlphaSaturateFactor:x8,SrcColorFactor:f8,StaticCopyUsage:J$,StaticDrawUsage:Ib,StaticReadUsage:Q$,StereoCamera:Eae,StreamCopyUsage:eee,StreamDrawUsage:Y$,StreamReadUsage:K$,StringKeyframeTrack:iv,SubtractEquation:c8,SubtractiveBlending:HR,TOUCH:qm,TangentSpaceNormalMap:Pp,TetrahedronGeometry:U2,Texture:dn,TextureLoader:H2,TorusGeometry:F2,TorusKnotGeometry:k2,Triangle:Oo,TriangleFanDrawMode:L$,TriangleStripDrawMode:I$,TrianglesDrawMode:R$,TubeGeometry:V2,TwoPassDoubleSide:E$,UVMapping:g2,Uint16BufferAttribute:_z,Uint32BufferAttribute:Sz,Uint8BufferAttribute:zee,Uint8ClampedBufferAttribute:Bee,Uniform:Qz,UniformsGroup:Wae,UniformsLib:Vt,UniformsUtils:h9,UnsignedByteType:Vu,UnsignedInt248Type:up,UnsignedIntType:gd,UnsignedShort4444Type:uz,UnsignedShort5551Type:hz,UnsignedShortType:v2,VSMShadowMap:Ic,Vector2:yt,Vector3:pe,Vector4:Pr,VectorKeyframeTrack:Fb,VideoTexture:Rse,WebGL1Renderer:w9,WebGL3DRenderTarget:bee,WebGLArrayRenderTarget:wee,WebGLCoordinateSystem:Uc,WebGLCubeRenderTarget:Az,WebGLMultipleRenderTargets:_ee,WebGLRenderTarget:qc,WebGLRenderer:Dz,WebGLUtils:y9,WebGPUCoordinateSystem:Zy,WireframeGeometry:U9,WrapAroundEnding:Cb,ZeroCurvatureEnding:ug,ZeroFactor:h8,ZeroSlopeEnding:hg,ZeroStencilOp:O$,_SRGBAFormat:XE,createCanvasElement:o9,sRGBEncoding:dp},Symbol.toStringTag,{value:"Module"}));var XP={exports:{}},Cf={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ok;function foe(){return Ok||(Ok=1,Cf.ConcurrentRoot=1,Cf.ContinuousEventPriority=4,Cf.DefaultEventPriority=16,Cf.DiscreteEventPriority=1,Cf.IdleEventPriority=536870912,Cf.LegacyRoot=0),Cf}var zk;function poe(){return zk||(zk=1,XP.exports=foe()),XP.exports}var _y=poe();function moe(e){let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(h!==t){const d=t;t=u?h:Object.assign({},t,h),i.forEach(f=>f(t,d))}},n=()=>t,s=(c,u=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(t);function f(){const m=u(t);if(!h(d,m)){const v=d;c(d=m,v)}}return i.add(f),()=>i.delete(f)},l={setState:r,getState:n,subscribe:(c,u,h)=>u||h?s(c,u,h):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}const goe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Bk=goe?Se.useEffect:Se.useLayoutEffect;function voe(e){const t=typeof e=="function"?moe(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=Se.useReducer(g=>g+1,0),a=t.getState(),o=Se.useRef(a),l=Se.useRef(r),c=Se.useRef(n),u=Se.useRef(!1),h=Se.useRef();h.current===void 0&&(h.current=r(a));let d,f=!1;(o.current!==a||l.current!==r||c.current!==n||u.current)&&(d=r(a),f=!n(h.current,d)),Bk(()=>{f&&(h.current=d),o.current=a,l.current=r,c.current=n,u.current=!1});const m=Se.useRef(a);Bk(()=>{const g=()=>{try{const S=t.getState(),_=l.current(S);c.current(h.current,_)||(o.current=S,h.current=_,s())}catch{u.current=!0,s()}},x=t.subscribe(g);return t.getState()!==m.current&&g(),x},[]);const v=f?d:h.current;return Se.useDebugValue(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}var qP={exports:{}},YP={exports:{}},QP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nk;function yoe(){return Nk||(Nk=1,function(e){function t(W,ee){var K=W.length;W.push(ee);e:for(;0<K;){var j=K-1>>>1,$=W[j];if(0<n($,ee))W[j]=ee,W[K]=$,K=j;else break e}}function i(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var ee=W[0],K=W.pop();if(K!==ee){W[0]=K;e:for(var j=0,$=W.length,se=$>>>1;j<se;){var re=2*(j+1)-1,he=W[re],oe=re+1,ve=W[oe];if(0>n(he,K))oe<$&&0>n(ve,he)?(W[j]=ve,W[oe]=K,j=oe):(W[j]=he,W[re]=K,j=re);else if(oe<$&&0>n(ve,K))W[j]=ve,W[oe]=K,j=oe;else break e}}return ee}function n(W,ee){var K=W.sortIndex-ee.sortIndex;return K!==0?K:W.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,m=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(W){for(var ee=i(c);ee!==null;){if(ee.callback===null)r(c);else if(ee.startTime<=W)r(c),ee.sortIndex=ee.expirationTime,t(l,ee);else break;ee=i(c)}}function A(W){if(v=!1,_(W),!m)if(i(l)!==null)m=!0,ie(T);else{var ee=i(c);ee!==null&&Q(A,ee.startTime-W)}}function T(W,ee){m=!1,v&&(v=!1,x(P),P=-1),f=!0;var K=d;try{for(_(ee),h=i(l);h!==null&&(!(h.expirationTime>ee)||W&&!z());){var j=h.callback;if(typeof j=="function"){h.callback=null,d=h.priorityLevel;var $=j(h.expirationTime<=ee);ee=e.unstable_now(),typeof $=="function"?h.callback=$:h===i(l)&&r(l),_(ee)}else r(l);h=i(l)}if(h!==null)var se=!0;else{var re=i(c);re!==null&&Q(A,re.startTime-ee),se=!1}return se}finally{h=null,d=K,f=!1}}var E=!1,I=null,P=-1,C=5,L=-1;function z(){return!(e.unstable_now()-L<C)}function F(){if(I!==null){var W=e.unstable_now();L=W;var ee=!0;try{ee=I(!0,W)}finally{ee?G():(E=!1,I=null)}}else E=!1}var G;if(typeof S=="function")G=function(){S(F)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,q=N.port2;N.port1.onmessage=F,G=function(){q.postMessage(null)}}else G=function(){g(F,0)};function ie(W){I=W,E||(E=!0,G())}function Q(W,ee){P=g(function(){W(e.unstable_now())},ee)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,ie(T))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(W){switch(d){case 1:case 2:case 3:var ee=3;break;default:ee=d}var K=d;d=ee;try{return W()}finally{d=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,ee){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var K=d;d=W;try{return ee()}finally{d=K}},e.unstable_scheduleCallback=function(W,ee,K){var j=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?j+K:j):K=j,W){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=K+$,W={id:u++,callback:ee,priorityLevel:W,startTime:K,expirationTime:$,sortIndex:-1},K>j?(W.sortIndex=K,t(c,W),i(l)===null&&W===i(c)&&(v?(x(P),P=-1):v=!0,Q(A,K-j))):(W.sortIndex=$,t(l,W),m||f||(m=!0,ie(T))),W},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(W){var ee=d;return function(){var K=d;d=ee;try{return W.apply(this,arguments)}finally{d=K}}}}(QP)),QP}var Uk;function p7(){return Uk||(Uk=1,YP.exports=yoe()),YP.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZP,Fk;function xoe(){return Fk||(Fk=1,ZP=function(t){var i={},r=Kg(),n=p7(),s=Object.assign;function a(w){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+w,D=1;D<arguments.length;D++)b+="&args[]="+encodeURIComponent(arguments[D]);return"Minified React error #"+w+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),A=Symbol.for("react.offscreen"),T=Symbol.iterator;function E(w){return w===null||typeof w!="object"?null:(w=T&&w[T]||w["@@iterator"],typeof w=="function"?w:null)}function I(w){if(w==null)return null;if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w;switch(w){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case x:return"SuspenseList"}if(typeof w=="object")switch(w.$$typeof){case m:return(w.displayName||"Context")+".Consumer";case f:return(w._context.displayName||"Context")+".Provider";case v:var b=w.render;return w=w.displayName,w||(w=b.displayName||b.name||"",w=w!==""?"ForwardRef("+w+")":"ForwardRef"),w;case S:return b=w.displayName||null,b!==null?b:I(w.type)||"Memo";case _:b=w._payload,w=w._init;try{return I(w(b))}catch{}}return null}function P(w){var b=w.type;switch(w.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return w=b.render,w=w.displayName||w.name||"",b.displayName||(w!==""?"ForwardRef("+w+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return I(b);case 8:return b===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function C(w){var b=w,D=w;if(w.alternate)for(;b.return;)b=b.return;else{w=b;do b=w,(b.flags&4098)!==0&&(D=b.return),w=b.return;while(w)}return b.tag===3?D:null}function L(w){if(C(w)!==w)throw Error(a(188))}function z(w){var b=w.alternate;if(!b){if(b=C(w),b===null)throw Error(a(188));return b!==w?null:w}for(var D=w,O=b;;){var U=D.return;if(U===null)break;var Y=U.alternate;if(Y===null){if(O=U.return,O!==null){D=O;continue}break}if(U.child===Y.child){for(Y=U.child;Y;){if(Y===D)return L(U),w;if(Y===O)return L(U),b;Y=Y.sibling}throw Error(a(188))}if(D.return!==O.return)D=U,O=Y;else{for(var ye=!1,Fe=U.child;Fe;){if(Fe===D){ye=!0,D=U,O=Y;break}if(Fe===O){ye=!0,O=U,D=Y;break}Fe=Fe.sibling}if(!ye){for(Fe=Y.child;Fe;){if(Fe===D){ye=!0,D=Y,O=U;break}if(Fe===O){ye=!0,O=Y,D=U;break}Fe=Fe.sibling}if(!ye)throw Error(a(189))}}if(D.alternate!==O)throw Error(a(190))}if(D.tag!==3)throw Error(a(188));return D.stateNode.current===D?w:b}function F(w){return w=z(w),w!==null?G(w):null}function G(w){if(w.tag===5||w.tag===6)return w;for(w=w.child;w!==null;){var b=G(w);if(b!==null)return b;w=w.sibling}return null}function N(w){if(w.tag===5||w.tag===6)return w;for(w=w.child;w!==null;){if(w.tag!==4){var b=N(w);if(b!==null)return b}w=w.sibling}return null}var q=Array.isArray,ie=t.getPublicInstance,Q=t.getRootHostContext,W=t.getChildHostContext,ee=t.prepareForCommit,K=t.resetAfterCommit,j=t.createInstance,$=t.appendInitialChild,se=t.finalizeInitialChildren,re=t.prepareUpdate,he=t.shouldSetTextContent,oe=t.createTextInstance,ve=t.scheduleTimeout,xe=t.cancelTimeout,be=t.noTimeout,Me=t.isPrimaryRenderer,Te=t.supportsMutation,ae=t.supportsPersistence,Ce=t.supportsHydration,Ie=t.getInstanceFromNode,Be=t.preparePortalMount,Ve=t.getCurrentEventPriority,lt=t.detachDeletedInstance,We=t.supportsMicrotasks,je=t.scheduleMicrotask,xt=t.supportsTestSelectors,Mt=t.findFiberRoot,de=t.getBoundingRect,V=t.getTextContent,X=t.isHiddenSubtree,we=t.matchAccessibilityRole,J=t.setFocusIfFocusable,Le=t.setupIntersectionObserver,qe=t.appendChild,ct=t.appendChildToContainer,Pe=t.commitTextUpdate,nt=t.commitMount,gt=t.commitUpdate,Tt=t.insertBefore,rt=t.insertInContainerBefore,Dt=t.removeChild,ge=t.removeChildFromContainer,$e=t.resetTextContent,mt=t.hideInstance,me=t.hideTextInstance,Ne=t.unhideInstance,ue=t.unhideTextInstance,et=t.clearContainer,at=t.cloneInstance,Ze=t.createContainerChildSet,bt=t.appendChildToContainerChildSet,Ft=t.finalizeContainerChildren,ui=t.replaceContainerChildren,ci=t.cloneHiddenInstance,Qi=t.cloneHiddenTextInstance,mi=t.canHydrateInstance,Or=t.canHydrateTextInstance,bn=t.canHydrateSuspenseInstance,Yl=t.isSuspenseInstancePending,Qs=t.isSuspenseInstanceFallback,fe=t.registerSuspenseInstanceRetry,Ye=t.getNextHydratableSibling,ut=t.getFirstHydratableChild,Xe=t.getFirstHydratableChildWithinContainer,ft=t.getFirstHydratableChildWithinSuspenseInstance,Yt=t.hydrateInstance,oi=t.hydrateTextInstance,gi=t.hydrateSuspenseInstance,le=t.getNextHydratableInstanceAfterSuspenseInstance,Oe=t.commitHydratedContainer,ke=t.commitHydratedSuspenseInstance,Ge=t.clearSuspenseBoundary,Ue=t.clearSuspenseBoundaryFromContainer,Rt=t.shouldDeleteUnhydratedTailInstances,Xt=t.didNotMatchHydratedContainerTextInstance,ri=t.didNotMatchHydratedTextInstance,Pt;function zt(w){if(Pt===void 0)try{throw Error()}catch(D){var b=D.stack.trim().match(/\n( *(at )?)/);Pt=b&&b[1]||""}return`
`+Pt+w}var ni=!1;function Lt(w,b){if(!w||ni)return"";ni=!0;var D=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(It){var O=It}Reflect.construct(w,[],b)}else{try{b.call()}catch(It){O=It}w.call(b.prototype)}else{try{throw Error()}catch(It){O=It}w()}}catch(It){if(It&&O&&typeof It.stack=="string"){for(var U=It.stack.split(`
`),Y=O.stack.split(`
`),ye=U.length-1,Fe=Y.length-1;1<=ye&&0<=Fe&&U[ye]!==Y[Fe];)Fe--;for(;1<=ye&&0<=Fe;ye--,Fe--)if(U[ye]!==Y[Fe]){if(ye!==1||Fe!==1)do if(ye--,Fe--,0>Fe||U[ye]!==Y[Fe]){var pt=`
`+U[ye].replace(" at new "," at ");return w.displayName&&pt.includes("<anonymous>")&&(pt=pt.replace("<anonymous>",w.displayName)),pt}while(1<=ye&&0<=Fe);break}}}finally{ni=!1,Error.prepareStackTrace=D}return(w=w?w.displayName||w.name:"")?zt(w):""}var Zi=Object.prototype.hasOwnProperty,Vr=[],$i=-1;function lr(w){return{current:w}}function Z(w){0>$i||(w.current=Vr[$i],Vr[$i]=null,$i--)}function te(w,b){$i++,Vr[$i]=w.current,w.current=b}var _e={},ce=lr(_e),De=lr(!1),_t=_e;function Hr(w,b){var D=w.type.contextTypes;if(!D)return _e;var O=w.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===b)return O.__reactInternalMemoizedMaskedChildContext;var U={},Y;for(Y in D)U[Y]=b[Y];return O&&(w=w.stateNode,w.__reactInternalMemoizedUnmaskedChildContext=b,w.__reactInternalMemoizedMaskedChildContext=U),U}function Gr(w){return w=w.childContextTypes,w!=null}function gr(){Z(De),Z(ce)}function cs(w,b,D){if(ce.current!==_e)throw Error(a(168));te(ce,b),te(De,D)}function Yo(w,b,D){var O=w.stateNode;if(b=b.childContextTypes,typeof O.getChildContext!="function")return D;O=O.getChildContext();for(var U in O)if(!(U in b))throw Error(a(108,P(w)||"Unknown",U));return s({},D,O)}function fn(w){return w=(w=w.stateNode)&&w.__reactInternalMemoizedMergedChildContext||_e,_t=ce.current,te(ce,w),te(De,De.current),!0}function iu(w,b,D){var O=w.stateNode;if(!O)throw Error(a(169));D?(w=Yo(w,b,_t),O.__reactInternalMemoizedMergedChildContext=w,Z(De),Z(ce),te(ce,w)):Z(De),te(De,D)}var ya=Math.clz32?Math.clz32:TC,Vd=Math.log,Fp=Math.LN2;function TC(w){return w>>>=0,w===0?32:31-(Vd(w)/Fp|0)|0}var Hd=64,cr=4194304;function Gd(w){switch(w&-w){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return w&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return w}}function kp(w,b){var D=w.pendingLanes;if(D===0)return 0;var O=0,U=w.suspendedLanes,Y=w.pingedLanes,ye=D&268435455;if(ye!==0){var Fe=ye&~U;Fe!==0?O=Gd(Fe):(Y&=ye,Y!==0&&(O=Gd(Y)))}else ye=D&~U,ye!==0?O=Gd(ye):Y!==0&&(O=Gd(Y));if(O===0)return 0;if(b!==0&&b!==O&&(b&U)===0&&(U=O&-O,Y=b&-b,U>=Y||U===16&&(Y&4194240)!==0))return b;if((O&4)!==0&&(O|=D&16),b=w.entangledLanes,b!==0)for(w=w.entanglements,b&=O;0<b;)D=31-ya(b),U=1<<D,O|=w[D],b&=~U;return O}function Vx(w,b){switch(w){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $_(w,b){for(var D=w.suspendedLanes,O=w.pingedLanes,U=w.expirationTimes,Y=w.pendingLanes;0<Y;){var ye=31-ya(Y),Fe=1<<ye,pt=U[ye];pt===-1?((Fe&D)===0||(Fe&O)!==0)&&(U[ye]=Vx(Fe,b)):pt<=b&&(w.expiredLanes|=Fe),Y&=~Fe}}function hv(w){return w=w.pendingLanes&-1073741825,w!==0?w:w&1073741824?1073741824:0}function dv(w){for(var b=[],D=0;31>D;D++)b.push(w);return b}function ah(w,b,D){w.pendingLanes|=b,b!==536870912&&(w.suspendedLanes=0,w.pingedLanes=0),w=w.eventTimes,b=31-ya(b),w[b]=D}function fv(w,b){var D=w.pendingLanes&~b;w.pendingLanes=b,w.suspendedLanes=0,w.pingedLanes=0,w.expiredLanes&=b,w.mutableReadLanes&=b,w.entangledLanes&=b,b=w.entanglements;var O=w.eventTimes;for(w=w.expirationTimes;0<D;){var U=31-ya(D),Y=1<<U;b[U]=0,O[U]=-1,w[U]=-1,D&=~Y}}function gl(w,b){var D=w.entangledLanes|=b;for(w=w.entanglements;D;){var O=31-ya(D),U=1<<O;U&b|w[O]&b&&(w[O]|=b),D&=~U}}var ji=0;function Ql(w){return w&=-w,1<w?4<w?(w&268435455)!==0?16:536870912:4:1}var oh=n.unstable_scheduleCallback,jd=n.unstable_cancelCallback,ru=n.unstable_shouldYield,CC=n.unstable_requestPaint,In=n.unstable_now,lh=n.unstable_ImmediatePriority,PC=n.unstable_UserBlockingPriority,pv=n.unstable_NormalPriority,mv=n.unstable_IdlePriority,Vp=null,vl=null;function Hp(w){if(vl&&typeof vl.onCommitFiberRoot=="function")try{vl.onCommitFiberRoot(Vp,w,void 0,(w.current.flags&128)===128)}catch{}}function Gp(w,b){return w===b&&(w!==0||1/w===1/b)||w!==w&&b!==b}var Zs=typeof Object.is=="function"?Object.is:Gp,yo=null,gv=!1,Hx=!1;function vv(w){yo===null?yo=[w]:yo.push(w)}function yv(w){gv=!0,vv(w)}function xo(){if(!Hx&&yo!==null){Hx=!0;var w=0,b=ji;try{var D=yo;for(ji=1;w<D.length;w++){var O=D[w];do O=O(!0);while(O!==null)}yo=null,gv=!1}catch(U){throw yo!==null&&(yo=yo.slice(w+1)),oh(lh,xo),U}finally{ji=b,Hx=!1}}return null}var eS=o.ReactCurrentBatchConfig;function Qo(w,b){if(Zs(w,b))return!0;if(typeof w!="object"||w===null||typeof b!="object"||b===null)return!1;var D=Object.keys(w),O=Object.keys(b);if(D.length!==O.length)return!1;for(O=0;O<D.length;O++){var U=D[O];if(!Zi.call(b,U)||!Zs(w[U],b[U]))return!1}return!0}function Gx(w){switch(w.tag){case 5:return zt(w.type);case 16:return zt("Lazy");case 13:return zt("Suspense");case 19:return zt("SuspenseList");case 0:case 2:case 15:return w=Lt(w.type,!1),w;case 11:return w=Lt(w.type.render,!1),w;case 1:return w=Lt(w.type,!0),w;default:return""}}function xa(w,b){if(w&&w.defaultProps){b=s({},b),w=w.defaultProps;for(var D in w)b[D]===void 0&&(b[D]=w[D]);return b}return b}var jp=lr(null),ch=null,Zl=null,xv=null;function Ks(){xv=Zl=ch=null}function uh(w,b,D){Me?(te(jp,b._currentValue),b._currentValue=D):(te(jp,b._currentValue2),b._currentValue2=D)}function Wp(w){var b=jp.current;Z(jp),Me?w._currentValue=b:w._currentValue2=b}function hh(w,b,D){for(;w!==null;){var O=w.alternate;if((w.childLanes&b)!==b?(w.childLanes|=b,O!==null&&(O.childLanes|=b)):O!==null&&(O.childLanes&b)!==b&&(O.childLanes|=b),w===D)break;w=w.return}}function Wd(w,b){ch=w,xv=Zl=null,w=w.dependencies,w!==null&&w.firstContext!==null&&((w.lanes&b)!==0&&(Yn=!0),w.firstContext=null)}function wa(w){var b=Me?w._currentValue:w._currentValue2;if(xv!==w)if(w={context:w,memoizedValue:b,next:null},Zl===null){if(ch===null)throw Error(a(308));Zl=w,ch.dependencies={lanes:0,firstContext:w}}else Zl=Zl.next=w;return b}var wo=null,bo=!1;function Xd(w){w.updateQueue={baseState:w.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jx(w,b){w=w.updateQueue,b.updateQueue===w&&(b.updateQueue={baseState:w.baseState,firstBaseUpdate:w.firstBaseUpdate,lastBaseUpdate:w.lastBaseUpdate,shared:w.shared,effects:w.effects})}function Kl(w,b){return{eventTime:w,lane:b,tag:0,payload:null,callback:null,next:null}}function nu(w,b){var D=w.updateQueue;D!==null&&(D=D.shared,mn!==null&&(w.mode&1)!==0&&(ki&2)===0?(w=D.interleaved,w===null?(b.next=b,wo===null?wo=[D]:wo.push(D)):(b.next=w.next,w.next=b),D.interleaved=b):(w=D.pending,w===null?b.next=b:(b.next=w.next,w.next=b),D.pending=b))}function wv(w,b,D){if(b=b.updateQueue,b!==null&&(b=b.shared,(D&4194240)!==0)){var O=b.lanes;O&=w.pendingLanes,D|=O,b.lanes=D,gl(w,D)}}function bv(w,b){var D=w.updateQueue,O=w.alternate;if(O!==null&&(O=O.updateQueue,D===O)){var U=null,Y=null;if(D=D.firstBaseUpdate,D!==null){do{var ye={eventTime:D.eventTime,lane:D.lane,tag:D.tag,payload:D.payload,callback:D.callback,next:null};Y===null?U=Y=ye:Y=Y.next=ye,D=D.next}while(D!==null);Y===null?U=Y=b:Y=Y.next=b}else U=Y=b;D={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:Y,shared:O.shared,effects:O.effects},w.updateQueue=D;return}w=D.lastBaseUpdate,w===null?D.firstBaseUpdate=b:w.next=b,D.lastBaseUpdate=b}function _v(w,b,D,O){var U=w.updateQueue;bo=!1;var Y=U.firstBaseUpdate,ye=U.lastBaseUpdate,Fe=U.shared.pending;if(Fe!==null){U.shared.pending=null;var pt=Fe,It=pt.next;pt.next=null,ye===null?Y=It:ye.next=It,ye=pt;var Kt=w.alternate;Kt!==null&&(Kt=Kt.updateQueue,Fe=Kt.lastBaseUpdate,Fe!==ye&&(Fe===null?Kt.firstBaseUpdate=It:Fe.next=It,Kt.lastBaseUpdate=pt))}if(Y!==null){var Ii=U.baseState;ye=0,Kt=It=pt=null,Fe=Y;do{var vi=Fe.lane,Hi=Fe.eventTime;if((O&vi)===vi){Kt!==null&&(Kt=Kt.next={eventTime:Hi,lane:0,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null});e:{var jt=w,ms=Fe;switch(vi=b,Hi=D,ms.tag){case 1:if(jt=ms.payload,typeof jt=="function"){Ii=jt.call(Hi,Ii,vi);break e}Ii=jt;break e;case 3:jt.flags=jt.flags&-65537|128;case 0:if(jt=ms.payload,vi=typeof jt=="function"?jt.call(Hi,Ii,vi):jt,vi==null)break e;Ii=s({},Ii,vi);break e;case 2:bo=!0}}Fe.callback!==null&&Fe.lane!==0&&(w.flags|=64,vi=U.effects,vi===null?U.effects=[Fe]:vi.push(Fe))}else Hi={eventTime:Hi,lane:vi,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null},Kt===null?(It=Kt=Hi,pt=Ii):Kt=Kt.next=Hi,ye|=vi;if(Fe=Fe.next,Fe===null){if(Fe=U.shared.pending,Fe===null)break;vi=Fe,Fe=vi.next,vi.next=null,U.lastBaseUpdate=vi,U.shared.pending=null}}while(!0);if(Kt===null&&(pt=Ii),U.baseState=pt,U.firstBaseUpdate=It,U.lastBaseUpdate=Kt,b=U.shared.interleaved,b!==null){U=b;do ye|=U.lane,U=U.next;while(U!==b)}else Y===null&&(U.shared.lanes=0);bl|=ye,w.lanes=ye,w.memoizedState=Ii}}function tS(w,b,D){if(w=b.effects,b.effects=null,w!==null)for(b=0;b<w.length;b++){var O=w[b],U=O.callback;if(U!==null){if(O.callback=null,O=D,typeof U!="function")throw Error(a(191,U));U.call(O)}}}var iS=new r.Component().refs;function Wx(w,b,D,O){b=w.memoizedState,D=D(O,b),D=D==null?b:s({},b,D),w.memoizedState=D,w.lanes===0&&(w.updateQueue.baseState=D)}var Sv={isMounted:function(w){return(w=w._reactInternals)?C(w)===w:!1},enqueueSetState:function(w,b,D){w=w._reactInternals;var O=ur(),U=il(w),Y=Kl(O,U);Y.payload=b,D!=null&&(Y.callback=D),nu(w,Y),b=Ls(w,U,O),b!==null&&wv(b,w,U)},enqueueReplaceState:function(w,b,D){w=w._reactInternals;var O=ur(),U=il(w),Y=Kl(O,U);Y.tag=1,Y.payload=b,D!=null&&(Y.callback=D),nu(w,Y),b=Ls(w,U,O),b!==null&&wv(b,w,U)},enqueueForceUpdate:function(w,b){w=w._reactInternals;var D=ur(),O=il(w),U=Kl(D,O);U.tag=2,b!=null&&(U.callback=b),nu(w,U),b=Ls(w,O,D),b!==null&&wv(b,w,O)}};function Xx(w,b,D,O,U,Y,ye){return w=w.stateNode,typeof w.shouldComponentUpdate=="function"?w.shouldComponentUpdate(O,Y,ye):b.prototype&&b.prototype.isPureReactComponent?!Qo(D,O)||!Qo(U,Y):!0}function rS(w,b,D){var O=!1,U=_e,Y=b.contextType;return typeof Y=="object"&&Y!==null?Y=wa(Y):(U=Gr(b)?_t:ce.current,O=b.contextTypes,Y=(O=O!=null)?Hr(w,U):_e),b=new b(D,Y),w.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Sv,w.stateNode=b,b._reactInternals=w,O&&(w=w.stateNode,w.__reactInternalMemoizedUnmaskedChildContext=U,w.__reactInternalMemoizedMaskedChildContext=Y),b}function nS(w,b,D,O){w=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(D,O),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(D,O),b.state!==w&&Sv.enqueueReplaceState(b,b.state,null)}function qx(w,b,D,O){var U=w.stateNode;U.props=D,U.state=w.memoizedState,U.refs=iS,Xd(w);var Y=b.contextType;typeof Y=="object"&&Y!==null?U.context=wa(Y):(Y=Gr(b)?_t:ce.current,U.context=Hr(w,Y)),U.state=w.memoizedState,Y=b.getDerivedStateFromProps,typeof Y=="function"&&(Wx(w,b,Y,D),U.state=w.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(b=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),b!==U.state&&Sv.enqueueReplaceState(U,U.state,null),_v(w,D,U,O),U.state=w.memoizedState),typeof U.componentDidMount=="function"&&(w.flags|=4194308)}var qd=[],su=0,Mv=null,Av=0,_o=[],ka=0,dh=null,Jl=1,$l="";function fh(w,b){qd[su++]=Av,qd[su++]=Mv,Mv=w,Av=b}function sS(w,b,D){_o[ka++]=Jl,_o[ka++]=$l,_o[ka++]=dh,dh=w;var O=Jl;w=$l;var U=32-ya(O)-1;O&=~(1<<U),D+=1;var Y=32-ya(b)+U;if(30<Y){var ye=U-U%5;Y=(O&(1<<ye)-1).toString(32),O>>=ye,U-=ye,Jl=1<<32-ya(b)+U|D<<U|O,$l=Y+w}else Jl=1<<Y|D<<U|O,$l=w}function Yx(w){w.return!==null&&(fh(w,1),sS(w,1,0))}function Qx(w){for(;w===Mv;)Mv=qd[--su],qd[su]=null,Av=qd[--su],qd[su]=null;for(;w===dh;)dh=_o[--ka],_o[ka]=null,$l=_o[--ka],_o[ka]=null,Jl=_o[--ka],_o[ka]=null}var Js=null,us=null,Yr=!1,Yd=!1,So=null;function Zx(w,b){var D=qa(5,null,null,0);D.elementType="DELETED",D.stateNode=b,D.return=w,b=w.deletions,b===null?(w.deletions=[D],w.flags|=16):b.push(D)}function Kx(w,b){switch(w.tag){case 5:return b=mi(b,w.type,w.pendingProps),b!==null?(w.stateNode=b,Js=w,us=ut(b),!0):!1;case 6:return b=Or(b,w.pendingProps),b!==null?(w.stateNode=b,Js=w,us=null,!0):!1;case 13:if(b=bn(b),b!==null){var D=dh!==null?{id:Jl,overflow:$l}:null;return w.memoizedState={dehydrated:b,treeContext:D,retryLane:1073741824},D=qa(18,null,null,0),D.stateNode=b,D.return=w,w.child=D,Js=w,us=null,!0}return!1;default:return!1}}function Ev(w){return(w.mode&1)!==0&&(w.flags&128)===0}function au(w){if(Yr){var b=us;if(b){var D=b;if(!Kx(w,b)){if(Ev(w))throw Error(a(418));b=Ye(D);var O=Js;b&&Kx(w,b)?Zx(O,D):(w.flags=w.flags&-4097|2,Yr=!1,Js=w)}}else{if(Ev(w))throw Error(a(418));w.flags=w.flags&-4097|2,Yr=!1,Js=w}}}function aS(w){for(w=w.return;w!==null&&w.tag!==5&&w.tag!==3&&w.tag!==13;)w=w.return;Js=w}function Xp(w){if(!Ce||w!==Js)return!1;if(!Yr)return aS(w),Yr=!0,!1;if(w.tag!==3&&(w.tag!==5||Rt(w.type)&&!he(w.type,w.memoizedProps))){var b=us;if(b){if(Ev(w)){for(w=us;w;)w=Ye(w);throw Error(a(418))}for(;b;)Zx(w,b),b=Ye(b)}}if(aS(w),w.tag===13){if(!Ce)throw Error(a(316));if(w=w.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(a(317));us=le(w)}else us=Js?Ye(w.stateNode):null;return!0}function Qd(){Ce&&(us=Js=null,Yd=Yr=!1)}function Tv(w){So===null?So=[w]:So.push(w)}function Zd(w,b,D){if(w=D.ref,w!==null&&typeof w!="function"&&typeof w!="object"){if(D._owner){if(D=D._owner,D){if(D.tag!==1)throw Error(a(309));var O=D.stateNode}if(!O)throw Error(a(147,w));var U=O,Y=""+w;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===Y?b.ref:(b=function(ye){var Fe=U.refs;Fe===iS&&(Fe=U.refs={}),ye===null?delete Fe[Y]:Fe[Y]=ye},b._stringRef=Y,b)}if(typeof w!="string")throw Error(a(284));if(!D._owner)throw Error(a(290,w))}return w}function ou(w,b){throw w=Object.prototype.toString.call(b),Error(a(31,w==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":w))}function Kd(w){var b=w._init;return b(w._payload)}function oS(w){function b(it,He){if(w){var ht=it.deletions;ht===null?(it.deletions=[He],it.flags|=16):ht.push(He)}}function D(it,He){if(!w)return null;for(;He!==null;)b(it,He),He=He.sibling;return null}function O(it,He){for(it=new Map;He!==null;)He.key!==null?it.set(He.key,He):it.set(He.index,He),He=He.sibling;return it}function U(it,He){return it=fc(it,He),it.index=0,it.sibling=null,it}function Y(it,He,ht){return it.index=ht,w?(ht=it.alternate,ht!==null?(ht=ht.index,ht<He?(it.flags|=2,He):ht):(it.flags|=2,He)):(it.flags|=1048576,He)}function ye(it){return w&&it.alternate===null&&(it.flags|=2),it}function Fe(it,He,ht,Ht){return He===null||He.tag!==6?(He=e0(ht,it.mode,Ht),He.return=it,He):(He=U(He,ht),He.return=it,He)}function pt(it,He,ht,Ht){var ai=ht.type;return ai===u?Kt(it,He,ht.props.children,Ht,ht.key):He!==null&&(He.elementType===ai||typeof ai=="object"&&ai!==null&&ai.$$typeof===_&&Kd(ai)===He.type)?(Ht=U(He,ht.props),Ht.ref=Zd(it,He,ht),Ht.return=it,Ht):(Ht=$v(ht.type,ht.key,ht.props,null,it.mode,Ht),Ht.ref=Zd(it,He,ht),Ht.return=it,Ht)}function It(it,He,ht,Ht){return He===null||He.tag!==4||He.stateNode.containerInfo!==ht.containerInfo||He.stateNode.implementation!==ht.implementation?(He=t0(ht,it.mode,Ht),He.return=it,He):(He=U(He,ht.children||[]),He.return=it,He)}function Kt(it,He,ht,Ht,ai){return He===null||He.tag!==7?(He=zh(ht,it.mode,Ht,ai),He.return=it,He):(He=U(He,ht),He.return=it,He)}function Ii(it,He,ht){if(typeof He=="string"&&He!==""||typeof He=="number")return He=e0(""+He,it.mode,ht),He.return=it,He;if(typeof He=="object"&&He!==null){switch(He.$$typeof){case l:return ht=$v(He.type,He.key,He.props,null,it.mode,ht),ht.ref=Zd(it,null,He),ht.return=it,ht;case c:return He=t0(He,it.mode,ht),He.return=it,He;case _:var Ht=He._init;return Ii(it,Ht(He._payload),ht)}if(q(He)||E(He))return He=zh(He,it.mode,ht,null),He.return=it,He;ou(it,He)}return null}function vi(it,He,ht,Ht){var ai=He!==null?He.key:null;if(typeof ht=="string"&&ht!==""||typeof ht=="number")return ai!==null?null:Fe(it,He,""+ht,Ht);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case l:return ht.key===ai?pt(it,He,ht,Ht):null;case c:return ht.key===ai?It(it,He,ht,Ht):null;case _:return ai=ht._init,vi(it,He,ai(ht._payload),Ht)}if(q(ht)||E(ht))return ai!==null?null:Kt(it,He,ht,Ht,null);ou(it,ht)}return null}function Hi(it,He,ht,Ht,ai){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return it=it.get(ht)||null,Fe(He,it,""+Ht,ai);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case l:return it=it.get(Ht.key===null?ht:Ht.key)||null,pt(He,it,Ht,ai);case c:return it=it.get(Ht.key===null?ht:Ht.key)||null,It(He,it,Ht,ai);case _:var Ni=Ht._init;return Hi(it,He,ht,Ni(Ht._payload),ai)}if(q(Ht)||E(Ht))return it=it.get(ht)||null,Kt(He,it,Ht,ai,null);ou(He,Ht)}return null}function jt(it,He,ht,Ht){for(var ai=null,Ni=null,Li=He,sr=He=0,Sn=null;Li!==null&&sr<ht.length;sr++){Li.index>sr?(Sn=Li,Li=null):Sn=Li.sibling;var ir=vi(it,Li,ht[sr],Ht);if(ir===null){Li===null&&(Li=Sn);break}w&&Li&&ir.alternate===null&&b(it,Li),He=Y(ir,He,sr),Ni===null?ai=ir:Ni.sibling=ir,Ni=ir,Li=Sn}if(sr===ht.length)return D(it,Li),Yr&&fh(it,sr),ai;if(Li===null){for(;sr<ht.length;sr++)Li=Ii(it,ht[sr],Ht),Li!==null&&(He=Y(Li,He,sr),Ni===null?ai=Li:Ni.sibling=Li,Ni=Li);return Yr&&fh(it,sr),ai}for(Li=O(it,Li);sr<ht.length;sr++)Sn=Hi(Li,it,sr,ht[sr],Ht),Sn!==null&&(w&&Sn.alternate!==null&&Li.delete(Sn.key===null?sr:Sn.key),He=Y(Sn,He,sr),Ni===null?ai=Sn:Ni.sibling=Sn,Ni=Sn);return w&&Li.forEach(function(pc){return b(it,pc)}),Yr&&fh(it,sr),ai}function ms(it,He,ht,Ht){var ai=E(ht);if(typeof ai!="function")throw Error(a(150));if(ht=ai.call(ht),ht==null)throw Error(a(151));for(var Ni=ai=null,Li=He,sr=He=0,Sn=null,ir=ht.next();Li!==null&&!ir.done;sr++,ir=ht.next()){Li.index>sr?(Sn=Li,Li=null):Sn=Li.sibling;var pc=vi(it,Li,ir.value,Ht);if(pc===null){Li===null&&(Li=Sn);break}w&&Li&&pc.alternate===null&&b(it,Li),He=Y(pc,He,sr),Ni===null?ai=pc:Ni.sibling=pc,Ni=pc,Li=Sn}if(ir.done)return D(it,Li),Yr&&fh(it,sr),ai;if(Li===null){for(;!ir.done;sr++,ir=ht.next())ir=Ii(it,ir.value,Ht),ir!==null&&(He=Y(ir,He,sr),Ni===null?ai=ir:Ni.sibling=ir,Ni=ir);return Yr&&fh(it,sr),ai}for(Li=O(it,Li);!ir.done;sr++,ir=ht.next())ir=Hi(Li,it,sr,ir.value,Ht),ir!==null&&(w&&ir.alternate!==null&&Li.delete(ir.key===null?sr:ir.key),He=Y(ir,He,sr),Ni===null?ai=ir:Ni.sibling=ir,Ni=ir);return w&&Li.forEach(function(C1){return b(it,C1)}),Yr&&fh(it,sr),ai}function Ya(it,He,ht,Ht){if(typeof ht=="object"&&ht!==null&&ht.type===u&&ht.key===null&&(ht=ht.props.children),typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case l:e:{for(var ai=ht.key,Ni=He;Ni!==null;){if(Ni.key===ai){if(ai=ht.type,ai===u){if(Ni.tag===7){D(it,Ni.sibling),He=U(Ni,ht.props.children),He.return=it,it=He;break e}}else if(Ni.elementType===ai||typeof ai=="object"&&ai!==null&&ai.$$typeof===_&&Kd(ai)===Ni.type){D(it,Ni.sibling),He=U(Ni,ht.props),He.ref=Zd(it,Ni,ht),He.return=it,it=He;break e}D(it,Ni);break}else b(it,Ni);Ni=Ni.sibling}ht.type===u?(He=zh(ht.props.children,it.mode,Ht,ht.key),He.return=it,it=He):(Ht=$v(ht.type,ht.key,ht.props,null,it.mode,Ht),Ht.ref=Zd(it,He,ht),Ht.return=it,it=Ht)}return ye(it);case c:e:{for(Ni=ht.key;He!==null;){if(He.key===Ni)if(He.tag===4&&He.stateNode.containerInfo===ht.containerInfo&&He.stateNode.implementation===ht.implementation){D(it,He.sibling),He=U(He,ht.children||[]),He.return=it,it=He;break e}else{D(it,He);break}else b(it,He);He=He.sibling}He=t0(ht,it.mode,Ht),He.return=it,it=He}return ye(it);case _:return Ni=ht._init,Ya(it,He,Ni(ht._payload),Ht)}if(q(ht))return jt(it,He,ht,Ht);if(E(ht))return ms(it,He,ht,Ht);ou(it,ht)}return typeof ht=="string"&&ht!==""||typeof ht=="number"?(ht=""+ht,He!==null&&He.tag===6?(D(it,He.sibling),He=U(He,ht),He.return=it,it=He):(D(it,He),He=e0(ht,it.mode,Ht),He.return=it,it=He),ye(it)):D(it,He)}return Ya}var ec=oS(!0),lS=oS(!1),Jd={},ba=lr(Jd),ph=lr(Jd),mh=lr(Jd);function Zo(w){if(w===Jd)throw Error(a(174));return w}function Cv(w,b){te(mh,b),te(ph,w),te(ba,Jd),w=Q(b),Z(ba),te(ba,w)}function $d(){Z(ba),Z(ph),Z(mh)}function cS(w){var b=Zo(mh.current),D=Zo(ba.current);b=W(D,w.type,b),D!==b&&(te(ph,w),te(ba,b))}function Jx(w){ph.current===w&&(Z(ba),Z(ph))}var en=lr(0);function Pv(w){for(var b=w;b!==null;){if(b.tag===13){var D=b.memoizedState;if(D!==null&&(D=D.dehydrated,D===null||Yl(D)||Qs(D)))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===w)break;for(;b.sibling===null;){if(b.return===null||b.return===w)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Va=[];function gh(){for(var w=0;w<Va.length;w++){var b=Va[w];Me?b._workInProgressVersionPrimary=null:b._workInProgressVersionSecondary=null}Va.length=0}var qp=o.ReactCurrentDispatcher,Ha=o.ReactCurrentBatchConfig,vh=0,tn=null,Wn=null,Xn=null,Dv=!1,yl=!1,yh=0,Yp=0;function qn(){throw Error(a(321))}function Rv(w,b){if(b===null)return!1;for(var D=0;D<b.length&&D<w.length;D++)if(!Zs(w[D],b[D]))return!1;return!0}function ef(w,b,D,O,U,Y){if(vh=Y,tn=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,qp.current=w===null||w.memoizedState===null?n1:s1,w=D(O,U),yl){Y=0;do{if(yl=!1,yh=0,25<=Y)throw Error(a(301));Y+=1,Xn=Wn=null,b.updateQueue=null,qp.current=a1,w=D(O,U)}while(yl)}if(qp.current=sf,b=Wn!==null&&Wn.next!==null,vh=0,Xn=Wn=tn=null,Dv=!1,b)throw Error(a(300));return w}function lu(){var w=yh!==0;return yh=0,w}function Ko(){var w={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xn===null?tn.memoizedState=Xn=w:Xn=Xn.next=w,Xn}function Jo(){if(Wn===null){var w=tn.alternate;w=w!==null?w.memoizedState:null}else w=Wn.next;var b=Xn===null?tn.memoizedState:Xn.next;if(b!==null)Xn=b,Wn=w;else{if(w===null)throw Error(a(310));Wn=w,w={memoizedState:Wn.memoizedState,baseState:Wn.baseState,baseQueue:Wn.baseQueue,queue:Wn.queue,next:null},Xn===null?tn.memoizedState=Xn=w:Xn=Xn.next=w}return Xn}function xl(w,b){return typeof b=="function"?b(w):b}function Qp(w){var b=Jo(),D=b.queue;if(D===null)throw Error(a(311));D.lastRenderedReducer=w;var O=Wn,U=O.baseQueue,Y=D.pending;if(Y!==null){if(U!==null){var ye=U.next;U.next=Y.next,Y.next=ye}O.baseQueue=U=Y,D.pending=null}if(U!==null){Y=U.next,O=O.baseState;var Fe=ye=null,pt=null,It=Y;do{var Kt=It.lane;if((vh&Kt)===Kt)pt!==null&&(pt=pt.next={lane:0,action:It.action,hasEagerState:It.hasEagerState,eagerState:It.eagerState,next:null}),O=It.hasEagerState?It.eagerState:w(O,It.action);else{var Ii={lane:Kt,action:It.action,hasEagerState:It.hasEagerState,eagerState:It.eagerState,next:null};pt===null?(Fe=pt=Ii,ye=O):pt=pt.next=Ii,tn.lanes|=Kt,bl|=Kt}It=It.next}while(It!==null&&It!==Y);pt===null?ye=O:pt.next=Fe,Zs(O,b.memoizedState)||(Yn=!0),b.memoizedState=O,b.baseState=ye,b.baseQueue=pt,D.lastRenderedState=O}if(w=D.interleaved,w!==null){U=w;do Y=U.lane,tn.lanes|=Y,bl|=Y,U=U.next;while(U!==w)}else U===null&&(D.lanes=0);return[b.memoizedState,D.dispatch]}function Zp(w){var b=Jo(),D=b.queue;if(D===null)throw Error(a(311));D.lastRenderedReducer=w;var O=D.dispatch,U=D.pending,Y=b.memoizedState;if(U!==null){D.pending=null;var ye=U=U.next;do Y=w(Y,ye.action),ye=ye.next;while(ye!==U);Zs(Y,b.memoizedState)||(Yn=!0),b.memoizedState=Y,b.baseQueue===null&&(b.baseState=Y),D.lastRenderedState=Y}return[Y,O]}function $x(){}function e1(w,b){var D=tn,O=Jo(),U=b(),Y=!Zs(O.memoizedState,U);if(Y&&(O.memoizedState=U,Yn=!0),O=O.queue,tf(tc.bind(null,D,O,w),[w]),O.getSnapshot!==b||Y||Xn!==null&&Xn.memoizedState.tag&1){if(D.flags|=2048,Jp(9,i1.bind(null,D,O,U,b),void 0,null),mn===null)throw Error(a(349));(vh&30)!==0||t1(D,b,U)}return U}function t1(w,b,D){w.flags|=16384,w={getSnapshot:b,value:D},b=tn.updateQueue,b===null?(b={lastEffect:null,stores:null},tn.updateQueue=b,b.stores=[w]):(D=b.stores,D===null?b.stores=[w]:D.push(w))}function i1(w,b,D,O){b.value=D,b.getSnapshot=O,Iv(b)&&Ls(w,1,-1)}function tc(w,b,D){return D(function(){Iv(b)&&Ls(w,1,-1)})}function Iv(w){var b=w.getSnapshot;w=w.value;try{var D=b();return!Zs(w,D)}catch{return!0}}function Kp(w){var b=Ko();return typeof w=="function"&&(w=w()),b.memoizedState=b.baseState=w,w={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:w},b.queue=w,w=w.dispatch=DC.bind(null,tn,w),[b.memoizedState,w]}function Jp(w,b,D,O){return w={tag:w,create:b,destroy:D,deps:O,next:null},b=tn.updateQueue,b===null?(b={lastEffect:null,stores:null},tn.updateQueue=b,b.lastEffect=w.next=w):(D=b.lastEffect,D===null?b.lastEffect=w.next=w:(O=D.next,D.next=w,w.next=O,b.lastEffect=w)),w}function uS(){return Jo().memoizedState}function cu(w,b,D,O){var U=Ko();tn.flags|=w,U.memoizedState=Jp(1|b,D,void 0,O===void 0?null:O)}function Lv(w,b,D,O){var U=Jo();O=O===void 0?null:O;var Y=void 0;if(Wn!==null){var ye=Wn.memoizedState;if(Y=ye.destroy,O!==null&&Rv(O,ye.deps)){U.memoizedState=Jp(b,D,Y,O);return}}tn.flags|=w,U.memoizedState=Jp(1|b,D,Y,O)}function Ov(w,b){return cu(8390656,8,w,b)}function tf(w,b){return Lv(2048,8,w,b)}function zr(w,b){return Lv(4,2,w,b)}function zv(w,b){return Lv(4,4,w,b)}function $p(w,b){if(typeof b=="function")return w=w(),b(w),function(){b(null)};if(b!=null)return w=w(),b.current=w,function(){b.current=null}}function rf(w,b,D){return D=D!=null?D.concat([w]):null,Lv(4,4,$p.bind(null,b,w),D)}function Bv(){}function Nv(w,b){var D=Jo();b=b===void 0?null:b;var O=D.memoizedState;return O!==null&&b!==null&&Rv(b,O[1])?O[0]:(D.memoizedState=[w,b],w)}function nf(w,b){var D=Jo();b=b===void 0?null:b;var O=D.memoizedState;return O!==null&&b!==null&&Rv(b,O[1])?O[0]:(w=w(),D.memoizedState=[w,b],w)}function Uv(w,b){var D=ji;ji=D!==0&&4>D?D:4,w(!0);var O=Ha.transition;Ha.transition={};try{w(!1),b()}finally{ji=D,Ha.transition=O}}function xh(){return Jo().memoizedState}function hS(w,b,D){var O=il(w);D={lane:O,action:D,hasEagerState:!1,eagerState:null,next:null},dS(w)?r1(b,D):(em(w,b,D),D=ur(),w=Ls(w,O,D),w!==null&&tm(w,b,O))}function DC(w,b,D){var O=il(w),U={lane:O,action:D,hasEagerState:!1,eagerState:null,next:null};if(dS(w))r1(b,U);else{em(w,b,U);var Y=w.alternate;if(w.lanes===0&&(Y===null||Y.lanes===0)&&(Y=b.lastRenderedReducer,Y!==null))try{var ye=b.lastRenderedState,Fe=Y(ye,D);if(U.hasEagerState=!0,U.eagerState=Fe,Zs(Fe,ye))return}catch{}finally{}D=ur(),w=Ls(w,O,D),w!==null&&tm(w,b,O)}}function dS(w){var b=w.alternate;return w===tn||b!==null&&b===tn}function r1(w,b){yl=Dv=!0;var D=w.pending;D===null?b.next=b:(b.next=D.next,D.next=b),w.pending=b}function em(w,b,D){mn!==null&&(w.mode&1)!==0&&(ki&2)===0?(w=b.interleaved,w===null?(D.next=D,wo===null?wo=[b]:wo.push(b)):(D.next=w.next,w.next=D),b.interleaved=D):(w=b.pending,w===null?D.next=D:(D.next=w.next,w.next=D),b.pending=D)}function tm(w,b,D){if((D&4194240)!==0){var O=b.lanes;O&=w.pendingLanes,D|=O,b.lanes=D,gl(w,D)}}var sf={readContext:wa,useCallback:qn,useContext:qn,useEffect:qn,useImperativeHandle:qn,useInsertionEffect:qn,useLayoutEffect:qn,useMemo:qn,useReducer:qn,useRef:qn,useState:qn,useDebugValue:qn,useDeferredValue:qn,useTransition:qn,useMutableSource:qn,useSyncExternalStore:qn,useId:qn,unstable_isNewReconciler:!1},n1={readContext:wa,useCallback:function(w,b){return Ko().memoizedState=[w,b===void 0?null:b],w},useContext:wa,useEffect:Ov,useImperativeHandle:function(w,b,D){return D=D!=null?D.concat([w]):null,cu(4194308,4,$p.bind(null,b,w),D)},useLayoutEffect:function(w,b){return cu(4194308,4,w,b)},useInsertionEffect:function(w,b){return cu(4,2,w,b)},useMemo:function(w,b){var D=Ko();return b=b===void 0?null:b,w=w(),D.memoizedState=[w,b],w},useReducer:function(w,b,D){var O=Ko();return b=D!==void 0?D(b):b,O.memoizedState=O.baseState=b,w={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:w,lastRenderedState:b},O.queue=w,w=w.dispatch=hS.bind(null,tn,w),[O.memoizedState,w]},useRef:function(w){var b=Ko();return w={current:w},b.memoizedState=w},useState:Kp,useDebugValue:Bv,useDeferredValue:function(w){var b=Kp(w),D=b[0],O=b[1];return Ov(function(){var U=Ha.transition;Ha.transition={};try{O(w)}finally{Ha.transition=U}},[w]),D},useTransition:function(){var w=Kp(!1),b=w[0];return w=Uv.bind(null,w[1]),Ko().memoizedState=w,[b,w]},useMutableSource:function(){},useSyncExternalStore:function(w,b,D){var O=tn,U=Ko();if(Yr){if(D===void 0)throw Error(a(407));D=D()}else{if(D=b(),mn===null)throw Error(a(349));(vh&30)!==0||t1(O,b,D)}U.memoizedState=D;var Y={value:D,getSnapshot:b};return U.queue=Y,Ov(tc.bind(null,O,Y,w),[w]),O.flags|=2048,Jp(9,i1.bind(null,O,Y,D,b),void 0,null),D},useId:function(){var w=Ko(),b=mn.identifierPrefix;if(Yr){var D=$l,O=Jl;D=(O&~(1<<32-ya(O)-1)).toString(32)+D,b=":"+b+"R"+D,D=yh++,0<D&&(b+="H"+D.toString(32)),b+=":"}else D=Yp++,b=":"+b+"r"+D.toString(32)+":";return w.memoizedState=b},unstable_isNewReconciler:!1},s1={readContext:wa,useCallback:Nv,useContext:wa,useEffect:tf,useImperativeHandle:rf,useInsertionEffect:zr,useLayoutEffect:zv,useMemo:nf,useReducer:Qp,useRef:uS,useState:function(){return Qp(xl)},useDebugValue:Bv,useDeferredValue:function(w){var b=Qp(xl),D=b[0],O=b[1];return tf(function(){var U=Ha.transition;Ha.transition={};try{O(w)}finally{Ha.transition=U}},[w]),D},useTransition:function(){var w=Qp(xl)[0],b=Jo().memoizedState;return[w,b]},useMutableSource:$x,useSyncExternalStore:e1,useId:xh,unstable_isNewReconciler:!1},a1={readContext:wa,useCallback:Nv,useContext:wa,useEffect:tf,useImperativeHandle:rf,useInsertionEffect:zr,useLayoutEffect:zv,useMemo:nf,useReducer:Zp,useRef:uS,useState:function(){return Zp(xl)},useDebugValue:Bv,useDeferredValue:function(w){var b=Zp(xl),D=b[0],O=b[1];return tf(function(){var U=Ha.transition;Ha.transition={};try{O(w)}finally{Ha.transition=U}},[w]),D},useTransition:function(){var w=Zp(xl)[0],b=Jo().memoizedState;return[w,b]},useMutableSource:$x,useSyncExternalStore:e1,useId:xh,unstable_isNewReconciler:!1};function o1(w,b){try{var D="",O=b;do D+=Gx(O),O=O.return;while(O);var U=D}catch(Y){U=`
Error generating stack: `+Y.message+`
`+Y.stack}return{value:w,source:b,stack:U}}function Fv(w,b){try{console.error(b.value)}catch(D){setTimeout(function(){throw D})}}var RC=typeof WeakMap=="function"?WeakMap:Map;function fS(w,b,D){D=Kl(-1,D),D.tag=3,D.payload={element:null};var O=b.value;return D.callback=function(){hf||(hf=!0,Wr=O),Fv(w,b)},D}function kv(w,b,D){D=Kl(-1,D),D.tag=3;var O=w.type.getDerivedStateFromError;if(typeof O=="function"){var U=b.value;D.payload=function(){return O(U)},D.callback=function(){Fv(w,b)}}var Y=w.stateNode;return Y!==null&&typeof Y.componentDidCatch=="function"&&(D.callback=function(){Fv(w,b),typeof O!="function"&&(tl===null?tl=new Set([this]):tl.add(this));var ye=b.stack;this.componentDidCatch(b.value,{componentStack:ye!==null?ye:""})}),D}function ic(w,b,D){var O=w.pingCache;if(O===null){O=w.pingCache=new RC;var U=new Set;O.set(b,U)}else U=O.get(b),U===void 0&&(U=new Set,O.set(b,U));U.has(D)||(U.add(D),w=A1.bind(null,w,b,D),b.then(w,w))}function l1(w){do{var b;if((b=w.tag===13)&&(b=w.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return w;w=w.return}while(w!==null);return null}function wh(w,b,D,O,U){return(w.mode&1)===0?(w===b?w.flags|=65536:(w.flags|=128,D.flags|=131072,D.flags&=-52805,D.tag===1&&(D.alternate===null?D.tag=17:(b=Kl(-1,1),b.tag=2,nu(D,b))),D.lanes|=1),w):(w.flags|=65536,w.lanes=U,w)}function Ln(w){w.flags|=4}function af(w,b){if(w!==null&&w.child===b.child)return!0;if((b.flags&16)!==0)return!1;for(w=b.child;w!==null;){if((w.flags&12854)!==0||(w.subtreeFlags&12854)!==0)return!1;w=w.sibling}return!0}var Ga,bh,Vv,Hv;if(Te)Ga=function(w,b){for(var D=b.child;D!==null;){if(D.tag===5||D.tag===6)$(w,D.stateNode);else if(D.tag!==4&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===b)break;for(;D.sibling===null;){if(D.return===null||D.return===b)return;D=D.return}D.sibling.return=D.return,D=D.sibling}},bh=function(){},Vv=function(w,b,D,O,U){if(w=w.memoizedProps,w!==O){var Y=b.stateNode,ye=Zo(ba.current);D=re(Y,D,w,O,U,ye),(b.updateQueue=D)&&Ln(b)}},Hv=function(w,b,D,O){D!==O&&Ln(b)};else if(ae){Ga=function(w,b,D,O){for(var U=b.child;U!==null;){if(U.tag===5){var Y=U.stateNode;D&&O&&(Y=ci(Y,U.type,U.memoizedProps,U)),$(w,Y)}else if(U.tag===6)Y=U.stateNode,D&&O&&(Y=Qi(Y,U.memoizedProps,U)),$(w,Y);else if(U.tag!==4){if(U.tag===22&&U.memoizedState!==null)Y=U.child,Y!==null&&(Y.return=U),Ga(w,U,!0,!0);else if(U.child!==null){U.child.return=U,U=U.child;continue}}if(U===b)break;for(;U.sibling===null;){if(U.return===null||U.return===b)return;U=U.return}U.sibling.return=U.return,U=U.sibling}};var uu=function(w,b,D,O){for(var U=b.child;U!==null;){if(U.tag===5){var Y=U.stateNode;D&&O&&(Y=ci(Y,U.type,U.memoizedProps,U)),bt(w,Y)}else if(U.tag===6)Y=U.stateNode,D&&O&&(Y=Qi(Y,U.memoizedProps,U)),bt(w,Y);else if(U.tag!==4){if(U.tag===22&&U.memoizedState!==null)Y=U.child,Y!==null&&(Y.return=U),uu(w,U,!0,!0);else if(U.child!==null){U.child.return=U,U=U.child;continue}}if(U===b)break;for(;U.sibling===null;){if(U.return===null||U.return===b)return;U=U.return}U.sibling.return=U.return,U=U.sibling}};bh=function(w,b){var D=b.stateNode;if(!af(w,b)){w=D.containerInfo;var O=Ze(w);uu(O,b,!1,!1),D.pendingChildren=O,Ln(b),Ft(w,O)}},Vv=function(w,b,D,O,U){var Y=w.stateNode,ye=w.memoizedProps;if((w=af(w,b))&&ye===O)b.stateNode=Y;else{var Fe=b.stateNode,pt=Zo(ba.current),It=null;ye!==O&&(It=re(Fe,D,ye,O,U,pt)),w&&It===null?b.stateNode=Y:(Y=at(Y,It,D,ye,O,b,w,Fe),se(Y,D,O,U,pt)&&Ln(b),b.stateNode=Y,w?Ln(b):Ga(Y,b,!1,!1))}},Hv=function(w,b,D,O){D!==O?(w=Zo(mh.current),D=Zo(ba.current),b.stateNode=oe(O,w,D,b),Ln(b)):b.stateNode=w.stateNode}}else bh=function(){},Vv=function(){},Hv=function(){};function rc(w,b){if(!Yr)switch(w.tailMode){case"hidden":b=w.tail;for(var D=null;b!==null;)b.alternate!==null&&(D=b),b=b.sibling;D===null?w.tail=null:D.sibling=null;break;case"collapsed":D=w.tail;for(var O=null;D!==null;)D.alternate!==null&&(O=D),D=D.sibling;O===null?b||w.tail===null?w.tail=null:w.tail.sibling=null:O.sibling=null}}function pn(w){var b=w.alternate!==null&&w.alternate.child===w.child,D=0,O=0;if(b)for(var U=w.child;U!==null;)D|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=w,U=U.sibling;else for(U=w.child;U!==null;)D|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=w,U=U.sibling;return w.subtreeFlags|=O,w.childLanes=D,b}function Gv(w,b,D){var O=b.pendingProps;switch(Qx(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(b),null;case 1:return Gr(b.type)&&gr(),pn(b),null;case 3:return O=b.stateNode,$d(),Z(De),Z(ce),gh(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(w===null||w.child===null)&&(Xp(b)?Ln(b):w===null||w.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,So!==null&&(pm(So),So=null))),bh(w,b),pn(b),null;case 5:Jx(b),D=Zo(mh.current);var U=b.type;if(w!==null&&b.stateNode!=null)Vv(w,b,U,O,D),w.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!O){if(b.stateNode===null)throw Error(a(166));return pn(b),null}if(w=Zo(ba.current),Xp(b)){if(!Ce)throw Error(a(175));w=Yt(b.stateNode,b.type,b.memoizedProps,D,w,b,!Yd),b.updateQueue=w,w!==null&&Ln(b)}else{var Y=j(U,O,D,w,b);Ga(Y,b,!1,!1),b.stateNode=Y,se(Y,U,O,D,w)&&Ln(b)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return pn(b),null;case 6:if(w&&b.stateNode!=null)Hv(w,b,w.memoizedProps,O);else{if(typeof O!="string"&&b.stateNode===null)throw Error(a(166));if(w=Zo(mh.current),D=Zo(ba.current),Xp(b)){if(!Ce)throw Error(a(176));if(w=b.stateNode,O=b.memoizedProps,(D=oi(w,O,b,!Yd))&&(U=Js,U!==null))switch(Y=(U.mode&1)!==0,U.tag){case 3:Xt(U.stateNode.containerInfo,w,O,Y);break;case 5:ri(U.type,U.memoizedProps,U.stateNode,w,O,Y)}D&&Ln(b)}else b.stateNode=oe(O,w,D,b)}return pn(b),null;case 13:if(Z(en),O=b.memoizedState,Yr&&us!==null&&(b.mode&1)!==0&&(b.flags&128)===0){for(w=us;w;)w=Ye(w);return Qd(),b.flags|=98560,b}if(O!==null&&O.dehydrated!==null){if(O=Xp(b),w===null){if(!O)throw Error(a(318));if(!Ce)throw Error(a(344));if(w=b.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(a(317));gi(w,b)}else Qd(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;return pn(b),null}return So!==null&&(pm(So),So=null),(b.flags&128)!==0?(b.lanes=D,b):(O=O!==null,D=!1,w===null?Xp(b):D=w.memoizedState!==null,O&&!D&&(b.child.flags|=8192,(b.mode&1)!==0&&(w===null||(en.current&1)!==0?on===0&&(on=3):Zv())),b.updateQueue!==null&&(b.flags|=4),pn(b),null);case 4:return $d(),bh(w,b),w===null&&Be(b.stateNode.containerInfo),pn(b),null;case 10:return Wp(b.type._context),pn(b),null;case 17:return Gr(b.type)&&gr(),pn(b),null;case 19:if(Z(en),U=b.memoizedState,U===null)return pn(b),null;if(O=(b.flags&128)!==0,Y=U.rendering,Y===null)if(O)rc(U,!1);else{if(on!==0||w!==null&&(w.flags&128)!==0)for(w=b.child;w!==null;){if(Y=Pv(w),Y!==null){for(b.flags|=128,rc(U,!1),w=Y.updateQueue,w!==null&&(b.updateQueue=w,b.flags|=4),b.subtreeFlags=0,w=D,O=b.child;O!==null;)D=O,U=w,D.flags&=14680066,Y=D.alternate,Y===null?(D.childLanes=0,D.lanes=U,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=Y.childLanes,D.lanes=Y.lanes,D.child=Y.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=Y.memoizedProps,D.memoizedState=Y.memoizedState,D.updateQueue=Y.updateQueue,D.type=Y.type,U=Y.dependencies,D.dependencies=U===null?null:{lanes:U.lanes,firstContext:U.firstContext}),O=O.sibling;return te(en,en.current&1|2),b.child}w=w.sibling}U.tail!==null&&In()>fu&&(b.flags|=128,O=!0,rc(U,!1),b.lanes=4194304)}else{if(!O)if(w=Pv(Y),w!==null){if(b.flags|=128,O=!0,w=w.updateQueue,w!==null&&(b.updateQueue=w,b.flags|=4),rc(U,!0),U.tail===null&&U.tailMode==="hidden"&&!Y.alternate&&!Yr)return pn(b),null}else 2*In()-U.renderingStartTime>fu&&D!==1073741824&&(b.flags|=128,O=!0,rc(U,!1),b.lanes=4194304);U.isBackwards?(Y.sibling=b.child,b.child=Y):(w=U.last,w!==null?w.sibling=Y:b.child=Y,U.last=Y)}return U.tail!==null?(b=U.tail,U.rendering=b,U.tail=b.sibling,U.renderingStartTime=In(),b.sibling=null,w=en.current,te(en,O?w&1|2:w&1),b):(pn(b),null);case 22:case 23:return mm(),O=b.memoizedState!==null,w!==null&&w.memoizedState!==null!==O&&(b.flags|=8192),O&&(b.mode&1)!==0?(Is&1073741824)!==0&&(pn(b),Te&&b.subtreeFlags&6&&(b.flags|=8192)):pn(b),null;case 24:return null;case 25:return null}throw Error(a(156,b.tag))}var c1=o.ReactCurrentOwner,Yn=!1;function an(w,b,D,O){b.child=w===null?lS(b,null,D,O):ec(b,w.child,D,O)}function Br(w,b,D,O,U){D=D.render;var Y=b.ref;return Wd(b,U),O=ef(w,b,D,O,Y,U),D=lu(),w!==null&&!Yn?(b.updateQueue=w.updateQueue,b.flags&=-2053,w.lanes&=~U,_a(w,b,U)):(Yr&&D&&Yx(b),b.flags|=1,an(w,b,O,U),b.child)}function Ar(w,b,D,O,U){if(w===null){var Y=D.type;return typeof Y=="function"&&!Jv(Y)&&Y.defaultProps===void 0&&D.compare===null&&D.defaultProps===void 0?(b.tag=15,b.type=Y,nc(w,b,Y,O,U)):(w=$v(D.type,null,O,b,b.mode,U),w.ref=b.ref,w.return=b,b.child=w)}if(Y=w.child,(w.lanes&U)===0){var ye=Y.memoizedProps;if(D=D.compare,D=D!==null?D:Qo,D(ye,O)&&w.ref===b.ref)return _a(w,b,U)}return b.flags|=1,w=fc(Y,O),w.ref=b.ref,w.return=b,b.child=w}function nc(w,b,D,O,U){if(w!==null&&Qo(w.memoizedProps,O)&&w.ref===b.ref)if(Yn=!1,(w.lanes&U)!==0)(w.flags&131072)!==0&&(Yn=!0);else return b.lanes=w.lanes,_a(w,b,U);return sc(w,b,D,O,U)}function hs(w,b,D){var O=b.pendingProps,U=O.children,Y=w!==null?w.memoizedState:null;if(O.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null},te(Dh,Is),Is|=D;else if((D&1073741824)!==0)b.memoizedState={baseLanes:0,cachePool:null},O=Y!==null?Y.baseLanes:D,te(Dh,Is),Is|=O;else return w=Y!==null?Y.baseLanes|D:D,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:w,cachePool:null},b.updateQueue=null,te(Dh,Is),Is|=w,null;else Y!==null?(O=Y.baseLanes|D,b.memoizedState=null):O=D,te(Dh,Is),Is|=O;return an(w,b,U,D),b.child}function $s(w,b){var D=b.ref;(w===null&&D!==null||w!==null&&w.ref!==D)&&(b.flags|=512,b.flags|=2097152)}function sc(w,b,D,O,U){var Y=Gr(D)?_t:ce.current;return Y=Hr(b,Y),Wd(b,U),D=ef(w,b,D,O,Y,U),O=lu(),w!==null&&!Yn?(b.updateQueue=w.updateQueue,b.flags&=-2053,w.lanes&=~U,_a(w,b,U)):(Yr&&O&&Yx(b),b.flags|=1,an(w,b,D,U),b.child)}function _h(w,b,D,O,U){if(Gr(D)){var Y=!0;fn(b)}else Y=!1;if(Wd(b,U),b.stateNode===null)w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),rS(b,D,O),qx(b,D,O,U),O=!0;else if(w===null){var ye=b.stateNode,Fe=b.memoizedProps;ye.props=Fe;var pt=ye.context,It=D.contextType;typeof It=="object"&&It!==null?It=wa(It):(It=Gr(D)?_t:ce.current,It=Hr(b,It));var Kt=D.getDerivedStateFromProps,Ii=typeof Kt=="function"||typeof ye.getSnapshotBeforeUpdate=="function";Ii||typeof ye.UNSAFE_componentWillReceiveProps!="function"&&typeof ye.componentWillReceiveProps!="function"||(Fe!==O||pt!==It)&&nS(b,ye,O,It),bo=!1;var vi=b.memoizedState;ye.state=vi,_v(b,O,ye,U),pt=b.memoizedState,Fe!==O||vi!==pt||De.current||bo?(typeof Kt=="function"&&(Wx(b,D,Kt,O),pt=b.memoizedState),(Fe=bo||Xx(b,D,Fe,O,vi,pt,It))?(Ii||typeof ye.UNSAFE_componentWillMount!="function"&&typeof ye.componentWillMount!="function"||(typeof ye.componentWillMount=="function"&&ye.componentWillMount(),typeof ye.UNSAFE_componentWillMount=="function"&&ye.UNSAFE_componentWillMount()),typeof ye.componentDidMount=="function"&&(b.flags|=4194308)):(typeof ye.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=O,b.memoizedState=pt),ye.props=O,ye.state=pt,ye.context=It,O=Fe):(typeof ye.componentDidMount=="function"&&(b.flags|=4194308),O=!1)}else{ye=b.stateNode,jx(w,b),Fe=b.memoizedProps,It=b.type===b.elementType?Fe:xa(b.type,Fe),ye.props=It,Ii=b.pendingProps,vi=ye.context,pt=D.contextType,typeof pt=="object"&&pt!==null?pt=wa(pt):(pt=Gr(D)?_t:ce.current,pt=Hr(b,pt));var Hi=D.getDerivedStateFromProps;(Kt=typeof Hi=="function"||typeof ye.getSnapshotBeforeUpdate=="function")||typeof ye.UNSAFE_componentWillReceiveProps!="function"&&typeof ye.componentWillReceiveProps!="function"||(Fe!==Ii||vi!==pt)&&nS(b,ye,O,pt),bo=!1,vi=b.memoizedState,ye.state=vi,_v(b,O,ye,U);var jt=b.memoizedState;Fe!==Ii||vi!==jt||De.current||bo?(typeof Hi=="function"&&(Wx(b,D,Hi,O),jt=b.memoizedState),(It=bo||Xx(b,D,It,O,vi,jt,pt)||!1)?(Kt||typeof ye.UNSAFE_componentWillUpdate!="function"&&typeof ye.componentWillUpdate!="function"||(typeof ye.componentWillUpdate=="function"&&ye.componentWillUpdate(O,jt,pt),typeof ye.UNSAFE_componentWillUpdate=="function"&&ye.UNSAFE_componentWillUpdate(O,jt,pt)),typeof ye.componentDidUpdate=="function"&&(b.flags|=4),typeof ye.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof ye.componentDidUpdate!="function"||Fe===w.memoizedProps&&vi===w.memoizedState||(b.flags|=4),typeof ye.getSnapshotBeforeUpdate!="function"||Fe===w.memoizedProps&&vi===w.memoizedState||(b.flags|=1024),b.memoizedProps=O,b.memoizedState=jt),ye.props=O,ye.state=jt,ye.context=pt,O=It):(typeof ye.componentDidUpdate!="function"||Fe===w.memoizedProps&&vi===w.memoizedState||(b.flags|=4),typeof ye.getSnapshotBeforeUpdate!="function"||Fe===w.memoizedProps&&vi===w.memoizedState||(b.flags|=1024),O=!1)}return Rs(w,b,D,O,Y,U)}function Rs(w,b,D,O,U,Y){$s(w,b);var ye=(b.flags&128)!==0;if(!O&&!ye)return U&&iu(b,D,!1),_a(w,b,Y);O=b.stateNode,c1.current=b;var Fe=ye&&typeof D.getDerivedStateFromError!="function"?null:O.render();return b.flags|=1,w!==null&&ye?(b.child=ec(b,w.child,null,Y),b.child=ec(b,null,Fe,Y)):an(w,b,Fe,Y),b.memoizedState=O.state,U&&iu(b,D,!0),b.child}function im(w){var b=w.stateNode;b.pendingContext?cs(w,b.pendingContext,b.pendingContext!==b.context):b.context&&cs(w,b.context,!1),Cv(w,b.containerInfo)}function u1(w,b,D,O,U){return Qd(),Tv(U),b.flags|=256,an(w,b,D,O),b.child}var rm={dehydrated:null,treeContext:null,retryLane:0};function Sh(w){return{baseLanes:w,cachePool:null}}function h1(w,b,D){var O=b.pendingProps,U=en.current,Y=!1,ye=(b.flags&128)!==0,Fe;if((Fe=ye)||(Fe=w!==null&&w.memoizedState===null?!1:(U&2)!==0),Fe?(Y=!0,b.flags&=-129):(w===null||w.memoizedState!==null)&&(U|=1),te(en,U&1),w===null)return au(b),w=b.memoizedState,w!==null&&(w=w.dehydrated,w!==null)?((b.mode&1)===0?b.lanes=1:Qs(w)?b.lanes=8:b.lanes=1073741824,null):(U=O.children,w=O.fallback,Y?(O=b.mode,Y=b.child,U={mode:"hidden",children:U},(O&1)===0&&Y!==null?(Y.childLanes=0,Y.pendingProps=U):Y=ym(U,O,0,null),w=zh(w,O,D,null),Y.return=b,w.return=b,Y.sibling=w,b.child=Y,b.child.memoizedState=Sh(D),b.memoizedState=rm,w):$o(b,U));if(U=w.memoizedState,U!==null){if(Fe=U.dehydrated,Fe!==null){if(ye)return b.flags&256?(b.flags&=-257,sm(w,b,D,Error(a(422)))):b.memoizedState!==null?(b.child=w.child,b.flags|=128,null):(Y=O.fallback,U=b.mode,O=ym({mode:"visible",children:O.children},U,0,null),Y=zh(Y,U,D,null),Y.flags|=2,O.return=b,Y.return=b,O.sibling=Y,b.child=O,(b.mode&1)!==0&&ec(b,w.child,null,D),b.child.memoizedState=Sh(D),b.memoizedState=rm,Y);if((b.mode&1)===0)b=sm(w,b,D,null);else if(Qs(Fe))b=sm(w,b,D,Error(a(419)));else if(O=(D&w.childLanes)!==0,Yn||O){if(O=mn,O!==null){switch(D&-D){case 4:Y=2;break;case 16:Y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Y=32;break;case 536870912:Y=268435456;break;default:Y=0}O=(Y&(O.suspendedLanes|D))!==0?0:Y,O!==0&&O!==U.retryLane&&(U.retryLane=O,Ls(w,O,-1))}Zv(),b=sm(w,b,D,Error(a(421)))}else Yl(Fe)?(b.flags|=128,b.child=w.child,b=yS.bind(null,w),fe(Fe,b),b=null):(D=U.treeContext,Ce&&(us=ft(Fe),Js=b,Yr=!0,So=null,Yd=!1,D!==null&&(_o[ka++]=Jl,_o[ka++]=$l,_o[ka++]=dh,Jl=D.id,$l=D.overflow,dh=b)),b=$o(b,b.pendingProps.children),b.flags|=4096);return b}return Y?(O=jv(w,b,O.children,O.fallback,D),Y=b.child,U=w.child.memoizedState,Y.memoizedState=U===null?Sh(D):{baseLanes:U.baseLanes|D,cachePool:null},Y.childLanes=w.childLanes&~D,b.memoizedState=rm,O):(D=nm(w,b,O.children,D),b.memoizedState=null,D)}return Y?(O=jv(w,b,O.children,O.fallback,D),Y=b.child,U=w.child.memoizedState,Y.memoizedState=U===null?Sh(D):{baseLanes:U.baseLanes|D,cachePool:null},Y.childLanes=w.childLanes&~D,b.memoizedState=rm,O):(D=nm(w,b,O.children,D),b.memoizedState=null,D)}function $o(w,b){return b=ym({mode:"visible",children:b},w.mode,0,null),b.return=w,w.child=b}function nm(w,b,D,O){var U=w.child;return w=U.sibling,D=fc(U,{mode:"visible",children:D}),(b.mode&1)===0&&(D.lanes=O),D.return=b,D.sibling=null,w!==null&&(O=b.deletions,O===null?(b.deletions=[w],b.flags|=16):O.push(w)),b.child=D}function jv(w,b,D,O,U){var Y=b.mode;w=w.child;var ye=w.sibling,Fe={mode:"hidden",children:D};return(Y&1)===0&&b.child!==w?(D=b.child,D.childLanes=0,D.pendingProps=Fe,b.deletions=null):(D=fc(w,Fe),D.subtreeFlags=w.subtreeFlags&14680064),ye!==null?O=fc(ye,O):(O=zh(O,Y,U,null),O.flags|=2),O.return=b,D.return=b,D.sibling=O,b.child=D,O}function sm(w,b,D,O){return O!==null&&Tv(O),ec(b,w.child,null,D),w=$o(b,b.pendingProps.children),w.flags|=2,b.memoizedState=null,w}function pS(w,b,D){w.lanes|=b;var O=w.alternate;O!==null&&(O.lanes|=b),hh(w.return,b,D)}function wl(w,b,D,O,U){var Y=w.memoizedState;Y===null?w.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:O,tail:D,tailMode:U}:(Y.isBackwards=b,Y.rendering=null,Y.renderingStartTime=0,Y.last=O,Y.tail=D,Y.tailMode=U)}function Mh(w,b,D){var O=b.pendingProps,U=O.revealOrder,Y=O.tail;if(an(w,b,O.children,D),O=en.current,(O&2)!==0)O=O&1|2,b.flags|=128;else{if(w!==null&&(w.flags&128)!==0)e:for(w=b.child;w!==null;){if(w.tag===13)w.memoizedState!==null&&pS(w,D,b);else if(w.tag===19)pS(w,D,b);else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===b)break e;for(;w.sibling===null;){if(w.return===null||w.return===b)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}O&=1}if(te(en,O),(b.mode&1)===0)b.memoizedState=null;else switch(U){case"forwards":for(D=b.child,U=null;D!==null;)w=D.alternate,w!==null&&Pv(w)===null&&(U=D),D=D.sibling;D=U,D===null?(U=b.child,b.child=null):(U=D.sibling,D.sibling=null),wl(b,!1,U,D,Y);break;case"backwards":for(D=null,U=b.child,b.child=null;U!==null;){if(w=U.alternate,w!==null&&Pv(w)===null){b.child=U;break}w=U.sibling,U.sibling=D,D=U,U=w}wl(b,!0,D,null,Y);break;case"together":wl(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function _a(w,b,D){if(w!==null&&(b.dependencies=w.dependencies),bl|=b.lanes,(D&b.childLanes)===0)return null;if(w!==null&&b.child!==w.child)throw Error(a(153));if(b.child!==null){for(w=b.child,D=fc(w,w.pendingProps),b.child=D,D.return=b;w.sibling!==null;)w=w.sibling,D=D.sibling=fc(w,w.pendingProps),D.return=b;D.sibling=null}return b.child}function Wv(w,b,D){switch(b.tag){case 3:im(b),Qd();break;case 5:cS(b);break;case 1:Gr(b.type)&&fn(b);break;case 4:Cv(b,b.stateNode.containerInfo);break;case 10:uh(b,b.type._context,b.memoizedProps.value);break;case 13:var O=b.memoizedState;if(O!==null)return O.dehydrated!==null?(te(en,en.current&1),b.flags|=128,null):(D&b.child.childLanes)!==0?h1(w,b,D):(te(en,en.current&1),w=_a(w,b,D),w!==null?w.sibling:null);te(en,en.current&1);break;case 19:if(O=(D&b.childLanes)!==0,(w.flags&128)!==0){if(O)return Mh(w,b,D);b.flags|=128}var U=b.memoizedState;if(U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),te(en,en.current),O)break;return null;case 22:case 23:return b.lanes=0,hs(w,b,D)}return _a(w,b,D)}function Xv(w,b){switch(Qx(b),b.tag){case 1:return Gr(b.type)&&gr(),w=b.flags,w&65536?(b.flags=w&-65537|128,b):null;case 3:return $d(),Z(De),Z(ce),gh(),w=b.flags,(w&65536)!==0&&(w&128)===0?(b.flags=w&-65537|128,b):null;case 5:return Jx(b),null;case 13:if(Z(en),w=b.memoizedState,w!==null&&w.dehydrated!==null){if(b.alternate===null)throw Error(a(340));Qd()}return w=b.flags,w&65536?(b.flags=w&-65537|128,b):null;case 19:return Z(en),null;case 4:return $d(),null;case 10:return Wp(b.type._context),null;case 22:case 23:return mm(),null;case 24:return null;default:return null}}var ea=!1,Qn=!1,Ah=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function Mo(w,b){var D=w.ref;if(D!==null)if(typeof D=="function")try{D(null)}catch(O){ia(w,b,O)}else D.current=null}function ac(w,b,D){try{D()}catch(O){ia(w,b,O)}}var d1=!1;function f1(w,b){for(ee(w.containerInfo),Nt=b;Nt!==null;)if(w=Nt,b=w.child,(w.subtreeFlags&1028)!==0&&b!==null)b.return=w,Nt=b;else for(;Nt!==null;){w=Nt;try{var D=w.alternate;if((w.flags&1024)!==0)switch(w.tag){case 0:case 11:case 15:break;case 1:if(D!==null){var O=D.memoizedProps,U=D.memoizedState,Y=w.stateNode,ye=Y.getSnapshotBeforeUpdate(w.elementType===w.type?O:xa(w.type,O),U);Y.__reactInternalSnapshotBeforeUpdate=ye}break;case 3:Te&&et(w.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Fe){ia(w,w.return,Fe)}if(b=w.sibling,b!==null){b.return=w.return,Nt=b;break}Nt=w.return}return D=d1,d1=!1,D}function oc(w,b,D){var O=b.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&w)===w){var Y=U.destroy;U.destroy=void 0,Y!==void 0&&ac(b,D,Y)}U=U.next}while(U!==O)}}function ds(w,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var D=b=b.next;do{if((D.tag&w)===w){var O=D.create;D.destroy=O()}D=D.next}while(D!==b)}}function ta(w){var b=w.ref;if(b!==null){var D=w.stateNode;switch(w.tag){case 5:w=ie(D);break;default:w=D}typeof b=="function"?b(w):b.current=w}}function jr(w,b,D){if(vl&&typeof vl.onCommitFiberUnmount=="function")try{vl.onCommitFiberUnmount(Vp,b)}catch{}switch(b.tag){case 0:case 11:case 14:case 15:if(w=b.updateQueue,w!==null&&(w=w.lastEffect,w!==null)){var O=w=w.next;do{var U=O,Y=U.destroy;U=U.tag,Y!==void 0&&((U&2)!==0||(U&4)!==0)&&ac(b,D,Y),O=O.next}while(O!==w)}break;case 1:if(Mo(b,D),w=b.stateNode,typeof w.componentWillUnmount=="function")try{w.props=b.memoizedProps,w.state=b.memoizedState,w.componentWillUnmount()}catch(ye){ia(b,D,ye)}break;case 5:Mo(b,D);break;case 4:Te?g1(w,b,D):ae&&ae&&(b=b.stateNode.containerInfo,D=Ze(b),ui(b,D))}}function Ao(w,b,D){for(var O=b;;)if(jr(w,O,D),O.child===null||Te&&O.tag===4){if(O===b)break;for(;O.sibling===null;){if(O.return===null||O.return===b)return;O=O.return}O.sibling.return=O.return,O=O.sibling}else O.child.return=O,O=O.child}function p1(w){var b=w.alternate;b!==null&&(w.alternate=null,p1(b)),w.child=null,w.deletions=null,w.sibling=null,w.tag===5&&(b=w.stateNode,b!==null&&lt(b)),w.stateNode=null,w.return=null,w.dependencies=null,w.memoizedProps=null,w.memoizedState=null,w.pendingProps=null,w.stateNode=null,w.updateQueue=null}function m1(w){return w.tag===5||w.tag===3||w.tag===4}function qv(w){e:for(;;){for(;w.sibling===null;){if(w.return===null||m1(w.return))return null;w=w.return}for(w.sibling.return=w.return,w=w.sibling;w.tag!==5&&w.tag!==6&&w.tag!==18;){if(w.flags&2||w.child===null||w.tag===4)continue e;w.child.return=w,w=w.child}if(!(w.flags&2))return w.stateNode}}function Yv(w){if(Te){e:{for(var b=w.return;b!==null;){if(m1(b))break e;b=b.return}throw Error(a(160))}var D=b;switch(D.tag){case 5:b=D.stateNode,D.flags&32&&($e(b),D.flags&=-33),D=qv(w),of(w,D,b);break;case 3:case 4:b=D.stateNode.containerInfo,D=qv(w),Qv(w,D,b);break;default:throw Error(a(161))}}}function Qv(w,b,D){var O=w.tag;if(O===5||O===6)w=w.stateNode,b?rt(D,w,b):ct(D,w);else if(O!==4&&(w=w.child,w!==null))for(Qv(w,b,D),w=w.sibling;w!==null;)Qv(w,b,D),w=w.sibling}function of(w,b,D){var O=w.tag;if(O===5||O===6)w=w.stateNode,b?Tt(D,w,b):qe(D,w);else if(O!==4&&(w=w.child,w!==null))for(of(w,b,D),w=w.sibling;w!==null;)of(w,b,D),w=w.sibling}function g1(w,b,D){for(var O=b,U=!1,Y,ye;;){if(!U){U=O.return;e:for(;;){if(U===null)throw Error(a(160));switch(Y=U.stateNode,U.tag){case 5:ye=!1;break e;case 3:Y=Y.containerInfo,ye=!0;break e;case 4:Y=Y.containerInfo,ye=!0;break e}U=U.return}U=!0}if(O.tag===5||O.tag===6)Ao(w,O,D),ye?ge(Y,O.stateNode):Dt(Y,O.stateNode);else if(O.tag===18)ye?Ue(Y,O.stateNode):Ge(Y,O.stateNode);else if(O.tag===4){if(O.child!==null){Y=O.stateNode.containerInfo,ye=!0,O.child.return=O,O=O.child;continue}}else if(jr(w,O,D),O.child!==null){O.child.return=O,O=O.child;continue}if(O===b)break;for(;O.sibling===null;){if(O.return===null||O.return===b)return;O=O.return,O.tag===4&&(U=!1)}O.sibling.return=O.return,O=O.sibling}}function hu(w,b){if(Te){switch(b.tag){case 0:case 11:case 14:case 15:oc(3,b,b.return),ds(3,b),oc(5,b,b.return);return;case 1:return;case 5:var D=b.stateNode;if(D!=null){var O=b.memoizedProps;w=w!==null?w.memoizedProps:O;var U=b.type,Y=b.updateQueue;b.updateQueue=null,Y!==null&&gt(D,Y,U,w,O,b)}return;case 6:if(b.stateNode===null)throw Error(a(162));D=b.memoizedProps,Pe(b.stateNode,w!==null?w.memoizedProps:D,D);return;case 3:Ce&&w!==null&&w.memoizedState.isDehydrated&&Oe(b.stateNode.containerInfo);return;case 12:return;case 13:lf(b);return;case 19:lf(b);return;case 17:return}throw Error(a(163))}switch(b.tag){case 0:case 11:case 14:case 15:oc(3,b,b.return),ds(3,b),oc(5,b,b.return);return;case 12:return;case 13:lf(b);return;case 19:lf(b);return;case 3:Ce&&w!==null&&w.memoizedState.isDehydrated&&Oe(b.stateNode.containerInfo);break;case 22:case 23:return}e:if(ae){switch(b.tag){case 1:case 5:case 6:break e;case 3:case 4:b=b.stateNode,ui(b.containerInfo,b.pendingChildren);break e}throw Error(a(163))}}function lf(w){var b=w.updateQueue;if(b!==null){w.updateQueue=null;var D=w.stateNode;D===null&&(D=w.stateNode=new Ah),b.forEach(function(O){var U=xS.bind(null,w,O);D.has(O)||(D.add(O),O.then(U,U))})}}function IC(w,b){for(Nt=b;Nt!==null;){b=Nt;var D=b.deletions;if(D!==null)for(var O=0;O<D.length;O++){var U=D[O];try{var Y=w;Te?g1(Y,U,b):Ao(Y,U,b);var ye=U.alternate;ye!==null&&(ye.return=null),U.return=null}catch(ai){ia(U,b,ai)}}if(D=b.child,(b.subtreeFlags&12854)!==0&&D!==null)D.return=b,Nt=D;else for(;Nt!==null;){b=Nt;try{var Fe=b.flags;if(Fe&32&&Te&&$e(b.stateNode),Fe&512){var pt=b.alternate;if(pt!==null){var It=pt.ref;It!==null&&(typeof It=="function"?It(null):It.current=null)}}if(Fe&8192)switch(b.tag){case 13:if(b.memoizedState!==null){var Kt=b.alternate;(Kt===null||Kt.memoizedState===null)&&(dm=In())}break;case 22:var Ii=b.memoizedState!==null,vi=b.alternate,Hi=vi!==null&&vi.memoizedState!==null;if(D=b,Te){e:if(O=D,U=Ii,Y=null,Te)for(var jt=O;;){if(jt.tag===5){if(Y===null){Y=jt;var ms=jt.stateNode;U?mt(ms):Ne(jt.stateNode,jt.memoizedProps)}}else if(jt.tag===6){if(Y===null){var Ya=jt.stateNode;U?me(Ya):ue(Ya,jt.memoizedProps)}}else if((jt.tag!==22&&jt.tag!==23||jt.memoizedState===null||jt===O)&&jt.child!==null){jt.child.return=jt,jt=jt.child;continue}if(jt===O)break;for(;jt.sibling===null;){if(jt.return===null||jt.return===O)break e;Y===jt&&(Y=null),jt=jt.return}Y===jt&&(Y=null),jt.sibling.return=jt.return,jt=jt.sibling}}if(Ii&&!Hi&&(D.mode&1)!==0){Nt=D;for(var it=D.child;it!==null;){for(D=Nt=it;Nt!==null;){O=Nt;var He=O.child;switch(O.tag){case 0:case 11:case 14:case 15:oc(4,O,O.return);break;case 1:Mo(O,O.return);var ht=O.stateNode;if(typeof ht.componentWillUnmount=="function"){var Ht=O.return;try{ht.props=O.memoizedProps,ht.state=O.memoizedState,ht.componentWillUnmount()}catch(ai){ia(O,Ht,ai)}}break;case 5:Mo(O,O.return);break;case 22:if(O.memoizedState!==null){y1(D);continue}}He!==null?(He.return=O,Nt=He):y1(D)}it=it.sibling}}}switch(Fe&4102){case 2:Yv(b),b.flags&=-3;break;case 6:Yv(b),b.flags&=-3,hu(b.alternate,b);break;case 4096:b.flags&=-4097;break;case 4100:b.flags&=-4097,hu(b.alternate,b);break;case 4:hu(b.alternate,b)}}catch(ai){ia(b,b.return,ai)}if(D=b.sibling,D!==null){D.return=b.return,Nt=D;break}Nt=b.return}}}function am(w,b,D){Nt=w,om(w)}function om(w,b,D){for(var O=(w.mode&1)!==0;Nt!==null;){var U=Nt,Y=U.child;if(U.tag===22&&O){var ye=U.memoizedState!==null||ea;if(!ye){var Fe=U.alternate,pt=Fe!==null&&Fe.memoizedState!==null||Qn;Fe=ea;var It=Qn;if(ea=ye,(Qn=pt)&&!It)for(Nt=U;Nt!==null;)ye=Nt,pt=ye.child,ye.tag===22&&ye.memoizedState!==null?Eh(U):pt!==null?(pt.return=ye,Nt=pt):Eh(U);for(;Y!==null;)Nt=Y,om(Y),Y=Y.sibling;Nt=U,ea=Fe,Qn=It}v1(w)}else(U.subtreeFlags&8772)!==0&&Y!==null?(Y.return=U,Nt=Y):v1(w)}}function v1(w){for(;Nt!==null;){var b=Nt;if((b.flags&8772)!==0){var D=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Qn||ds(5,b);break;case 1:var O=b.stateNode;if(b.flags&4&&!Qn)if(D===null)O.componentDidMount();else{var U=b.elementType===b.type?D.memoizedProps:xa(b.type,D.memoizedProps);O.componentDidUpdate(U,D.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var Y=b.updateQueue;Y!==null&&tS(b,Y,O);break;case 3:var ye=b.updateQueue;if(ye!==null){if(D=null,b.child!==null)switch(b.child.tag){case 5:D=ie(b.child.stateNode);break;case 1:D=b.child.stateNode}tS(b,ye,D)}break;case 5:var Fe=b.stateNode;D===null&&b.flags&4&&nt(Fe,b.type,b.memoizedProps,b);break;case 6:break;case 4:break;case 12:break;case 13:if(Ce&&b.memoizedState===null){var pt=b.alternate;if(pt!==null){var It=pt.memoizedState;if(It!==null){var Kt=It.dehydrated;Kt!==null&&ke(Kt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}Qn||b.flags&512&&ta(b)}catch(Ii){ia(b,b.return,Ii)}}if(b===w){Nt=null;break}if(D=b.sibling,D!==null){D.return=b.return,Nt=D;break}Nt=b.return}}function y1(w){for(;Nt!==null;){var b=Nt;if(b===w){Nt=null;break}var D=b.sibling;if(D!==null){D.return=b.return,Nt=D;break}Nt=b.return}}function Eh(w){for(;Nt!==null;){var b=Nt;try{switch(b.tag){case 0:case 11:case 15:var D=b.return;try{ds(4,b)}catch(pt){ia(b,D,pt)}break;case 1:var O=b.stateNode;if(typeof O.componentDidMount=="function"){var U=b.return;try{O.componentDidMount()}catch(pt){ia(b,U,pt)}}var Y=b.return;try{ta(b)}catch(pt){ia(b,Y,pt)}break;case 5:var ye=b.return;try{ta(b)}catch(pt){ia(b,ye,pt)}}}catch(pt){ia(b,b.return,pt)}if(b===w){Nt=null;break}var Fe=b.sibling;if(Fe!==null){Fe.return=b.return,Nt=Fe;break}Nt=b.return}}var lm=0,Th=1,Ch=2,lc=3,cf=4;if(typeof Symbol=="function"&&Symbol.for){var Ph=Symbol.for;lm=Ph("selector.component"),Th=Ph("selector.has_pseudo_class"),Ch=Ph("selector.role"),lc=Ph("selector.test_id"),cf=Ph("selector.text")}function cm(w){var b=Ie(w);if(b!=null){if(typeof b.memoizedProps["data-testname"]!="string")throw Error(a(364));return b}if(w=Mt(w),w===null)throw Error(a(362));return w.stateNode.current}function um(w,b){switch(b.$$typeof){case lm:if(w.type===b.value)return!0;break;case Th:e:{b=b.value,w=[w,0];for(var D=0;D<w.length;){var O=w[D++],U=w[D++],Y=b[U];if(O.tag!==5||!X(O)){for(;Y!=null&&um(O,Y);)U++,Y=b[U];if(U===b.length){b=!0;break e}else for(O=O.child;O!==null;)w.push(O,U),O=O.sibling}}b=!1}return b;case Ch:if(w.tag===5&&we(w.stateNode,b.value))return!0;break;case cf:if((w.tag===5||w.tag===6)&&(w=V(w),w!==null&&0<=w.indexOf(b.value)))return!0;break;case lc:if(w.tag===5&&(w=w.memoizedProps["data-testname"],typeof w=="string"&&w.toLowerCase()===b.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function du(w){switch(w.$$typeof){case lm:return"<"+(I(w.value)||"Unknown")+">";case Th:return":has("+(du(w)||"")+")";case Ch:return'[role="'+w.value+'"]';case cf:return'"'+w.value+'"';case lc:return'[data-testname="'+w.value+'"]';default:throw Error(a(365))}}function ja(w,b){var D=[];w=[w,0];for(var O=0;O<w.length;){var U=w[O++],Y=w[O++],ye=b[Y];if(U.tag!==5||!X(U)){for(;ye!=null&&um(U,ye);)Y++,ye=b[Y];if(Y===b.length)D.push(U);else for(U=U.child;U!==null;)w.push(U,Y),U=U.sibling}}return D}function cc(w,b){if(!xt)throw Error(a(363));w=cm(w),w=ja(w,b),b=[],w=Array.from(w);for(var D=0;D<w.length;){var O=w[D++];if(O.tag===5)X(O)||b.push(O.stateNode);else for(O=O.child;O!==null;)w.push(O),O=O.sibling}return b}var x1=Math.ceil,hm=o.ReactCurrentDispatcher,el=o.ReactCurrentOwner,br=o.ReactCurrentBatchConfig,ki=0,mn=null,_r=null,Qr=0,Is=0,Dh=lr(0),on=0,uf=null,bl=0,Wa=0,Rh=0,uc=null,_n=null,dm=0,fu=1/0;function Ih(){fu=In()+500}var hf=!1,Wr=null,tl=null,df=!1,_l=null,Lh=0,Oh=0,hc=null,Nr=-1,ln=0;function ur(){return(ki&6)!==0?In():Nr!==-1?Nr:Nr=In()}function il(w){return(w.mode&1)===0?1:(ki&2)!==0&&Qr!==0?Qr&-Qr:eS.transition!==null?(ln===0&&(w=Hd,Hd<<=1,(Hd&4194240)===0&&(Hd=64),ln=w),ln):(w=ji,w!==0?w:Ve())}function Ls(w,b,D){if(50<Oh)throw Oh=0,hc=null,Error(a(185));var O=pu(w,b);return O===null?null:(ah(O,b,D),((ki&2)===0||O!==mn)&&(O===mn&&((ki&2)===0&&(Wa|=b),on===4&&ps(O,Qr)),Sa(O,D),b===1&&ki===0&&(w.mode&1)===0&&(Ih(),gv&&xo())),O)}function pu(w,b){w.lanes|=b;var D=w.alternate;for(D!==null&&(D.lanes|=b),D=w,w=w.return;w!==null;)w.childLanes|=b,D=w.alternate,D!==null&&(D.childLanes|=b),D=w,w=w.return;return D.tag===3?D.stateNode:null}function Sa(w,b){var D=w.callbackNode;$_(w,b);var O=kp(w,w===mn?Qr:0);if(O===0)D!==null&&jd(D),w.callbackNode=null,w.callbackPriority=0;else if(b=O&-O,w.callbackPriority!==b){if(D!=null&&jd(D),b===1)w.tag===0?yv(Xa.bind(null,w)):vv(Xa.bind(null,w)),We?je(function(){ki===0&&xo()}):oh(lh,xo),D=null;else{switch(Ql(O)){case 1:D=lh;break;case 4:D=PC;break;case 16:D=pv;break;case 536870912:D=mv;break;default:D=pv}D=Kv(D,fs.bind(null,w))}w.callbackPriority=b,w.callbackNode=D}}function fs(w,b){if(Nr=-1,ln=0,(ki&6)!==0)throw Error(a(327));var D=w.callbackNode;if(Sl()&&w.callbackNode!==D)return null;var O=kp(w,w===mn?Qr:0);if(O===0)return null;if((O&30)!==0||(O&w.expiredLanes)!==0||b)b=gm(w,O);else{b=O;var U=ki;ki|=2;var Y=_1();(mn!==w||Qr!==b)&&(Ih(),dc(w,b));do try{gS();break}catch(Fe){b1(w,Fe)}while(!0);Ks(),hm.current=Y,ki=U,_r!==null?b=0:(mn=null,Qr=0,b=on)}if(b!==0){if(b===2&&(U=hv(w),U!==0&&(O=U,b=fm(w,U))),b===1)throw D=uf,dc(w,0),ps(w,O),Sa(w,In()),D;if(b===6)ps(w,O);else{if(U=w.current.alternate,(O&30)===0&&!w1(U)&&(b=gm(w,O),b===2&&(Y=hv(w),Y!==0&&(O=Y,b=fm(w,Y))),b===1))throw D=uf,dc(w,0),ps(w,O),Sa(w,In()),D;switch(w.finishedWork=U,w.finishedLanes=O,b){case 0:case 1:throw Error(a(345));case 2:rl(w,_n);break;case 3:if(ps(w,O),(O&130023424)===O&&(b=dm+500-In(),10<b)){if(kp(w,0)!==0)break;if(U=w.suspendedLanes,(U&O)!==O){ur(),w.pingedLanes|=w.suspendedLanes&U;break}w.timeoutHandle=ve(rl.bind(null,w,_n),b);break}rl(w,_n);break;case 4:if(ps(w,O),(O&4194240)===O)break;for(b=w.eventTimes,U=-1;0<O;){var ye=31-ya(O);Y=1<<ye,ye=b[ye],ye>U&&(U=ye),O&=~Y}if(O=U,O=In()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*x1(O/1960))-O,10<O){w.timeoutHandle=ve(rl.bind(null,w,_n),O);break}rl(w,_n);break;case 5:rl(w,_n);break;default:throw Error(a(329))}}}return Sa(w,In()),w.callbackNode===D?fs.bind(null,w):null}function fm(w,b){var D=uc;return w.current.memoizedState.isDehydrated&&(dc(w,b).flags|=256),w=gm(w,b),w!==2&&(b=_n,_n=D,b!==null&&pm(b)),w}function pm(w){_n===null?_n=w:_n.push.apply(_n,w)}function w1(w){for(var b=w;;){if(b.flags&16384){var D=b.updateQueue;if(D!==null&&(D=D.stores,D!==null))for(var O=0;O<D.length;O++){var U=D[O],Y=U.getSnapshot;U=U.value;try{if(!Zs(Y(),U))return!1}catch{return!1}}}if(D=b.child,b.subtreeFlags&16384&&D!==null)D.return=b,b=D;else{if(b===w)break;for(;b.sibling===null;){if(b.return===null||b.return===w)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function ps(w,b){for(b&=~Rh,b&=~Wa,w.suspendedLanes|=b,w.pingedLanes&=~b,w=w.expirationTimes;0<b;){var D=31-ya(b),O=1<<D;w[D]=-1,b&=~O}}function Xa(w){if((ki&6)!==0)throw Error(a(327));Sl();var b=kp(w,0);if((b&1)===0)return Sa(w,In()),null;var D=gm(w,b);if(w.tag!==0&&D===2){var O=hv(w);O!==0&&(b=O,D=fm(w,O))}if(D===1)throw D=uf,dc(w,0),ps(w,b),Sa(w,In()),D;if(D===6)throw Error(a(345));return w.finishedWork=w.current.alternate,w.finishedLanes=b,rl(w,_n),Sa(w,In()),null}function ff(w){_l!==null&&_l.tag===0&&(ki&6)===0&&Sl();var b=ki;ki|=1;var D=br.transition,O=ji;try{if(br.transition=null,ji=1,w)return w()}finally{ji=O,br.transition=D,ki=b,(ki&6)===0&&xo()}}function mm(){Is=Dh.current,Z(Dh)}function dc(w,b){w.finishedWork=null,w.finishedLanes=0;var D=w.timeoutHandle;if(D!==be&&(w.timeoutHandle=be,xe(D)),_r!==null)for(D=_r.return;D!==null;){var O=D;switch(Qx(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&gr();break;case 3:$d(),Z(De),Z(ce),gh();break;case 5:Jx(O);break;case 4:$d();break;case 13:Z(en);break;case 19:Z(en);break;case 10:Wp(O.type._context);break;case 22:case 23:mm()}D=D.return}if(mn=w,_r=w=fc(w.current,null),Qr=Is=b,on=0,uf=null,Rh=Wa=bl=0,_n=uc=null,wo!==null){for(b=0;b<wo.length;b++)if(D=wo[b],O=D.interleaved,O!==null){D.interleaved=null;var U=O.next,Y=D.pending;if(Y!==null){var ye=Y.next;Y.next=U,O.next=ye}D.pending=O}wo=null}return w}function b1(w,b){do{var D=_r;try{if(Ks(),qp.current=sf,Dv){for(var O=tn.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}Dv=!1}if(vh=0,Xn=Wn=tn=null,yl=!1,yh=0,el.current=null,D===null||D.return===null){on=1,uf=b,_r=null;break}e:{var Y=w,ye=D.return,Fe=D,pt=b;if(b=Qr,Fe.flags|=32768,pt!==null&&typeof pt=="object"&&typeof pt.then=="function"){var It=pt,Kt=Fe,Ii=Kt.tag;if((Kt.mode&1)===0&&(Ii===0||Ii===11||Ii===15)){var vi=Kt.alternate;vi?(Kt.updateQueue=vi.updateQueue,Kt.memoizedState=vi.memoizedState,Kt.lanes=vi.lanes):(Kt.updateQueue=null,Kt.memoizedState=null)}var Hi=l1(ye);if(Hi!==null){Hi.flags&=-257,wh(Hi,ye,Fe,Y,b),Hi.mode&1&&ic(Y,It,b),b=Hi,pt=It;var jt=b.updateQueue;if(jt===null){var ms=new Set;ms.add(pt),b.updateQueue=ms}else jt.add(pt);break e}else{if((b&1)===0){ic(Y,It,b),Zv();break e}pt=Error(a(426))}}else if(Yr&&Fe.mode&1){var Ya=l1(ye);if(Ya!==null){(Ya.flags&65536)===0&&(Ya.flags|=256),wh(Ya,ye,Fe,Y,b),Tv(pt);break e}}Y=pt,on!==4&&(on=2),uc===null?uc=[Y]:uc.push(Y),pt=o1(pt,Fe),Fe=ye;do{switch(Fe.tag){case 3:Fe.flags|=65536,b&=-b,Fe.lanes|=b;var it=fS(Fe,pt,b);bv(Fe,it);break e;case 1:Y=pt;var He=Fe.type,ht=Fe.stateNode;if((Fe.flags&128)===0&&(typeof He.getDerivedStateFromError=="function"||ht!==null&&typeof ht.componentDidCatch=="function"&&(tl===null||!tl.has(ht)))){Fe.flags|=65536,b&=-b,Fe.lanes|=b;var Ht=kv(Fe,Y,b);bv(Fe,Ht);break e}}Fe=Fe.return}while(Fe!==null)}M1(D)}catch(ai){b=ai,_r===D&&D!==null&&(_r=D=D.return);continue}break}while(!0)}function _1(){var w=hm.current;return hm.current=sf,w===null?sf:w}function Zv(){(on===0||on===3||on===2)&&(on=4),mn===null||(bl&268435455)===0&&(Wa&268435455)===0||ps(mn,Qr)}function gm(w,b){var D=ki;ki|=2;var O=_1();mn===w&&Qr===b||dc(w,b);do try{mS();break}catch(U){b1(w,U)}while(!0);if(Ks(),ki=D,hm.current=O,_r!==null)throw Error(a(261));return mn=null,Qr=0,on}function mS(){for(;_r!==null;)S1(_r)}function gS(){for(;_r!==null&&!ru();)S1(_r)}function S1(w){var b=T1(w.alternate,w,Is);w.memoizedProps=w.pendingProps,b===null?M1(w):_r=b,el.current=null}function M1(w){var b=w;do{var D=b.alternate;if(w=b.return,(b.flags&32768)===0){if(D=Gv(D,b,Is),D!==null){_r=D;return}}else{if(D=Xv(D,b),D!==null){D.flags&=32767,_r=D;return}if(w!==null)w.flags|=32768,w.subtreeFlags=0,w.deletions=null;else{on=6,_r=null;return}}if(b=b.sibling,b!==null){_r=b;return}_r=b=w}while(b!==null);on===0&&(on=5)}function rl(w,b){var D=ji,O=br.transition;try{br.transition=null,ji=1,vS(w,b,D)}finally{br.transition=O,ji=D}return null}function vS(w,b,D){do Sl();while(_l!==null);if((ki&6)!==0)throw Error(a(327));var O=w.finishedWork,U=w.finishedLanes;if(O===null)return null;if(w.finishedWork=null,w.finishedLanes=0,O===w.current)throw Error(a(177));w.callbackNode=null,w.callbackPriority=0;var Y=O.lanes|O.childLanes;if(fv(w,Y),w===mn&&(_r=mn=null,Qr=0),(O.subtreeFlags&2064)===0&&(O.flags&2064)===0||df||(df=!0,Kv(pv,function(){return Sl(),null})),Y=(O.flags&15990)!==0,(O.subtreeFlags&15990)!==0||Y){Y=br.transition,br.transition=null;var ye=ji;ji=1;var Fe=ki;ki|=4,el.current=null,f1(w,O),IC(w,O),K(w.containerInfo),w.current=O,am(O),CC(),ki=Fe,ji=ye,br.transition=Y}else w.current=O;if(df&&(df=!1,_l=w,Lh=U),Y=w.pendingLanes,Y===0&&(tl=null),Hp(O.stateNode),Sa(w,In()),b!==null)for(D=w.onRecoverableError,O=0;O<b.length;O++)D(b[O]);if(hf)throw hf=!1,w=Wr,Wr=null,w;return(Lh&1)!==0&&w.tag!==0&&Sl(),Y=w.pendingLanes,(Y&1)!==0?w===hc?Oh++:(Oh=0,hc=w):Oh=0,xo(),null}function Sl(){if(_l!==null){var w=Ql(Lh),b=br.transition,D=ji;try{if(br.transition=null,ji=16>w?16:w,_l===null)var O=!1;else{if(w=_l,_l=null,Lh=0,(ki&6)!==0)throw Error(a(331));var U=ki;for(ki|=4,Nt=w.current;Nt!==null;){var Y=Nt,ye=Y.child;if((Nt.flags&16)!==0){var Fe=Y.deletions;if(Fe!==null){for(var pt=0;pt<Fe.length;pt++){var It=Fe[pt];for(Nt=It;Nt!==null;){var Kt=Nt;switch(Kt.tag){case 0:case 11:case 15:oc(8,Kt,Y)}var Ii=Kt.child;if(Ii!==null)Ii.return=Kt,Nt=Ii;else for(;Nt!==null;){Kt=Nt;var vi=Kt.sibling,Hi=Kt.return;if(p1(Kt),Kt===It){Nt=null;break}if(vi!==null){vi.return=Hi,Nt=vi;break}Nt=Hi}}}var jt=Y.alternate;if(jt!==null){var ms=jt.child;if(ms!==null){jt.child=null;do{var Ya=ms.sibling;ms.sibling=null,ms=Ya}while(ms!==null)}}Nt=Y}}if((Y.subtreeFlags&2064)!==0&&ye!==null)ye.return=Y,Nt=ye;else e:for(;Nt!==null;){if(Y=Nt,(Y.flags&2048)!==0)switch(Y.tag){case 0:case 11:case 15:oc(9,Y,Y.return)}var it=Y.sibling;if(it!==null){it.return=Y.return,Nt=it;break e}Nt=Y.return}}var He=w.current;for(Nt=He;Nt!==null;){ye=Nt;var ht=ye.child;if((ye.subtreeFlags&2064)!==0&&ht!==null)ht.return=ye,Nt=ht;else e:for(ye=He;Nt!==null;){if(Fe=Nt,(Fe.flags&2048)!==0)try{switch(Fe.tag){case 0:case 11:case 15:ds(9,Fe)}}catch(ai){ia(Fe,Fe.return,ai)}if(Fe===ye){Nt=null;break e}var Ht=Fe.sibling;if(Ht!==null){Ht.return=Fe.return,Nt=Ht;break e}Nt=Fe.return}}if(ki=U,xo(),vl&&typeof vl.onPostCommitFiberRoot=="function")try{vl.onPostCommitFiberRoot(Vp,w)}catch{}O=!0}return O}finally{ji=D,br.transition=b}}return!1}function vm(w,b,D){b=o1(D,b),b=fS(w,b,1),nu(w,b),b=ur(),w=pu(w,1),w!==null&&(ah(w,1,b),Sa(w,b))}function ia(w,b,D){if(w.tag===3)vm(w,w,D);else for(;b!==null;){if(b.tag===3){vm(b,w,D);break}else if(b.tag===1){var O=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(tl===null||!tl.has(O))){w=o1(D,w),w=kv(b,w,1),nu(b,w),w=ur(),b=pu(b,1),b!==null&&(ah(b,1,w),Sa(b,w));break}}b=b.return}}function A1(w,b,D){var O=w.pingCache;O!==null&&O.delete(b),b=ur(),w.pingedLanes|=w.suspendedLanes&D,mn===w&&(Qr&D)===D&&(on===4||on===3&&(Qr&130023424)===Qr&&500>In()-dm?dc(w,0):Rh|=D),Sa(w,b)}function E1(w,b){b===0&&((w.mode&1)===0?b=1:(b=cr,cr<<=1,(cr&130023424)===0&&(cr=4194304)));var D=ur();w=pu(w,b),w!==null&&(ah(w,b,D),Sa(w,D))}function yS(w){var b=w.memoizedState,D=0;b!==null&&(D=b.retryLane),E1(w,D)}function xS(w,b){var D=0;switch(w.tag){case 13:var O=w.stateNode,U=w.memoizedState;U!==null&&(D=U.retryLane);break;case 19:O=w.stateNode;break;default:throw Error(a(314))}O!==null&&O.delete(b),E1(w,D)}var T1;T1=function(w,b,D){if(w!==null)if(w.memoizedProps!==b.pendingProps||De.current)Yn=!0;else{if((w.lanes&D)===0&&(b.flags&128)===0)return Yn=!1,Wv(w,b,D);Yn=(w.flags&131072)!==0}else Yn=!1,Yr&&(b.flags&1048576)!==0&&sS(b,Av,b.index);switch(b.lanes=0,b.tag){case 2:var O=b.type;w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),w=b.pendingProps;var U=Hr(b,ce.current);Wd(b,D),U=ef(null,b,O,w,U,D);var Y=lu();return b.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,Gr(O)?(Y=!0,fn(b)):Y=!1,b.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,Xd(b),U.updater=Sv,b.stateNode=U,U._reactInternals=b,qx(b,O,w,D),b=Rs(null,b,O,!0,Y,D)):(b.tag=0,Yr&&Y&&Yx(b),an(null,b,U,D),b=b.child),b;case 16:O=b.elementType;e:{switch(w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),w=b.pendingProps,U=O._init,O=U(O._payload),b.type=O,U=b.tag=LC(O),w=xa(O,w),U){case 0:b=sc(null,b,O,w,D);break e;case 1:b=_h(null,b,O,w,D);break e;case 11:b=Br(null,b,O,w,D);break e;case 14:b=Ar(null,b,O,xa(O.type,w),D);break e}throw Error(a(306,O,""))}return b;case 0:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:xa(O,U),sc(w,b,O,U,D);case 1:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:xa(O,U),_h(w,b,O,U,D);case 3:e:{if(im(b),w===null)throw Error(a(387));O=b.pendingProps,Y=b.memoizedState,U=Y.element,jx(w,b),_v(b,O,null,D);var ye=b.memoizedState;if(O=ye.element,Ce&&Y.isDehydrated)if(Y={element:O,isDehydrated:!1,cache:ye.cache,transitions:ye.transitions},b.updateQueue.baseState=Y,b.memoizedState=Y,b.flags&256){U=Error(a(423)),b=u1(w,b,O,D,U);break e}else if(O!==U){U=Error(a(424)),b=u1(w,b,O,D,U);break e}else for(Ce&&(us=Xe(b.stateNode.containerInfo),Js=b,Yr=!0,So=null,Yd=!1),D=lS(b,null,O,D),b.child=D;D;)D.flags=D.flags&-3|4096,D=D.sibling;else{if(Qd(),O===U){b=_a(w,b,D);break e}an(w,b,O,D)}b=b.child}return b;case 5:return cS(b),w===null&&au(b),O=b.type,U=b.pendingProps,Y=w!==null?w.memoizedProps:null,ye=U.children,he(O,U)?ye=null:Y!==null&&he(O,Y)&&(b.flags|=32),$s(w,b),an(w,b,ye,D),b.child;case 6:return w===null&&au(b),null;case 13:return h1(w,b,D);case 4:return Cv(b,b.stateNode.containerInfo),O=b.pendingProps,w===null?b.child=ec(b,null,O,D):an(w,b,O,D),b.child;case 11:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:xa(O,U),Br(w,b,O,U,D);case 7:return an(w,b,b.pendingProps,D),b.child;case 8:return an(w,b,b.pendingProps.children,D),b.child;case 12:return an(w,b,b.pendingProps.children,D),b.child;case 10:e:{if(O=b.type._context,U=b.pendingProps,Y=b.memoizedProps,ye=U.value,uh(b,O,ye),Y!==null)if(Zs(Y.value,ye)){if(Y.children===U.children&&!De.current){b=_a(w,b,D);break e}}else for(Y=b.child,Y!==null&&(Y.return=b);Y!==null;){var Fe=Y.dependencies;if(Fe!==null){ye=Y.child;for(var pt=Fe.firstContext;pt!==null;){if(pt.context===O){if(Y.tag===1){pt=Kl(-1,D&-D),pt.tag=2;var It=Y.updateQueue;if(It!==null){It=It.shared;var Kt=It.pending;Kt===null?pt.next=pt:(pt.next=Kt.next,Kt.next=pt),It.pending=pt}}Y.lanes|=D,pt=Y.alternate,pt!==null&&(pt.lanes|=D),hh(Y.return,D,b),Fe.lanes|=D;break}pt=pt.next}}else if(Y.tag===10)ye=Y.type===b.type?null:Y.child;else if(Y.tag===18){if(ye=Y.return,ye===null)throw Error(a(341));ye.lanes|=D,Fe=ye.alternate,Fe!==null&&(Fe.lanes|=D),hh(ye,D,b),ye=Y.sibling}else ye=Y.child;if(ye!==null)ye.return=Y;else for(ye=Y;ye!==null;){if(ye===b){ye=null;break}if(Y=ye.sibling,Y!==null){Y.return=ye.return,ye=Y;break}ye=ye.return}Y=ye}an(w,b,U.children,D),b=b.child}return b;case 9:return U=b.type,O=b.pendingProps.children,Wd(b,D),U=wa(U),O=O(U),b.flags|=1,an(w,b,O,D),b.child;case 14:return O=b.type,U=xa(O,b.pendingProps),U=xa(O.type,U),Ar(w,b,O,U,D);case 15:return nc(w,b,b.type,b.pendingProps,D);case 17:return O=b.type,U=b.pendingProps,U=b.elementType===O?U:xa(O,U),w!==null&&(w.alternate=null,b.alternate=null,b.flags|=2),b.tag=1,Gr(O)?(w=!0,fn(b)):w=!1,Wd(b,D),rS(b,O,U),qx(b,O,U,D),Rs(null,b,O,!0,w,D);case 19:return Mh(w,b,D);case 22:return hs(w,b,D)}throw Error(a(156,b.tag))};function Kv(w,b){return oh(w,b)}function wS(w,b,D,O){this.tag=w,this.key=D,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qa(w,b,D,O){return new wS(w,b,D,O)}function Jv(w){return w=w.prototype,!(!w||!w.isReactComponent)}function LC(w){if(typeof w=="function")return Jv(w)?1:0;if(w!=null){if(w=w.$$typeof,w===v)return 11;if(w===S)return 14}return 2}function fc(w,b){var D=w.alternate;return D===null?(D=qa(w.tag,b,w.key,w.mode),D.elementType=w.elementType,D.type=w.type,D.stateNode=w.stateNode,D.alternate=w,w.alternate=D):(D.pendingProps=b,D.type=w.type,D.flags=0,D.subtreeFlags=0,D.deletions=null),D.flags=w.flags&14680064,D.childLanes=w.childLanes,D.lanes=w.lanes,D.child=w.child,D.memoizedProps=w.memoizedProps,D.memoizedState=w.memoizedState,D.updateQueue=w.updateQueue,b=w.dependencies,D.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},D.sibling=w.sibling,D.index=w.index,D.ref=w.ref,D}function $v(w,b,D,O,U,Y){var ye=2;if(O=w,typeof w=="function")Jv(w)&&(ye=1);else if(typeof w=="string")ye=5;else e:switch(w){case u:return zh(D.children,U,Y,b);case h:ye=8,U|=8;break;case d:return w=qa(12,D,b,U|2),w.elementType=d,w.lanes=Y,w;case g:return w=qa(13,D,b,U),w.elementType=g,w.lanes=Y,w;case x:return w=qa(19,D,b,U),w.elementType=x,w.lanes=Y,w;case A:return ym(D,U,Y,b);default:if(typeof w=="object"&&w!==null)switch(w.$$typeof){case f:ye=10;break e;case m:ye=9;break e;case v:ye=11;break e;case S:ye=14;break e;case _:ye=16,O=null;break e}throw Error(a(130,w==null?w:typeof w,""))}return b=qa(ye,D,b,U),b.elementType=w,b.type=O,b.lanes=Y,b}function zh(w,b,D,O){return w=qa(7,w,O,b),w.lanes=D,w}function ym(w,b,D,O){return w=qa(22,w,O,b),w.elementType=A,w.lanes=D,w.stateNode={},w}function e0(w,b,D){return w=qa(6,w,null,b),w.lanes=D,w}function t0(w,b,D){return b=qa(4,w.children!==null?w.children:[],w.key,b),b.lanes=D,b.stateNode={containerInfo:w.containerInfo,pendingChildren:null,implementation:w.implementation},b}function i0(w,b,D,O,U){this.tag=b,this.containerInfo=w,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=be,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=dv(0),this.expirationTimes=dv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dv(0),this.identifierPrefix=O,this.onRecoverableError=U,Ce&&(this.mutableSourceEagerHydrationData=null)}function bS(w,b,D,O,U,Y,ye,Fe,pt){return w=new i0(w,b,D,Fe,pt),b===1?(b=1,Y===!0&&(b|=8)):b=0,Y=qa(3,null,null,b),w.current=Y,Y.stateNode=w,Y.memoizedState={element:O,isDehydrated:D,cache:null,transitions:null},Xd(Y),w}function _S(w){if(!w)return _e;w=w._reactInternals;e:{if(C(w)!==w||w.tag!==1)throw Error(a(170));var b=w;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(Gr(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(a(171))}if(w.tag===1){var D=w.type;if(Gr(D))return Yo(w,D,b)}return b}function SS(w){var b=w._reactInternals;if(b===void 0)throw typeof w.render=="function"?Error(a(188)):(w=Object.keys(w).join(","),Error(a(268,w)));return w=F(b),w===null?null:w.stateNode}function Eo(w,b){if(w=w.memoizedState,w!==null&&w.dehydrated!==null){var D=w.retryLane;w.retryLane=D!==0&&D<b?D:b}}function xm(w,b){Eo(w,b),(w=w.alternate)&&Eo(w,b)}function r0(w){return w=F(w),w===null?null:w.stateNode}function MS(){return null}return i.attemptContinuousHydration=function(w){if(w.tag===13){var b=ur();Ls(w,134217728,b),xm(w,134217728)}},i.attemptHydrationAtCurrentPriority=function(w){if(w.tag===13){var b=ur(),D=il(w);Ls(w,D,b),xm(w,D)}},i.attemptSynchronousHydration=function(w){switch(w.tag){case 3:var b=w.stateNode;if(b.current.memoizedState.isDehydrated){var D=Gd(b.pendingLanes);D!==0&&(gl(b,D|1),Sa(b,In()),(ki&6)===0&&(Ih(),xo()))}break;case 13:var O=ur();ff(function(){return Ls(w,1,O)}),xm(w,1)}},i.batchedUpdates=function(w,b){var D=ki;ki|=1;try{return w(b)}finally{ki=D,ki===0&&(Ih(),gv&&xo())}},i.createComponentSelector=function(w){return{$$typeof:lm,value:w}},i.createContainer=function(w,b,D,O,U,Y,ye){return bS(w,b,!1,null,D,O,U,Y,ye)},i.createHasPseudoClassSelector=function(w){return{$$typeof:Th,value:w}},i.createHydrationContainer=function(w,b,D,O,U,Y,ye,Fe,pt){return w=bS(D,O,!0,w,U,Y,ye,Fe,pt),w.context=_S(null),D=w.current,O=ur(),U=il(D),Y=Kl(O,U),Y.callback=b??null,nu(D,Y),w.current.lanes=U,ah(w,U,O),Sa(w,O),w},i.createPortal=function(w,b,D){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:O==null?null:""+O,children:w,containerInfo:b,implementation:D}},i.createRoleSelector=function(w){return{$$typeof:Ch,value:w}},i.createTestNameSelector=function(w){return{$$typeof:lc,value:w}},i.createTextSelector=function(w){return{$$typeof:cf,value:w}},i.deferredUpdates=function(w){var b=ji,D=br.transition;try{return br.transition=null,ji=16,w()}finally{ji=b,br.transition=D}},i.discreteUpdates=function(w,b,D,O,U){var Y=ji,ye=br.transition;try{return br.transition=null,ji=1,w(b,D,O,U)}finally{ji=Y,br.transition=ye,ki===0&&Ih()}},i.findAllNodes=cc,i.findBoundingRects=function(w,b){if(!xt)throw Error(a(363));b=cc(w,b),w=[];for(var D=0;D<b.length;D++)w.push(de(b[D]));for(b=w.length-1;0<b;b--){D=w[b];for(var O=D.x,U=O+D.width,Y=D.y,ye=Y+D.height,Fe=b-1;0<=Fe;Fe--)if(b!==Fe){var pt=w[Fe],It=pt.x,Kt=It+pt.width,Ii=pt.y,vi=Ii+pt.height;if(O>=It&&Y>=Ii&&U<=Kt&&ye<=vi){w.splice(b,1);break}else if(O!==It||D.width!==pt.width||vi<Y||Ii>ye){if(!(Y!==Ii||D.height!==pt.height||Kt<O||It>U)){It>O&&(pt.width+=It-O,pt.x=O),Kt<U&&(pt.width=U-It),w.splice(b,1);break}}else{Ii>Y&&(pt.height+=Ii-Y,pt.y=Y),vi<ye&&(pt.height=ye-Ii),w.splice(b,1);break}}}return w},i.findHostInstance=SS,i.findHostInstanceWithNoPortals=function(w){return w=z(w),w=w!==null?N(w):null,w===null?null:w.stateNode},i.findHostInstanceWithWarning=function(w){return SS(w)},i.flushControlled=function(w){var b=ki;ki|=1;var D=br.transition,O=ji;try{br.transition=null,ji=1,w()}finally{ji=O,br.transition=D,ki=b,ki===0&&(Ih(),xo())}},i.flushPassiveEffects=Sl,i.flushSync=ff,i.focusWithin=function(w,b){if(!xt)throw Error(a(363));for(w=cm(w),b=ja(w,b),b=Array.from(b),w=0;w<b.length;){var D=b[w++];if(!X(D)){if(D.tag===5&&J(D.stateNode))return!0;for(D=D.child;D!==null;)b.push(D),D=D.sibling}}return!1},i.getCurrentUpdatePriority=function(){return ji},i.getFindAllNodesFailureDescription=function(w,b){if(!xt)throw Error(a(363));var D=0,O=[];w=[cm(w),0];for(var U=0;U<w.length;){var Y=w[U++],ye=w[U++],Fe=b[ye];if((Y.tag!==5||!X(Y))&&(um(Y,Fe)&&(O.push(du(Fe)),ye++,ye>D&&(D=ye)),ye<b.length))for(Y=Y.child;Y!==null;)w.push(Y,ye),Y=Y.sibling}if(D<b.length){for(w=[];D<b.length;D++)w.push(du(b[D]));return`findAllNodes was able to match part of the selector:
  `+(O.join(" > ")+`

No matching component was found for:
  `)+w.join(" > ")}return null},i.getPublicRootInstance=function(w){if(w=w.current,!w.child)return null;switch(w.child.tag){case 5:return ie(w.child.stateNode);default:return w.child.stateNode}},i.injectIntoDevTools=function(w){if(w={bundleType:w.bundleType,version:w.version,rendererPackageName:w.rendererPackageName,rendererConfig:w.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:r0,findFiberByHostInstance:w.findFiberByHostInstance||MS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")w=!1;else{var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)w=!0;else{try{Vp=b.inject(w),vl=b}catch{}w=!!b.checkDCE}}return w},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(w,b,D,O){if(!xt)throw Error(a(363));w=cc(w,b);var U=Le(w,D,O).disconnect;return{disconnect:function(){U()}}},i.registerMutableSourceForHydration=function(w,b){var D=b._getVersion;D=D(b._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[b,D]:w.mutableSourceEagerHydrationData.push(b,D)},i.runWithPriority=function(w,b){var D=ji;try{return ji=w,b()}finally{ji=D}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(w,b,D,O){var U=b.current,Y=ur(),ye=il(U);return D=_S(D),b.context===null?b.context=D:b.pendingContext=D,b=Kl(Y,ye),b.payload={element:w},O=O===void 0?null:O,O!==null&&(b.callback=O),nu(U,b),w=Ls(U,ye,Y),w!==null&&wv(w,U,ye),ye},i}),ZP}var kk;function woe(){return kk||(kk=1,qP.exports=xoe()),qP.exports}var boe=woe();const _oe=Cp(boe);var Vk=p7();const Soe=e=>typeof e=="object"&&typeof e.then=="function",pg=[];function m7(e,t,i=(r,n)=>r===n){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let n=0;n<r;n++)if(!i(e[n],t[n]))return!1;return!0}function g7(e,t=null,i=!1,r={}){t===null&&(t=[e]);for(const s of pg)if(m7(t,s.keys,s.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!i)throw s.promise}const n={keys:t,equal:r.equal,remove:()=>{const s=pg.indexOf(n);s!==-1&&pg.splice(s,1)},promise:(Soe(e)?e:e(...t)).then(s=>{n.response=s,r.lifespan&&r.lifespan>0&&(n.timeout=setTimeout(n.remove,r.lifespan))}).catch(s=>n.error=s)};if(pg.push(n),!i)throw n.promise}const Moe=(e,t,i)=>g7(e,t,!1,i),Aoe=(e,t,i)=>void g7(e,t,!0,i),Eoe=e=>{if(e===void 0||e.length===0)pg.splice(0,pg.length);else{const t=pg.find(i=>m7(e,i.keys,i.equal));t&&t.remove()}},Zz={},Toe=e=>void Object.assign(Zz,e);function Coe(e,t){function i(u,{args:h=[],attach:d,...f},m){let v=`${u[0].toUpperCase()}${u.slice(1)}`,g;if(u==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const x=f.object;g=ly(x,{type:u,root:m,attach:d,primitive:!0})}else{const x=Zz[v];if(!x)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");g=ly(new x(...h),{type:u,root:m,attach:d,memoizedProps:{args:h}})}return g.__r3f.attach===void 0&&(g instanceof Gi?g.__r3f.attach="geometry":g instanceof ga&&(g.__r3f.attach="material")),v!=="inject"&&$P(g,f),g}function r(u,h){let d=!1;if(h){var f,m;(f=h.__r3f)!=null&&f.attach?JP(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(m=u.__r3f)==null||m.objects.push(h),h.__r3f||ly(h,{}),h.__r3f.parent=u,RI(h),cy(h)}}function n(u,h,d){let f=!1;if(h){var m,v;if((m=h.__r3f)!=null&&m.attach)JP(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"});const g=u.children.filter(S=>S!==h),x=g.indexOf(d);u.children=[...g.slice(0,x),h,...g.slice(x)],f=!0}f||(v=u.__r3f)==null||v.objects.push(h),h.__r3f||ly(h,{}),h.__r3f.parent=u,RI(h),cy(h)}}function s(u,h,d=!1){u&&[...u].forEach(f=>a(h,f,d))}function a(u,h,d){if(h){var f,m,v;if(h.__r3f&&(h.__r3f.parent=null),(f=u.__r3f)!=null&&f.objects&&(u.__r3f.objects=u.__r3f.objects.filter(A=>A!==h)),(m=h.__r3f)!=null&&m.attach)Xk(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var g;u.remove(h),(g=h.__r3f)!=null&&g.root&&Boe(h.__r3f.root,h)}const S=(v=h.__r3f)==null?void 0:v.primitive,_=d===void 0?h.dispose!==null&&!S:d;if(!S){var x;s((x=h.__r3f)==null?void 0:x.objects,h,_),s(h.children,h,_)}delete h.__r3f,_&&h.dispose&&h.type!=="Scene"&&Vk.unstable_scheduleCallback(Vk.unstable_IdlePriority,()=>{try{h.dispose()}catch{}}),cy(u)}}function o(u,h,d,f){var m;const v=(m=u.__r3f)==null?void 0:m.parent;if(!v)return;const g=i(h,d,u.__r3f.root);if(u.children){for(const x of u.children)x.__r3f&&r(g,x);u.children=u.children.filter(x=>!x.__r3f)}u.__r3f.objects.forEach(x=>r(g,x)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||a(v,u),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),r(v,g),g.raycast&&g.__r3f.eventCount&&g.__r3f.root.getState().internal.interaction.push(g),[f,f.alternate].forEach(x=>{x!==null&&(x.stateNode=g,x.ref&&(typeof x.ref=="function"?x.ref(g):x.ref.current=g))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:_oe({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&a(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const f=u.getState().scene;f.__r3f&&n(f,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,f){var m;if(((m=u==null?void 0:u.__r3f)!=null?m:{}).primitive&&f.object&&f.object!==u)return[!0];{const{args:g=[],children:x,...S}=f,{args:_=[],children:A,...T}=d;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((I,P)=>I!==_[P]))return[!0];const E=S7(u,S,T,!0);return E.changes.length?[!1,E]:null}},commitUpdate(u,[h,d],f,m,v,g){h?o(u,f,v,g):$P(u,d)},commitMount(u,h,d,f){var m;const v=(m=u.__r3f)!=null?m:{};u.raycast&&v.handlers&&v.eventCount&&u.__r3f.root.getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>ly(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:f}=(h=u.__r3f)!=null?h:{};d&&f&&Xk(f,u,d),u.isObject3D&&(u.visible=!1),cy(u)},unhideInstance(u,h){var d;const{attach:f,parent:m}=(d=u.__r3f)!=null?d:{};f&&m&&JP(m,u,f),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),cy(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():_y.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&nn.fun(performance.now)?performance.now:nn.fun(Date.now)?Date.now:()=>0,scheduleTimeout:nn.fun(setTimeout)?setTimeout:void 0,cancelTimeout:nn.fun(clearTimeout)?clearTimeout:void 0}),applyProps:$P}}var Hk,Gk;const KP=e=>"colorSpace"in e||"outputColorSpace"in e,v7=()=>{var e;return(e=Zz.ColorManagement)!=null?e:null},y7=e=>e&&e.isOrthographicCamera,Poe=e=>e&&e.hasOwnProperty("current"),D_=typeof window<"u"&&((Hk=window.document)!=null&&Hk.createElement||((Gk=window.navigator)==null?void 0:Gk.product)==="ReactNative")?Se.useLayoutEffect:Se.useEffect;function x7(e){const t=Se.useRef(e);return D_(()=>void(t.current=e),[e]),t}function Doe({set:e}){return D_(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class w7 extends Se.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}w7.getDerivedStateFromError=()=>({error:!0});const b7="__default",jk=new Map,Roe=e=>e&&!!e.memoized&&!!e.changes;function _7(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const q1=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},nn={obj:e=>e===Object(e)&&!nn.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(nn.str(e)||nn.num(e))return e===t;const s=nn.obj(e);if(s&&r==="reference")return e===t;const a=nn.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?t:e)if(!nn.equ(e[o],t[o],{strict:n,objects:"reference"}))return!1}else for(o in n?t:e)if(e[o]!==t[o])return!1;if(nn.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Ioe(e){const t={nodes:{},materials:{}};return e&&e.traverse(i=>{i.name&&(t.nodes[i.name]=i),i.material&&!t.materials[i.material.name]&&(t.materials[i.material.name]=i.material)}),t}function Loe(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ly(e,t){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function DI(e,t){let i=e;if(t.includes("-")){const r=t.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],e),{target:i,key:n}}else return{target:i,key:t}}const Wk=/-\d+$/;function JP(e,t,i){if(nn.str(i)){if(Wk.test(i)){const s=i.replace(Wk,""),{target:a,key:o}=DI(e,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=DI(e,i);t.__r3f.previousAttach=r[n],r[n]=t}else t.__r3f.previousAttach=i(e,t)}function Xk(e,t,i){var r,n;if(nn.str(i)){const{target:s,key:a}=DI(e,i),o=t.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(n=t.__r3f)==null||delete n.previousAttach}function S7(e,{children:t,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){var u;const h=(u=e==null?void 0:e.__r3f)!=null?u:{},d=Object.entries(n),f=[];if(c){const v=Object.keys(l);for(let g=0;g<v.length;g++)n.hasOwnProperty(v[g])||d.unshift([v[g],b7+"remove"])}d.forEach(([v,g])=>{var x;if((x=e.__r3f)!=null&&x.primitive&&v==="object"||nn.equ(g,l[v]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(v))return f.push([v,g,!0,[]]);let S=[];v.includes("-")&&(S=v.split("-")),f.push([v,g,!1,S]);for(const _ in n){const A=n[_];_.startsWith(`${v}-`)&&f.push([_,A,!1,_.split("-")])}});const m={...n};return h.memoizedProps&&h.memoizedProps.args&&(m.args=h.memoizedProps.args),h.memoizedProps&&h.memoizedProps.attach&&(m.attach=h.memoizedProps.attach),{memoized:m,changes:f}}function $P(e,t){var i,r,n;const s=(i=e.__r3f)!=null?i:{},a=s.root,o=(r=a==null||a.getState==null?void 0:a.getState())!=null?r:{},{memoized:l,changes:c}=Roe(t)?t:S7(e,t),u=s.eventCount;e.__r3f&&(e.__r3f.memoizedProps=l);for(let d=0;d<c.length;d++){let[f,m,v,g]=c[d];if(KP(e)){const A="srgb",T="srgb-linear";f==="encoding"?(f="colorSpace",m=m===3001?A:T):f==="outputEncoding"&&(f="outputColorSpace",m=m===3001?A:T)}let x=e,S=x[f];if(g.length&&(S=g.reduce((_,A)=>_[A],e),!(S&&S.set))){const[_,...A]=g.reverse();x=A.reverse().reduce((T,E)=>T[E],e),f=_}if(m===b7+"remove")if(x.constructor){let _=jk.get(x.constructor);_||(_=new x.constructor,jk.set(x.constructor,_)),m=_[f]}else m=0;if(v)m?s.handlers[f]=m:delete s.handlers[f],s.eventCount=Object.keys(s.handlers).length;else if(S&&S.set&&(S.copy||S instanceof Tg)){if(Array.isArray(m))S.fromArray?S.fromArray(m):S.set(...m);else if(S.copy&&m&&m.constructor&&S.constructor===m.constructor)S.copy(m);else if(m!==void 0){const _=S instanceof Zt;!_&&S.setScalar?S.setScalar(m):S instanceof Tg&&m instanceof Tg?S.mask=m.mask:S.set(m),!v7()&&!o.linear&&_&&S.convertSRGBToLinear()}}else if(x[f]=m,x[f]instanceof dn&&x[f].format===so&&x[f].type===Vu){const _=x[f];KP(_)&&KP(o.gl)?_.colorSpace=o.gl.outputColorSpace:_.encoding=o.gl.outputEncoding}cy(e)}if(s.parent&&o.internal&&e.raycast&&u!==s.eventCount){const d=o.internal.interaction.indexOf(e);d>-1&&o.internal.interaction.splice(d,1),s.eventCount&&o.internal.interaction.push(e)}return!(c.length===1&&c[0][0]==="onUpdate")&&c.length&&(n=e.__r3f)!=null&&n.parent&&RI(e),e}function cy(e){var t,i;const r=(t=e.__r3f)==null||(i=t.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function RI(e){e.onUpdate==null||e.onUpdate(e)}function Ooe(e,t){e.manual||(y7(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function FM(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function zoe(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return _y.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return _y.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return _y.ContinuousEventPriority;default:return _y.DefaultEventPriority}}function M7(e,t,i,r){const n=i.get(t);n&&(i.delete(t),i.size===0&&(e.delete(r),n.target.releasePointerCapture(r)))}function Boe(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(r=>r!==t),i.initialHits=i.initialHits.filter(r=>r!==t),i.hovered.forEach((r,n)=>{(r.eventObject===t||r.object===t)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{M7(i.capturedMap,t,r,n)})}function Noe(e){function t(l){const{internal:c}=e.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=e.getState(),h=new Set,d=[],f=c?c(u.internal.interaction):u.internal.interaction;for(let x=0;x<f.length;x++){const S=q1(f[x]);S&&(S.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function m(x){const S=q1(x);if(!S||!S.events.enabled||S.raycaster.camera===null)return[];if(S.raycaster.camera===void 0){var _;S.events.compute==null||S.events.compute(l,S,(_=S.previousRoot)==null?void 0:_.getState()),S.raycaster.camera===void 0&&(S.raycaster.camera=null)}return S.raycaster.camera?S.raycaster.intersectObject(x,!0):[]}let v=f.flatMap(m).sort((x,S)=>{const _=q1(x.object),A=q1(S.object);return!_||!A?x.distance-S.distance:A.events.priority-_.events.priority||x.distance-S.distance}).filter(x=>{const S=FM(x);return h.has(S)?!1:(h.add(S),!0)});u.events.filter&&(v=u.events.filter(v,u));for(const x of v){let S=x.object;for(;S;){var g;(g=S.__r3f)!=null&&g.eventCount&&d.push({...x,eventObject:S}),S=S.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let x of u.internal.capturedMap.get(l.pointerId).values())h.has(FM(x.intersection))||d.push(x.intersection);return d}function n(l,c,u,h){const d=e.getState();if(l.length){const f={stopped:!1};for(const m of l){const v=q1(m.object)||d,{raycaster:g,pointer:x,camera:S,internal:_}=v,A=new pe(x.x,x.y,0).unproject(S),T=L=>{var z,F;return(z=(F=_.capturedMap.get(L))==null?void 0:F.has(m.eventObject))!=null?z:!1},E=L=>{const z={intersection:m,target:c.target};_.capturedMap.has(L)?_.capturedMap.get(L).set(m.eventObject,z):_.capturedMap.set(L,new Map([[m.eventObject,z]])),c.target.setPointerCapture(L)},I=L=>{const z=_.capturedMap.get(L);z&&M7(_.capturedMap,m.eventObject,z,L)};let P={};for(let L in c){let z=c[L];typeof z!="function"&&(P[L]=z)}let C={...m,...P,pointer:x,intersections:l,stopped:f.stopped,delta:u,unprojectedPoint:A,ray:g.ray,camera:S,stopPropagation(){const L="pointerId"in c&&_.capturedMap.get(c.pointerId);if((!L||L.has(m.eventObject))&&(C.stopped=f.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(z=>z.eventObject===m.eventObject))){const z=l.slice(0,l.indexOf(m));s([...z,m])}},target:{hasPointerCapture:T,setPointerCapture:E,releasePointerCapture:I},currentTarget:{hasPointerCapture:T,setPointerCapture:E,releasePointerCapture:I},nativeEvent:c};if(h(C),f.stopped===!0)break}}return l}function s(l){const{internal:c}=e.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,f=d==null?void 0:d.handlers;if(c.hovered.delete(FM(u)),d!=null&&d.eventCount){const m={...u,intersections:l};f.onPointerOut==null||f.onPointerOut(m),f.onPointerLeave==null||f.onPointerLeave(m)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=e.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=u;const f=l==="onPointerMove",m=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",g=r(u,f?i:void 0),x=m?t(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=g.map(_=>_.eventObject)),m&&!g.length&&x<=2&&(a(u,d.interaction),h&&h(u)),f&&s(g);function S(_){const A=_.eventObject,T=A.__r3f,E=T==null?void 0:T.handlers;if(T!=null&&T.eventCount)if(f){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const I=FM(_),P=d.hovered.get(I);P?P.stopped&&_.stopPropagation():(d.hovered.set(I,_),E.onPointerOver==null||E.onPointerOver(_),E.onPointerEnter==null||E.onPointerEnter(_))}E.onPointerMove==null||E.onPointerMove(_)}else{const I=E[l];I?(!m||d.initialHits.includes(A))&&(a(u,d.interaction.filter(P=>!d.initialHits.includes(P))),I(_)):m&&d.initialHits.includes(A)&&a(u,d.interaction.filter(P=>!d.initialHits.includes(P)))}}n(g,u,x,S)}}return{handlePointer:o}}const A7=e=>!!(e!=null&&e.render),E7=Se.createContext(null),Uoe=(e,t)=>{const i=voe((o,l)=>{const c=new pe,u=new pe,h=new pe;function d(x=l().camera,S=u,_=l().size){const{width:A,height:T,top:E,left:I}=_,P=A/T;S instanceof pe?h.copy(S):h.set(...S);const C=x.getWorldPosition(c).distanceTo(h);if(y7(x))return{width:A/x.zoom,height:T/x.zoom,top:E,left:I,factor:1,distance:C,aspect:P};{const L=x.fov*Math.PI/180,z=2*Math.tan(L/2)*C,F=z*(A/T);return{width:F,height:z,top:E,left:I,factor:A/F,distance:C,aspect:P}}}let f;const m=x=>o(S=>({performance:{...S.performance,current:x}})),v=new yt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(x=1)=>e(l(),x),advance:(x,S)=>t(x,S,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Xz,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const x=l();f&&clearTimeout(f),x.performance.current!==x.performance.min&&m(x.performance.min),f=setTimeout(()=>m(l().performance.max),x.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:x=>o(S=>({...S,events:{...S.events,...x}})),setSize:(x,S,_,A,T)=>{const E=l().camera,I={width:x,height:S,top:A||0,left:T||0,updateStyle:_};o(P=>({size:I,viewport:{...P.viewport,...d(E,u,I)}}))},setDpr:x=>o(S=>{const _=_7(x);return{viewport:{...S.viewport,dpr:_,initialDpr:S.viewport.initialDpr||_}}}),setFrameloop:(x="always")=>{const S=l().clock;S.stop(),S.elapsedTime=0,x!=="never"&&(S.start(),S.elapsedTime=0),o(()=>({frameloop:x}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:Se.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(x,S,_)=>{const A=l().internal;return A.priority=A.priority+(S>0?1:0),A.subscribers.push({ref:x,priority:S,store:_}),A.subscribers=A.subscribers.sort((T,E)=>T.priority-E.priority),()=>{const T=l().internal;T!=null&&T.subscribers&&(T.priority=T.priority-(S>0?1:0),T.subscribers=T.subscribers.filter(E=>E.ref!==x))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l!==n||c.dpr!==s){var d;n=l,s=c.dpr,Ooe(o,l),u.setPixelRatio(c.dpr);const f=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,f)}o!==a&&(a=o,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};let kM,Foe=new Set,koe=new Set,Voe=new Set;function eD(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function Y1(e,t){switch(e){case"before":return eD(Foe,t);case"after":return eD(koe,t);case"tail":return eD(Voe,t)}}let tD,iD;function rD(e,t,i){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),tD=t.internal.subscribers,kM=0;kM<tD.length;kM++)iD=tD[kM],iD.ref.current(iD.store.getState(),r,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Hoe(e){let t=!1,i,r,n;function s(l){r=requestAnimationFrame(s),t=!0,i=0,Y1("before",l);for(const u of e.values()){var c;n=u.store.getState(),n.internal.active&&(n.frameloop==="always"||n.internal.frames>0)&&!((c=n.gl.xr)!=null&&c.isPresenting)&&(i+=rD(l,n))}if(Y1("after",l),i===0)return Y1("tail",l),t=!1,cancelAnimationFrame(r)}function a(l,c=1){var u;if(!l)return e.forEach(h=>a(h.store.getState()),c);(u=l.gl.xr)!=null&&u.isPresenting||!l.internal.active||l.frameloop==="never"||(l.internal.frames=Math.min(60,l.internal.frames+c),t||(t=!0,requestAnimationFrame(s)))}function o(l,c=!0,u,h){if(c&&Y1("before",l),u)rD(l,u,h);else for(const d of e.values())rD(l,d.store.getState());c&&Y1("after",l)}return{loop:s,invalidate:a,advance:o}}function T7(){const e=Se.useContext(E7);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function cl(e=i=>i,t){return T7()(e,t)}function _x(e,t=0){const i=T7(),r=i.getState().internal.subscribe,n=x7(e);return D_(()=>r(n,t,i),[t,r,i]),null}function C7(e,t){return function(i,...r){const n=new i;return e&&e(n),Promise.all(r.map(s=>new Promise((a,o)=>n.load(s,l=>{l.scene&&Object.assign(l,Ioe(l.scene)),a(l)},t,l=>o(new Error(`Could not load ${s}: ${l.message})`))))))}}function R_(e,t,i,r){const n=Array.isArray(t)?t:[t],s=Moe(C7(i,r),[e,...n],{equal:nn.equ});return Array.isArray(t)?s:s[0]}R_.preload=function(e,t,i){const r=Array.isArray(t)?t:[t];return Aoe(C7(i),[e,...r])};R_.clear=function(e,t){const i=Array.isArray(t)?t:[t];return Eoe([e,...i])};const ex=new Map,{invalidate:qk,advance:Yk}=Hoe(ex),{reconciler:ZE,applyProps:Iu}=Coe(ex,zoe),P0={objects:"shallow",strict:!1},Goe=(e,t)=>{const i=typeof e=="function"?e(t):e;return A7(i)?i:new Dz({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function joe(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:r,top:n,left:s}=e.parentElement.getBoundingClientRect();return{width:i,height:r,top:n,left:s}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Woe(e){const t=ex.get(e),i=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||Uoe(qk,Yk),a=i||ZE.createContainer(s,_y.ConcurrentRoot,null,!1,null,"",n,null);t||ex.set(e,{fiber:a,store:s});let o,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:f,events:m,onCreated:v,shadows:g=!1,linear:x=!1,flat:S=!1,legacy:_=!1,orthographic:A=!1,frameloop:T="always",dpr:E=[1,2],performance:I,raycaster:P,camera:C,onPointerMissed:L}=u,z=s.getState(),F=z.gl;z.gl||z.set({gl:F=Goe(h,e)});let G=z.raycaster;G||z.set({raycaster:G=new d7});const{params:N,...q}=P||{};if(nn.equ(q,G,P0)||Iu(G,{...q}),nn.equ(N,G.params,P0)||Iu(G,{params:{...G.params,...N}}),!z.camera||z.camera===c&&!nn.equ(c,C,P0)){c=C;const j=C instanceof __,$=j?C:A?new Hu(0,0,0,0,.1,1e3):new gn(75,0,.1,1e3);j||($.position.z=5,C&&Iu($,C),!z.camera&&!(C!=null&&C.rotation)&&$.lookAt(0,0,0)),z.set({camera:$})}if(!z.scene){let j;f instanceof YE?j=f:(j=new YE,f&&Iu(j,f)),z.set({scene:ly(j)})}if(!z.xr){const j=(re,he)=>{const oe=s.getState();oe.frameloop!=="never"&&Yk(re,!0,oe,he)},$=()=>{const re=s.getState();re.gl.xr.enabled=re.gl.xr.isPresenting,re.gl.xr.setAnimationLoop(re.gl.xr.isPresenting?j:null),re.gl.xr.isPresenting||qk(re)},se={connect(){const re=s.getState().gl;re.xr.addEventListener("sessionstart",$),re.xr.addEventListener("sessionend",$)},disconnect(){const re=s.getState().gl;re.xr.removeEventListener("sessionstart",$),re.xr.removeEventListener("sessionend",$)}};F.xr&&se.connect(),z.set({xr:se})}if(F.shadowMap){const j=F.shadowMap.enabled,$=F.shadowMap.type;if(F.shadowMap.enabled=!!g,nn.boo(g))F.shadowMap.type=Xw;else if(nn.str(g)){var ie;const se={basic:o8,percentage:m2,soft:Xw,variance:Ic};F.shadowMap.type=(ie=se[g])!=null?ie:Xw}else nn.obj(g)&&Object.assign(F.shadowMap,g);(j!==F.shadowMap.enabled||$!==F.shadowMap.type)&&(F.shadowMap.needsUpdate=!0)}const Q=v7();Q&&("enabled"in Q?Q.enabled=!_:"legacyMode"in Q&&(Q.legacyMode=_)),Iu(F,{outputEncoding:x?3e3:3001,toneMapping:S?ku:oz}),z.legacy!==_&&z.set(()=>({legacy:_})),z.linear!==x&&z.set(()=>({linear:x})),z.flat!==S&&z.set(()=>({flat:S})),h&&!nn.fun(h)&&!A7(h)&&!nn.equ(h,F,P0)&&Iu(F,h),m&&!z.events.handlers&&z.set({events:m(s)});const K=joe(e,d);return nn.equ(K,z.size,P0)||z.setSize(K.width,K.height,K.updateStyle,K.top,K.left),E&&z.viewport.dpr!==_7(E)&&z.setDpr(E),z.frameloop!==T&&z.setFrameloop(T),z.onPointerMissed||z.set({onPointerMissed:L}),I&&!nn.equ(I,z.performance,P0)&&z.set(j=>({performance:{...j.performance,...I}})),o=v,l=!0,this},render(u){return l||this.configure(),ZE.updateContainer(Se.createElement(Xoe,{store:s,children:u,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){P7(e)}}}function Xoe({store:e,children:t,onCreated:i,rootElement:r}){return D_(()=>{const n=e.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),e.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),Se.createElement(E7.Provider,{value:e},t)}function P7(e,t){const i=ex.get(e),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),ZE.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),Loe(n),ex.delete(e)}catch{}},500)})}}ZE.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Se.version});function Wl(){return Wl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Wl.apply(null,arguments)}function Qk(e,t){let i;return(...r)=>{window.clearTimeout(i),i=window.setTimeout(()=>e(...r),t)}}function qoe({debounce:e,scroll:t,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=Se.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=Se.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=Se.useRef(!1);Se.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,f]=Se.useMemo(()=>{const x=()=>{if(!o.current.element)return;const{left:S,top:_,width:A,height:T,bottom:E,right:I,x:P,y:C}=o.current.element.getBoundingClientRect(),L={left:S,top:_,width:A,height:T,bottom:E,right:I,x:P,y:C};o.current.element instanceof HTMLElement&&r&&(L.height=o.current.element.offsetHeight,L.width=o.current.element.offsetWidth),Object.freeze(L),u.current&&!Koe(o.current.lastBounds,L)&&a(o.current.lastBounds=L)};return[x,c?Qk(x,c):x,l?Qk(x,l):x]},[a,r,l,c]);function m(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(x=>x.removeEventListener("scroll",f,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function v(){o.current.element&&(o.current.resizeObserver=new n(f),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(x=>x.addEventListener("scroll",f,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const g=x=>{!x||x===o.current.element||(m(),o.current.element=x,o.current.scrollContainers=D7(x),v())};return Qoe(f,!!t),Yoe(d),Se.useEffect(()=>{m(),v()},[t,f,d]),Se.useEffect(()=>m,[]),[g,s,h]}function Yoe(e){Se.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Qoe(e,t){Se.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function D7(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...D7(e.parentElement)]}const Zoe=["x","y","top","bottom","left","right","width","height"],Koe=(e,t)=>Zoe.every(i=>e[i]===t[i]);var Joe=Object.defineProperty,$oe=Object.defineProperties,ele=Object.getOwnPropertyDescriptors,Zk=Object.getOwnPropertySymbols,tle=Object.prototype.hasOwnProperty,ile=Object.prototype.propertyIsEnumerable,Kk=(e,t,i)=>t in e?Joe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Jk=(e,t)=>{for(var i in t||(t={}))tle.call(t,i)&&Kk(e,i,t[i]);if(Zk)for(var i of Zk(t))ile.call(t,i)&&Kk(e,i,t[i]);return e},rle=(e,t)=>$oe(e,ele(t)),$k,e4;typeof window<"u"&&(($k=window.document)!=null&&$k.createElement||((e4=window.navigator)==null?void 0:e4.product)==="ReactNative")?Se.useLayoutEffect:Se.useEffect;function R7(e,t,i){if(!e)return;if(i(e)===!0)return e;let r=e.child;for(;r;){const n=R7(r,t,i);if(n)return n;r=r.sibling}}function I7(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const t4=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=t4;return}return t4.apply(this,arguments)};const Kz=I7(Se.createContext(null));class L7 extends Se.Component{render(){return Se.createElement(Kz.Provider,{value:this._reactInternals},this.props.children)}}function nle(){const e=Se.useContext(Kz);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=Se.useId();return Se.useMemo(()=>{for(const r of[e,e==null?void 0:e.alternate]){if(!r)continue;const n=R7(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===t)return!0;a=a.next}});if(n)return n}},[e,t])}function sle(){const e=nle(),[t]=Se.useState(()=>new Map);t.clear();let i=e;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==Kz&&!t.has(n)&&t.set(n,Se.useContext(I7(n)))}i=i.return}return t}function ale(){const e=sle();return Se.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>r=>Se.createElement(t,null,Se.createElement(i.Provider,rle(Jk({},r),{value:e.get(i)}))),t=>Se.createElement(L7,Jk({},t))),[e])}const nD={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function ole(e){const{handlePointer:t}=Noe(e);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(nD).reduce((i,r)=>({...i,[r]:t(r)}),{}),update:()=>{var i;const{events:r,internal:n}=e.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=e.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=nD[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=e.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=nD[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}const lle=Se.forwardRef(function({children:t,fallback:i,resize:r,style:n,gl:s,events:a=ole,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:m,dpr:v,performance:g,raycaster:x,camera:S,onPointerMissed:_,onCreated:A,...T},E){Se.useMemo(()=>Toe(doe),[]);const I=ale(),[P,C]=qoe({scroll:!0,debounce:{scroll:50,resize:0},...r}),L=Se.useRef(null),z=Se.useRef(null);Se.useImperativeHandle(E,()=>L.current);const F=x7(_),[G,N]=Se.useState(!1),[q,ie]=Se.useState(!1);if(G)throw G;if(q)throw q;const Q=Se.useRef(null);D_(()=>{const ee=L.current;C.width>0&&C.height>0&&ee&&(Q.current||(Q.current=Woe(ee)),Q.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:m,dpr:v,performance:g,raycaster:x,camera:S,size:C,onPointerMissed:(...K)=>F.current==null?void 0:F.current(...K),onCreated:K=>{K.events.connect==null||K.events.connect(o?Poe(o)?o.current:o:z.current),l&&K.setEvents({compute:(j,$)=>{const se=j[l+"X"],re=j[l+"Y"];$.pointer.set(se/$.size.width*2-1,-(re/$.size.height)*2+1),$.raycaster.setFromCamera($.pointer,$.camera)}}),A==null||A(K)}}),Q.current.render(Se.createElement(I,null,Se.createElement(w7,{set:ie},Se.createElement(Se.Suspense,{fallback:Se.createElement(Doe,{set:N})},t)))))}),Se.useEffect(()=>{const ee=L.current;if(ee)return()=>P7(ee)},[]);const W=o?"none":"auto";return Se.createElement("div",Wl({ref:z,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...n}},T),Se.createElement("div",{ref:P,style:{width:"100%",height:"100%"}},Se.createElement("canvas",{ref:L,style:{display:"block"}},i)))}),O7=Se.forwardRef(function(t,i){return Se.createElement(L7,null,Se.createElement(lle,Wl({},t,{ref:i})))}),I_=new pe,Jz=new pe,cle=new pe,i4=new yt;function ule(e,t,i){const r=I_.setFromMatrixPosition(e.matrixWorld);r.project(t);const n=i.width/2,s=i.height/2;return[r.x*n+n,-(r.y*s)+s]}function hle(e,t){const i=I_.setFromMatrixPosition(e.matrixWorld),r=Jz.setFromMatrixPosition(t.matrixWorld),n=i.sub(r),s=t.getWorldDirection(cle);return n.angleTo(s)>Math.PI/2}function dle(e,t,i,r){const n=I_.setFromMatrixPosition(e.matrixWorld),s=n.clone();s.project(t),i4.set(s.x,s.y),i.setFromCamera(i4,t);const a=i.intersectObjects(r,!0);if(a.length){const o=a[0].distance;return n.distanceTo(i.ray.origin)<o}return!0}function fle(e,t){if(t instanceof Hu)return t.zoom;if(t instanceof gn){const i=I_.setFromMatrixPosition(e.matrixWorld),r=Jz.setFromMatrixPosition(t.matrixWorld),n=t.fov*Math.PI/180,s=i.distanceTo(r);return 1/(2*Math.tan(n/2)*s)}else return 1}function ple(e,t,i){if(t instanceof gn||t instanceof Hu){const r=I_.setFromMatrixPosition(e.matrixWorld),n=Jz.setFromMatrixPosition(t.matrixWorld),s=r.distanceTo(n),a=(i[1]-i[0])/(t.far-t.near),o=i[1]-a*t.far;return Math.round(a*s+o)}}const II=e=>Math.abs(e)<1e-10?0:e;function z7(e,t,i=""){let r="matrix3d(";for(let n=0;n!==16;n++)r+=II(t[n]*e.elements[n])+(n!==15?",":")");return i+r}const mle=(e=>t=>z7(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),gle=(e=>(t,i)=>z7(t,e(i),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function vle(e){return e&&typeof e=="object"&&"current"in e}const yle=Se.forwardRef(({children:e,eps:t=.001,style:i,className:r,prepend:n,center:s,fullscreen:a,portal:o,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:d,castShadow:f,receiveShadow:m,material:v,geometry:g,zIndexRange:x=[16777271,0],calculatePosition:S=ule,as:_="div",wrapperClass:A,pointerEvents:T="auto",...E},I)=>{const{gl:P,camera:C,scene:L,size:z,raycaster:F,events:G,viewport:N}=cl(),[q]=Se.useState(()=>document.createElement(_)),ie=Se.useRef(),Q=Se.useRef(null),W=Se.useRef(0),ee=Se.useRef([0,0]),K=Se.useRef(null),j=Se.useRef(null),$=(o==null?void 0:o.current)||G.connected||P.domElement.parentNode,se=Se.useRef(null),re=Se.useRef(!1),he=Se.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&vle(h[0]),[h]);Se.useLayoutEffect(()=>{const Me=P.domElement;h&&h==="blending"?(Me.style.zIndex=`${Math.floor(x[0]/2)}`,Me.style.position="absolute",Me.style.pointerEvents="none"):(Me.style.zIndex=null,Me.style.position=null,Me.style.pointerEvents=null)},[h]),Se.useLayoutEffect(()=>{if(Q.current){const Me=ie.current=ZW.createRoot(q);if(L.updateMatrixWorld(),u)q.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Te=S(Q.current,C,z);q.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Te[0]}px,${Te[1]}px,0);transform-origin:0 0;`}return $&&(n?$.prepend(q):$.appendChild(q)),()=>{$&&$.removeChild(q),Me.unmount()}}},[$,u]),Se.useLayoutEffect(()=>{A&&(q.className=A)},[A]);const oe=Se.useMemo(()=>u?{position:"absolute",top:0,left:0,width:z.width,height:z.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-z.height/2,left:-z.width/2,width:z.width,height:z.height},...i},[i,s,a,z,u]),ve=Se.useMemo(()=>({position:"absolute",pointerEvents:T}),[T]);Se.useLayoutEffect(()=>{if(re.current=!1,u){var Me;(Me=ie.current)==null||Me.render(Se.createElement("div",{ref:K,style:oe},Se.createElement("div",{ref:j,style:ve},Se.createElement("div",{ref:I,className:r,style:i,children:e}))))}else{var Te;(Te=ie.current)==null||Te.render(Se.createElement("div",{ref:I,style:oe,className:r,children:e}))}});const xe=Se.useRef(!0);_x(Me=>{if(Q.current){C.updateMatrixWorld(),Q.current.updateWorldMatrix(!0,!1);const Te=u?ee.current:S(Q.current,C,z);if(u||Math.abs(W.current-C.zoom)>t||Math.abs(ee.current[0]-Te[0])>t||Math.abs(ee.current[1]-Te[1])>t){const ae=hle(Q.current,C);let Ce=!1;he&&(Array.isArray(h)?Ce=h.map(lt=>lt.current):h!=="blending"&&(Ce=[L]));const Ie=xe.current;if(Ce){const lt=dle(Q.current,C,F,Ce);xe.current=lt&&!ae}else xe.current=!ae;Ie!==xe.current&&(d?d(!xe.current):q.style.display=xe.current?"block":"none");const Be=Math.floor(x[0]/2),Ve=h?he?[x[0],Be]:[Be-1,0]:x;if(q.style.zIndex=`${ple(Q.current,C,Ve)}`,u){const[lt,We]=[z.width/2,z.height/2],je=C.projectionMatrix.elements[5]*We,{isOrthographicCamera:xt,top:Mt,left:de,bottom:V,right:X}=C,we=mle(C.matrixWorldInverse),J=xt?`scale(${je})translate(${II(-(X+de)/2)}px,${II((Mt+V)/2)}px)`:`translateZ(${je}px)`;let Le=Q.current.matrixWorld;c&&(Le=C.matrixWorldInverse.clone().transpose().copyPosition(Le).scale(Q.current.scale),Le.elements[3]=Le.elements[7]=Le.elements[11]=0,Le.elements[15]=1),q.style.width=z.width+"px",q.style.height=z.height+"px",q.style.perspective=xt?"":`${je}px`,K.current&&j.current&&(K.current.style.transform=`${J}${we}translate(${lt}px,${We}px)`,j.current.style.transform=gle(Le,1/((l||10)/400)))}else{const lt=l===void 0?1:fle(Q.current,C)*l;q.style.transform=`translate3d(${Te[0]}px,${Te[1]}px,0) scale(${lt})`}ee.current=Te,W.current=C.zoom}}if(!he&&se.current&&!re.current)if(u){if(K.current){const Te=K.current.children[0];if(Te!=null&&Te.clientWidth&&Te!=null&&Te.clientHeight){const{isOrthographicCamera:ae}=C;if(ae||g)E.scale&&(Array.isArray(E.scale)?E.scale instanceof pe?se.current.scale.copy(E.scale.clone().divideScalar(1)):se.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):se.current.scale.setScalar(1/E.scale));else{const Ce=(l||10)/400,Ie=Te.clientWidth*Ce,Be=Te.clientHeight*Ce;se.current.scale.set(Ie,Be,1)}re.current=!0}}}else{const Te=q.children[0];if(Te!=null&&Te.clientWidth&&Te!=null&&Te.clientHeight){const ae=1/N.factor,Ce=Te.clientWidth*ae,Ie=Te.clientHeight*ae;se.current.scale.set(Ce,Ie,1),re.current=!0}se.current.lookAt(Me.camera.position)}});const be=Se.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return Se.createElement("group",Wl({},E,{ref:Q}),h&&!he&&Se.createElement("mesh",{castShadow:f,receiveShadow:m,ref:se},g||Se.createElement("planeGeometry",null),v||Se.createElement("shaderMaterial",{side:Oc,vertexShader:be.vertexShader,fragmentShader:be.fragmentShader})))}),r4=e=>{let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(!Object.is(h,t)){const d=t;t=u??(typeof h!="object"||h===null)?h:Object.assign({},t,h),i.forEach(f=>f(t,d))}},n=()=>t,o={setState:r,getState:n,getInitialState:()=>l,subscribe:c=>(i.add(c),()=>i.delete(c))},l=t=e(r,n,o);return o},xle=e=>e?r4(e):r4,wle=e=>e;function ble(e,t=wle){const i=Gc.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return Gc.useDebugValue(i),i}const n4=e=>{const t=xle(e),i=r=>ble(t,r);return Object.assign(i,t),i},_le=e=>e?n4(e):n4;let Q1=0;const Sle=_le(e=>(by.onStart=(t,i,r)=>{e({active:!0,item:t,loaded:i,total:r,progress:(i-Q1)/(r-Q1)*100})},by.onLoad=()=>{e({active:!1})},by.onError=t=>e(i=>({errors:[...i.errors,t]})),by.onProgress=(t,i,r)=>{i===r&&(Q1=r),e({active:!0,item:t,loaded:i,total:r,progress:(i-Q1)/(r-Q1)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));var Mle=Object.defineProperty,Ale=(e,t,i)=>t in e?Mle(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ele=(e,t,i)=>(Ale(e,t+"",i),i);class Tle{constructor(){Ele(this,"_listeners")}addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}var Cle=Object.defineProperty,Ple=(e,t,i)=>t in e?Cle(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Si=(e,t,i)=>(Ple(e,typeof t!="symbol"?t+"":t,i),i);const VM=new Jg,s4=new od,Dle=Math.cos(70*(Math.PI/180)),a4=(e,t)=>(e%t+t)%t;let Rle=class extends Tle{constructor(t,i){super(),Si(this,"object"),Si(this,"domElement"),Si(this,"enabled",!0),Si(this,"target",new pe),Si(this,"minDistance",0),Si(this,"maxDistance",1/0),Si(this,"minZoom",0),Si(this,"maxZoom",1/0),Si(this,"minPolarAngle",0),Si(this,"maxPolarAngle",Math.PI),Si(this,"minAzimuthAngle",-1/0),Si(this,"maxAzimuthAngle",1/0),Si(this,"enableDamping",!1),Si(this,"dampingFactor",.05),Si(this,"enableZoom",!0),Si(this,"zoomSpeed",1),Si(this,"enableRotate",!0),Si(this,"rotateSpeed",1),Si(this,"enablePan",!0),Si(this,"panSpeed",1),Si(this,"screenSpacePanning",!0),Si(this,"keyPanSpeed",7),Si(this,"zoomToCursor",!1),Si(this,"autoRotate",!1),Si(this,"autoRotateSpeed",2),Si(this,"reverseOrbit",!1),Si(this,"reverseHorizontalOrbit",!1),Si(this,"reverseVerticalOrbit",!1),Si(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Si(this,"mouseButtons",{LEFT:Xm.ROTATE,MIDDLE:Xm.DOLLY,RIGHT:Xm.PAN}),Si(this,"touches",{ONE:qm.ROTATE,TWO:qm.DOLLY_PAN}),Si(this,"target0"),Si(this,"position0"),Si(this,"zoom0"),Si(this,"_domElementKeyEvents",null),Si(this,"getPolarAngle"),Si(this,"getAzimuthalAngle"),Si(this,"setPolarAngle"),Si(this,"setAzimuthalAngle"),Si(this,"getDistance"),Si(this,"getZoomScale"),Si(this,"listenToKeyEvents"),Si(this,"stopListenToKeyEvents"),Si(this,"saveState"),Si(this,"reset"),Si(this,"update"),Si(this,"connect"),Si(this,"dispose"),Si(this,"dollyIn"),Si(this,"dollyOut"),Si(this,"getScale"),Si(this,"setScale"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=ge=>{let $e=a4(ge,2*Math.PI),mt=u.phi;mt<0&&(mt+=2*Math.PI),$e<0&&($e+=2*Math.PI);let me=Math.abs($e-mt);2*Math.PI-me<me&&($e<mt?$e+=2*Math.PI:mt+=2*Math.PI),h.phi=$e-mt,r.update()},this.setAzimuthalAngle=ge=>{let $e=a4(ge,2*Math.PI),mt=u.theta;mt<0&&(mt+=2*Math.PI),$e<0&&($e+=2*Math.PI);let me=Math.abs($e-mt);2*Math.PI-me<me&&($e<mt?$e+=2*Math.PI:mt+=2*Math.PI),h.theta=$e-mt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=ge=>{ge.addEventListener("keydown",qe),this._domElementKeyEvents=ge},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",qe),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const ge=new pe,$e=new pe(0,1,0),mt=new za().setFromUnitVectors(t.up,$e),me=mt.clone().invert(),Ne=new pe,ue=new za,et=2*Math.PI;return function(){const Ze=r.object.position;mt.setFromUnitVectors(t.up,$e),me.copy(mt).invert(),ge.copy(Ze).sub(r.target),ge.applyQuaternion(mt),u.setFromVector3(ge),r.autoRotate&&l===o.NONE&&N(F()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let bt=r.minAzimuthAngle,Ft=r.maxAzimuthAngle;isFinite(bt)&&isFinite(Ft)&&(bt<-Math.PI?bt+=et:bt>Math.PI&&(bt-=et),Ft<-Math.PI?Ft+=et:Ft>Math.PI&&(Ft-=et),bt<=Ft?u.theta=Math.max(bt,Math.min(Ft,u.theta)):u.theta=u.theta>(bt+Ft)/2?Math.max(bt,u.theta):Math.min(Ft,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),r.zoomToCursor&&C||r.object.isOrthographicCamera?u.radius=se(u.radius):u.radius=se(u.radius*d),ge.setFromSpherical(u),ge.applyQuaternion(me),Ze.copy(r.target).add(ge),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),f.set(0,0,0));let ui=!1;if(r.zoomToCursor&&C){let ci=null;if(r.object instanceof gn&&r.object.isPerspectiveCamera){const Qi=ge.length();ci=se(Qi*d);const mi=Qi-ci;r.object.position.addScaledVector(I,mi),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Qi=new pe(P.x,P.y,0);Qi.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),ui=!0;const mi=new pe(P.x,P.y,0);mi.unproject(r.object),r.object.position.sub(mi).add(Qi),r.object.updateMatrixWorld(),ci=ge.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;ci!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(ci).add(r.object.position):(VM.origin.copy(r.object.position),VM.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(VM.direction))<Dle?t.lookAt(r.target):(s4.setFromNormalAndCoplanarPoint(r.object.up,r.target),VM.intersectPlane(s4,r.target))))}else r.object instanceof Hu&&r.object.isOrthographicCamera&&(ui=d!==1,ui&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,C=!1,ui||Ne.distanceToSquared(r.object.position)>c||8*(1-ue.dot(r.object.quaternion))>c?(r.dispatchEvent(n),Ne.copy(r.object.position),ue.copy(r.object.quaternion),ui=!1,!0):!1}})(),this.connect=ge=>{r.domElement=ge,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",nt),r.domElement.addEventListener("pointerdown",de),r.domElement.addEventListener("pointercancel",X),r.domElement.addEventListener("wheel",Le)},this.dispose=()=>{var ge,$e,mt,me,Ne,ue;r.domElement&&(r.domElement.style.touchAction="auto"),(ge=r.domElement)==null||ge.removeEventListener("contextmenu",nt),($e=r.domElement)==null||$e.removeEventListener("pointerdown",de),(mt=r.domElement)==null||mt.removeEventListener("pointercancel",X),(me=r.domElement)==null||me.removeEventListener("wheel",Le),(Ne=r.domElement)==null||Ne.ownerDocument.removeEventListener("pointermove",V),(ue=r.domElement)==null||ue.ownerDocument.removeEventListener("pointerup",X),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",qe)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new PI,h=new PI;let d=1;const f=new pe,m=new yt,v=new yt,g=new yt,x=new yt,S=new yt,_=new yt,A=new yt,T=new yt,E=new yt,I=new pe,P=new yt;let C=!1;const L=[],z={};function F(){return 2*Math.PI/60/60*r.autoRotateSpeed}function G(){return Math.pow(.95,r.zoomSpeed)}function N(ge){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=ge:h.theta-=ge}function q(ge){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=ge:h.phi-=ge}const ie=(()=>{const ge=new pe;return function(mt,me){ge.setFromMatrixColumn(me,0),ge.multiplyScalar(-mt),f.add(ge)}})(),Q=(()=>{const ge=new pe;return function(mt,me){r.screenSpacePanning===!0?ge.setFromMatrixColumn(me,1):(ge.setFromMatrixColumn(me,0),ge.crossVectors(r.object.up,ge)),ge.multiplyScalar(mt),f.add(ge)}})(),W=(()=>{const ge=new pe;return function(mt,me){const Ne=r.domElement;if(Ne&&r.object instanceof gn&&r.object.isPerspectiveCamera){const ue=r.object.position;ge.copy(ue).sub(r.target);let et=ge.length();et*=Math.tan(r.object.fov/2*Math.PI/180),ie(2*mt*et/Ne.clientHeight,r.object.matrix),Q(2*me*et/Ne.clientHeight,r.object.matrix)}else Ne&&r.object instanceof Hu&&r.object.isOrthographicCamera?(ie(mt*(r.object.right-r.object.left)/r.object.zoom/Ne.clientWidth,r.object.matrix),Q(me*(r.object.top-r.object.bottom)/r.object.zoom/Ne.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function ee(ge){r.object instanceof gn&&r.object.isPerspectiveCamera||r.object instanceof Hu&&r.object.isOrthographicCamera?d=ge:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function K(ge){ee(d/ge)}function j(ge){ee(d*ge)}function $(ge){if(!r.zoomToCursor||!r.domElement)return;C=!0;const $e=r.domElement.getBoundingClientRect(),mt=ge.clientX-$e.left,me=ge.clientY-$e.top,Ne=$e.width,ue=$e.height;P.x=mt/Ne*2-1,P.y=-(me/ue)*2+1,I.set(P.x,P.y,1).unproject(r.object).sub(r.object.position).normalize()}function se(ge){return Math.max(r.minDistance,Math.min(r.maxDistance,ge))}function re(ge){m.set(ge.clientX,ge.clientY)}function he(ge){$(ge),A.set(ge.clientX,ge.clientY)}function oe(ge){x.set(ge.clientX,ge.clientY)}function ve(ge){v.set(ge.clientX,ge.clientY),g.subVectors(v,m).multiplyScalar(r.rotateSpeed);const $e=r.domElement;$e&&(N(2*Math.PI*g.x/$e.clientHeight),q(2*Math.PI*g.y/$e.clientHeight)),m.copy(v),r.update()}function xe(ge){T.set(ge.clientX,ge.clientY),E.subVectors(T,A),E.y>0?K(G()):E.y<0&&j(G()),A.copy(T),r.update()}function be(ge){S.set(ge.clientX,ge.clientY),_.subVectors(S,x).multiplyScalar(r.panSpeed),W(_.x,_.y),x.copy(S),r.update()}function Me(ge){$(ge),ge.deltaY<0?j(G()):ge.deltaY>0&&K(G()),r.update()}function Te(ge){let $e=!1;switch(ge.code){case r.keys.UP:W(0,r.keyPanSpeed),$e=!0;break;case r.keys.BOTTOM:W(0,-r.keyPanSpeed),$e=!0;break;case r.keys.LEFT:W(r.keyPanSpeed,0),$e=!0;break;case r.keys.RIGHT:W(-r.keyPanSpeed,0),$e=!0;break}$e&&(ge.preventDefault(),r.update())}function ae(){if(L.length==1)m.set(L[0].pageX,L[0].pageY);else{const ge=.5*(L[0].pageX+L[1].pageX),$e=.5*(L[0].pageY+L[1].pageY);m.set(ge,$e)}}function Ce(){if(L.length==1)x.set(L[0].pageX,L[0].pageY);else{const ge=.5*(L[0].pageX+L[1].pageX),$e=.5*(L[0].pageY+L[1].pageY);x.set(ge,$e)}}function Ie(){const ge=L[0].pageX-L[1].pageX,$e=L[0].pageY-L[1].pageY,mt=Math.sqrt(ge*ge+$e*$e);A.set(0,mt)}function Be(){r.enableZoom&&Ie(),r.enablePan&&Ce()}function Ve(){r.enableZoom&&Ie(),r.enableRotate&&ae()}function lt(ge){if(L.length==1)v.set(ge.pageX,ge.pageY);else{const mt=Dt(ge),me=.5*(ge.pageX+mt.x),Ne=.5*(ge.pageY+mt.y);v.set(me,Ne)}g.subVectors(v,m).multiplyScalar(r.rotateSpeed);const $e=r.domElement;$e&&(N(2*Math.PI*g.x/$e.clientHeight),q(2*Math.PI*g.y/$e.clientHeight)),m.copy(v)}function We(ge){if(L.length==1)S.set(ge.pageX,ge.pageY);else{const $e=Dt(ge),mt=.5*(ge.pageX+$e.x),me=.5*(ge.pageY+$e.y);S.set(mt,me)}_.subVectors(S,x).multiplyScalar(r.panSpeed),W(_.x,_.y),x.copy(S)}function je(ge){const $e=Dt(ge),mt=ge.pageX-$e.x,me=ge.pageY-$e.y,Ne=Math.sqrt(mt*mt+me*me);T.set(0,Ne),E.set(0,Math.pow(T.y/A.y,r.zoomSpeed)),K(E.y),A.copy(T)}function xt(ge){r.enableZoom&&je(ge),r.enablePan&&We(ge)}function Mt(ge){r.enableZoom&&je(ge),r.enableRotate&&lt(ge)}function de(ge){var $e,mt;r.enabled!==!1&&(L.length===0&&(($e=r.domElement)==null||$e.ownerDocument.addEventListener("pointermove",V),(mt=r.domElement)==null||mt.ownerDocument.addEventListener("pointerup",X)),gt(ge),ge.pointerType==="touch"?ct(ge):we(ge))}function V(ge){r.enabled!==!1&&(ge.pointerType==="touch"?Pe(ge):J(ge))}function X(ge){var $e,mt,me;Tt(ge),L.length===0&&(($e=r.domElement)==null||$e.releasePointerCapture(ge.pointerId),(mt=r.domElement)==null||mt.ownerDocument.removeEventListener("pointermove",V),(me=r.domElement)==null||me.ownerDocument.removeEventListener("pointerup",X)),r.dispatchEvent(a),l=o.NONE}function we(ge){let $e;switch(ge.button){case 0:$e=r.mouseButtons.LEFT;break;case 1:$e=r.mouseButtons.MIDDLE;break;case 2:$e=r.mouseButtons.RIGHT;break;default:$e=-1}switch($e){case Xm.DOLLY:if(r.enableZoom===!1)return;he(ge),l=o.DOLLY;break;case Xm.ROTATE:if(ge.ctrlKey||ge.metaKey||ge.shiftKey){if(r.enablePan===!1)return;oe(ge),l=o.PAN}else{if(r.enableRotate===!1)return;re(ge),l=o.ROTATE}break;case Xm.PAN:if(ge.ctrlKey||ge.metaKey||ge.shiftKey){if(r.enableRotate===!1)return;re(ge),l=o.ROTATE}else{if(r.enablePan===!1)return;oe(ge),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function J(ge){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;ve(ge);break;case o.DOLLY:if(r.enableZoom===!1)return;xe(ge);break;case o.PAN:if(r.enablePan===!1)return;be(ge);break}}function Le(ge){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(ge.preventDefault(),r.dispatchEvent(s),Me(ge),r.dispatchEvent(a))}function qe(ge){r.enabled===!1||r.enablePan===!1||Te(ge)}function ct(ge){switch(rt(ge),L.length){case 1:switch(r.touches.ONE){case qm.ROTATE:if(r.enableRotate===!1)return;ae(),l=o.TOUCH_ROTATE;break;case qm.PAN:if(r.enablePan===!1)return;Ce(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case qm.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Be(),l=o.TOUCH_DOLLY_PAN;break;case qm.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ve(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function Pe(ge){switch(rt(ge),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;lt(ge),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;We(ge),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;xt(ge),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Mt(ge),r.update();break;default:l=o.NONE}}function nt(ge){r.enabled!==!1&&ge.preventDefault()}function gt(ge){L.push(ge)}function Tt(ge){delete z[ge.pointerId];for(let $e=0;$e<L.length;$e++)if(L[$e].pointerId==ge.pointerId){L.splice($e,1);return}}function rt(ge){let $e=z[ge.pointerId];$e===void 0&&($e=new yt,z[ge.pointerId]=$e),$e.set(ge.pageX,ge.pageY)}function Dt(ge){const $e=ge.pointerId===L[0].pointerId?L[1]:L[0];return z[$e.pointerId]}this.dollyIn=(ge=G())=>{j(ge),r.update()},this.dollyOut=(ge=G())=>{K(ge),r.update()},this.getScale=()=>d,this.setScale=ge=>{ee(ge),r.update()},this.getZoomScale=()=>G(),i!==void 0&&this.connect(i),this.update()}};class Ile extends Gi{constructor(t,i,r,n){super();const s=[],a=[],o=[],l=new pe,c=new Ci;c.makeRotationFromEuler(r),c.setPosition(i);const u=new Ci;u.copy(c).invert(),h(),this.setAttribute("position",new ii(s,3)),this.setAttribute("normal",new ii(a,3)),this.setAttribute("uv",new ii(o,2));function h(){let v,g=[];const x=new pe,S=new pe;if(t.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const _=t.geometry,A=_.attributes.position,T=_.attributes.normal;if(_.index!==null){const E=_.index;for(v=0;v<E.count;v++)x.fromBufferAttribute(A,E.getX(v)),S.fromBufferAttribute(T,E.getX(v)),d(g,x,S)}else for(v=0;v<A.count;v++)x.fromBufferAttribute(A,v),S.fromBufferAttribute(T,v),d(g,x,S);for(g=f(g,l.set(1,0,0)),g=f(g,l.set(-1,0,0)),g=f(g,l.set(0,1,0)),g=f(g,l.set(0,-1,0)),g=f(g,l.set(0,0,1)),g=f(g,l.set(0,0,-1)),v=0;v<g.length;v++){const E=g[v];o.push(.5+E.position.x/n.x,.5+E.position.y/n.y),E.position.applyMatrix4(c),s.push(E.position.x,E.position.y,E.position.z),a.push(E.normal.x,E.normal.y,E.normal.z)}}function d(v,g,x){g.applyMatrix4(t.matrixWorld),g.applyMatrix4(u),x.transformDirection(t.matrixWorld),v.push(new o4(g.clone(),x.clone()))}function f(v,g){const x=[],S=.5*Math.abs(n.dot(g));for(let _=0;_<v.length;_+=3){let A,T,E,I=0,P,C,L,z;const F=v[_+0].position.dot(g)-S,G=v[_+1].position.dot(g)-S,N=v[_+2].position.dot(g)-S;switch(A=F>0,T=G>0,E=N>0,I=(A?1:0)+(T?1:0)+(E?1:0),I){case 0:{x.push(v[_]),x.push(v[_+1]),x.push(v[_+2]);break}case 1:{if(A&&(P=v[_+1],C=v[_+2],L=m(v[_],P,g,S),z=m(v[_],C,g,S)),T){P=v[_],C=v[_+2],L=m(v[_+1],P,g,S),z=m(v[_+1],C,g,S),x.push(L),x.push(C.clone()),x.push(P.clone()),x.push(C.clone()),x.push(L.clone()),x.push(z);break}E&&(P=v[_],C=v[_+1],L=m(v[_+2],P,g,S),z=m(v[_+2],C,g,S)),x.push(P.clone()),x.push(C.clone()),x.push(L),x.push(z),x.push(L.clone()),x.push(C.clone());break}case 2:{A||(P=v[_].clone(),C=m(P,v[_+1],g,S),L=m(P,v[_+2],g,S),x.push(P),x.push(C),x.push(L)),T||(P=v[_+1].clone(),C=m(P,v[_+2],g,S),L=m(P,v[_],g,S),x.push(P),x.push(C),x.push(L)),E||(P=v[_+2].clone(),C=m(P,v[_],g,S),L=m(P,v[_+1],g,S),x.push(P),x.push(C),x.push(L));break}}}return x}function m(v,g,x,S){const _=v.position.dot(x)-S,A=g.position.dot(x)-S,T=_/(_-A);return new o4(new pe(v.position.x+T*(g.position.x-v.position.x),v.position.y+T*(g.position.y-v.position.y),v.position.z+T*(g.position.z-v.position.z)),new pe(v.normal.x+T*(g.normal.x-v.normal.x),v.normal.y+T*(g.normal.y-v.normal.y),v.normal.z+T*(g.normal.z-v.normal.z)))}}}class o4{constructor(t,i){this.position=t,this.normal=i}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const sD=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function $z(e,t){const i=cl(s=>s.gl),r=R_(H2,sD(e)?Object.values(e):e);return Se.useLayoutEffect(()=>{t==null||t(r)},[t]),Se.useEffect(()=>{if("initTexture"in i){let s=[];Array.isArray(r)?s=r:r instanceof dn?s=[r]:sD(r)&&(s=Object.values(r)),s.forEach(a=>{a instanceof dn&&i.initTexture(a)})}},[i,r]),Se.useMemo(()=>{if(sD(e)){const s={};let a=0;for(const o in e)s[o]=r[a++];return s}else return r},[e,r])}$z.preload=e=>R_.preload(H2,e);$z.clear=e=>R_.clear(H2,e);const Lle=()=>parseInt(x_.replace(/\D+/g,"")),B7=Lle();function Ole(e){return Array.isArray(e)}function aD(e=[0,0,0]){return Ole(e)?e:e instanceof pe||e instanceof $g?[e.x,e.y,e.z]:[e,e,e]}const zle=Se.forwardRef(function({debug:t,depthTest:i=!1,polygonOffsetFactor:r=-10,map:n,mesh:s,children:a,position:o,rotation:l,scale:c,...u},h){const d=Se.useRef(null);Se.useImperativeHandle(h,()=>d.current);const f=Se.useRef(null),m=Se.useRef({position:new pe,rotation:new $g,scale:new pe(1,1,1)});return Se.useLayoutEffect(()=>{const v=(s==null?void 0:s.current)||d.current.parent,g=d.current;if(!(v instanceof rs))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(v){Iu(m.current,{position:o,scale:c});const x=v.matrixWorld.clone();if(v.matrixWorld.identity(),!l||typeof l=="number"){const S=new mr;S.position.copy(m.current.position);const _=v.geometry.attributes.position.array;v.geometry.attributes.normal===void 0&&v.geometry.computeVertexNormals();const A=v.geometry.attributes.normal.array;let T=1/0;new pe;let E=new pe;const I=S.position.x,P=S.position.y,C=S.position.z,L=_.length;let z=-1;for(let F=0;F<L;F+=3){const G=_[F],N=_[F+1],q=_[F+2],ie=G-I,Q=N-P,W=q-C,ee=ie*ie+Q*Q+W*W;ee<T&&(T=ee,z=F)}E.fromArray(A,z),S.lookAt(S.position.clone().add(E)),S.rotateZ(Math.PI),S.rotateY(Math.PI),typeof l=="number"&&S.rotateZ(l),Iu(m.current,{rotation:S.rotation})}else Iu(m.current,{rotation:l});return g.geometry=new Ile(v,m.current.position,m.current.rotation,m.current.scale),v.matrixWorld=x,()=>{g.geometry.dispose()}}},[s,...aD(o),...aD(c),...aD(l)]),Se.useLayoutEffect(()=>{f.current&&(Iu(f.current,m.current),f.current.traverse(v=>v.raycast=()=>null))},[t]),Se.createElement("mesh",Wl({ref:d,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":i,"material-map":n},u),a,t&&Se.createElement("mesh",{ref:f},Se.createElement("boxGeometry",null),Se.createElement("meshNormalMaterial",{wireframe:!0}),Se.createElement("axesHelper",null)))}),Ble=Se.forwardRef(({makeDefault:e,camera:t,regress:i,domElement:r,enableDamping:n=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=cl(E=>E.invalidate),d=cl(E=>E.camera),f=cl(E=>E.gl),m=cl(E=>E.events),v=cl(E=>E.setEvents),g=cl(E=>E.set),x=cl(E=>E.get),S=cl(E=>E.performance),_=t||d,A=r||m.connected||f.domElement,T=Se.useMemo(()=>new Rle(_),[_]);return _x(()=>{T.enabled&&T.update()},-1),Se.useEffect(()=>(s&&T.connect(s===!0?A:s),T.connect(A),()=>void T.dispose()),[s,A,i,T,h]),Se.useEffect(()=>{const E=C=>{h(),i&&S.regress(),a&&a(C)},I=C=>{o&&o(C)},P=C=>{l&&l(C)};return T.addEventListener("change",E),T.addEventListener("start",I),T.addEventListener("end",P),()=>{T.removeEventListener("start",I),T.removeEventListener("end",P),T.removeEventListener("change",E)}},[a,o,l,T,h,v]),Se.useEffect(()=>{if(e){const E=x().controls;return g({controls:T}),()=>g({controls:E})}},[e,T]),Se.createElement("primitive",Wl({ref:u,object:T,enableDamping:n},c))}),Nle="modulepreload",Ule=function(e,t){return new URL(e,t).href},l4={},Lp=function(t,i,r){let n=Promise.resolve();if(i&&i.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(i.map(c=>{if(c=Ule(c,r),c in l4)return;l4[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!r)for(let m=a.length-1;m>=0;m--){const v=a[m];if(v.href===c&&(!u||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Nle,u||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((m,v)=>{f.addEventListener("load",m),f.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var oD={exports:{}},lD,c4;function Fle(){if(c4)return lD;c4=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return lD=e,lD}var cD,u4;function kle(){if(u4)return cD;u4=1;var e=Fle();function t(){}function i(){}return i.resetWarningCache=t,cD=function(){function r(a,o,l,c,u,h){if(h!==e){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}r.isRequired=r;function n(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:n,element:r,elementType:r,instanceOf:n,node:r,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:i,resetWarningCache:t};return s.PropTypes=s,s},cD}var h4;function eB(){return h4||(h4=1,oD.exports=kle()()),oD.exports}var Vle=eB();const cn=Cp(Vle),uD=B7>=154?"opaque_fragment":"output_fragment";class Hle extends E2{constructor(t){super(t),this.onBeforeCompile=(i,r)=>{const{isWebGL2:n}=r.capabilities;i.fragmentShader=i.fragmentShader.replace(`#include <${uD}>`,`
        ${n?`#include <${uD}>`:`#extension GL_OES_standard_derivatives : enable
#include <${uD}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${B7>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Gle=Se.forwardRef((e,t)=>{const[i]=Se.useState(()=>new Hle(null));return Se.createElement("primitive",Wl({},e,{object:i,ref:t,attach:"material"}))}),jle=Se.forwardRef(({children:e,enabled:t=!0,speed:i=1,rotationIntensity:r=1,floatIntensity:n=1,floatingRange:s=[-.1,.1],autoInvalidate:a=!1,...o},l)=>{const c=Se.useRef(null);Se.useImperativeHandle(l,()=>c.current,[]);const u=Se.useRef(Math.random()*1e4);return _x(h=>{var d,f;if(!t||i===0)return;a&&h.invalidate();const m=u.current+h.clock.elapsedTime;c.current.rotation.x=Math.cos(m/4*i)/8*r,c.current.rotation.y=Math.sin(m/4*i)/8*r,c.current.rotation.z=Math.sin(m/4*i)/20*r;let v=Math.sin(m/4*i)/10;v=s9.mapLinear(v,-.1,.1,(d=s==null?void 0:s[0])!==null&&d!==void 0?d:-.1,(f=s==null?void 0:s[1])!==null&&f!==void 0?f:.1),c.current.position.y=v*n,c.current.updateMatrix()}),Se.createElement("group",o,Se.createElement("group",{ref:c,matrixAutoUpdate:!1},e))});let zm,Z1;const Wle=Se.createContext(null),d4=new Ci,f4=new pe,Xle=Se.forwardRef(({children:e,range:t,limit:i=1e3,...r},n)=>{const s=Se.useRef(null);Se.useImperativeHandle(n,()=>s.current,[]);const[a,o]=Se.useState([]),[[l,c,u]]=Se.useState(()=>[new Float32Array(i*3),Float32Array.from({length:i*3},()=>1),Float32Array.from({length:i},()=>1)]);Se.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),_x(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),d4.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(i,t!==void 0?t:i,a.length),zm=0;zm<a.length;zm++)Z1=a[zm].current,Z1.getWorldPosition(f4).applyMatrix4(d4),f4.toArray(l,zm*3),s.current.geometry.attributes.position.needsUpdate=!0,Z1.matrixWorldNeedsUpdate=!0,Z1.color.toArray(c,zm*3),s.current.geometry.attributes.color.needsUpdate=!0,u.set([Z1.size],zm),s.current.geometry.attributes.size.needsUpdate=!0});const h=Se.useMemo(()=>({getParent:()=>s,subscribe:d=>(o(f=>[...f,d]),()=>o(f=>f.filter(m=>m.current!==d.current)))}),[]);return Se.createElement("points",Wl({userData:{instances:a},matrixAutoUpdate:!1,ref:s,raycast:()=>null},r),Se.createElement("bufferGeometry",null,Se.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:Ag}),Se.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:Ag}),Se.createElement("bufferAttribute",{attach:"attributes-size",count:u.length,array:u,itemSize:1,usage:Ag})),Se.createElement(Wle.Provider,{value:h},e))}),qle=Se.forwardRef(({children:e,positions:t,colors:i,sizes:r,stride:n=3,...s},a)=>{const o=Se.useRef(null);return Se.useImperativeHandle(a,()=>o.current,[]),_x(()=>{const l=o.current.geometry.attributes;l.position.needsUpdate=!0,i&&(l.color.needsUpdate=!0),r&&(l.size.needsUpdate=!0)}),Se.createElement("points",Wl({ref:o},s),Se.createElement("bufferGeometry",null,Se.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/n,array:t,itemSize:n,usage:Ag}),i&&Se.createElement("bufferAttribute",{attach:"attributes-color",count:i.length/n,array:i,itemSize:3,usage:Ag}),r&&Se.createElement("bufferAttribute",{attach:"attributes-size",count:r.length/n,array:r,itemSize:1,usage:Ag})),e)}),Yle=Se.forwardRef((e,t)=>e.positions instanceof Float32Array?Se.createElement(qle,Wl({},e,{ref:t})):Se.createElement(Xle,Wl({},e,{ref:t})));function N7({all:e,scene:t,camera:i}){const r=cl(({gl:a})=>a),n=cl(({camera:a})=>a),s=cl(({scene:a})=>a);return Se.useLayoutEffect(()=>{const a=[];e&&(t||s).traverse(c=>{c.visible===!1&&(a.push(c),c.visible=!0)}),r.compile(t||s,i||n);const o=new Az(128);new Mz(.01,1e5,o).update(r,t||s),o.dispose(),a.forEach(c=>c.visible=!1)},[]),null}const Qle=()=>{const{progress:e}=Sle();return Qe.jsx(yle,{children:Qe.jsx("span",{className:"canvas-load",children:Qe.jsx("p",{style:{fontSize:14,color:"#f1f1f1",fontWeight:800,marginTop:40},children:e.toFixed(2)})})})},Zle=e=>{const[t]=$z([e.imgUrl]);return Qe.jsxs(jle,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[Qe.jsx("ambientLight",{intensity:.25}),Qe.jsx("directionalLight",{position:[0,0,.05]}),Qe.jsxs("mesh",{castShadow:!0,receiveShadow:!0,scale:2.75,children:[Qe.jsx("icosahedronGeometry",{args:[1,1]}),Qe.jsx("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),Qe.jsx(zle,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:t,flatShading:!0})]})]})},Kle=({icon:e})=>Qe.jsxs(O7,{frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},children:[Qe.jsxs(Se.Suspense,{fallback:Qe.jsx(Qle,{}),children:[Qe.jsx(Ble,{enableZoom:!1}),Qe.jsx(Zle,{imgUrl:e})]}),Qe.jsx(N7,{all:!0})]});function Oy(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function p4(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function m4(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?p4(Object(i),!0).forEach(function(r){Oy(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p4(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function U7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}new yt;new yt;var Tl=function e(t,i,r){var n=this;U7(this,e),Oy(this,"dot2",function(s,a){return n.x*s+n.y*a}),Oy(this,"dot3",function(s,a,o){return n.x*s+n.y*a+n.z*o}),this.x=t,this.y=i,this.z=r},Jle=[new Tl(1,1,0),new Tl(-1,1,0),new Tl(1,-1,0),new Tl(-1,-1,0),new Tl(1,0,1),new Tl(-1,0,1),new Tl(1,0,-1),new Tl(-1,0,-1),new Tl(0,1,1),new Tl(0,-1,1),new Tl(0,1,-1),new Tl(0,-1,-1)],g4=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],v4=new Array(512),y4=new Array(512),$le=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var i=0;i<256;i++){var r;i&1?r=g4[i]^t&255:r=g4[i]^t>>8&255,v4[i]=v4[i+256]=r,y4[i]=y4[i+256]=Jle[r%12]}};$le(0);function ece(e){if(typeof e=="number")e=Math.abs(e);else if(typeof e=="string"){var t=e;e=0;for(var i=0;i<t.length;i++)e=(e+(i+1)*(t.charCodeAt(i)%96))%2147483647}return e===0&&(e=311),e}function x4(e){var t=ece(e);return function(){var i=t*48271%2147483647;return t=i,i/2147483647}}var tce=function e(t){var i=this;U7(this,e),Oy(this,"seed",0),Oy(this,"init",function(r){i.seed=r,i.value=x4(r)}),Oy(this,"value",x4(this.seed)),this.init(t)},ice=new tce(Math.random()),rce={radius:1,center:[0,0,0]};function nce(e,t){for(var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ice,r=m4(m4({},rce),t),n=r.radius,s=r.center,a=0;a<e.length;a+=3){var o=Math.pow(i.value(),.3333333333333333),l=i.value()*2-1,c=i.value()*2-1,u=i.value()*2-1,h=Math.sqrt(l*l+c*c+u*u);l=o*l/h,c=o*c/h,u=o*u/h,e[a]=l*n+s[0],e[a+1]=c*n+s[1],e[a+2]=u*n+s[2]}return e}const sce=e=>{const t=Se.useRef(),[i]=Se.useState(()=>nce(new Float32Array(5001),{radius:1.2}));return _x((r,n)=>{t.current.rotation.x-=n/10,t.current.rotation.y-=n/15}),Qe.jsx("group",{rotation:[0,0,Math.PI/4],children:Qe.jsx(Yle,{ref:t,positions:i,stride:3,frustumCulled:!0,...e,children:Qe.jsx(Gle,{transparent:!0,color:"#f272c8",size:.002,sizeAttenuation:!0,depthWrite:!1})})})},ace=()=>Qe.jsx("div",{className:"w-full h-auto absolute inset-0 z-[-1]",children:Qe.jsxs(O7,{camera:{position:[0,0,1]},children:[Qe.jsx(Se.Suspense,{fallback:null,children:Qe.jsx(sce,{})}),Qe.jsx(N7,{all:!0})]})}),F7=Se.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),j2=Se.createContext({});function oce(){return Se.useContext(j2).visualElement}const tB=Se.createContext(null),W2=typeof document<"u",w4=W2?Se.useLayoutEffect:Se.useEffect,k7=Se.createContext({strict:!1});function lce(e,t,i,r){const n=oce(),s=Se.useContext(k7),a=Se.useContext(tB),o=Se.useContext(F7).reducedMotion,l=Se.useRef();r=r||s.renderer,!l.current&&r&&(l.current=r(e,{visualState:t,parent:n,props:i,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:o}));const c=l.current;return Se.useInsertionEffect(()=>{c&&c.update(i,a)}),w4(()=>{c&&c.render()}),Se.useEffect(()=>{c&&c.updateFeatures()}),(window.HandoffAppearAnimations?w4:Se.useEffect)(()=>{c&&c.animationState&&c.animationState.animateChanges()}),c}function Sy(e){return typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function cce(e,t,i){return Se.useCallback(r=>{r&&e.mount&&e.mount(r),t&&(r?t.mount(r):t.unmount()),i&&(typeof i=="function"?i(r):Sy(i)&&(i.current=r))},[t])}function Hb(e){return typeof e=="string"||Array.isArray(e)}function X2(e){return typeof e=="object"&&typeof e.start=="function"}const iB=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],rB=["initial",...iB];function q2(e){return X2(e.animate)||rB.some(t=>Hb(e[t]))}function V7(e){return!!(q2(e)||e.variants)}function uce(e,t){if(q2(e)){const{initial:i,animate:r}=e;return{initial:i===!1||Hb(i)?i:void 0,animate:Hb(r)?r:void 0}}return e.inherit!==!1?t:{}}function hce(e){const{initial:t,animate:i}=uce(e,Se.useContext(j2));return Se.useMemo(()=>({initial:t,animate:i}),[b4(t),b4(i)])}function b4(e){return Array.isArray(e)?e.join(" "):e}const _4={animation:["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag","whileInView"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Gb={};for(const e in _4)Gb[e]={isEnabled:t=>_4[e].some(i=>!!t[i])};function dce(e){for(const t in e)Gb[t]={...Gb[t],...e[t]}}function H7(e){const t=Se.useRef(null);return t.current===null&&(t.current=e()),t.current}const Jw={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let fce=1;function pce(){return H7(()=>{if(Jw.hasEverUpdated)return fce++})}const G7=Se.createContext({}),j7=Se.createContext({}),mce=Symbol.for("motionComponentSymbol");function gce({preloadedFeatures:e,createVisualElement:t,useRender:i,useVisualState:r,Component:n}){e&&dce(e);function s(o,l){let c;const u={...Se.useContext(F7),...o,layoutId:vce(o)},{isStatic:h}=u,d=hce(o),f=h?void 0:pce(),m=r(o,h);if(!h&&W2){d.visualElement=lce(n,m,u,t);const v=Se.useContext(j7),g=Se.useContext(k7).strict;d.visualElement&&(c=d.visualElement.loadFeatures(u,g,e,f,v))}return Se.createElement(j2.Provider,{value:d},c&&d.visualElement?Se.createElement(c,{visualElement:d.visualElement,...u}):null,i(n,o,f,cce(m,d.visualElement,l),m,h,d.visualElement))}const a=Se.forwardRef(s);return a[mce]=n,a}function vce({layoutId:e}){const t=Se.useContext(G7).id;return t&&e!==void 0?t+"-"+e:e}function yce(e){function t(r,n={}){return gce(e(r,n))}if(typeof Proxy>"u")return t;const i=new Map;return new Proxy(t,{get:(r,n)=>(i.has(n)||i.set(n,t(n)),i.get(n))})}const xce=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function nB(e){return typeof e!="string"||e.includes("-")?!1:!!(xce.indexOf(e)>-1||/[A-Z]/.test(e))}const KE={};function wce(e){Object.assign(KE,e)}const Y2=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],rv=new Set(Y2);function W7(e,{layout:t,layoutId:i}){return rv.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!KE[e]||e==="opacity")}const Go=e=>!!(e&&e.getVelocity),bce={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},_ce=Y2.length;function Sce(e,{enableHardwareAcceleration:t=!0,allowTransformNone:i=!0},r,n){let s="";for(let a=0;a<_ce;a++){const o=Y2[a];if(e[o]!==void 0){const l=bce[o]||o;s+=`${l}(${e[o]}) `}}return t&&!e.z&&(s+="translateZ(0)"),s=s.trim(),n?s=n(e,r?"":s):i&&r&&(s="none"),s}const X7=e=>t=>typeof t=="string"&&t.startsWith(e),q7=X7("--"),LI=X7("var(--"),Mce=(e,t)=>t&&typeof e=="number"?t.transform(e):e,tx=(e,t,i)=>Math.min(Math.max(i,e),t),nv={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},$w={...nv,transform:e=>tx(0,1,e)},HM={...nv,default:1},eb=e=>Math.round(e*1e5)/1e5,jb=/(-)?([\d]*\.?[\d])+/g,OI=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Ace=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function L_(e){return typeof e=="string"}const O_=e=>({test:t=>L_(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),jf=O_("deg"),ju=O_("%"),Pi=O_("px"),Ece=O_("vh"),Tce=O_("vw"),S4={...ju,parse:e=>ju.parse(e)/100,transform:e=>ju.transform(e*100)},M4={...nv,transform:Math.round},Y7={borderWidth:Pi,borderTopWidth:Pi,borderRightWidth:Pi,borderBottomWidth:Pi,borderLeftWidth:Pi,borderRadius:Pi,radius:Pi,borderTopLeftRadius:Pi,borderTopRightRadius:Pi,borderBottomRightRadius:Pi,borderBottomLeftRadius:Pi,width:Pi,maxWidth:Pi,height:Pi,maxHeight:Pi,size:Pi,top:Pi,right:Pi,bottom:Pi,left:Pi,padding:Pi,paddingTop:Pi,paddingRight:Pi,paddingBottom:Pi,paddingLeft:Pi,margin:Pi,marginTop:Pi,marginRight:Pi,marginBottom:Pi,marginLeft:Pi,rotate:jf,rotateX:jf,rotateY:jf,rotateZ:jf,scale:HM,scaleX:HM,scaleY:HM,scaleZ:HM,skew:jf,skewX:jf,skewY:jf,distance:Pi,translateX:Pi,translateY:Pi,translateZ:Pi,x:Pi,y:Pi,z:Pi,perspective:Pi,transformPerspective:Pi,opacity:$w,originX:S4,originY:S4,originZ:Pi,zIndex:M4,fillOpacity:$w,strokeOpacity:$w,numOctaves:M4};function sB(e,t,i,r){const{style:n,vars:s,transform:a,transformOrigin:o}=e;let l=!1,c=!1,u=!0;for(const h in t){const d=t[h];if(q7(h)){s[h]=d;continue}const f=Y7[h],m=Mce(d,f);if(rv.has(h)){if(l=!0,a[h]=m,!u)continue;d!==(f.default||0)&&(u=!1)}else h.startsWith("origin")?(c=!0,o[h]=m):n[h]=m}if(t.transform||(l||r?n.transform=Sce(e.transform,i,u,r):n.transform&&(n.transform="none")),c){const{originX:h="50%",originY:d="50%",originZ:f=0}=o;n.transformOrigin=`${h} ${d} ${f}`}}const aB=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Q7(e,t,i){for(const r in t)!Go(t[r])&&!W7(r,i)&&(e[r]=t[r])}function Cce({transformTemplate:e},t,i){return Se.useMemo(()=>{const r=aB();return sB(r,t,{enableHardwareAcceleration:!i},e),Object.assign({},r.vars,r.style)},[t])}function Pce(e,t,i){const r=e.style||{},n={};return Q7(n,r,e),Object.assign(n,Cce(e,t,i)),e.transformValues?e.transformValues(n):n}function Dce(e,t,i){const r={},n=Pce(e,t,i);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const Rce=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","ignoreStrict","viewport"]);function JE(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||Rce.has(e)}let Z7=e=>!JE(e);function Ice(e){e&&(Z7=t=>t.startsWith("on")?!JE(t):e(t))}try{Ice(require("@emotion/is-prop-valid").default)}catch{}function Lce(e,t,i){const r={};for(const n in e)n==="values"&&typeof e.values=="object"||(Z7(n)||i===!0&&JE(n)||!t&&!JE(n)||e.draggable&&n.startsWith("onDrag"))&&(r[n]=e[n]);return r}function A4(e,t,i){return typeof e=="string"?e:Pi.transform(t+i*e)}function Oce(e,t,i){const r=A4(t,e.x,e.width),n=A4(i,e.y,e.height);return`${r} ${n}`}const zce={offset:"stroke-dashoffset",array:"stroke-dasharray"},Bce={offset:"strokeDashoffset",array:"strokeDasharray"};function Nce(e,t,i=1,r=0,n=!0){e.pathLength=1;const s=n?zce:Bce;e[s.offset]=Pi.transform(-r);const a=Pi.transform(t),o=Pi.transform(i);e[s.array]=`${a} ${o}`}function oB(e,{attrX:t,attrY:i,originX:r,originY:n,pathLength:s,pathSpacing:a=1,pathOffset:o=0,...l},c,u,h){if(sB(e,l,c,h),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:d,style:f,dimensions:m}=e;d.transform&&(m&&(f.transform=d.transform),delete d.transform),m&&(r!==void 0||n!==void 0||f.transform)&&(f.transformOrigin=Oce(m,r!==void 0?r:.5,n!==void 0?n:.5)),t!==void 0&&(d.x=t),i!==void 0&&(d.y=i),s!==void 0&&Nce(d,s,a,o,!1)}const K7=()=>({...aB(),attrs:{}}),lB=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Uce(e,t,i,r){const n=Se.useMemo(()=>{const s=K7();return oB(s,t,{enableHardwareAcceleration:!1},lB(r),e.transformTemplate),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};Q7(s,e.style,e),n.style={...s,...n.style}}return n}function Fce(e=!1){return(i,r,n,s,{latestValues:a},o)=>{const c=(nB(i)?Uce:Dce)(r,a,o,i),h={...Lce(r,typeof i=="string",e),...c,ref:s},{children:d}=r,f=Se.useMemo(()=>Go(d)?d.get():d,[d]);return n&&(h["data-projection-id"]=n),Se.createElement(i,{...h,children:f})}}const cB=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();function J7(e,{style:t,vars:i},r,n){Object.assign(e.style,t,n&&n.getProjectionStyles(r));for(const s in i)e.style.setProperty(s,i[s])}const $7=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function eX(e,t,i,r){J7(e,t,void 0,r);for(const n in t.attrs)e.setAttribute($7.has(n)?n:cB(n),t.attrs[n])}function uB(e,t){const{style:i}=e,r={};for(const n in i)(Go(i[n])||t.style&&Go(t.style[n])||W7(n,e))&&(r[n]=i[n]);return r}function tX(e,t){const i=uB(e,t);for(const r in e)if(Go(e[r])||Go(t[r])){const n=r==="x"||r==="y"?"attr"+r.toUpperCase():r;i[n]=e[r]}return i}function hB(e,t,i,r={},n={}){return typeof t=="function"&&(t=t(i!==void 0?i:e.custom,r,n)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(i!==void 0?i:e.custom,r,n)),t}const $E=e=>Array.isArray(e),kce=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),Vce=e=>$E(e)?e[e.length-1]||0:e;function _E(e){const t=Go(e)?e.get():e;return kce(t)?t.toValue():t}function Hce({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:i},r,n,s){const a={latestValues:Gce(r,n,s,e),renderState:t()};return i&&(a.mount=o=>i(r,o,a)),a}const iX=e=>(t,i)=>{const r=Se.useContext(j2),n=Se.useContext(tB),s=()=>Hce(e,t,r,n);return i?s():H7(s)};function Gce(e,t,i,r){const n={},s=r(e,{});for(const d in s)n[d]=_E(s[d]);let{initial:a,animate:o}=e;const l=q2(e),c=V7(e);t&&c&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let u=i?i.initial===!1:!1;u=u||a===!1;const h=u?o:a;return h&&typeof h!="boolean"&&!X2(h)&&(Array.isArray(h)?h:[h]).forEach(f=>{const m=hB(e,f);if(!m)return;const{transitionEnd:v,transition:g,...x}=m;for(const S in x){let _=x[S];if(Array.isArray(_)){const A=u?_.length-1:0;_=_[A]}_!==null&&(n[S]=_)}for(const S in v)n[S]=v[S]}),n}const jce={useVisualState:iX({scrapeMotionValuesFromProps:tX,createRenderState:K7,onMount:(e,t,{renderState:i,latestValues:r})=>{try{i.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{i.dimensions={x:0,y:0,width:0,height:0}}oB(i,r,{enableHardwareAcceleration:!1},lB(t.tagName),e.transformTemplate),eX(t,i)}})},Wce={useVisualState:iX({scrapeMotionValuesFromProps:uB,createRenderState:aB})};function Xce(e,{forwardMotionProps:t=!1},i,r){return{...nB(e)?jce:Wce,preloadedFeatures:i,useRender:Fce(t),createVisualElement:r,Component:e}}function vd(e,t,i,r={passive:!0}){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i)}const rX=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function Q2(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}const qce=e=>t=>rX(t)&&e(t,Q2(t));function Ad(e,t,i,r){return vd(e,t,qce(i),r)}const Yce=(e,t)=>i=>t(e(i)),fp=(...e)=>e.reduce(Yce);function nX(e){let t=null;return()=>{const i=()=>{t=null};return t===null?(t=e,i):!1}}const E4=nX("dragHorizontal"),T4=nX("dragVertical");function sX(e){let t=!1;if(e==="y")t=T4();else if(e==="x")t=E4();else{const i=E4(),r=T4();i&&r?t=()=>{i(),r()}:(i&&i(),r&&r())}return t}function aX(){const e=sX(!0);return e?(e(),!1):!0}class Op{constructor(t){this.isMounted=!1,this.node=t}update(){}}function C4(e,t){const i="pointer"+(t?"enter":"leave"),r="onHover"+(t?"Start":"End"),n=(s,a)=>{if(s.type==="touch"||aX())return;const o=e.getProps();e.animationState&&o.whileHover&&e.animationState.setActive("whileHover",t),o[r]&&o[r](s,a)};return Ad(e.current,i,n,{passive:!e.getProps()[r]})}class Qce extends Op{mount(){this.unmount=fp(C4(this.node,!0),C4(this.node,!1))}unmount(){}}class Zce extends Op{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=fp(vd(this.node.current,"focus",()=>this.onFocus()),vd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const oX=(e,t)=>t?e===t?!0:oX(e,t.parentElement):!1,Wc=e=>e;function hD(e,t){if(!t)return;const i=new PointerEvent("pointer"+e);t(i,Q2(i))}class Kce extends Op{constructor(){super(...arguments),this.removeStartListeners=Wc,this.removeEndListeners=Wc,this.removeAccessibleListeners=Wc,this.startPointerPress=(t,i)=>{if(this.removeEndListeners(),this.isPressing)return;const r=this.node.getProps(),s=Ad(window,"pointerup",(o,l)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:u}=this.node.getProps();oX(this.node.current,o.target)?c&&c(o,l):u&&u(o,l)},{passive:!(r.onTap||r.onPointerUp)}),a=Ad(window,"pointercancel",(o,l)=>this.cancelPress(o,l),{passive:!(r.onTapCancel||r.onPointerCancel)});this.removeEndListeners=fp(s,a),this.startPress(t,i)},this.startAccessiblePress=()=>{const t=s=>{if(s.key!=="Enter"||this.isPressing)return;const a=o=>{o.key!=="Enter"||!this.checkPressEnd()||hD("up",this.node.getProps().onTap)};this.removeEndListeners(),this.removeEndListeners=vd(this.node.current,"keyup",a),hD("down",(o,l)=>{this.startPress(o,l)})},i=vd(this.node.current,"keydown",t),r=()=>{this.isPressing&&hD("cancel",(s,a)=>this.cancelPress(s,a))},n=vd(this.node.current,"blur",r);this.removeAccessibleListeners=fp(i,n)}}startPress(t,i){this.isPressing=!0;const{onTapStart:r,whileTap:n}=this.node.getProps();n&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),r&&r(t,i)}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!aX()}cancelPress(t,i){if(!this.checkPressEnd())return;const{onTapCancel:r}=this.node.getProps();r&&r(t,i)}mount(){const t=this.node.getProps(),i=Ad(this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),r=vd(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=fp(i,r)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const zI=new WeakMap,dD=new WeakMap,Jce=e=>{const t=zI.get(e.target);t&&t(e)},$ce=e=>{e.forEach(Jce)};function eue({root:e,...t}){const i=e||document;dD.has(i)||dD.set(i,{});const r=dD.get(i),n=JSON.stringify(t);return r[n]||(r[n]=new IntersectionObserver($ce,{root:e,...t})),r[n]}function tue(e,t,i){const r=eue(t);return zI.set(e,i),r.observe(e),()=>{zI.delete(e),r.unobserve(e)}}const iue={some:0,all:1};class rue extends Op{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}viewportFallback(){requestAnimationFrame(()=>{this.hasEnteredView=!0;const{onViewportEnter:t}=this.node.getProps();t&&t(null),this.node.animationState&&this.node.animationState.setActive("whileInView",!0)})}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s,fallback:a=!0}=t;if(typeof IntersectionObserver>"u"){a&&this.viewportFallback();return}const o={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:iue[n]},l=c=>{const{isIntersecting:u}=c;if(this.isInView===u||(this.isInView=u,s&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:h,onViewportLeave:d}=this.node.getProps(),f=u?h:d;f&&f(c)};return tue(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(nue(t,i))&&this.startObserver()}unmount(){}}function nue({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const sue={inView:{Feature:rue},tap:{Feature:Kce},focus:{Feature:Zce},hover:{Feature:Qce}};function lX(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}const aue=e=>/^\-?\d*\.?\d+$/.test(e),oue=e=>/^0[^.\s]+$/.test(e),Ed={delta:0,timestamp:0},cX=1/60*1e3,lue=typeof performance<"u"?()=>performance.now():()=>Date.now(),uX=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(lue()),cX);function cue(e){let t=[],i=[],r=0,n=!1,s=!1;const a=new WeakSet,o={schedule:(l,c=!1,u=!1)=>{const h=u&&n,d=h?t:i;return c&&a.add(l),d.indexOf(l)===-1&&(d.push(l),h&&n&&(r=t.length)),l},cancel:l=>{const c=i.indexOf(l);c!==-1&&i.splice(c,1),a.delete(l)},process:l=>{if(n){s=!0;return}if(n=!0,[t,i]=[i,t],i.length=0,r=t.length,r)for(let c=0;c<r;c++){const u=t[c];u(l),a.has(u)&&(o.schedule(u),e())}n=!1,s&&(s=!1,o.process(l))}};return o}const uue=40;let BI=!0,Wb=!1,NI=!1;const z_=["read","update","preRender","render","postRender"],Z2=z_.reduce((e,t)=>(e[t]=cue(()=>Wb=!0),e),{}),fo=z_.reduce((e,t)=>{const i=Z2[t];return e[t]=(r,n=!1,s=!1)=>(Wb||due(),i.schedule(r,n,s)),e},{}),_p=z_.reduce((e,t)=>(e[t]=Z2[t].cancel,e),{}),fD=z_.reduce((e,t)=>(e[t]=()=>Z2[t].process(Ed),e),{}),hue=e=>Z2[e].process(Ed),hX=e=>{Wb=!1,Ed.delta=BI?cX:Math.max(Math.min(e-Ed.timestamp,uue),1),Ed.timestamp=e,NI=!0,z_.forEach(hue),NI=!1,Wb&&(BI=!1,uX(hX))},due=()=>{Wb=!0,BI=!0,NI||uX(hX)};function dB(e,t){e.indexOf(t)===-1&&e.push(t)}function fB(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}class pB{constructor(){this.subscriptions=[]}add(t){return dB(this.subscriptions,t),()=>fB(this.subscriptions,t)}notify(t,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(t,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function mB(e,t){return t?e*(1e3/t):0}const fue=e=>!isNaN(parseFloat(e));class pue{constructor(t,i={}){this.version="9.1.7",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(r,n=!0)=>{this.prev=this.current,this.current=r;const{delta:s,timestamp:a}=Ed;this.lastUpdated!==a&&(this.timeDelta=s,this.lastUpdated=a,fo.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>fo.postRender(this.velocityCheck),this.velocityCheck=({timestamp:r})=>{r!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=fue(this.current),this.owner=i.owner}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new pB);const r=this.events[t].add(i);return t==="change"?()=>{r(),fo.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,r){this.set(i),this.prev=t,this.timeDelta=r}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?mB(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i)||null,this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){this.animation=null}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ix(e,t){return new pue(e,t)}const gB=(e,t)=>i=>!!(L_(i)&&Ace.test(i)&&i.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(i,t)),dX=(e,t,i)=>r=>{if(!L_(r))return r;const[n,s,a,o]=r.match(jb);return{[e]:parseFloat(n),[t]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},mue=e=>tx(0,255,e),pD={...nv,transform:e=>Math.round(mue(e))},mg={test:gB("rgb","red"),parse:dX("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:r=1})=>"rgba("+pD.transform(e)+", "+pD.transform(t)+", "+pD.transform(i)+", "+eb($w.transform(r))+")"};function gue(e){let t="",i="",r="",n="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),r=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),r=e.substring(3,4),n=e.substring(4,5),t+=t,i+=i,r+=r,n+=n),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const UI={test:gB("#"),parse:gue,transform:mg.transform},My={test:gB("hsl","hue"),parse:dX("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:r=1})=>"hsla("+Math.round(e)+", "+ju.transform(eb(t))+", "+ju.transform(eb(i))+", "+eb($w.transform(r))+")"},ro={test:e=>mg.test(e)||UI.test(e)||My.test(e),parse:e=>mg.test(e)?mg.parse(e):My.test(e)?My.parse(e):UI.parse(e),transform:e=>L_(e)?e:e.hasOwnProperty("red")?mg.transform(e):My.transform(e)},fX="${c}",pX="${n}";function vue(e){var t,i;return isNaN(e)&&L_(e)&&(((t=e.match(jb))===null||t===void 0?void 0:t.length)||0)+(((i=e.match(OI))===null||i===void 0?void 0:i.length)||0)>0}function eT(e){typeof e=="number"&&(e=`${e}`);const t=[];let i=0,r=0;const n=e.match(OI);n&&(i=n.length,e=e.replace(OI,fX),t.push(...n.map(ro.parse)));const s=e.match(jb);return s&&(r=s.length,e=e.replace(jb,pX),t.push(...s.map(nv.parse))),{values:t,numColors:i,numNumbers:r,tokenised:e}}function mX(e){return eT(e).values}function gX(e){const{values:t,numColors:i,tokenised:r}=eT(e),n=t.length;return s=>{let a=r;for(let o=0;o<n;o++)a=a.replace(o<i?fX:pX,o<i?ro.transform(s[o]):eb(s[o]));return a}}const yue=e=>typeof e=="number"?0:e;function xue(e){const t=mX(e);return gX(e)(t.map(yue))}const Sp={test:vue,parse:mX,createTransformer:gX,getAnimatableNone:xue},wue=new Set(["brightness","contrast","saturate","opacity"]);function bue(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=i.match(jb)||[];if(!r)return e;const n=i.replace(r,"");let s=wue.has(t)?1:0;return r!==i&&(s*=100),t+"("+s+n+")"}const _ue=/([a-z-]*)\(.*?\)/g,FI={...Sp,getAnimatableNone:e=>{const t=e.match(_ue);return t?t.map(bue).join(" "):e}},Sue={...Y7,color:ro,backgroundColor:ro,outlineColor:ro,fill:ro,stroke:ro,borderColor:ro,borderTopColor:ro,borderRightColor:ro,borderBottomColor:ro,borderLeftColor:ro,filter:FI,WebkitFilter:FI},vB=e=>Sue[e];function yB(e,t){let i=vB(e);return i!==FI&&(i=Sp),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const vX=e=>t=>t.test(e),Mue={test:e=>e==="auto",parse:e=>e},yX=[nv,Pi,ju,jf,Tce,Ece,Mue],K1=e=>yX.find(vX(e)),Aue=[...yX,ro,Sp],Eue=e=>Aue.find(vX(e));function Tue(e){const t={};return e.values.forEach((i,r)=>t[r]=i.get()),t}function Cue(e){const t={};return e.values.forEach((i,r)=>t[r]=i.getVelocity()),t}function K2(e,t,i){const r=e.getProps();return hB(r,t,i!==void 0?i:r.custom,Tue(e),Cue(e))}function Pue(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,ix(i))}function Due(e,t){const i=K2(e,t);let{transitionEnd:r={},transition:n={},...s}=i?e.makeTargetAnimatable(i,!1):{};s={...s,...r};for(const a in s){const o=Vce(s[a]);Pue(e,a,o)}}function Rue(e,t,i){var r,n;const s=Object.keys(t).filter(o=>!e.hasValue(o)),a=s.length;if(a)for(let o=0;o<a;o++){const l=s[o],c=t[l];let u=null;Array.isArray(c)&&(u=c[0]),u===null&&(u=(n=(r=i[l])!==null&&r!==void 0?r:e.readValue(l))!==null&&n!==void 0?n:t[l]),u!=null&&(typeof u=="string"&&(aue(u)||oue(u))?u=parseFloat(u):!Eue(u)&&Sp.test(c)&&(u=yB(l,c)),e.addValue(l,ix(u,{owner:e})),i[l]===void 0&&(i[l]=u),u!==null&&e.setBaseTarget(l,u))}}function Iue(e,t){return t?(t[e]||t.default||t).from:void 0}function Lue(e,t,i){const r={};for(const n in e){const s=Iue(n,t);if(s!==void 0)r[n]=s;else{const a=i.getValue(n);a&&(r[n]=a.get())}}return r}function tT(e){return!!(Go(e)&&e.add)}const Oue="framerAppearId",zue="data-"+cB(Oue);let iT=Wc;const SE=e=>e*1e3,Bue={current:!1},xB=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,wB=e=>t=>1-e(1-t),bB=e=>e*e,Nue=wB(bB),_B=xB(bB),yn=(e,t,i)=>-i*e+i*t+e;function mD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function Uue({hue:e,saturation:t,lightness:i,alpha:r}){e/=360,t/=100,i/=100;let n=0,s=0,a=0;if(!t)n=s=a=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;n=mD(l,o,e+1/3),s=mD(l,o,e),a=mD(l,o,e-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}const gD=(e,t,i)=>{const r=e*e;return Math.sqrt(Math.max(0,i*(t*t-r)+r))},Fue=[UI,mg,My],kue=e=>Fue.find(t=>t.test(e));function P4(e){const t=kue(e);let i=t.parse(e);return t===My&&(i=Uue(i)),i}const xX=(e,t)=>{const i=P4(e),r=P4(t),n={...i};return s=>(n.red=gD(i.red,r.red,s),n.green=gD(i.green,r.green,s),n.blue=gD(i.blue,r.blue,s),n.alpha=yn(i.alpha,r.alpha,s),mg.transform(n))};function wX(e,t){return typeof e=="number"?i=>yn(e,t,i):ro.test(e)?xX(e,t):_X(e,t)}const bX=(e,t)=>{const i=[...e],r=i.length,n=e.map((s,a)=>wX(s,t[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}},Vue=(e,t)=>{const i={...e,...t},r={};for(const n in i)e[n]!==void 0&&t[n]!==void 0&&(r[n]=wX(e[n],t[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}},_X=(e,t)=>{const i=Sp.createTransformer(t),r=eT(e),n=eT(t);return r.numColors===n.numColors&&r.numNumbers>=n.numNumbers?fp(bX(r.values,n.values),i):a=>`${a>0?t:e}`},Xb=(e,t,i)=>{const r=t-e;return r===0?1:(i-e)/r},D4=(e,t)=>i=>yn(e,t,i);function Hue(e){return typeof e=="number"?D4:typeof e=="string"?ro.test(e)?xX:_X:Array.isArray(e)?bX:typeof e=="object"?Vue:D4}function Gue(e,t,i){const r=[],n=i||Hue(e[0]),s=e.length-1;for(let a=0;a<s;a++){let o=n(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]:t;o=fp(l,o)}r.push(o)}return r}function SX(e,t,{clamp:i=!0,ease:r,mixer:n}={}){const s=e.length;iT(s===t.length),iT(!r||!Array.isArray(r)||r.length===s-1),e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=Gue(t,r,n),o=a.length,l=c=>{let u=0;if(o>1)for(;u<e.length-2&&!(c<e[u+1]);u++);const h=Xb(e[u],e[u+1],c);return a[u](h)};return i?c=>l(tx(e[0],e[s-1],c)):l}function jue(e,t){const i=e[e.length-1];for(let r=1;r<=t;r++){const n=Xb(0,t,r);e.push(yn(i,1,n))}}function Wue(e){const t=[0];return jue(t,e.length-1),t}function Xue(e,t){return e.map(i=>i*t)}const MX=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,que=1e-7,Yue=12;function Que(e,t,i,r,n){let s,a,o=0;do a=t+(i-t)/2,s=MX(a,r,n)-e,s>0?i=a:t=a;while(Math.abs(s)>que&&++o<Yue);return a}function AX(e,t,i,r){if(e===t&&i===r)return Wc;const n=s=>Que(s,0,1,e,i);return s=>s===0||s===1?s:MX(n(s),t,r)}const EX=e=>1-Math.sin(Math.acos(e)),SB=wB(EX),Zue=xB(SB),TX=AX(.33,1.53,.69,.99),MB=wB(TX),Kue=xB(MB),Jue=e=>(e*=2)<1?.5*MB(e):.5*(2-Math.pow(2,-10*(e-1))),$ue={linear:Wc,easeIn:bB,easeInOut:_B,easeOut:Nue,circIn:EX,circInOut:Zue,circOut:SB,backIn:MB,backInOut:Kue,backOut:TX,anticipate:Jue},R4=e=>{if(Array.isArray(e)){iT(e.length===4);const[t,i,r,n]=e;return AX(t,i,r,n)}else if(typeof e=="string")return $ue[e];return e},ehe=e=>Array.isArray(e)&&typeof e[0]!="number";function the(e,t){return e.map(()=>t||_B).splice(0,e.length-1)}function kI({keyframes:e,ease:t=_B,times:i,duration:r=300}){e=[...e];const n=ehe(t)?t.map(R4):R4(t),s={done:!1,value:e[0]},a=Xue(i&&i.length===e.length?i:Wue(e),r);function o(){return SX(a,e,{ease:Array.isArray(n)?n:the(e,n)})}let l=o();return{next:c=>(s.value=l(c),s.done=c>=r,s),flipTarget:()=>{e.reverse(),l=o()}}}const I4=.001,ihe=.01,rhe=10,nhe=.05,she=1;function ahe({duration:e=800,bounce:t=.25,velocity:i=0,mass:r=1}){let n,s,a=1-t;a=tx(nhe,she,a),e=tx(ihe,rhe,e/1e3),a<1?(n=c=>{const u=c*a,h=u*e,d=u-i,f=VI(c,a),m=Math.exp(-h);return I4-d/f*m},s=c=>{const h=c*a*e,d=h*i+i,f=Math.pow(a,2)*Math.pow(c,2)*e,m=Math.exp(-h),v=VI(Math.pow(c,2),a);return(-n(c)+I4>0?-1:1)*((d-f)*m)/v}):(n=c=>{const u=Math.exp(-c*e),h=(c-i)*e+1;return-.001+u*h},s=c=>{const u=Math.exp(-c*e),h=(i-c)*(e*e);return u*h});const o=5/e,l=lhe(n,s,o);if(e=e*1e3,isNaN(l))return{stiffness:100,damping:10,duration:e};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:a*2*Math.sqrt(r*c),duration:e}}}const ohe=12;function lhe(e,t,i){let r=i;for(let n=1;n<ohe;n++)r=r-e(r)/t(r);return r}function VI(e,t){return e*Math.sqrt(1-t*t)}const che=["duration","bounce"],uhe=["stiffness","damping","mass"];function L4(e,t){return t.some(i=>e[i]!==void 0)}function hhe(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!L4(e,uhe)&&L4(e,che)){const i=ahe(e);t={...t,...i,velocity:0,mass:1},t.isResolvedFromDuration=!0}return t}const dhe=5;function CX({keyframes:e,restDelta:t,restSpeed:i,...r}){let n=e[0],s=e[e.length-1];const a={done:!1,value:n},{stiffness:o,damping:l,mass:c,velocity:u,duration:h,isResolvedFromDuration:d}=hhe(r);let f=fhe,m=u?-(u/1e3):0;const v=l/(2*Math.sqrt(o*c));function g(){const x=s-n,S=Math.sqrt(o/c)/1e3,_=Math.abs(x)<5;if(i||(i=_?.01:2),t||(t=_?.005:.5),v<1){const A=VI(S,v);f=T=>{const E=Math.exp(-v*S*T);return s-E*((m+v*S*x)/A*Math.sin(A*T)+x*Math.cos(A*T))}}else if(v===1)f=A=>s-Math.exp(-S*A)*(x+(m+S*x)*A);else{const A=S*Math.sqrt(v*v-1);f=T=>{const E=Math.exp(-v*S*T),I=Math.min(A*T,300);return s-E*((m+v*S*x)*Math.sinh(I)+A*x*Math.cosh(I))/A}}}return g(),{next:x=>{const S=f(x);if(d)a.done=x>=h;else{let _=m;if(x!==0)if(v<1){const E=Math.max(0,x-dhe);_=mB(S-f(E),x-E)}else _=0;const A=Math.abs(_)<=i,T=Math.abs(s-S)<=t;a.done=A&&T}return a.value=a.done?s:S,a},flipTarget:()=>{m=-m,[n,s]=[s,n],g()}}}CX.needsInterpolation=(e,t)=>typeof e=="string"||typeof t=="string";const fhe=e=>0;function phe({keyframes:e=[0],velocity:t=0,power:i=.8,timeConstant:r=350,restDelta:n=.5,modifyTarget:s}){const a=e[0],o={done:!1,value:a};let l=i*t;const c=a+l,u=s===void 0?c:s(c);return u!==c&&(l=u-a),{next:h=>{const d=-l*Math.exp(-h/r);return o.done=!(d>n||d<-n),o.value=o.done?u:u+d,o},flipTarget:()=>{}}}const mhe={decay:phe,keyframes:kI,tween:kI,spring:CX};function PX(e,t,i=0){return e-t-i}function ghe(e,t=0,i=0,r=!0){return r?PX(t+-e,t,i):t-(e-t)+i}function vhe(e,t,i,r){return r?e>=t+i:e<=-i}const yhe=e=>{const t=({delta:i})=>e(i);return{start:()=>fo.update(t,!0),stop:()=>_p.update(t)}};function rT({duration:e,driver:t=yhe,elapsed:i=0,repeat:r=0,repeatType:n="loop",repeatDelay:s=0,keyframes:a,autoplay:o=!0,onPlay:l,onStop:c,onComplete:u,onRepeat:h,onUpdate:d,type:f="keyframes",...m}){const v=i;let g,x=0,S=e,_=!1,A=!0,T;const E=mhe[a.length>2?"keyframes":f]||kI,I=a[0],P=a[a.length-1];let C={done:!1,value:I};const{needsInterpolation:L}=E;L&&L(I,P)&&(T=SX([0,100],[I,P],{clamp:!1}),a=[0,100]);const z=E({...m,duration:e,keyframes:a});function F(){x++,n==="reverse"?(A=x%2===0,i=ghe(i,S,s,A)):(i=PX(i,S,s),n==="mirror"&&z.flipTarget()),_=!1,h&&h()}function G(){g&&g.stop(),u&&u()}function N(ie){A||(ie=-ie),i+=ie,_||(C=z.next(Math.max(0,i)),T&&(C.value=T(C.value)),_=A?C.done:i<=0),d&&d(C.value),_&&(x===0&&(S=S!==void 0?S:i),x<r?vhe(i,S,s,A)&&F():G())}function q(){l&&l(),g=t(N),g.start()}return o&&q(),{stop:()=>{c&&c(),g&&g.stop()},set currentTime(ie){i=v,N(ie)},sample:ie=>{i=v;const Q=e&&typeof e=="number"?Math.max(e*.5,50):50;let W=0;for(N(0);W<=ie;){const ee=ie-W;N(Math.min(ee,Q)),W+=Q}return C}}}function xhe(e){return!e||Array.isArray(e)||typeof e=="string"&&DX[e]}const Ow=([e,t,i,r])=>`cubic-bezier(${e}, ${t}, ${i}, ${r})`,DX={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ow([0,.65,.55,1]),circOut:Ow([.55,0,1,.45]),backIn:Ow([.31,.01,.66,-.59]),backOut:Ow([.33,1.53,.69,.99])};function whe(e){if(e)return Array.isArray(e)?Ow(e):DX[e]}function bhe(e,t,i,{delay:r=0,duration:n,repeat:s=0,repeatType:a="loop",ease:o,times:l}={}){return e.animate({[t]:i,offset:l},{delay:r,duration:n,easing:whe(o),fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"})}const O4={waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate")},vD={},RX={};for(const e in O4)RX[e]=()=>(vD[e]===void 0&&(vD[e]=O4[e]()),vD[e]);function _he(e,{repeat:t,repeatType:i="loop"}){const r=t&&i!=="loop"&&t%2===1?0:e.length-1;return e[r]}const She=new Set(["opacity","clipPath","filter","transform"]),GM=10;function Mhe(e,t,{onUpdate:i,onComplete:r,...n}){if(!(RX.waapi()&&She.has(t)&&!n.repeatDelay&&n.repeatType!=="mirror"&&n.damping!==0))return!1;let{keyframes:a,duration:o=300,elapsed:l=0,ease:c}=n;if(n.type==="spring"||!xhe(n.ease)){if(n.repeat===1/0)return;const h=rT({...n,elapsed:0});let d={done:!1,value:a[0]};const f=[];let m=0;for(;!d.done&&m<2e4;)d=h.sample(m),f.push(d.value),m+=GM;a=f,o=m-GM,c="linear"}const u=bhe(e.owner.current,t,a,{...n,delay:-l,duration:o,ease:c});return u.onfinish=()=>{e.set(_he(a,n)),fo.update(()=>u.cancel()),r&&r()},{get currentTime(){return u.currentTime||0},set currentTime(h){u.currentTime=h},stop:()=>{const{currentTime:h}=u;if(h){const d=rT({...n,autoplay:!1});e.setWithVelocity(d.sample(h-GM).value,d.sample(h).value,GM)}fo.update(()=>u.cancel())}}}function IX(e,t){const i=performance.now(),r=({timestamp:n})=>{const s=n-i;s>=t&&(_p.read(r),e(s-t))};return fo.read(r,!0),()=>_p.read(r)}function Ahe({keyframes:e,elapsed:t,onUpdate:i,onComplete:r}){const n=()=>{i&&i(e[e.length-1]),r&&r()};return t?{stop:IX(n,-t)}:n()}function Ehe({keyframes:e,velocity:t=0,min:i,max:r,power:n=.8,timeConstant:s=750,bounceStiffness:a=500,bounceDamping:o=10,restDelta:l=1,modifyTarget:c,driver:u,onUpdate:h,onComplete:d,onStop:f}){const m=e[0];let v;function g(A){return i!==void 0&&A<i||r!==void 0&&A>r}function x(A){return i===void 0?r:r===void 0||Math.abs(i-A)<Math.abs(r-A)?i:r}function S(A){v&&v.stop(),v=rT({keyframes:[0,1],velocity:0,...A,driver:u,onUpdate:T=>{h&&h(T),A.onUpdate&&A.onUpdate(T)},onComplete:d,onStop:f})}function _(A){S({type:"spring",stiffness:a,damping:o,restDelta:l,...A})}if(g(m))_({velocity:t,keyframes:[m,x(m)]});else{let A=n*t+m;typeof c<"u"&&(A=c(A));const T=x(A),E=T===i?-1:1;let I,P;const C=L=>{I=P,P=L,t=mB(L-I,Ed.delta),(E===1&&L>T||E===-1&&L<T)&&_({keyframes:[L,T],velocity:t})};S({type:"decay",keyframes:[m,0],velocity:t,timeConstant:s,power:n,restDelta:l,modifyTarget:c,onUpdate:g(A)?C:void 0})}return{stop:()=>v&&v.stop()}}const The={type:"spring",stiffness:500,damping:25,restSpeed:10},Che=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Phe={type:"keyframes",duration:.8},Dhe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Rhe=(e,{keyframes:t})=>t.length>2?Phe:rv.has(e)?e.startsWith("scale")?Che(t[1]):The:Dhe,HI=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&Sp.test(t)&&!t.startsWith("url("));function Ihe({when:e,delay:t,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length}function z4(e){return e===0||typeof e=="string"&&parseFloat(e)===0&&e.indexOf(" ")===-1}function B4(e){return typeof e=="number"?0:yB("",e)}function LX(e,t){return e[t]||e.default||e}function Lhe(e,t,i,r){const n=HI(t,i);let s=r.from!==void 0?r.from:e.get();return s==="none"&&n&&typeof i=="string"?s=yB(t,i):z4(s)&&typeof i=="string"?s=B4(i):!Array.isArray(i)&&z4(i)&&typeof s=="string"&&(i=B4(s)),Array.isArray(i)?(i[0]===null&&(i[0]=s),i):[s,i]}const AB=(e,t,i,r={})=>n=>{const s=LX(r,e)||{},a=s.delay||r.delay||0;let{elapsed:o=0}=r;o=o-SE(a);const l=Lhe(t,e,i,s),c=l[0],u=l[l.length-1],h=HI(e,c),d=HI(e,u);let f={keyframes:l,velocity:t.getVelocity(),...s,elapsed:o,onUpdate:m=>{t.set(m),s.onUpdate&&s.onUpdate(m)},onComplete:()=>{n(),s.onComplete&&s.onComplete()}};if(!h||!d||Bue.current||s.type===!1)return Ahe(f);if(s.type==="inertia")return Ehe(f);if(Ihe(s)||(f={...f,...Rhe(e,f)}),f.duration&&(f.duration=SE(f.duration)),f.repeatDelay&&(f.repeatDelay=SE(f.repeatDelay)),t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const m=Mhe(t,e,f);if(m)return m}return rT(f)};function Ohe(e,t,i={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const n=t.map(s=>GI(e,s,i));r=Promise.all(n)}else if(typeof t=="string")r=GI(e,t,i);else{const n=typeof t=="function"?K2(e,t,i.custom):t;r=OX(e,n,i)}return r.then(()=>e.notify("AnimationComplete",t))}function GI(e,t,i={}){const r=K2(e,t,i.custom);let{transition:n=e.getDefaultTransition()||{}}=r||{};i.transitionOverride&&(n=i.transitionOverride);const s=r?()=>OX(e,r,i):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:h}=n;return zhe(e,t,c+l,u,h,i)}:()=>Promise.resolve(),{when:o}=n;if(o){const[l,c]=o==="beforeChildren"?[s,a]:[a,s];return l().then(c)}else return Promise.all([s(),a(i.delay)])}function OX(e,t,{delay:i=0,transitionOverride:r,type:n}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:a,...o}=e.makeTargetAnimatable(t);const l=e.getValue("willChange");r&&(s=r);const c=[],u=n&&e.animationState&&e.animationState.getState()[n];for(const h in o){const d=e.getValue(h),f=o[h];if(!d||f===void 0||u&&Nhe(u,h))continue;const m={delay:i,elapsed:0,...s};if(window.HandoffAppearAnimations&&!d.hasAnimated){const g=e.getProps()[zue];g&&(m.elapsed=window.HandoffAppearAnimations(g,h,d,fo))}let v=d.start(AB(h,d,f,e.shouldReduceMotion&&rv.has(h)?{type:!1}:m));tT(l)&&(l.add(h),v=v.then(()=>l.remove(h))),c.push(v)}return Promise.all(c).then(()=>{a&&Due(e,a)})}function zhe(e,t,i=0,r=0,n=1,s){const a=[],o=(e.variantChildren.size-1)*r,l=n===1?(c=0)=>c*r:(c=0)=>o-c*r;return Array.from(e.variantChildren).sort(Bhe).forEach((c,u)=>{c.notify("AnimationStart",t),a.push(GI(c,t,{...s,delay:i+l(u)}).then(()=>c.notify("AnimationComplete",t)))}),Promise.all(a)}function Bhe(e,t){return e.sortNodePosition(t)}function Nhe({protectedKeys:e,needsAnimating:t},i){const r=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,r}const Uhe=[...iB].reverse(),Fhe=iB.length;function khe(e){return t=>Promise.all(t.map(({animation:i,options:r})=>Ohe(e,i,r)))}function Vhe(e){let t=khe(e);const i=Ghe();let r=!0;const n=(l,c)=>{const u=K2(e,c);if(u){const{transition:h,transitionEnd:d,...f}=u;l={...l,...f,...d}}return l};function s(l){t=l(e)}function a(l,c){const u=e.getProps(),h=e.getVariantContext(!0)||{},d=[],f=new Set;let m={},v=1/0;for(let x=0;x<Fhe;x++){const S=Uhe[x],_=i[S],A=u[S]!==void 0?u[S]:h[S],T=Hb(A),E=S===c?_.isActive:null;E===!1&&(v=x);let I=A===h[S]&&A!==u[S]&&T;if(I&&r&&e.manuallyAnimateOnMount&&(I=!1),_.protectedKeys={...m},!_.isActive&&E===null||!A&&!_.prevProp||X2(A)||typeof A=="boolean")continue;const P=Hhe(_.prevProp,A);let C=P||S===c&&_.isActive&&!I&&T||x>v&&T;const L=Array.isArray(A)?A:[A];let z=L.reduce(n,{});E===!1&&(z={});const{prevResolvedValues:F={}}=_,G={...F,...z},N=q=>{C=!0,f.delete(q),_.needsAnimating[q]=!0};for(const q in G){const ie=z[q],Q=F[q];m.hasOwnProperty(q)||(ie!==Q?$E(ie)&&$E(Q)?!lX(ie,Q)||P?N(q):_.protectedKeys[q]=!0:ie!==void 0?N(q):f.add(q):ie!==void 0&&f.has(q)?N(q):_.protectedKeys[q]=!0)}_.prevProp=A,_.prevResolvedValues=z,_.isActive&&(m={...m,...z}),r&&e.blockInitialAnimation&&(C=!1),C&&!I&&d.push(...L.map(q=>({animation:q,options:{type:S,...l}})))}if(f.size){const x={};f.forEach(S=>{const _=e.getBaseTarget(S);_!==void 0&&(x[S]=_)}),d.push({animation:x})}let g=!!d.length;return r&&u.initial===!1&&!e.manuallyAnimateOnMount&&(g=!1),r=!1,g?t(d):Promise.resolve()}function o(l,c,u){var h;if(i[l].isActive===c)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(f=>{var m;return(m=f.animationState)===null||m===void 0?void 0:m.setActive(l,c)}),i[l].isActive=c;const d=a(u,l);for(const f in i)i[f].protectedKeys={};return d}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i}}function Hhe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!lX(t,e):!1}function Bm(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ghe(){return{animate:Bm(!0),whileInView:Bm(),whileHover:Bm(),whileTap:Bm(),whileDrag:Bm(),whileFocus:Bm(),exit:Bm()}}class jhe extends Op{constructor(t){super(t),t.animationState||(t.animationState=Vhe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),X2(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){}}let Whe=0;class Xhe extends Op{constructor(){super(...arguments),this.id=Whe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i,custom:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const s=this.node.animationState.setActive("exit",!t,{custom:r??this.node.getProps().custom});i&&!t&&s.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const qhe={animation:{Feature:jhe},exit:{Feature:Xhe}},N4=(e,t)=>Math.abs(e-t);function Yhe(e,t){const i=N4(e.x,t.x),r=N4(e.y,t.y);return Math.sqrt(i**2+r**2)}class zX{constructor(t,i,{transformPagePoint:r}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const c=xD(this.lastMoveEventInfo,this.history),u=this.startEvent!==null,h=Yhe(c.offset,{x:0,y:0})>=3;if(!u&&!h)return;const{point:d}=c,{timestamp:f}=Ed;this.history.push({...d,timestamp:f});const{onStart:m,onMove:v}=this.handlers;u||(m&&m(this.lastMoveEvent,c),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,c)},this.handlePointerMove=(c,u)=>{this.lastMoveEvent=c,this.lastMoveEventInfo=yD(u,this.transformPagePoint),fo.update(this.updatePoint,!0)},this.handlePointerUp=(c,u)=>{if(this.end(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const{onEnd:h,onSessionEnd:d}=this.handlers,f=xD(c.type==="pointercancel"?this.lastMoveEventInfo:yD(u,this.transformPagePoint),this.history);this.startEvent&&h&&h(c,f),d&&d(c,f)},!rX(t))return;this.handlers=i,this.transformPagePoint=r;const n=Q2(t),s=yD(n,this.transformPagePoint),{point:a}=s,{timestamp:o}=Ed;this.history=[{...a,timestamp:o}];const{onSessionStart:l}=i;l&&l(t,xD(s,this.history)),this.removeListeners=fp(Ad(window,"pointermove",this.handlePointerMove),Ad(window,"pointerup",this.handlePointerUp),Ad(window,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),_p.update(this.updatePoint)}}function yD(e,t){return t?{point:t(e.point)}:e}function U4(e,t){return{x:e.x-t.x,y:e.y-t.y}}function xD({point:e},t){return{point:e,delta:U4(e,BX(t)),offset:U4(e,Qhe(t)),velocity:Zhe(t,.1)}}function Qhe(e){return e[0]}function BX(e){return e[e.length-1]}function Zhe(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,r=null;const n=BX(e);for(;i>=0&&(r=e[i],!(n.timestamp-r.timestamp>SE(t)));)i--;if(!r)return{x:0,y:0};const s=(n.timestamp-r.timestamp)/1e3;if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function pl(e){return e.max-e.min}function jI(e,t=0,i=.01){return Math.abs(e-t)<=i}function F4(e,t,i,r=.5){e.origin=r,e.originPoint=yn(t.min,t.max,e.origin),e.scale=pl(i)/pl(t),(jI(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=yn(i.min,i.max,e.origin)-e.originPoint,(jI(e.translate)||isNaN(e.translate))&&(e.translate=0)}function tb(e,t,i,r){F4(e.x,t.x,i.x,r?r.originX:void 0),F4(e.y,t.y,i.y,r?r.originY:void 0)}function k4(e,t,i){e.min=i.min+t.min,e.max=e.min+pl(t)}function Khe(e,t,i){k4(e.x,t.x,i.x),k4(e.y,t.y,i.y)}function V4(e,t,i){e.min=t.min-i.min,e.max=e.min+pl(t)}function ib(e,t,i){V4(e.x,t.x,i.x),V4(e.y,t.y,i.y)}function Jhe(e,{min:t,max:i},r){return t!==void 0&&e<t?e=r?yn(t,e,r.min):Math.max(e,t):i!==void 0&&e>i&&(e=r?yn(i,e,r.max):Math.min(e,i)),e}function H4(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function $he(e,{top:t,left:i,bottom:r,right:n}){return{x:H4(e.x,i,n),y:H4(e.y,t,r)}}function G4(e,t){let i=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,r]=[r,i]),{min:i,max:r}}function ede(e,t){return{x:G4(e.x,t.x),y:G4(e.y,t.y)}}function tde(e,t){let i=.5;const r=pl(e),n=pl(t);return n>r?i=Xb(t.min,t.max-r,e.min):r>n&&(i=Xb(e.min,e.max-n,t.min)),tx(0,1,i)}function ide(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const WI=.35;function rde(e=WI){return e===!1?e=0:e===!0&&(e=WI),{x:j4(e,"left","right"),y:j4(e,"top","bottom")}}function j4(e,t,i){return{min:W4(e,t),max:W4(e,i)}}function W4(e,t){return typeof e=="number"?e:e[t]||0}const X4=()=>({translate:0,scale:1,origin:0,originPoint:0}),rb=()=>({x:X4(),y:X4()}),q4=()=>({min:0,max:0}),es=()=>({x:q4(),y:q4()});function Pu(e){return[e("x"),e("y")]}function NX({top:e,left:t,right:i,bottom:r}){return{x:{min:t,max:i},y:{min:e,max:r}}}function nde({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function sde(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}function wD(e){return e===void 0||e===1}function XI({scale:e,scaleX:t,scaleY:i}){return!wD(e)||!wD(t)||!wD(i)}function Zm(e){return XI(e)||UX(e)||e.z||e.rotate||e.rotateX||e.rotateY}function UX(e){return Y4(e.x)||Y4(e.y)}function Y4(e){return e&&e!=="0%"}function nT(e,t,i){const r=e-i,n=t*r;return i+n}function Q4(e,t,i,r,n){return n!==void 0&&(e=nT(e,n,r)),nT(e,i,r)+t}function qI(e,t=0,i=1,r,n){e.min=Q4(e.min,t,i,r,n),e.max=Q4(e.max,t,i,r,n)}function FX(e,{x:t,y:i}){qI(e.x,t.translate,t.scale,t.originPoint),qI(e.y,i.translate,i.scale,i.originPoint)}function ade(e,t,i,r=!1){const n=i.length;if(!n)return;t.x=t.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const l=s.instance;l&&l.style&&l.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Ay(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,FX(e,a)),r&&Zm(s.latestValues)&&Ay(e,s.latestValues))}t.x=Z4(t.x),t.y=Z4(t.y)}function Z4(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function Wf(e,t){e.min=e.min+t,e.max=e.max+t}function K4(e,t,[i,r,n]){const s=t[n]!==void 0?t[n]:.5,a=yn(e.min,e.max,s);qI(e,t[i],t[r],a,t.scale)}const ode=["x","scaleX","originX"],lde=["y","scaleY","originY"];function Ay(e,t){K4(e.x,t,ode),K4(e.y,t,lde)}function kX(e,t){return NX(sde(e.getBoundingClientRect(),t))}function cde(e,t,i){const r=kX(e,i),{scroll:n}=t;return n&&(Wf(r.x,n.offset.x),Wf(r.y,n.offset.y)),r}const ude=new WeakMap;class hde{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=es(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const n=l=>{this.stopAnimation(),i&&this.snapToCursor(Q2(l,"page").point)},s=(l,c)=>{const{drag:u,dragPropagation:h,onDragStart:d}=this.getProps();if(u&&!h&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=sX(u),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Pu(m=>{let v=this.getAxisMotionValue(m).get()||0;if(ju.test(v)){const{projection:g}=this.visualElement;if(g&&g.layout){const x=g.layout.layoutBox[m];x&&(v=pl(x)*(parseFloat(v)/100))}}this.originPoint[m]=v}),d&&d(l,c);const{animationState:f}=this.visualElement;f&&f.setActive("whileDrag",!0)},a=(l,c)=>{const{dragPropagation:u,dragDirectionLock:h,onDirectionLock:d,onDrag:f}=this.getProps();if(!u&&!this.openGlobalLock)return;const{offset:m}=c;if(h&&this.currentDirection===null){this.currentDirection=dde(m),this.currentDirection!==null&&d&&d(this.currentDirection);return}this.updateAxis("x",c.point,m),this.updateAxis("y",c.point,m),this.visualElement.render(),f&&f(l,c)},o=(l,c)=>this.stop(l,c);this.panSession=new zX(t,{onSessionStart:n,onStart:s,onMove:a,onSessionEnd:o},{transformPagePoint:this.visualElement.getTransformPagePoint()})}stop(t,i){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=i;this.startAnimation(n);const{onDragEnd:s}=this.getProps();s&&s(t,i)}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,r){const{drag:n}=this.getProps();if(!r||!jM(t,n,this.currentDirection))return;const s=this.getAxisMotionValue(t);let a=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(a=Jhe(a,this.constraints[t],this.elastic[t])),s.set(a)}resolveConstraints(){const{dragConstraints:t,dragElastic:i}=this.getProps(),{layout:r}=this.visualElement.projection||{},n=this.constraints;t&&Sy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=$he(r.layoutBox,t):this.constraints=!1,this.elastic=rde(i),n!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Pu(s=>{this.getAxisMotionValue(s)&&(this.constraints[s]=ide(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!Sy(t))return!1;const r=t.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=cde(r,n.root,this.visualElement.getTransformPagePoint());let a=ede(n.layout.layoutBox,s);if(i){const o=i(nde(a));this.hasMutatedConstraints=!!o,o&&(a=NX(o))}return a}startAnimation(t){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=Pu(u=>{if(!jM(u,i,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const d=n?200:1e6,f=n?40:1e7,m={type:"inertia",velocity:r?t[u]:0,bounceStiffness:d,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,m)});return Promise.all(c).then(o)}startAxisValueAnimation(t,i){const r=this.getAxisMotionValue(t);return r.start(AB(t,r,0,i))}stopAnimation(){Pu(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){const i="_drag"+t.toUpperCase(),r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Pu(i=>{const{drag:r}=this.getProps();if(!jM(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(t[i]-yn(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!Sy(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Pu(a=>{const o=this.getAxisMotionValue(a);if(o){const l=o.get();n[a]=tde({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Pu(a=>{if(!jM(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(yn(l,c,n[a]))})}addListeners(){if(!this.visualElement.current)return;ude.set(this.visualElement,this);const t=this.visualElement.current,i=Ad(t,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();Sy(l)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),r();const a=vd(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Pu(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),i(),s(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=WI,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function jM(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function dde(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class fde extends Op{constructor(t){super(t),this.removeGroupControls=Wc,this.removeListeners=Wc,this.controls=new hde(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Wc}unmount(){this.removeGroupControls(),this.removeListeners()}}class pde extends Op{constructor(){super(...arguments),this.removePointerDownListener=Wc}onPointerDown(t){this.session=new zX(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint()})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:t,onStart:i,onMove:r,onEnd:(s,a)=>{delete this.session,n&&n(s,a)}}}mount(){this.removePointerDownListener=Ad(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function mde(){const e=Se.useContext(tB);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:i,register:r}=e,n=Se.useId();return Se.useEffect(()=>r(n),[]),!t&&i?[!1,()=>i&&i(n)]:[!0]}function J4(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const J1={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Pi.test(e))e=parseFloat(e);else return e;const i=J4(e,t.target.x),r=J4(e,t.target.y);return`${i}% ${r}%`}},VX=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function gde(e){const t=VX.exec(e);if(!t)return[,];const[,i,r]=t;return[i,r]}function YI(e,t,i=1){const[r,n]=gde(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);return s?s.trim():LI(n)?YI(n,t,i+1):n}function vde(e,{...t},i){const r=e.current;if(!(r instanceof Element))return{target:t,transitionEnd:i};i&&(i={...i}),e.values.forEach(n=>{const s=n.get();if(!LI(s))return;const a=YI(s,r);a&&n.set(a)});for(const n in t){const s=t[n];if(!LI(s))continue;const a=YI(s,r);a&&(t[n]=a,i&&i[n]===void 0&&(i[n]=s))}return{target:t,transitionEnd:i}}const $4="_$css",yde={correct:(e,{treeScale:t,projectionDelta:i})=>{const r=e,n=e.includes("var("),s=[];n&&(e=e.replace(VX,f=>(s.push(f),$4)));const a=Sp.parse(e);if(a.length>5)return r;const o=Sp.createTransformer(e),l=typeof a[0]!="number"?1:0,c=i.x.scale*t.x,u=i.y.scale*t.y;a[0+l]/=c,a[1+l]/=u;const h=yn(c,u,.5);typeof a[2+l]=="number"&&(a[2+l]/=h),typeof a[3+l]=="number"&&(a[3+l]/=h);let d=o(a);if(n){let f=0;d=d.replace($4,()=>{const m=s[f];return f++,m})}return d}};class xde extends Gc.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=t;wce(wde),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),Jw.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,a=r.projection;return a&&(a.isPresent=s,n||t.layoutDependency!==i||i===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?a.promote():a.relegate()||fo.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),!t.currentAnimation&&t.isLead()&&this.safeToRemove())}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=t;n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function HX(e){const[t,i]=mde(),r=Se.useContext(G7);return Gc.createElement(xde,{...e,layoutGroup:r,switchLayoutGroup:Se.useContext(j7),isPresent:t,safeToRemove:i})}const wde={borderRadius:{...J1,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:J1,borderTopRightRadius:J1,borderBottomLeftRadius:J1,borderBottomRightRadius:J1,boxShadow:yde};function bde(e,t,i={}){const r=Go(e)?e:ix(e);return r.start(AB("",r,t,i)),{stop:()=>r.stop(),isAnimating:()=>r.isAnimating()}}const GX=["TopLeft","TopRight","BottomLeft","BottomRight"],_de=GX.length,e5=e=>typeof e=="string"?parseFloat(e):e,t5=e=>typeof e=="number"||Pi.test(e);function Sde(e,t,i,r,n,s){n?(e.opacity=yn(0,i.opacity!==void 0?i.opacity:1,Mde(r)),e.opacityExit=yn(t.opacity!==void 0?t.opacity:1,0,Ade(r))):s&&(e.opacity=yn(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,r));for(let a=0;a<_de;a++){const o=`border${GX[a]}Radius`;let l=i5(t,o),c=i5(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||t5(l)===t5(c)?(e[o]=Math.max(yn(e5(l),e5(c),r),0),(ju.test(c)||ju.test(l))&&(e[o]+="%")):e[o]=c}(t.rotate||i.rotate)&&(e.rotate=yn(t.rotate||0,i.rotate||0,r))}function i5(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Mde=jX(0,.5,SB),Ade=jX(.5,.95,Wc);function jX(e,t,i){return r=>r<e?0:r>t?1:i(Xb(e,t,r))}function r5(e,t){e.min=t.min,e.max=t.max}function Cl(e,t){r5(e.x,t.x),r5(e.y,t.y)}function n5(e,t,i,r,n){return e-=t,e=nT(e,1/i,r),n!==void 0&&(e=nT(e,1/n,r)),e}function Ede(e,t=0,i=1,r=.5,n,s=e,a=e){if(ju.test(t)&&(t=parseFloat(t),t=yn(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=yn(s.min,s.max,r);e===s&&(o-=t),e.min=n5(e.min,t,i,o,n),e.max=n5(e.max,t,i,o,n)}function s5(e,t,[i,r,n],s,a){Ede(e,t[i],t[r],t[n],t.scale,s,a)}const Tde=["x","scaleX","originX"],Cde=["y","scaleY","originY"];function a5(e,t,i,r){s5(e.x,t,Tde,i?i.x:void 0,r?r.x:void 0),s5(e.y,t,Cde,i?i.y:void 0,r?r.y:void 0)}function o5(e){return e.translate===0&&e.scale===1}function WX(e){return o5(e.x)&&o5(e.y)}function QI(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function l5(e){return pl(e.x)/pl(e.y)}class Pde{constructor(){this.members=[]}add(t){dB(this.members,t),t.scheduleRender()}remove(t){if(fB(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(n=>t===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,i){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,i&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:r}=t;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function c5(e,t,i){let r="";const n=e.x.translate/t.x,s=e.y.translate/t.y;if((n||s)&&(r=`translate3d(${n}px, ${s}px, 0) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),i){const{rotate:l,rotateX:c,rotateY:u}=i;l&&(r+=`rotate(${l}deg) `),c&&(r+=`rotateX(${c}deg) `),u&&(r+=`rotateY(${u}deg) `)}const a=e.x.scale*t.x,o=e.y.scale*t.y;return(a!==1||o!==1)&&(r+=`scale(${a}, ${o})`),r||"none"}const Dde=(e,t)=>e.depth-t.depth;class Rde{constructor(){this.children=[],this.isDirty=!1}add(t){dB(this.children,t),this.isDirty=!0}remove(t){fB(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Dde),this.isDirty=!1,this.children.forEach(t)}}function Ide(e){window.MotionDebug&&window.MotionDebug.record(e)}const u5=["","X","Y","Z"],h5=1e3;let Lde=0;const Km={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function XX({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a,o={},l=t==null?void 0:t()){this.id=Lde++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.potentialNodes=new Map,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{Km.totalNodes=Km.resolvedTargetDeltas=Km.recalculatedProjection=0,this.nodes.forEach(Bde),this.nodes.forEach(kde),this.nodes.forEach(Vde),this.nodes.forEach(Nde),Ide(Km)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.elementId=a,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0,a&&this.root.registerPotentialNode(a,this);for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Rde)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new pB),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}registerPotentialNode(a,o){this.potentialNodes.set(a,o)}mount(a,o=!1){if(this.instance)return;this.isSVG=a instanceof SVGElement&&a.tagName!=="svg",this.instance=a;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.elementId&&this.root.potentialNodes.delete(this.elementId),o&&(c||l)&&(this.isLayoutDirty=!0),e){let h;const d=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=IX(d,250),Jw.hasAnimatedSinceResize&&(Jw.hasAnimatedSinceResize=!1,this.nodes.forEach(f5))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:d,hasRelativeTargetChanged:f,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||Xde,{onLayoutAnimationStart:g,onLayoutAnimationComplete:x}=u.getProps(),S=!this.targetLayout||!QI(this.targetLayout,m)||f,_=!d&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||_||d&&(S||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,_);const A={...LX(v,"layout"),onPlay:g,onComplete:x};(u.shouldReduceMotion||this.options.layoutRoot)&&(A.delay=0,A.type=!1),this.startAnimation(A)}else!d&&this.animationProgress===0&&f5(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,_p.preRender(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Hde),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}didUpdate(){if(this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(d5);return}this.isUpdating&&(this.isUpdating=!1,this.potentialNodes.size&&(this.potentialNodes.forEach(qde),this.potentialNodes.clear()),this.nodes.forEach(Fde),this.nodes.forEach(Ode),this.nodes.forEach(zde),this.clearAllSnapshots(),fD.update(),fD.preRender(),fD.render())}clearAllSnapshots(){this.nodes.forEach(Ude),this.sharedNodes.forEach(Gde)}scheduleUpdateProjection(){fo.preRender(this.updateProjection,!1,!0)}scheduleCheckAfterUnmount(){fo.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=es(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&(this.scroll={animationId:this.root.animationId,phase:a,isRoot:r(this.instance),offset:i(this.instance)})}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform,o=this.projectionDelta&&!WX(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;a&&(o||Zm(this.latestValues)||u)&&(n(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),Yde(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return es();const o=a.measureViewportBox(),{scroll:l}=this.root;return l&&(Wf(o.x,l.offset.x),Wf(o.y,l.offset.y)),o}removeElementScroll(a){const o=es();Cl(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:h}=c;if(c!==this.root&&u&&h.layoutScroll){if(u.isRoot){Cl(o,a);const{scroll:d}=this.root;d&&(Wf(o.x,-d.offset.x),Wf(o.y,-d.offset.y))}Wf(o.x,u.offset.x),Wf(o.y,u.offset.y)}}return o}applyTransform(a,o=!1){const l=es();Cl(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Ay(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Zm(u.latestValues)&&Ay(l,u.latestValues)}return Zm(this.latestValues)&&Ay(l,this.latestValues),l}removeTransform(a){const o=es();Cl(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Zm(c.latestValues))continue;XI(c.latestValues)&&c.updateSnapshot();const u=es(),h=c.measurePageBox();Cl(u,h),a5(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Zm(this.latestValues)&&a5(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}resolveTargetDelta(){var a;const o=this.getLead();if(this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty),!((!!this.resumingFrom||this!==o)&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:u,layoutId:h}=this.options;if(!(!this.layout||!(u||h))){if(!this.targetDelta&&!this.relativeTarget){const d=this.getClosestProjectingParent();d&&d.layout?(this.relativeParent=d,this.relativeTarget=es(),this.relativeTargetOrigin=es(),ib(this.relativeTargetOrigin,this.layout.layoutBox,d.layout.layoutBox),Cl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=es(),this.targetWithTransforms=es()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?Khe(this.target,this.relativeTarget,this.relativeParent.target):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Cl(this.target,this.layout.layoutBox),FX(this.target,this.targetDelta)):Cl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const d=this.getClosestProjectingParent();d&&!!d.resumingFrom==!!this.resumingFrom&&!d.options.layoutScroll&&d.target?(this.relativeParent=d,this.relativeTarget=es(),this.relativeTargetOrigin=es(),ib(this.relativeTargetOrigin,this.target,d.target),Cl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Km.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||XI(this.parent.latestValues)||UX(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),c)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;Cl(this.layoutCorrected,this.layout.layoutBox),ade(this.layoutCorrected,this.treeScale,this.path,l);const{target:d}=o;if(!d)return;this.projectionDelta||(this.projectionDelta=rb(),this.projectionDeltaWithTransform=rb());const f=this.treeScale.x,m=this.treeScale.y,v=this.projectionTransform;tb(this.projectionDelta,this.layoutCorrected,d,this.latestValues),this.projectionTransform=c5(this.projectionDelta,this.treeScale),(this.projectionTransform!==v||this.treeScale.x!==f||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",d)),Km.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},h=rb();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=es(),f=l?l.source:void 0,m=this.layout?this.layout.source:void 0,v=f!==m,g=this.getStack(),x=!g||g.members.length<=1,S=!!(v&&!x&&this.options.crossfade===!0&&!this.path.some(Wde));this.animationProgress=0;let _;this.mixTargetDelta=A=>{const T=A/1e3;p5(h.x,a.x,T),p5(h.y,a.y,T),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ib(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),jde(this.relativeTarget,this.relativeTargetOrigin,d,T),_&&QI(this.relativeTarget,_)&&(this.isProjectionDirty=!1),_||(_=es()),Cl(_,this.relativeTarget)),v&&(this.animationValues=u,Sde(u,c,this.latestValues,T,S,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(_p.update(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=fo.update(()=>{Jw.hasAnimatedSinceResize=!0,this.currentAnimation=bde(0,h5,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(h5),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:u}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&qX(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||es();const h=pl(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=pl(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}Cl(o,l),Ay(o,u),tb(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Pde),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.rotate||l.rotateX||l.rotateY||l.rotateZ)&&(o=!0),!o)return;const c={};for(let u=0;u<u5.length;u++){const h="rotate"+u5[u];l[h]&&(c[h]=l[h],a.setStaticValue(h,0))}a.render();for(const u in c)a.setStaticValue(u,c[u]);a.scheduleRender()}getProjectionStyles(a={}){var o,l;const c={};if(!this.instance||this.isSVG)return c;if(this.isVisible)c.visibility="";else return{visibility:"hidden"};const u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=_E(a.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=_E(a.pointerEvents)||""),this.hasProjected&&!Zm(this.latestValues)&&(v.transform=u?u({},""):"none",this.hasProjected=!1),v}const d=h.animationValues||h.latestValues;this.applyTransformsToTarget(),c.transform=c5(this.projectionDeltaWithTransform,this.treeScale,d),u&&(c.transform=u(d,c.transform));const{x:f,y:m}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${m.origin*100}% 0`,h.animationValues?c.opacity=h===this?(l=(o=d.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:c.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const v in KE){if(d[v]===void 0)continue;const{correct:g,applyTo:x}=KE[v],S=c.transform==="none"?d[v]:g(d[v],h);if(x){const _=x.length;for(let A=0;A<_;A++)c[x[A]]=S}else c[v]=S}return this.options.layoutId&&(c.pointerEvents=h===this?_E(a.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(d5),this.root.sharedNodes.clear()}}}function Ode(e){e.updateLayout()}function zde(e){var t;const i=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:s}=e.options,a=i.source!==e.layout.source;s==="size"?Pu(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],f=pl(d);d.min=r[h].min,d.max=d.min+f}):qX(s,i.layoutBox,r)&&Pu(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],f=pl(r[h]);d.max=d.min+f});const o=rb();tb(o,r,i.layoutBox);const l=rb();a?tb(l,e.applyTransform(n,!0),i.measuredBox):tb(l,r,i.layoutBox);const c=!WX(o);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:d,layout:f}=h;if(d&&f){const m=es();ib(m,i.layoutBox,d.layoutBox);const v=es();ib(v,r,f.layoutBox),QI(m,v)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=m,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:i,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function Bde(e){Km.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Nde(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Ude(e){e.clearSnapshot()}function d5(e){e.clearMeasurements()}function Fde(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function f5(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0}function kde(e){e.resolveTargetDelta()}function Vde(e){e.calcProjection()}function Hde(e){e.resetRotation()}function Gde(e){e.removeLeadSnapshot()}function p5(e,t,i){e.translate=yn(t.translate,0,i),e.scale=yn(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function m5(e,t,i,r){e.min=yn(t.min,i.min,r),e.max=yn(t.max,i.max,r)}function jde(e,t,i,r){m5(e.x,t.x,i.x,r),m5(e.y,t.y,i.y,r)}function Wde(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Xde={duration:.45,ease:[.4,0,.1,1]};function qde(e,t){let i=e.root;for(let s=e.path.length-1;s>=0;s--)if(e.path[s].instance){i=e.path[s];break}const n=(i&&i!==e.root?i.instance:document).querySelector(`[data-projection-id="${t}"]`);n&&e.mount(n,!0)}function g5(e){e.min=Math.round(e.min),e.max=Math.round(e.max)}function Yde(e){g5(e.x),g5(e.y)}function qX(e,t,i){return e==="position"||e==="preserve-aspect"&&!jI(l5(t),l5(i),.2)}const Qde=XX({attachResizeListener:(e,t)=>vd(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),bD={current:void 0},YX=XX({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!bD.current){const e=new Qde(0,{});e.mount(window),e.setOptions({layoutScroll:!0}),bD.current=e}return bD.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Zde={pan:{Feature:pde},drag:{Feature:fde,ProjectionNode:YX,MeasureLayout:HX}},Kde=new Set(["width","height","top","left","right","bottom","x","y"]),QX=e=>Kde.has(e),Jde=e=>Object.keys(e).some(QX),v5=e=>e===nv||e===Pi,y5=(e,t)=>parseFloat(e.split(", ")[t]),x5=(e,t)=>(i,{transform:r})=>{if(r==="none"||!r)return 0;const n=r.match(/^matrix3d\((.+)\)$/);if(n)return y5(n[1],t);{const s=r.match(/^matrix\((.+)\)$/);return s?y5(s[1],e):0}},$de=new Set(["x","y","z"]),efe=Y2.filter(e=>!$de.has(e));function tfe(e){const t=[];return efe.forEach(i=>{const r=e.getValue(i);r!==void 0&&(t.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),t.length&&e.render(),t}const w5={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:x5(4,13),y:x5(5,14)},ife=(e,t,i)=>{const r=t.measureViewportBox(),n=t.current,s=getComputedStyle(n),{display:a}=s,o={};a==="none"&&t.setStaticValue("display",e.display||"block"),i.forEach(c=>{o[c]=w5[c](r,s)}),t.render();const l=t.measureViewportBox();return i.forEach(c=>{const u=t.getValue(c);u&&u.jump(o[c]),e[c]=w5[c](l,s)}),e},rfe=(e,t,i={},r={})=>{t={...t},r={...r};const n=Object.keys(t).filter(QX);let s=[],a=!1;const o=[];if(n.forEach(l=>{const c=e.getValue(l);if(!e.hasValue(l))return;let u=i[l],h=K1(u);const d=t[l];let f;if($E(d)){const m=d.length,v=d[0]===null?1:0;u=d[v],h=K1(u);for(let g=v;g<m;g++)f?iT(K1(d[g])===f):f=K1(d[g])}else f=K1(d);if(h!==f)if(v5(h)&&v5(f)){const m=c.get();typeof m=="string"&&c.set(parseFloat(m)),typeof d=="string"?t[l]=parseFloat(d):Array.isArray(d)&&f===Pi&&(t[l]=d.map(parseFloat))}else h!=null&&h.transform&&(f!=null&&f.transform)&&(u===0||d===0)?u===0?c.set(f.transform(u)):t[l]=h.transform(d):(a||(s=tfe(e),a=!0),o.push(l),r[l]=r[l]!==void 0?r[l]:t[l],c.jump(d))}),o.length){const l=o.indexOf("height")>=0?window.pageYOffset:null,c=ife(t,e,o);return s.length&&s.forEach(([u,h])=>{e.getValue(u).set(h)}),e.render(),W2&&l!==null&&window.scrollTo({top:l}),{target:c,transitionEnd:r}}else return{target:t,transitionEnd:r}};function nfe(e,t,i,r){return Jde(t)?rfe(e,t,i,r):{target:t,transitionEnd:r}}const sfe=(e,t,i,r)=>{const n=vde(e,t,r);return t=n.target,r=n.transitionEnd,nfe(e,t,i,r)},ZI={current:null},ZX={current:!1};function afe(){if(ZX.current=!0,!!W2)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>ZI.current=e.matches;e.addListener(t),t()}else ZI.current=!1}function ofe(e,t,i){const{willChange:r}=t;for(const n in t){const s=t[n],a=i[n];if(Go(s))e.addValue(n,s),tT(r)&&r.add(n);else if(Go(a))e.addValue(n,ix(s,{owner:e})),tT(r)&&r.remove(n);else if(a!==s)if(e.hasValue(n)){const o=e.getValue(n);!o.hasAnimated&&o.set(s)}else{const o=e.getStaticValue(n);e.addValue(n,ix(o!==void 0?o:s,{owner:e}))}}for(const n in i)t[n]===void 0&&e.removeValue(n);return t}const KX=Object.keys(Gb),lfe=KX.length,b5=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],cfe=rB.length;class ufe{constructor({parent:t,props:i,presenceContext:r,reducedMotionConfig:n,visualState:s},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>fo.render(this.render,!1,!0);const{latestValues:o,renderState:l}=s;this.latestValues=o,this.baseTarget={...o},this.initialValues=i.initial?{...o}:{},this.renderState=l,this.parent=t,this.props=i,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=n,this.options=a,this.isControllingVariants=q2(i),this.isVariantNode=V7(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(i,{});for(const h in u){const d=u[h];o[h]!==void 0&&Go(d)&&(d.set(o[h],!1),tT(c)&&c.add(h))}}scrapeMotionValuesFromProps(t,i){return{}}mount(t){this.current=t,this.projection&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),ZX.current||afe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:ZI.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),_p.update(this.notifyUpdate),_p.render(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,i){const r=rv.has(t),n=i.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&fo.update(this.notifyUpdate,!1,!0),r&&this.projection&&(this.projection.isTransformDirty=!0)}),s=i.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{n(),s()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...i},r,n,s,a){let o,l;for(let c=0;c<lfe;c++){const u=KX[c],{isEnabled:h,Feature:d,ProjectionNode:f,MeasureLayout:m}=Gb[u];f&&(o=f),h(i)&&(!this.features[u]&&d&&(this.features[u]=new d(this)),m&&(l=m))}if(!this.projection&&o){this.projection=new o(s,this.latestValues,this.parent&&this.parent.projection);const{layoutId:c,layout:u,drag:h,dragConstraints:d,layoutScroll:f,layoutRoot:m}=i;this.projection.setOptions({layoutId:c,layout:u,alwaysMeasureLayout:!!h||d&&Sy(d),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof u=="string"?u:"both",initialPromotionConfig:a,layoutScroll:f,layoutRoot:m})}return l}updateFeatures(){for(const t in this.features){const i=this.features[t];i.isMounted?i.update(this.props,this.prevProps):(i.mount(),i.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):es()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}makeTargetAnimatable(t,i=!0){return this.makeTargetAnimatableFromInstance(t,this.props,i)}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<b5.length;r++){const n=b5[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s=t["on"+n];s&&(this.propEventSubscriptions[n]=this.on(n,s))}this.prevMotionValues=ofe(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const r=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(r.initial=this.props.initial),r}const i={};for(let r=0;r<cfe;r++){const n=rB[r],s=this.props[n];(Hb(s)||s===!1)&&(i[n]=s)}return i}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){i!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,i)),this.values.set(t,i),this.latestValues[t]=i.get()}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&i!==void 0&&(r=ix(i,{owner:this}),this.addValue(t,r)),r}readValue(t){return this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.readValueFromInstance(this.current,t,this.options)}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:r}=this.props,n=typeof r=="string"||typeof r=="object"?(i=hB(this.props,r))===null||i===void 0?void 0:i[t]:void 0;if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!Go(s)?s:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new pB),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class JX extends ufe{sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:r}){delete i[t],delete r[t]}makeTargetAnimatableFromInstance({transition:t,transitionEnd:i,...r},{transformValues:n},s){let a=Lue(r,t||{},this);if(n&&(i&&(i=n(i)),r&&(r=n(r)),a&&(a=n(a))),s){Rue(this,r,a);const o=sfe(this,r,a,i);i=o.transitionEnd,r=o.target}return{transition:t,transitionEnd:i,...r}}}function hfe(e){return window.getComputedStyle(e)}class dfe extends JX{readValueFromInstance(t,i){if(rv.has(i)){const r=vB(i);return r&&r.default||0}else{const r=hfe(t),n=(q7(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(t,{transformPagePoint:i}){return kX(t,i)}build(t,i,r,n){sB(t,i,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,i){return uB(t,i)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Go(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}renderInstance(t,i,r,n){J7(t,i,r,n)}}class ffe extends JX{constructor(){super(...arguments),this.isSVGTag=!1}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(rv.has(i)){const r=vB(i);return r&&r.default||0}return i=$7.has(i)?i:cB(i),t.getAttribute(i)}measureInstanceViewportBox(){return es()}scrapeMotionValuesFromProps(t,i){return tX(t,i)}build(t,i,r,n){oB(t,i,r,this.isSVGTag,n.transformTemplate)}renderInstance(t,i,r,n){eX(t,i,r,n)}mount(t){this.isSVGTag=lB(t.tagName),super.mount(t)}}const pfe=(e,t)=>nB(e)?new ffe(t,{enableHardwareAcceleration:!1}):new dfe(t,{enableHardwareAcceleration:!0}),mfe={layout:{ProjectionNode:YX,MeasureLayout:HX}},gfe={...qhe,...sue,...Zde,...mfe},Ku=yce((e,t)=>Xce(e,t,gfe,pfe));var vfe=Object.create,J2=Object.defineProperty,yfe=Object.getOwnPropertyDescriptor,xfe=Object.getOwnPropertyNames,wfe=Object.getPrototypeOf,bfe=Object.prototype.hasOwnProperty,_fe=(e,t,i)=>t in e?J2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,sv=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Sfe=(e,t)=>{for(var i in t)J2(e,i,{get:t[i],enumerable:!0})},Mfe=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of xfe(t))!bfe.call(e,n)&&n!==i&&J2(e,n,{get:()=>t[n],enumerable:!(r=yfe(t,n))||r.enumerable});return e},zp=(e,t,i)=>(i=e!=null?vfe(wfe(e)):{},Mfe(t||!e||!e.__esModule?J2(i,"default",{value:e,enumerable:!0}):i,e)),zw=(e,t,i)=>(_fe(e,typeof t!="symbol"?t+"":t,i),i),Afe=sv((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),$X=sv((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,f,m,v,g,x,S,_,A=r[0].length,T=r.length;if(T<A)throw new TypeError("Invalid matrix: m < n");for(var E=[],I=[],P=[],C=n==="f"?T:A,L=x=m=0;L<T;L++)I[L]=new Array(C).fill(0);for(L=0;L<A;L++)P[L]=new Array(A).fill(0);var z,F=new Array(A).fill(0);for(L=0;L<T;L++)for(l=0;l<A;l++)I[L][l]=r[L][l];for(L=0;L<A;L++){for(E[L]=m,g=0,u=L+1,l=L;l<T;l++)g+=Math.pow(I[l][L],2);if(g<o)m=0;else for(v=(f=I[L][L])*(m=f<0?Math.sqrt(g):-Math.sqrt(g))-g,I[L][L]=f-m,l=u;l<A;l++){for(g=0,c=L;c<T;c++)g+=I[c][L]*I[c][l];for(f=g/v,c=L;c<T;c++)I[c][l]=I[c][l]+f*I[c][L]}for(F[L]=m,g=0,l=u;l<A;l++)g+=Math.pow(I[L][l],2);if(g<o)m=0;else{for(v=(f=I[L][L+1])*(m=f<0?Math.sqrt(g):-Math.sqrt(g))-g,I[L][L+1]=f-m,l=u;l<A;l++)E[l]=I[L][l]/v;for(l=u;l<T;l++){for(g=0,c=u;c<A;c++)g+=I[l][c]*I[L][c];for(c=u;c<A;c++)I[l][c]=I[l][c]+g*E[c]}}x<(S=Math.abs(F[L])+Math.abs(E[L]))&&(x=S)}if(s)for(L=A-1;0<=L;L--){if(m!==0){for(v=I[L][L+1]*m,l=u;l<A;l++)P[l][L]=I[L][l]/v;for(l=u;l<A;l++){for(g=0,c=u;c<A;c++)g+=I[L][c]*P[c][l];for(c=u;c<A;c++)P[c][l]=P[c][l]+g*P[c][L]}}for(l=u;l<A;l++)P[L][l]=0,P[l][L]=0;P[L][L]=1,m=E[L],u=L}if(n){if(n==="f")for(L=A;L<T;L++){for(l=A;l<T;l++)I[L][l]=0;I[L][L]=1}for(L=A-1;0<=L;L--){for(u=L+1,m=F[L],l=u;l<C;l++)I[L][l]=0;if(m!==0){for(v=I[L][L]*m,l=u;l<C;l++){for(g=0,c=u;c<T;c++)g+=I[c][L]*I[c][l];for(f=g/v,c=L;c<T;c++)I[c][l]=I[c][l]+f*I[c][L]}for(l=L;l<T;l++)I[l][L]=I[l][L]/m}else for(l=L;l<T;l++)I[l][L]=0;I[L][L]=I[L][L]+1}}for(a*=x,c=A-1;0<=c;c--)for(var G=0;G<50;G++){for(z=!1,u=c;0<=u;u--){if(Math.abs(E[u])<=a){z=!0;break}if(Math.abs(F[u-1])<=a)break}if(!z){for(d=0,h=u-(g=1),L=u;L<c+1&&(f=g*E[L],E[L]=d*E[L],!(Math.abs(f)<=a));L++)if(m=F[L],F[L]=Math.sqrt(f*f+m*m),d=m/(v=F[L]),g=-f/v,n)for(l=0;l<T;l++)S=I[l][h],_=I[l][L],I[l][h]=S*d+_*g,I[l][L]=-S*g+_*d}if(_=F[c],u===c){if(_<0&&(F[c]=-_,s))for(l=0;l<A;l++)P[l][c]=-P[l][c];break}for(x=F[u],f=(((S=F[c-1])-_)*(S+_)+((m=E[c-1])-(v=E[c]))*(m+v))/(2*v*S),m=Math.sqrt(f*f+1),f=((x-_)*(x+_)+v*(S/(f<0?f-m:f+m)-v))/x,L=u+(g=d=1);L<c+1;L++){if(m=E[L],S=F[L],v=g*m,m*=d,_=Math.sqrt(f*f+v*v),f=x*(d=f/(E[L-1]=_))+m*(g=v/_),m=-x*g+m*d,v=S*g,S*=d,s)for(l=0;l<A;l++)x=P[l][L-1],_=P[l][L],P[l][L-1]=x*d+_*g,P[l][L]=-x*g+_*d;if(_=Math.sqrt(f*f+v*v),f=(d=f/(F[L-1]=_))*m+(g=v/_)*S,x=-g*m+d*S,n)for(l=0;l<T;l++)S=I[l][L-1],_=I[l][L],I[l][L-1]=S*d+_*g,I[l][L]=-S*g+_*d}E[u]=0,E[c]=f,F[c]=x}for(L=0;L<A;L++)F[L]<a&&(F[L]=0);return{u:I,q:F,v:P}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),Efe=sv((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),Tfe=sv((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),Cfe=sv((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(m){return'"'+c(m.text)+'"'},class:function(m){var v="",g;for(g=0;g<m.parts.length;g++)v+=m.parts[g]instanceof Array?u(m.parts[g][0])+"-"+u(m.parts[g][1]):u(m.parts[g]);return"["+(m.inverted?"^":"")+v+"]"},any:function(m){return"any character"},end:function(m){return"end of input"},other:function(m){return m.description}};function l(m){return m.charCodeAt(0).toString(16).toUpperCase()}function c(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function u(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function h(m){return o[m.type](m)}function d(m){var v=new Array(m.length),g,x;for(g=0;g<m.length;g++)v[g]=h(m[g]);if(v.sort(),v.length>0){for(g=1,x=1;g<v.length;g++)v[g-1]!==v[g]&&(v[x]=v[g],x++);v.length=x}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+c(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:mt},c=mt,u=function(Z){if(!Z)return[];for(var te=[],_e=0;_e<Z.length;_e++)te=te.concat.apply(te,Z[_e]);var ce=te[0];return ce&&ce.code=="m"&&(delete ce.relative,ce.code="M"),te},h=function(Z,te){return Zi(Z,te)},d=/^[Mm]/,f=gt(["M","m"],!1,!1),m=function(Z,te,_e){var ce=lr(Z,[te]);return _e&&(ce=ce.concat(lr(Z=="M"?"L":"l",_e[1]))),ce},v=/^[Zz]/,g=gt(["Z","z"],!1,!1),x=function(){return lr("Z")},S=/^[Ll]/,_=gt(["L","l"],!1,!1),A=function(Z,te){return lr(Z,te)},T=/^[Hh]/,E=gt(["H","h"],!1,!1),I=function(Z,te){return lr(Z,te.map(function(_e){return{x:_e}}))},P=/^[Vv]/,C=gt(["V","v"],!1,!1),L=function(Z,te){return lr(Z,te.map(function(_e){return{y:_e}}))},z=/^[Cc]/,F=gt(["C","c"],!1,!1),G=function(Z,te,_e){return{x1:Z.x,y1:Z.y,x2:te.x,y2:te.y,x:_e.x,y:_e.y}},N=/^[Ss]/,q=gt(["S","s"],!1,!1),ie=function(Z,te){return{x2:Z.x,y2:Z.y,x:te.x,y:te.y}},Q=/^[Qq]/,W=gt(["Q","q"],!1,!1),ee=function(Z,te){return{x1:Z.x,y1:Z.y,x:te.x,y:te.y}},K=/^[Tt]/,j=gt(["T","t"],!1,!1),$=/^[Aa]/,se=gt(["A","a"],!1,!1),re=function(Z,te,_e,ce,De,_t){return{rx:Z,ry:te,xAxisRotation:_e,largeArc:ce,sweep:De,x:_t.x,y:_t.y}},he=function(Z,te){return{x:Z,y:te}},oe=function(Z){return Z*1},ve=function(Z){return Z.join("")*1},xe=/^[01]/,be=gt(["0","1"],!1,!1),Me=function(Z){return Z=="1"},Te=function(){return""},ae=",",Ce=nt(",",!1),Ie=function(Z){return Z.join("")},Be=".",Ve=nt(".",!1),lt=/^[eE]/,We=gt(["e","E"],!1,!1),je=/^[+\-]/,xt=gt(["+","-"],!1,!1),Mt=/^[0-9]/,de=gt([["0","9"]],!1,!1),V=function(Z){return Z.join("")},X=/^[ \t\n\r]/,we=gt([" ","	",`
`,"\r"],!1,!1),J=0,Le=[{line:1,column:1}],qe=0,ct=[],Pe;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function nt(Z,te){return{type:"literal",text:Z,ignoreCase:te}}function gt(Z,te,_e){return{type:"class",parts:Z,inverted:te,ignoreCase:_e}}function Tt(){return{type:"end"}}function rt(Z){var te=Le[Z],_e;if(te)return te;for(_e=Z-1;!Le[_e];)_e--;for(te=Le[_e],te={line:te.line,column:te.column};_e<Z;)s.charCodeAt(_e)===10?(te.line++,te.column=1):te.column++,_e++;return Le[Z]=te,te}function Dt(Z,te){var _e=rt(Z),ce=rt(te);return{start:{offset:Z,line:_e.line,column:_e.column},end:{offset:te,line:ce.line,column:ce.column}}}function ge(Z){J<qe||(J>qe&&(qe=J,ct=[]),ct.push(Z))}function $e(Z,te,_e){return new r(r.buildMessage(Z,te),Z,te,_e)}function mt(){var Z,te,_e,ce,De;for(Z=J,te=[],_e=Lt();_e!==o;)te.push(_e),_e=Lt();if(te!==o)if(_e=me(),_e===o&&(_e=null),_e!==o){for(ce=[],De=Lt();De!==o;)ce.push(De),De=Lt();ce!==o?(te=u(_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;else J=Z,Z=o;return Z}function me(){var Z,te,_e,ce,De,_t;if(Z=J,te=Ne(),te!==o){for(_e=[],ce=J,De=[],_t=Lt();_t!==o;)De.push(_t),_t=Lt();for(De!==o?(_t=Ne(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;){for(_e.push(ce),ce=J,De=[],_t=Lt();_t!==o;)De.push(_t),_t=Lt();De!==o?(_t=Ne(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o)}_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Ne(){var Z,te,_e,ce,De,_t;if(Z=J,te=et(),te!==o){for(_e=[],ce=J,De=[],_t=Lt();_t!==o;)De.push(_t),_t=Lt();for(De!==o?(_t=ue(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;){for(_e.push(ce),ce=J,De=[],_t=Lt();_t!==o;)De.push(_t),_t=Lt();De!==o?(_t=ue(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o)}_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function ue(){var Z;return Z=at(),Z===o&&(Z=Ze(),Z===o&&(Z=Ft(),Z===o&&(Z=ci(),Z===o&&(Z=Qi(),Z===o&&(Z=bn(),Z===o&&(Z=fe(),Z===o&&(Z=Xe(),Z===o&&(Z=Yt())))))))),Z}function et(){var Z,te,_e,ce,De,_t,Hr;if(Z=J,d.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(f)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=le(),ce!==o?(De=J,_t=Ue(),_t===o&&(_t=null),_t!==o?(Hr=bt(),Hr!==o?(_t=[_t,Hr],De=_t):(J=De,De=o)):(J=De,De=o),De===o&&(De=null),De!==o?(te=m(te,ce,De),Z=te):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function at(){var Z,te;return Z=J,v.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(g)),te!==o&&(te=x()),Z=te,Z}function Ze(){var Z,te,_e,ce;if(Z=J,S.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(_)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=bt(),ce!==o?(te=A(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function bt(){var Z,te,_e,ce,De,_t;if(Z=J,te=le(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=le(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=le(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Ft(){var Z,te,_e,ce;if(Z=J,T.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(E)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=ui(),ce!==o?(te=I(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function ui(){var Z,te,_e,ce,De,_t;if(Z=J,te=ke(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=ke(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=ke(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function ci(){var Z,te,_e,ce;if(Z=J,P.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(C)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=ui(),ce!==o?(te=L(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Qi(){var Z,te,_e,ce;if(Z=J,z.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(F)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=mi(),ce!==o?(te=A(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function mi(){var Z,te,_e,ce,De,_t;if(Z=J,te=Or(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=Or(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=Or(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Or(){var Z,te,_e,ce,De,_t;return Z=J,te=le(),te!==o?(_e=Ue(),_e===o&&(_e=null),_e!==o?(ce=le(),ce!==o?(De=Ue(),De===o&&(De=null),De!==o?(_t=le(),_t!==o?(te=G(te,ce,_t),Z=te):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o),Z}function bn(){var Z,te,_e,ce;if(Z=J,N.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(q)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=Yl(),ce!==o?(te=A(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Yl(){var Z,te,_e,ce,De,_t;if(Z=J,te=Qs(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=Qs(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=Qs(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Qs(){var Z,te,_e,ce;return Z=J,te=le(),te!==o?(_e=Ue(),_e===o&&(_e=null),_e!==o?(ce=le(),ce!==o?(te=ie(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o),Z}function fe(){var Z,te,_e,ce;if(Z=J,Q.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(W)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=Ye(),ce!==o?(te=A(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Ye(){var Z,te,_e,ce,De,_t;if(Z=J,te=ut(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=ut(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=ut(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function ut(){var Z,te,_e,ce;return Z=J,te=le(),te!==o?(_e=Ue(),_e===o&&(_e=null),_e!==o?(ce=le(),ce!==o?(te=ee(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o),Z}function Xe(){var Z,te,_e,ce;if(Z=J,K.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(j)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=ft(),ce!==o?(te=A(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function ft(){var Z,te,_e,ce,De,_t;if(Z=J,te=le(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=le(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=le(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function Yt(){var Z,te,_e,ce;if(Z=J,$.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(se)),te!==o){for(_e=[],ce=Lt();ce!==o;)_e.push(ce),ce=Lt();_e!==o?(ce=oi(),ce!==o?(te=A(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)}else J=Z,Z=o;return Z}function oi(){var Z,te,_e,ce,De,_t;if(Z=J,te=gi(),te!==o){for(_e=[],ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=gi(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);ce!==o;)_e.push(ce),ce=J,De=Ue(),De===o&&(De=null),De!==o?(_t=gi(),_t!==o?(De=[De,_t],ce=De):(J=ce,ce=o)):(J=ce,ce=o);_e!==o?(te=h(te,_e),Z=te):(J=Z,Z=o)}else J=Z,Z=o;return Z}function gi(){var Z,te,_e,ce,De,_t,Hr,Gr,gr,cs,Yo,fn;return Z=J,te=Oe(),te!==o?(_e=Ue(),_e===o&&(_e=null),_e!==o?(ce=Oe(),ce!==o?(De=Ue(),De===o&&(De=null),De!==o?(_t=ke(),_t!==o?(Hr=Ue(),Hr!==o?(Gr=Ge(),Gr!==o?(gr=Ue(),gr===o&&(gr=null),gr!==o?(cs=Ge(),cs!==o?(Yo=Ue(),Yo===o&&(Yo=null),Yo!==o?(fn=le(),fn!==o?(te=re(te,ce,_t,Gr,cs,fn),Z=te):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o),Z}function le(){var Z,te,_e,ce;return Z=J,te=ke(),te!==o?(_e=Ue(),_e===o&&(_e=null),_e!==o?(ce=ke(),ce!==o?(te=he(te,ce),Z=te):(J=Z,Z=o)):(J=Z,Z=o)):(J=Z,Z=o),Z}function Oe(){var Z,te;return Z=J,te=Xt(),te===o&&(te=ni()),te!==o&&(te=oe(te)),Z=te,Z}function ke(){var Z,te,_e,ce;return Z=J,te=J,_e=zt(),_e===o&&(_e=null),_e!==o?(ce=Xt(),ce!==o?(_e=[_e,ce],te=_e):(J=te,te=o)):(J=te,te=o),te===o&&(te=J,_e=zt(),_e===o&&(_e=null),_e!==o?(ce=ni(),ce!==o?(_e=[_e,ce],te=_e):(J=te,te=o)):(J=te,te=o)),te!==o&&(te=ve(te)),Z=te,Z}function Ge(){var Z,te;return Z=J,xe.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(be)),te!==o&&(te=Me(te)),Z=te,Z}function Ue(){var Z,te,_e,ce,De;if(Z=J,te=[],_e=Lt(),_e!==o)for(;_e!==o;)te.push(_e),_e=Lt();else te=o;if(te!==o)if(_e=Rt(),_e===o&&(_e=null),_e!==o){for(ce=[],De=Lt();De!==o;)ce.push(De),De=Lt();ce!==o?(te=[te,_e,ce],Z=te):(J=Z,Z=o)}else J=Z,Z=o;else J=Z,Z=o;if(Z===o){if(Z=J,te=J,_e=Rt(),_e!==o){for(ce=[],De=Lt();De!==o;)ce.push(De),De=Lt();ce!==o?(_e=[_e,ce],te=_e):(J=te,te=o)}else J=te,te=o;te!==o&&(te=Te()),Z=te}return Z}function Rt(){var Z;return s.charCodeAt(J)===44?(Z=ae,J++):(Z=o,ge(Ce)),Z}function Xt(){var Z,te,_e,ce;return Z=J,te=J,_e=ri(),_e!==o?(ce=Pt(),ce===o&&(ce=null),ce!==o?(_e=[_e,ce],te=_e):(J=te,te=o)):(J=te,te=o),te===o&&(te=J,_e=ni(),_e!==o?(ce=Pt(),ce!==o?(_e=[_e,ce],te=_e):(J=te,te=o)):(J=te,te=o)),te!==o&&(te=Ie(te)),Z=te,Z}function ri(){var Z,te,_e,ce,De;return Z=J,te=J,_e=ni(),_e===o&&(_e=null),_e!==o?(s.charCodeAt(J)===46?(ce=Be,J++):(ce=o,ge(Ve)),ce!==o?(De=ni(),De!==o?(_e=[_e,ce,De],te=_e):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te===o&&(te=J,_e=ni(),_e!==o?(s.charCodeAt(J)===46?(ce=Be,J++):(ce=o,ge(Ve)),ce!==o?(_e=[_e,ce],te=_e):(J=te,te=o)):(J=te,te=o)),te!==o&&(te=Ie(te)),Z=te,Z}function Pt(){var Z,te,_e,ce,De;return Z=J,te=J,lt.test(s.charAt(J))?(_e=s.charAt(J),J++):(_e=o,ge(We)),_e!==o?(ce=zt(),ce===o&&(ce=null),ce!==o?(De=ni(),De!==o?(_e=[_e,ce,De],te=_e):(J=te,te=o)):(J=te,te=o)):(J=te,te=o),te!==o&&(te=Ie(te)),Z=te,Z}function zt(){var Z;return je.test(s.charAt(J))?(Z=s.charAt(J),J++):(Z=o,ge(xt)),Z}function ni(){var Z,te,_e;if(Z=J,te=[],Mt.test(s.charAt(J))?(_e=s.charAt(J),J++):(_e=o,ge(de)),_e!==o)for(;_e!==o;)te.push(_e),Mt.test(s.charAt(J))?(_e=s.charAt(J),J++):(_e=o,ge(de));else te=o;return te!==o&&(te=V(te)),Z=te,Z}function Lt(){var Z,te;return Z=J,X.test(s.charAt(J))?(te=s.charAt(J),J++):(te=o,ge(we)),te!==o&&(te=Te()),Z=te,Z}function Zi(Z,te){if(!te)return[Z];for(var _e=[Z],ce=0,De=te.length;ce<De;ce++)_e[ce+1]=te[ce][1];return _e}var Vr={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var $i in Vr)Vr[$i.toUpperCase()]=Vr[$i];function lr(Z,te){te||(te=[{}]);for(var _e=te.length;_e--;){var ce={code:Z,command:Vr[Z]};Z==Z.toLowerCase()&&(ce.relative=!0);for(var De in te[_e])ce[De]=te[_e][De];te[_e]=ce}return te}if(Pe=c(),Pe!==o&&J===s.length)return Pe;throw Pe!==o&&J<s.length&&ge(Tt()),$e(ct,qe<s.length?s.charAt(qe):null,qe<s.length?Dt(qe,qe+1):Dt(qe,qe))}t.exports={SyntaxError:r,parse:n}}),eq=sv((e,t)=>{var i=Cfe().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),Pfe=sv((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),Sx="149",Pl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Dfe=0,_5=1,Rfe=2,EB=1,Ife=2,Bw=3,Yc=0,Ws=1,Oa=2,as=0,Dg=1,S5=2,M5=3,A5=4,Lfe=5,uy=100,Ofe=101,zfe=102,E5=103,T5=104,Bfe=200,Nfe=201,Ufe=202,Ffe=203,tq=204,iq=205,kfe=206,Vfe=207,Hfe=208,Gfe=209,jfe=210,Wfe=0,Xfe=1,qfe=2,KI=3,Yfe=4,Qfe=5,Zfe=6,Kfe=7,rq=0,Jfe=1,$fe=2,Wu=0,epe=1,tpe=2,ipe=3,rpe=4,npe=5,nq=300,Hg=301,Gg=302,JI=303,$I=304,B_=306,yd=1e3,sn=1001,eL=1002,qi=1003,C5=1004,_D=1005,Fi=1006,spe=1007,rx=1008,Ua=1009,ape=1010,ope=1011,sq=1012,lpe=1013,xd=1014,Cr=1015,Id=1016,cpe=1017,upe=1018,Rg=1020,hpe=1021,hn=1023,dpe=1024,fpe=1025,Ig=1026,jg=1027,ME=1028,ppe=1029,sT=1030,mpe=1031,aq=1033,SD=33776,MD=33777,AD=33778,ED=33779,P5=35840,D5=35841,R5=35842,I5=35843,gpe=36196,L5=37492,O5=37496,z5=37808,B5=37809,N5=37810,U5=37811,F5=37812,k5=37813,V5=37814,H5=37815,G5=37816,j5=37817,W5=37818,X5=37819,q5=37820,Y5=37821,TD=36492,vpe=36283,Q5=36284,Z5=36285,K5=36286,oq=2200,lq=2201,TB=2202,aT=2300,oT=2301,CD=2302,Ey=2400,Ty=2401,lT=2402,CB=2500,ype=2501,Qc=3e3,Bi=3001,Fd=3200,cq=3201,xpe=0,wpe=1,Du="srgb",cT="srgb-linear",PD=7680,bpe=519,tL=35044,_pe=35048,iL="300 es",rL=1035,va=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},Pa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],J5=1234567,nb=Math.PI/180,qb=180/Math.PI;function Hl(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Pa[e&255]+Pa[e>>8&255]+Pa[e>>16&255]+Pa[e>>24&255]+"-"+Pa[t&255]+Pa[t>>8&255]+"-"+Pa[t>>16&15|64]+Pa[t>>24&255]+"-"+Pa[i&63|128]+Pa[i>>8&255]+"-"+Pa[i>>16&255]+Pa[i>>24&255]+Pa[r&255]+Pa[r>>8&255]+Pa[r>>16&255]+Pa[r>>24&255]).toLowerCase()}function ts(e,t,i){return Math.max(t,Math.min(i,e))}function PB(e,t){return(e%t+t)%t}function Spe(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function Mpe(e,t,i){return e!==t?(i-e)/(t-e):0}function sb(e,t,i){return(1-i)*e+i*t}function Ape(e,t,i,r){return sb(e,t,1-Math.exp(-i*r))}function Epe(e,t=1){return t-Math.abs(PB(e,t*2)-t)}function Tpe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function Cpe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function Ppe(e,t){return e+Math.floor(Math.random()*(t-e+1))}function Dpe(e,t){return e+Math.random()*(t-e)}function Rpe(e){return e*(.5-Math.random())}function Ipe(e){e!==void 0&&(J5=e);let t=J5+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Lpe(e){return e*nb}function Ope(e){return e*qb}function nL(e){return(e&e-1)===0&&e!==0}function uq(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function uT(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function zpe(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),f=s((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*m,l*f,o*c);break;case"YXY":e.set(l*f,o*u,l*m,o*c);break;case"ZYZ":e.set(l*m,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function wd(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Xr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Gt=Object.freeze({__proto__:null,DEG2RAD:nb,RAD2DEG:qb,ceilPowerOfTwo:uq,clamp:ts,damp:Ape,degToRad:Lpe,denormalize:wd,euclideanModulo:PB,floorPowerOfTwo:uT,generateUUID:Hl,inverseLerp:Mpe,isPowerOfTwo:nL,lerp:sb,mapLinear:Spe,normalize:Xr,pingpong:Epe,radToDeg:Ope,randFloat:Dpe,randFloatSpread:Rpe,randInt:Ppe,seededRandom:Ipe,setQuaternionFromProperEuler:zpe,smootherstep:Cpe,smoothstep:Tpe}),Ee=class{constructor(e=0,t=0){Ee.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},ns=class{constructor(){ns.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],f=i[8],m=r[0],v=r[3],g=r[6],x=r[1],S=r[4],_=r[7],A=r[2],T=r[5],E=r[8];return n[0]=s*m+a*x+o*A,n[3]=s*v+a*S+o*T,n[6]=s*g+a*_+o*E,n[1]=l*m+c*x+u*A,n[4]=l*v+c*S+u*T,n[7]=l*g+c*_+u*E,n[2]=h*m+d*x+f*A,n[5]=h*v+d*S+f*T,n[8]=h*g+d*_+f*E,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,f=t*u+i*h+r*d;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);let m=1/f;return e[0]=u*m,e[1]=(r*l-c*i)*m,e[2]=(a*i-r*s)*m,e[3]=h*m,e[4]=(c*t-r*o)*m,e[5]=(r*n-a*t)*m,e[6]=d*m,e[7]=(i*o-l*t)*m,e[8]=(s*t-i*n)*m,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(DD.makeScale(e,t)),this}rotate(e){return this.premultiply(DD.makeRotation(-e)),this}translate(e,t){return this.premultiply(DD.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},DD=new ns;function hq(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Bpe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function WM(e,t){return new Bpe[e](t)}function Yb(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Npe(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function Lg(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function AE(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var RD={[Du]:{[cT]:Lg},[cT]:{[Du]:AE}},Ka={legacyMode:!0,get workingColorSpace(){return cT},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(RD[t]&&RD[t][i]!==void 0){let r=RD[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},dq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vs={r:0,g:0,b:0},bc={h:0,s:0,l:0},XM={h:0,s:0,l:0};function ID(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function qM(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var fi=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Du){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ka.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Ka.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ka.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Ka.workingColorSpace){if(e=PB(e,1),t=ts(t,0,1),i=ts(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=ID(s,n,e+1/3),this.g=ID(s,n,e),this.b=ID(s,n,e-1/3)}return Ka.toWorkingColorSpace(this,r),this}setStyle(e,t=Du){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Ka.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Ka.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Ka.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Ka.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Du){let i=dq[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Lg(e.r),this.g=Lg(e.g),this.b=Lg(e.b),this}copyLinearToSRGB(e){return this.r=AE(e.r),this.g=AE(e.g),this.b=AE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Du){return Ka.fromWorkingColorSpace(qM(this,vs),e),ts(vs.r*255,0,255)<<16^ts(vs.g*255,0,255)<<8^ts(vs.b*255,0,255)<<0}getHexString(e=Du){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ka.workingColorSpace){Ka.fromWorkingColorSpace(qM(this,vs),t);let i=vs.r,r=vs.g,n=vs.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-i)/u+2;break;case n:o=(i-r)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=Ka.workingColorSpace){return Ka.fromWorkingColorSpace(qM(this,vs),t),e.r=vs.r,e.g=vs.g,e.b=vs.b,e}getStyle(e=Du){return Ka.fromWorkingColorSpace(qM(this,vs),e),e!==Du?`color(${e} ${vs.r} ${vs.g} ${vs.b})`:`rgb(${vs.r*255|0},${vs.g*255|0},${vs.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(bc),bc.h+=e,bc.s+=t,bc.l+=i,this.setHSL(bc.h,bc.s,bc.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(bc),e.getHSL(XM);let i=sb(bc.h,XM.h,t),r=sb(bc.s,XM.s,t),n=sb(bc.l,XM.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};fi.NAMES=dq;var D0,fq=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{D0===void 0&&(D0=Yb("canvas")),D0.width=e.width,D0.height=e.height;let i=D0.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=D0}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=Yb("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=Lg(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Lg(t[i]/255)*255):t[i]=Lg(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},pq=class{constructor(e=null){this.isSource=!0,this.uuid=Hl(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(LD(r[s].image)):n.push(LD(r[s]))}else n=LD(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function LD(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?fq.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Upe=0,wn=class extends va{constructor(e=wn.DEFAULT_IMAGE,t=wn.DEFAULT_MAPPING,i=sn,r=sn,n=Fi,s=rx,a=hn,o=Ua,l=wn.DEFAULT_ANISOTROPY,c=Qc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Upe++}),this.uuid=Hl(),this.name="",this.source=new pq(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Ee(0,0),this.repeat=new Ee(1,1),this.center=new Ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ns,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==nq)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case yd:e.x=e.x-Math.floor(e.x);break;case sn:e.x=e.x<0?0:1;break;case eL:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case yd:e.y=e.y-Math.floor(e.y);break;case sn:e.y=e.y<0?0:1;break;case eL:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};wn.DEFAULT_IMAGE=null;wn.DEFAULT_MAPPING=nq;wn.DEFAULT_ANISOTROPY=1;var Ti=class{constructor(e=0,t=0,i=0,r=1){Ti.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],f=s[6],m=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+u+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let g=(a+1)/2,x=(u+1)/2,S=(m+1)/2,_=(o+c)/4,A=(l+d)/4,T=(h+f)/4;return g>x&&g>S?g<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(g),r=_/i,n=A/i):x>S?x<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(x),i=_/r,n=T/r):S<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(S),i=A/n,r=T/n),this.set(i,r,n,t),this}let v=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(v)<.001&&(v=1),this.x=(f-h)/v,this.y=(l-d)/v,this.z=(c-o)/v,this.w=Math.acos((a+u+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},rr=class extends va{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ti(0,0,e,t),this.scissorTest=!1,this.viewport=new Ti(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new wn(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Fi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new pq(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},mq=class extends wn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=qi,this.minFilter=qi,this.wrapR=sn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Fpe=class extends wn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=qi,this.minFilter=qi,this.wrapR=sn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},gq=class extends rr{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},Ai=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[s+0],d=n[s+1],f=n[s+2],m=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(a===1){e[t+0]=h,e[t+1]=d,e[t+2]=f,e[t+3]=m;return}if(u!==m||o!==h||l!==d||c!==f){let v=1-a,g=o*h+l*d+c*f+u*m,x=g>=0?1:-1,S=1-g*g;if(S>Number.EPSILON){let A=Math.sqrt(S),T=Math.atan2(A,g*x);v=Math.sin(v*T)/A,a=Math.sin(a*T)/A}let _=a*x;if(o=o*v+h*_,l=l*v+d*_,c=c*v+f*_,u=u*v+m*_,v===1-a){let A=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=A,l*=A,c*=A,u*=A}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=n[s],h=n[s+1],d=n[s+2],f=n[s+3];return e[t]=a*f+c*u+o*d-l*h,e[t+1]=o*f+c*h+l*u-a*d,e[t+2]=l*f+c*d+a*h-o*u,e[t+3]=c*f-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=o(i/2),d=o(r/2),f=o(n/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ts(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},k=class{constructor(e=0,t=0,i=0){k.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion($5.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion($5.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,s=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*r-a*i,c=o*i+a*t-n*r,u=o*r+n*i-s*t,h=-n*t-s*i-a*r;return this.x=l*o+h*-n+c*-a-u*-s,this.y=c*o+h*-s+u*-n-l*-a,this.z=u*o+h*-a+l*-s-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return OD.copy(this).projectOnVector(e),this.sub(OD)}reflect(e){return this.sub(OD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(ts(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},OD=new k,$5=new Ai,Gn=class{constructor(e=new k(1/0,1/0,1/0),t=new k(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Nm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Nm.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Nm)}else i.boundingBox===null&&i.computeBoundingBox(),zD.copy(i.boundingBox),zD.applyMatrix4(e.matrixWorld),this.union(zD);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Nm),Nm.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter($1),YM.subVectors(this.max,$1),R0.subVectors(e.a,$1),I0.subVectors(e.b,$1),L0.subVectors(e.c,$1),Pf.subVectors(I0,R0),Df.subVectors(L0,I0),Um.subVectors(R0,L0);let t=[0,-Pf.z,Pf.y,0,-Df.z,Df.y,0,-Um.z,Um.y,Pf.z,0,-Pf.x,Df.z,0,-Df.x,Um.z,0,-Um.x,-Pf.y,Pf.x,0,-Df.y,Df.x,0,-Um.y,Um.x,0];return!BD(t,R0,I0,L0,YM)||(t=[1,0,0,0,1,0,0,0,1],!BD(t,R0,I0,L0,YM))?!1:(QM.crossVectors(Pf,Df),t=[QM.x,QM.y,QM.z],BD(t,R0,I0,L0,YM))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Nm.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Nm).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(jh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),jh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),jh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),jh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),jh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),jh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),jh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),jh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(jh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},jh=[new k,new k,new k,new k,new k,new k,new k,new k],Nm=new k,zD=new Gn,R0=new k,I0=new k,L0=new k,Pf=new k,Df=new k,Um=new k,$1=new k,YM=new k,QM=new k,Fm=new k;function BD(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Fm.fromArray(e,s);let o=n.x*Math.abs(Fm.x)+n.y*Math.abs(Fm.y)+n.z*Math.abs(Fm.z),l=t.dot(Fm),c=i.dot(Fm),u=r.dot(Fm);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var kpe=new Gn,ew=new k,ND=new k,jo=class{constructor(e=new k,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):kpe.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ew.subVectors(e,this.center);let t=ew.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(ew,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(ND.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ew.copy(e.center).add(ND)),this.expandByPoint(ew.copy(e.center).sub(ND))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Wh=new k,UD=new k,ZM=new k,Rf=new k,FD=new k,KM=new k,kD=new k,Mx=class{constructor(e=new k,t=new k(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Wh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Wh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Wh.copy(this.direction).multiplyScalar(t).add(this.origin),Wh.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){UD.copy(e).add(t).multiplyScalar(.5),ZM.copy(t).sub(e).normalize(),Rf.copy(this.origin).sub(UD);let n=e.distanceTo(t)*.5,s=-this.direction.dot(ZM),a=Rf.dot(this.direction),o=-Rf.dot(ZM),l=Rf.lengthSq(),c=Math.abs(1-s*s),u,h,d,f;if(c>0)if(u=s*o-a,h=s*a-o,f=n*c,u>=0)if(h>=-f)if(h<=f){let m=1/c;u*=m,h*=m,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-f?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=f?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(ZM).multiplyScalar(h).add(UD),d}intersectSphere(e,t){Wh.subVectors(e.center,this.origin);let i=Wh.dot(this.direction),r=Wh.dot(Wh)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Wh)!==null}intersectTriangle(e,t,i,r,n){FD.subVectors(t,e),KM.subVectors(i,e),kD.crossVectors(FD,KM);let s=this.direction.dot(kD),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Rf.subVectors(this.origin,e);let o=a*this.direction.dot(KM.crossVectors(Rf,KM));if(o<0)return null;let l=a*this.direction.dot(FD.cross(Rf));if(l<0||o+l>s)return null;let c=-a*Rf.dot(kD);return c<0?null:this.at(c/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},St=class{constructor(){St.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,n,s,a,o,l,c,u,h,d,f,m,v){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=f,g[11]=m,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new St().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/O0.setFromMatrixColumn(e,0).length(),n=1/O0.setFromMatrixColumn(e,1).length(),s=1/O0.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if(e.order==="XYZ"){let h=s*c,d=s*u,f=a*c,m=a*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=d+f*l,t[5]=h-m*l,t[9]=-a*o,t[2]=m-h*l,t[6]=f+d*l,t[10]=s*o}else if(e.order==="YXZ"){let h=o*c,d=o*u,f=l*c,m=l*u;t[0]=h+m*a,t[4]=f*a-d,t[8]=s*l,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=d*a-f,t[6]=m+h*a,t[10]=s*o}else if(e.order==="ZXY"){let h=o*c,d=o*u,f=l*c,m=l*u;t[0]=h-m*a,t[4]=-s*u,t[8]=f+d*a,t[1]=d+f*a,t[5]=s*c,t[9]=m-h*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let h=s*c,d=s*u,f=a*c,m=a*u;t[0]=o*c,t[4]=f*l-d,t[8]=h*l+m,t[1]=o*u,t[5]=m*l+h,t[9]=d*l-f,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let h=s*o,d=s*l,f=a*o,m=a*l;t[0]=o*c,t[4]=m-h*u,t[8]=f*u+d,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=d*u+f,t[10]=h-m*u}else if(e.order==="XZY"){let h=s*o,d=s*l,f=a*o,m=a*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=h*u+m,t[5]=s*c,t[9]=d*u-f,t[2]=f*u-d,t[6]=a*c,t[10]=m*u+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Vpe,e,Hpe)}lookAt(e,t,i){let r=this.elements;return ol.subVectors(e,t),ol.lengthSq()===0&&(ol.z=1),ol.normalize(),If.crossVectors(i,ol),If.lengthSq()===0&&(Math.abs(i.z)===1?ol.x+=1e-4:ol.z+=1e-4,ol.normalize(),If.crossVectors(i,ol)),If.normalize(),JM.crossVectors(ol,If),r[0]=If.x,r[4]=JM.x,r[8]=ol.x,r[1]=If.y,r[5]=JM.y,r[9]=ol.y,r[2]=If.z,r[6]=JM.z,r[10]=ol.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],f=i[2],m=i[6],v=i[10],g=i[14],x=i[3],S=i[7],_=i[11],A=i[15],T=r[0],E=r[4],I=r[8],P=r[12],C=r[1],L=r[5],z=r[9],F=r[13],G=r[2],N=r[6],q=r[10],ie=r[14],Q=r[3],W=r[7],ee=r[11],K=r[15];return n[0]=s*T+a*C+o*G+l*Q,n[4]=s*E+a*L+o*N+l*W,n[8]=s*I+a*z+o*q+l*ee,n[12]=s*P+a*F+o*ie+l*K,n[1]=c*T+u*C+h*G+d*Q,n[5]=c*E+u*L+h*N+d*W,n[9]=c*I+u*z+h*q+d*ee,n[13]=c*P+u*F+h*ie+d*K,n[2]=f*T+m*C+v*G+g*Q,n[6]=f*E+m*L+v*N+g*W,n[10]=f*I+m*z+v*q+g*ee,n[14]=f*P+m*F+v*ie+g*K,n[3]=x*T+S*C+_*G+A*Q,n[7]=x*E+S*L+_*N+A*W,n[11]=x*I+S*z+_*q+A*ee,n[15]=x*P+S*F+_*ie+A*K,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],f=e[3],m=e[7],v=e[11],g=e[15];return f*(+n*o*u-r*l*u-n*a*h+i*l*h+r*a*d-i*o*d)+m*(+t*o*d-t*l*h+n*s*h-r*s*d+r*l*c-n*o*c)+v*(+t*l*u-t*a*d-n*s*u+i*s*d+n*a*c-i*l*c)+g*(-r*a*c-t*o*u+t*a*h+r*s*u-i*s*h+i*o*c)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],m=e[13],v=e[14],g=e[15],x=u*v*l-m*h*l+m*o*d-a*v*d-u*o*g+a*h*g,S=f*h*l-c*v*l-f*o*d+s*v*d+c*o*g-s*h*g,_=c*m*l-f*u*l+f*a*d-s*m*d-c*a*g+s*u*g,A=f*u*o-c*m*o-f*a*h+s*m*h+c*a*v-s*u*v,T=t*x+i*S+r*_+n*A;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let E=1/T;return e[0]=x*E,e[1]=(m*h*n-u*v*n-m*r*d+i*v*d+u*r*g-i*h*g)*E,e[2]=(a*v*n-m*o*n+m*r*l-i*v*l-a*r*g+i*o*g)*E,e[3]=(u*o*n-a*h*n-u*r*l+i*h*l+a*r*d-i*o*d)*E,e[4]=S*E,e[5]=(c*v*n-f*h*n+f*r*d-t*v*d-c*r*g+t*h*g)*E,e[6]=(f*o*n-s*v*n-f*r*l+t*v*l+s*r*g-t*o*g)*E,e[7]=(s*h*n-c*o*n+c*r*l-t*h*l-s*r*d+t*o*d)*E,e[8]=_*E,e[9]=(f*u*n-c*m*n-f*i*d+t*m*d+c*i*g-t*u*g)*E,e[10]=(s*m*n-f*a*n+f*i*l-t*m*l-s*i*g+t*a*g)*E,e[11]=(c*a*n-s*u*n-c*i*l+t*u*l+s*i*d-t*a*d)*E,e[12]=A*E,e[13]=(c*m*r-f*u*r+f*i*h-t*m*h-c*i*v+t*u*v)*E,e[14]=(f*a*r-s*m*r-f*i*o+t*m*o+s*i*v-t*a*v)*E,e[15]=(s*u*r-c*a*r+c*i*o-t*u*o-s*i*h+t*a*h)*E,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,a=e.y,o=e.z,l=n*s,c=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+i,c*o-r*s,0,l*o-r*a,c*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,c=s+s,u=a+a,h=n*l,d=n*c,f=n*u,m=s*c,v=s*u,g=a*u,x=o*l,S=o*c,_=o*u,A=i.x,T=i.y,E=i.z;return r[0]=(1-(m+g))*A,r[1]=(d+_)*A,r[2]=(f-S)*A,r[3]=0,r[4]=(d-_)*T,r[5]=(1-(h+g))*T,r[6]=(v+x)*T,r[7]=0,r[8]=(f+S)*E,r[9]=(v-x)*E,r[10]=(1-(h+m))*E,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=O0.set(r[0],r[1],r[2]).length(),s=O0.set(r[4],r[5],r[6]).length(),a=O0.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],_c.copy(this);let o=1/n,l=1/s,c=1/a;return _c.elements[0]*=o,_c.elements[1]*=o,_c.elements[2]*=o,_c.elements[4]*=l,_c.elements[5]*=l,_c.elements[6]*=l,_c.elements[8]*=c,_c.elements[9]*=c,_c.elements[10]*=c,t.setFromRotationMatrix(_c),i.x=n,i.y=s,i.z=a,this}makePerspective(e,t,i,r,n,s){let a=this.elements,o=2*n/(t-e),l=2*n/(i-r),c=(t+e)/(t-e),u=(i+r)/(i-r),h=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,s){let a=this.elements,o=1/(t-e),l=1/(i-r),c=1/(s-n),u=(t+e)*o,h=(i+r)*l,d=(s+n)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},O0=new k,_c=new St,Vpe=new k(0,0,0),Hpe=new k(1,1,1),If=new k,JM=new k,ol=new k,eV=new St,tV=new Ai,Ss=class{constructor(e=0,t=0,i=0,r=Ss.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(ts(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ts(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(ts(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-ts(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ts(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ts(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return eV.makeRotationFromQuaternion(e),this.setFromRotationMatrix(eV,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return tV.setFromEuler(this),this.setFromQuaternion(tV,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Ss.DEFAULT_ORDER="XYZ";var DB=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},Gpe=0,iV=new k,z0=new Ai,Xh=new St,$M=new k,tw=new k,jpe=new k,Wpe=new Ai,rV=new k(1,0,0),nV=new k(0,1,0),sV=new k(0,0,1),Xpe={type:"added"},aV={type:"removed"},Mr=class extends va{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Gpe++}),this.uuid=Hl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Mr.DEFAULT_UP.clone();let e=new k,t=new Ss,i=new Ai,r=new k(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new St},normalMatrix:{value:new ns}}),this.matrix=new St,this.matrixWorld=new St,this.matrixAutoUpdate=Mr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Mr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new DB,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return z0.setFromAxisAngle(e,t),this.quaternion.multiply(z0),this}rotateOnWorldAxis(e,t){return z0.setFromAxisAngle(e,t),this.quaternion.premultiply(z0),this}rotateX(e){return this.rotateOnAxis(rV,e)}rotateY(e){return this.rotateOnAxis(nV,e)}rotateZ(e){return this.rotateOnAxis(sV,e)}translateOnAxis(e,t){return iV.copy(e).applyQuaternion(this.quaternion),this.position.add(iV.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rV,e)}translateY(e){return this.translateOnAxis(nV,e)}translateZ(e){return this.translateOnAxis(sV,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Xh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?$M.copy(e):$M.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),tw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xh.lookAt(tw,$M,this.up):Xh.lookAt($M,tw,this.up),this.quaternion.setFromRotationMatrix(Xh),r&&(Xh.extractRotation(r.matrixWorld),z0.setFromRotationMatrix(Xh),this.quaternion.premultiply(z0.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Xpe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(aV)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(aV)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Xh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Xh.multiply(e.parent.matrixWorld)),e.applyMatrix4(Xh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tw,e,jpe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tw,Wpe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(e.shapes,u)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),f=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),f.length>0&&(i.nodes=f)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};Mr.DEFAULT_UP=new k(0,1,0);Mr.DEFAULT_MATRIX_AUTO_UPDATE=!0;Mr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Sc=new k,qh=new k,VD=new k,Yh=new k,B0=new k,N0=new k,oV=new k,HD=new k,GD=new k,jD=new k,ha=class{constructor(e=new k,t=new k,i=new k){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Sc.subVectors(e,t),r.cross(Sc);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){Sc.subVectors(r,t),qh.subVectors(i,t),VD.subVectors(e,t);let s=Sc.dot(Sc),a=Sc.dot(qh),o=Sc.dot(VD),l=qh.dot(qh),c=qh.dot(VD),u=s*l-a*a;if(u===0)return n.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,f=(s*c-a*o)*h;return n.set(1-d-f,f,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Yh),Yh.x>=0&&Yh.y>=0&&Yh.x+Yh.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,Yh),o.set(0,0),o.addScaledVector(n,Yh.x),o.addScaledVector(s,Yh.y),o.addScaledVector(a,Yh.z),o}static isFrontFacing(e,t,i,r){return Sc.subVectors(i,t),qh.subVectors(e,t),Sc.cross(qh).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Sc.subVectors(this.c,this.b),qh.subVectors(this.a,this.b),Sc.cross(qh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ha.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ha.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return ha.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return ha.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ha.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;B0.subVectors(r,i),N0.subVectors(n,i),HD.subVectors(e,i);let o=B0.dot(HD),l=N0.dot(HD);if(o<=0&&l<=0)return t.copy(i);GD.subVectors(e,r);let c=B0.dot(GD),u=N0.dot(GD);if(c>=0&&u<=c)return t.copy(r);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),t.copy(i).addScaledVector(B0,s);jD.subVectors(e,n);let d=B0.dot(jD),f=N0.dot(jD);if(f>=0&&d<=f)return t.copy(n);let m=d*l-o*f;if(m<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(i).addScaledVector(N0,a);let v=c*f-d*u;if(v<=0&&u-c>=0&&d-f>=0)return oV.subVectors(n,r),a=(u-c)/(u-c+(d-f)),t.copy(r).addScaledVector(oV,a);let g=1/(v+m+h);return s=m*g,a=h*g,t.copy(i).addScaledVector(B0,s).addScaledVector(N0,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},qpe=0,N_=class extends va{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qpe++}),this.uuid=Hl(),this.name="",this.type="Material",this.blending=Dg,this.side=Yc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=tq,this.blendDst=iq,this.blendEquation=uy,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=KI,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bpe,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=PD,this.stencilZFail=PD,this.stencilZPass=PD,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Dg&&(i.blending=this.blending),this.side!==Yc&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Ld=class extends N_{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rq,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Jn=new k,eA=new Ee,pi=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=tL,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)eA.fromBufferAttribute(this,t),eA.applyMatrix3(e),this.setXY(t,eA.x,eA.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Jn.fromBufferAttribute(this,t),Jn.applyMatrix3(e),this.setXYZ(t,Jn.x,Jn.y,Jn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Jn.fromBufferAttribute(this,t),Jn.applyMatrix4(e),this.setXYZ(t,Jn.x,Jn.y,Jn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Jn.fromBufferAttribute(this,t),Jn.applyNormalMatrix(e),this.setXYZ(t,Jn.x,Jn.y,Jn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Jn.fromBufferAttribute(this,t),Jn.transformDirection(e),this.setXYZ(t,Jn.x,Jn.y,Jn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=wd(t,this.array)),t}setX(e,t){return this.normalized&&(t=Xr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=wd(t,this.array)),t}setY(e,t){return this.normalized&&(t=Xr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=wd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Xr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=wd(t,this.array)),t}setW(e,t){return this.normalized&&(t=Xr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Xr(t,this.array),i=Xr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Xr(t,this.array),i=Xr(i,this.array),r=Xr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=Xr(t,this.array),i=Xr(i,this.array),r=Xr(r,this.array),n=Xr(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==tL&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},vq=class extends pi{constructor(e,t,i){super(new Uint16Array(e),t,i)}},zy=class extends pi{constructor(e,t,i){super(new Uint32Array(e),t,i)}},kt=class extends pi{constructor(e,t,i){super(new Float32Array(e),t,i)}},Ype=0,Dl=new St,WD=new Mr,U0=new k,ll=new Gn,iw=new Gn,Ns=new k,$t=class extends va{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ype++}),this.uuid=Hl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(hq(e)?zy:vq)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new ns().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Dl.makeRotationFromQuaternion(e),this.applyMatrix4(Dl),this}rotateX(e){return Dl.makeRotationX(e),this.applyMatrix4(Dl),this}rotateY(e){return Dl.makeRotationY(e),this.applyMatrix4(Dl),this}rotateZ(e){return Dl.makeRotationZ(e),this.applyMatrix4(Dl),this}translate(e,t,i){return Dl.makeTranslation(e,t,i),this.applyMatrix4(Dl),this}scale(e,t,i){return Dl.makeScale(e,t,i),this.applyMatrix4(Dl),this}lookAt(e){return WD.lookAt(e),WD.updateMatrix(),this.applyMatrix4(WD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(U0).negate(),this.translate(U0.x,U0.y,U0.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new kt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Gn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];ll.setFromBufferAttribute(n),this.morphTargetsRelative?(Ns.addVectors(this.boundingBox.min,ll.min),this.boundingBox.expandByPoint(Ns),Ns.addVectors(this.boundingBox.max,ll.max),this.boundingBox.expandByPoint(Ns)):(this.boundingBox.expandByPoint(ll.min),this.boundingBox.expandByPoint(ll.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new jo);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new k,1/0);return}if(e){let i=this.boundingSphere.center;if(ll.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];iw.setFromBufferAttribute(a),this.morphTargetsRelative?(Ns.addVectors(ll.min,iw.min),ll.expandByPoint(Ns),Ns.addVectors(ll.max,iw.max),ll.expandByPoint(Ns)):(ll.expandByPoint(iw.min),ll.expandByPoint(iw.max))}ll.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)Ns.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(Ns));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)Ns.fromBufferAttribute(a,l),o&&(U0.fromBufferAttribute(e,l),Ns.add(U0)),r=Math.max(r,i.distanceToSquared(Ns))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new pi(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let C=0;C<a;C++)l[C]=new k,c[C]=new k;let u=new k,h=new k,d=new k,f=new Ee,m=new Ee,v=new Ee,g=new k,x=new k;function S(C,L,z){u.fromArray(r,C*3),h.fromArray(r,L*3),d.fromArray(r,z*3),f.fromArray(s,C*2),m.fromArray(s,L*2),v.fromArray(s,z*2),h.sub(u),d.sub(u),m.sub(f),v.sub(f);let F=1/(m.x*v.y-v.x*m.y);!isFinite(F)||(g.copy(h).multiplyScalar(v.y).addScaledVector(d,-m.y).multiplyScalar(F),x.copy(d).multiplyScalar(m.x).addScaledVector(h,-v.x).multiplyScalar(F),l[C].add(g),l[L].add(g),l[z].add(g),c[C].add(x),c[L].add(x),c[z].add(x))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let C=0,L=_.length;C<L;++C){let z=_[C],F=z.start,G=z.count;for(let N=F,q=F+G;N<q;N+=3)S(i[N+0],i[N+1],i[N+2])}let A=new k,T=new k,E=new k,I=new k;function P(C){E.fromArray(n,C*3),I.copy(E);let L=l[C];A.copy(L),A.sub(E.multiplyScalar(E.dot(L))).normalize(),T.crossVectors(I,L);let z=T.dot(c[C])<0?-1:1;o[C*4]=A.x,o[C*4+1]=A.y,o[C*4+2]=A.z,o[C*4+3]=z}for(let C=0,L=_.length;C<L;++C){let z=_[C],F=z.start,G=z.count;for(let N=F,q=F+G;N<q;N+=3)P(i[N+0]),P(i[N+1]),P(i[N+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new pi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new k,n=new k,s=new k,a=new k,o=new k,l=new k,c=new k,u=new k;if(e)for(let h=0,d=e.count;h<d;h+=3){let f=e.getX(h+0),m=e.getX(h+1),v=e.getX(h+2);r.fromBufferAttribute(t,f),n.fromBufferAttribute(t,m),s.fromBufferAttribute(t,v),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),a.fromBufferAttribute(i,f),o.fromBufferAttribute(i,m),l.fromBufferAttribute(i,v),a.add(c),o.add(c),l.add(c),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(v,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)r.fromBufferAttribute(t,h+0),n.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Ns.fromBufferAttribute(e,t),Ns.normalize(),e.setXYZ(t,Ns.x,Ns.y,Ns.z)}toNonIndexed(){function e(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,f=0;for(let m=0,v=o.length;m<v;m++){a.isInterleavedBufferAttribute?d=o[m]*a.data.stride+a.offset:d=o[m]*c;for(let g=0;g<c;g++)h[f++]=l[d++]}return new pi(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new $t,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=e(h,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(e.data))}c.length>0&&(r[o]=c,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(t))}let n=e.morphAttributes;for(let l in n){let c=[],u=n[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},lV=new St,F0=new Mx,XD=new jo,rw=new k,nw=new k,sw=new k,qD=new k,tA=new k,iA=new Ee,rA=new Ee,nA=new Ee,YD=new k,sA=new k,qr=class extends Mr{constructor(e=new $t,t=new Ld){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(n&&a){tA.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(qD.fromBufferAttribute(u,e),s?tA.addScaledVector(qD,c):tA.addScaledVector(qD.sub(t),c))}t.add(tA)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),XD.copy(i.boundingSphere),XD.applyMatrix4(n),e.ray.intersectsSphere(XD)===!1)||(lV.copy(n).invert(),F0.copy(e.ray).applyMatrix4(lV),i.boundingBox!==null&&F0.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,f=u.length;d<f;d++){let m=u[d],v=r[m.materialIndex],g=Math.max(m.start,h.start),x=Math.min(a.count,Math.min(m.start+m.count,h.start+h.count));for(let S=g,_=x;S<_;S+=3){let A=a.getX(S),T=a.getX(S+1),E=a.getX(S+2);s=aA(this,v,e,F0,l,c,A,T,E),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),f=Math.min(a.count,h.start+h.count);for(let m=d,v=f;m<v;m+=3){let g=a.getX(m),x=a.getX(m+1),S=a.getX(m+2);s=aA(this,r,e,F0,l,c,g,x,S),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,f=u.length;d<f;d++){let m=u[d],v=r[m.materialIndex],g=Math.max(m.start,h.start),x=Math.min(o.count,Math.min(m.start+m.count,h.start+h.count));for(let S=g,_=x;S<_;S+=3){let A=S,T=S+1,E=S+2;s=aA(this,v,e,F0,l,c,A,T,E),s&&(s.faceIndex=Math.floor(S/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),f=Math.min(o.count,h.start+h.count);for(let m=d,v=f;m<v;m+=3){let g=m,x=m+1,S=m+2;s=aA(this,r,e,F0,l,c,g,x,S),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}}};function Qpe(e,t,i,r,n,s,a,o){let l;if(t.side===Ws?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Yc,o),l===null)return null;sA.copy(o),sA.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(sA);return c<i.near||c>i.far?null:{distance:c,point:sA.clone(),object:e}}function aA(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,rw),e.getVertexPosition(o,nw),e.getVertexPosition(l,sw);let c=Qpe(e,t,i,r,rw,nw,sw,YD);if(c){n&&(iA.fromBufferAttribute(n,a),rA.fromBufferAttribute(n,o),nA.fromBufferAttribute(n,l),c.uv=ha.getUV(YD,rw,nw,sw,iA,rA,nA,new Ee)),s&&(iA.fromBufferAttribute(s,a),rA.fromBufferAttribute(s,o),nA.fromBufferAttribute(s,l),c.uv2=ha.getUV(YD,rw,nw,sw,iA,rA,nA,new Ee));let u={a,b:o,c:l,normal:new k,materialIndex:0};ha.getNormal(rw,nw,sw,u.normal),c.face=u}return c}var Zc=class extends $t{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;f("z","y","x",-1,-1,i,t,e,s,n,0),f("z","y","x",1,-1,i,t,-e,s,n,1),f("x","z","y",1,1,e,i,t,r,s,2),f("x","z","y",1,-1,e,i,-t,r,s,3),f("x","y","z",1,-1,e,t,i,r,n,4),f("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new kt(l,3)),this.setAttribute("normal",new kt(c,3)),this.setAttribute("uv",new kt(u,2));function f(m,v,g,x,S,_,A,T,E,I,P){let C=_/E,L=A/I,z=_/2,F=A/2,G=T/2,N=E+1,q=I+1,ie=0,Q=0,W=new k;for(let ee=0;ee<q;ee++){let K=ee*L-F;for(let j=0;j<N;j++){let $=j*C-z;W[m]=$*x,W[v]=K*S,W[g]=G,l.push(W.x,W.y,W.z),W[m]=0,W[v]=0,W[g]=T>0?1:-1,c.push(W.x,W.y,W.z),u.push(j/E),u.push(1-ee/I),ie+=1}}for(let ee=0;ee<I;ee++)for(let K=0;K<E;K++){let j=h+K+N*ee,$=h+K+N*(ee+1),se=h+(K+1)+N*(ee+1),re=h+(K+1)+N*ee;o.push(j,$,re),o.push($,se,re),Q+=6}a.addGroup(d,Q,P),d+=Q,h+=ie}}static fromJSON(e){return new Zc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function nx(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function io(e){let t={};for(let i=0;i<e.length;i++){let r=nx(e[i]);for(let n in r)t[n]=r[n]}return t}function Zpe(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function yq(e){return e.getRenderTarget()===null&&e.outputEncoding===Bi?Du:cT}var Ax={clone:nx,merge:io},Kpe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Jpe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,nr=class extends N_{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Kpe,this.fragmentShader=Jpe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nx(e.uniforms),this.uniformsGroups=Zpe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Bp=class extends Mr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new St,this.projectionMatrix=new St,this.projectionMatrixInverse=new St}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Ra=class extends Bp{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=qb*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(nb*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return qb*2*Math.atan(Math.tan(nb*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(nb*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},k0=-90,V0=1,$pe=class extends Mr{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Ra(k0,V0,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new Ra(k0,V0,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new Ra(k0,V0,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new Ra(k0,V0,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new Ra(k0,V0,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Ra(k0,V0,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=Wu,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},RB=class extends wn{constructor(e,t,i,r,n,s,a,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:Hg,super(e,t,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},eme=class extends rr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new RB(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Fi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Zc(5,5,5),n=new nr({name:"CubemapFromEquirect",uniforms:nx(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Ws,blending:as});n.uniforms.tEquirect.value=t;let s=new qr(r,n),a=t.minFilter;return t.minFilter===rx&&(t.minFilter=Fi),new $pe(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},QD=new k,tme=new k,ime=new ns,zo=class{constructor(e=new k(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=QD.subVectors(i,t).cross(tme.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(QD),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||ime.getNormalMatrix(e),r=this.coplanarPoint(QD).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},H0=new jo,oA=new k,IB=class{constructor(e=new zo,t=new zo,i=new zo,r=new zo,n=new zo,s=new zo){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],f=i[10],m=i[11],v=i[12],g=i[13],x=i[14],S=i[15];return t[0].setComponents(a-r,u-o,m-h,S-v).normalize(),t[1].setComponents(a+r,u+o,m+h,S+v).normalize(),t[2].setComponents(a+n,u+l,m+d,S+g).normalize(),t[3].setComponents(a-n,u-l,m-d,S-g).normalize(),t[4].setComponents(a-s,u-c,m-f,S-x).normalize(),t[5].setComponents(a+s,u+c,m+f,S+x).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),H0.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(H0)}intersectsSprite(e){return H0.center.set(0,0,0),H0.radius=.7071067811865476,H0.applyMatrix4(e.matrixWorld),this.intersectsSphere(H0)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(oA.x=r.normal.x>0?e.max.x:e.min.x,oA.y=r.normal.y>0?e.max.y:e.min.y,oA.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(oA)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function xq(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function rme(e,t){let i=t.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,f=e.createBuffer();e.bindBuffer(u,f),e.bufferData(u,h,d),c.onUploadCallback();let m;if(h instanceof Float32Array)m=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)m=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=5123;else if(h instanceof Int16Array)m=5122;else if(h instanceof Uint32Array)m=5125;else if(h instanceof Int32Array)m=5124;else if(h instanceof Int8Array)m=5120;else if(h instanceof Uint8Array)m=5121;else if(h instanceof Uint8ClampedArray)m=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,f=u.updateRange;e.bindBuffer(h,c),f.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):e.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var Ju=class extends $t{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],f=[],m=[],v=[];for(let g=0;g<c;g++){let x=g*h-s;for(let S=0;S<l;S++){let _=S*u-n;f.push(_,-x,0),m.push(0,0,1),v.push(S/a),v.push(1-g/o)}}for(let g=0;g<o;g++)for(let x=0;x<a;x++){let S=x+l*g,_=x+l*(g+1),A=x+1+l*(g+1),T=x+1+l*g;d.push(S,_,T),d.push(_,A,T)}this.setIndex(d),this.setAttribute("position",new kt(f,3)),this.setAttribute("normal",new kt(m,3)),this.setAttribute("uv",new kt(v,2))}static fromJSON(e){return new Ju(e.width,e.height,e.widthSegments,e.heightSegments)}},nme=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,sme=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ame=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,ome=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,lme=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,cme=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ume="vec3 transformed = vec3( position );",hme=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,dme=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,fme=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,pme=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,mme=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,gme=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,vme=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,yme=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,xme=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,wme=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,bme=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,_me=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Sme=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Mme=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ame=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Eme=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Tme=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Cme=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Pme=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Dme="gl_FragColor = linearToOutputTexel( gl_FragColor );",Rme=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Ime=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Lme=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ome=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,zme=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Bme=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Nme=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Ume=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Fme=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,kme=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Vme=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Hme=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Gme=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,jme=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Wme=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Xme=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,qme=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Yme=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Qme=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Zme=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Kme=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Jme=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,$me=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ege=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,tge=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ige=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,rge=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,nge=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,sge=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,age=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,oge=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,lge=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,cge=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,uge=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hge=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,dge=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,fge=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,pge=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,mge=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,gge=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,vge=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,yge=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,xge=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,wge=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,bge=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,_ge=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Sge=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Mge=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Age=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Ege=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Tge=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Cge=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Pge=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Dge=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Rge=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ige=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Lge=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Oge=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,zge=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Bge=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Nge=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Uge=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Fge=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,kge=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Vge=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Hge=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Gge=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,jge=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Wge=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Xge=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,qge=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,Yge=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Qge=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Zge=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Kge=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,Jge=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,$ge=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,eve=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,tve=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,ive=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,rve=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,nve=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,sve=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ave=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ove=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,lve=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,cve=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,uve=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,hve=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,dve=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fve=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,pve=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mve=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,gve=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,vve=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yve=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xve=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wve=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,bve=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_ve=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Sve=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Mve=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ave=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Eve=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tve=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cve=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pve=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dve=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Rve=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ive=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lve=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ove=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,zve=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ui={alphamap_fragment:nme,alphamap_pars_fragment:sme,alphatest_fragment:ame,alphatest_pars_fragment:ome,aomap_fragment:lme,aomap_pars_fragment:cme,begin_vertex:ume,beginnormal_vertex:hme,bsdfs:dme,iridescence_fragment:fme,bumpmap_pars_fragment:pme,clipping_planes_fragment:mme,clipping_planes_pars_fragment:gme,clipping_planes_pars_vertex:vme,clipping_planes_vertex:yme,color_fragment:xme,color_pars_fragment:wme,color_pars_vertex:bme,color_vertex:_me,common:Sme,cube_uv_reflection_fragment:Mme,defaultnormal_vertex:Ame,displacementmap_pars_vertex:Eme,displacementmap_vertex:Tme,emissivemap_fragment:Cme,emissivemap_pars_fragment:Pme,encodings_fragment:Dme,encodings_pars_fragment:Rme,envmap_fragment:Ime,envmap_common_pars_fragment:Lme,envmap_pars_fragment:Ome,envmap_pars_vertex:zme,envmap_physical_pars_fragment:qme,envmap_vertex:Bme,fog_vertex:Nme,fog_pars_vertex:Ume,fog_fragment:Fme,fog_pars_fragment:kme,gradientmap_pars_fragment:Vme,lightmap_fragment:Hme,lightmap_pars_fragment:Gme,lights_lambert_fragment:jme,lights_lambert_pars_fragment:Wme,lights_pars_begin:Xme,lights_toon_fragment:Yme,lights_toon_pars_fragment:Qme,lights_phong_fragment:Zme,lights_phong_pars_fragment:Kme,lights_physical_fragment:Jme,lights_physical_pars_fragment:$me,lights_fragment_begin:ege,lights_fragment_maps:tge,lights_fragment_end:ige,logdepthbuf_fragment:rge,logdepthbuf_pars_fragment:nge,logdepthbuf_pars_vertex:sge,logdepthbuf_vertex:age,map_fragment:oge,map_pars_fragment:lge,map_particle_fragment:cge,map_particle_pars_fragment:uge,metalnessmap_fragment:hge,metalnessmap_pars_fragment:dge,morphcolor_vertex:fge,morphnormal_vertex:pge,morphtarget_pars_vertex:mge,morphtarget_vertex:gge,normal_fragment_begin:vge,normal_fragment_maps:yge,normal_pars_fragment:xge,normal_pars_vertex:wge,normal_vertex:bge,normalmap_pars_fragment:_ge,clearcoat_normal_fragment_begin:Sge,clearcoat_normal_fragment_maps:Mge,clearcoat_pars_fragment:Age,iridescence_pars_fragment:Ege,output_fragment:Tge,packing:Cge,premultiplied_alpha_fragment:Pge,project_vertex:Dge,dithering_fragment:Rge,dithering_pars_fragment:Ige,roughnessmap_fragment:Lge,roughnessmap_pars_fragment:Oge,shadowmap_pars_fragment:zge,shadowmap_pars_vertex:Bge,shadowmap_vertex:Nge,shadowmask_pars_fragment:Uge,skinbase_vertex:Fge,skinning_pars_vertex:kge,skinning_vertex:Vge,skinnormal_vertex:Hge,specularmap_fragment:Gge,specularmap_pars_fragment:jge,tonemapping_fragment:Wge,tonemapping_pars_fragment:Xge,transmission_fragment:qge,transmission_pars_fragment:Yge,uv_pars_fragment:Qge,uv_pars_vertex:Zge,uv_vertex:Kge,uv2_pars_fragment:Jge,uv2_pars_vertex:$ge,uv2_vertex:eve,worldpos_vertex:tve,background_vert:ive,background_frag:rve,backgroundCube_vert:nve,backgroundCube_frag:sve,cube_vert:ave,cube_frag:ove,depth_vert:lve,depth_frag:cve,distanceRGBA_vert:uve,distanceRGBA_frag:hve,equirect_vert:dve,equirect_frag:fve,linedashed_vert:pve,linedashed_frag:mve,meshbasic_vert:gve,meshbasic_frag:vve,meshlambert_vert:yve,meshlambert_frag:xve,meshmatcap_vert:wve,meshmatcap_frag:bve,meshnormal_vert:_ve,meshnormal_frag:Sve,meshphong_vert:Mve,meshphong_frag:Ave,meshphysical_vert:Eve,meshphysical_frag:Tve,meshtoon_vert:Cve,meshtoon_frag:Pve,points_vert:Dve,points_frag:Rve,shadow_vert:Ive,shadow_frag:Lve,sprite_vert:Ove,sprite_frag:zve},Bt={common:{diffuse:{value:new fi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ns},uv2Transform:{value:new ns},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ns}},sprite:{diffuse:{value:new fi(16777215)},opacity:{value:1},center:{value:new Ee(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ns}}},Lu={basic:{uniforms:io([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:Ui.meshbasic_vert,fragmentShader:Ui.meshbasic_frag},lambert:{uniforms:io([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new fi(0)}}]),vertexShader:Ui.meshlambert_vert,fragmentShader:Ui.meshlambert_frag},phong:{uniforms:io([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new fi(0)},specular:{value:new fi(1118481)},shininess:{value:30}}]),vertexShader:Ui.meshphong_vert,fragmentShader:Ui.meshphong_frag},standard:{uniforms:io([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new fi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ui.meshphysical_vert,fragmentShader:Ui.meshphysical_frag},toon:{uniforms:io([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new fi(0)}}]),vertexShader:Ui.meshtoon_vert,fragmentShader:Ui.meshtoon_frag},matcap:{uniforms:io([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:Ui.meshmatcap_vert,fragmentShader:Ui.meshmatcap_frag},points:{uniforms:io([Bt.points,Bt.fog]),vertexShader:Ui.points_vert,fragmentShader:Ui.points_frag},dashed:{uniforms:io([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ui.linedashed_vert,fragmentShader:Ui.linedashed_frag},depth:{uniforms:io([Bt.common,Bt.displacementmap]),vertexShader:Ui.depth_vert,fragmentShader:Ui.depth_frag},normal:{uniforms:io([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:Ui.meshnormal_vert,fragmentShader:Ui.meshnormal_frag},sprite:{uniforms:io([Bt.sprite,Bt.fog]),vertexShader:Ui.sprite_vert,fragmentShader:Ui.sprite_frag},background:{uniforms:{uvTransform:{value:new ns},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ui.background_vert,fragmentShader:Ui.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ui.backgroundCube_vert,fragmentShader:Ui.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ui.cube_vert,fragmentShader:Ui.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ui.equirect_vert,fragmentShader:Ui.equirect_frag},distanceRGBA:{uniforms:io([Bt.common,Bt.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ui.distanceRGBA_vert,fragmentShader:Ui.distanceRGBA_frag},shadow:{uniforms:io([Bt.lights,Bt.fog,{color:{value:new fi(0)},opacity:{value:1}}]),vertexShader:Ui.shadow_vert,fragmentShader:Ui.shadow_frag}};Lu.physical={uniforms:io([Lu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ee(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new fi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ee},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new fi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new fi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ui.meshphysical_vert,fragmentShader:Ui.meshphysical_frag};var lA={r:0,b:0,g:0};function Bve(e,t,i,r,n,s,a){let o=new fi(0),l=s===!0?0:1,c,u,h=null,d=0,f=null;function m(g,x){let S=!1,_=x.isScene===!0?x.background:null;_&&_.isTexture&&(_=(x.backgroundBlurriness>0?i:t).get(_));let A=e.xr,T=A.getSession&&A.getSession();T&&T.environmentBlendMode==="additive"&&(_=null),_===null?v(o,l):_&&_.isColor&&(v(_,1),S=!0),(e.autoClear||S)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),_&&(_.isCubeTexture||_.mapping===B_)?(u===void 0&&(u=new qr(new Zc(1,1,1),new nr({name:"BackgroundCubeMaterial",uniforms:nx(Lu.backgroundCube.uniforms),vertexShader:Lu.backgroundCube.vertexShader,fragmentShader:Lu.backgroundCube.fragmentShader,side:Ws,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(E,I,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=_.encoding!==Bi,(h!==_||d!==_.version||f!==e.toneMapping)&&(u.material.needsUpdate=!0,h=_,d=_.version,f=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new qr(new Ju(2,2),new nr({name:"BackgroundMaterial",uniforms:nx(Lu.background.uniforms),vertexShader:Lu.background.vertexShader,fragmentShader:Lu.background.fragmentShader,side:Yc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=_.encoding!==Bi,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(h!==_||d!==_.version||f!==e.toneMapping)&&(c.material.needsUpdate=!0,h=_,d=_.version,f=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function v(g,x){g.getRGB(lA,yq(e)),r.buffers.color.setClear(lA.r,lA.g,lA.b,x,a)}return{getClearColor:function(){return o},setClearColor:function(g,x=1){o.set(g),l=x,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(o,l)},render:m}}function Nve(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=g(null),c=l,u=!1;function h(N,q,ie,Q,W){let ee=!1;if(a){let K=v(Q,ie,q);c!==K&&(c=K,f(c.object)),ee=x(N,Q,ie,W),ee&&S(N,Q,ie,W)}else{let K=q.wireframe===!0;(c.geometry!==Q.id||c.program!==ie.id||c.wireframe!==K)&&(c.geometry=Q.id,c.program=ie.id,c.wireframe=K,ee=!0)}W!==null&&i.update(W,34963),(ee||u)&&(u=!1,P(N,q,ie,Q),W!==null&&e.bindBuffer(34963,i.get(W).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function f(N){return r.isWebGL2?e.bindVertexArray(N):s.bindVertexArrayOES(N)}function m(N){return r.isWebGL2?e.deleteVertexArray(N):s.deleteVertexArrayOES(N)}function v(N,q,ie){let Q=ie.wireframe===!0,W=o[N.id];W===void 0&&(W={},o[N.id]=W);let ee=W[q.id];ee===void 0&&(ee={},W[q.id]=ee);let K=ee[Q];return K===void 0&&(K=g(d()),ee[Q]=K),K}function g(N){let q=[],ie=[],Q=[];for(let W=0;W<n;W++)q[W]=0,ie[W]=0,Q[W]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:q,enabledAttributes:ie,attributeDivisors:Q,object:N,attributes:{},index:null}}function x(N,q,ie,Q){let W=c.attributes,ee=q.attributes,K=0,j=ie.getAttributes();for(let $ in j)if(j[$].location>=0){let se=W[$],re=ee[$];if(re===void 0&&($==="instanceMatrix"&&N.instanceMatrix&&(re=N.instanceMatrix),$==="instanceColor"&&N.instanceColor&&(re=N.instanceColor)),se===void 0||se.attribute!==re||re&&se.data!==re.data)return!0;K++}return c.attributesNum!==K||c.index!==Q}function S(N,q,ie,Q){let W={},ee=q.attributes,K=0,j=ie.getAttributes();for(let $ in j)if(j[$].location>=0){let se=ee[$];se===void 0&&($==="instanceMatrix"&&N.instanceMatrix&&(se=N.instanceMatrix),$==="instanceColor"&&N.instanceColor&&(se=N.instanceColor));let re={};re.attribute=se,se&&se.data&&(re.data=se.data),W[$]=re,K++}c.attributes=W,c.attributesNum=K,c.index=Q}function _(){let N=c.newAttributes;for(let q=0,ie=N.length;q<ie;q++)N[q]=0}function A(N){T(N,0)}function T(N,q){let ie=c.newAttributes,Q=c.enabledAttributes,W=c.attributeDivisors;ie[N]=1,Q[N]===0&&(e.enableVertexAttribArray(N),Q[N]=1),W[N]!==q&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](N,q),W[N]=q)}function E(){let N=c.newAttributes,q=c.enabledAttributes;for(let ie=0,Q=q.length;ie<Q;ie++)q[ie]!==N[ie]&&(e.disableVertexAttribArray(ie),q[ie]=0)}function I(N,q,ie,Q,W,ee){r.isWebGL2===!0&&(ie===5124||ie===5125)?e.vertexAttribIPointer(N,q,ie,W,ee):e.vertexAttribPointer(N,q,ie,Q,W,ee)}function P(N,q,ie,Q){if(r.isWebGL2===!1&&(N.isInstancedMesh||Q.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();let W=Q.attributes,ee=ie.getAttributes(),K=q.defaultAttributeValues;for(let j in ee){let $=ee[j];if($.location>=0){let se=W[j];if(se===void 0&&(j==="instanceMatrix"&&N.instanceMatrix&&(se=N.instanceMatrix),j==="instanceColor"&&N.instanceColor&&(se=N.instanceColor)),se!==void 0){let re=se.normalized,he=se.itemSize,oe=i.get(se);if(oe===void 0)continue;let ve=oe.buffer,xe=oe.type,be=oe.bytesPerElement;if(se.isInterleavedBufferAttribute){let Me=se.data,Te=Me.stride,ae=se.offset;if(Me.isInstancedInterleavedBuffer){for(let Ce=0;Ce<$.locationSize;Ce++)T($.location+Ce,Me.meshPerAttribute);N.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=Me.meshPerAttribute*Me.count)}else for(let Ce=0;Ce<$.locationSize;Ce++)A($.location+Ce);e.bindBuffer(34962,ve);for(let Ce=0;Ce<$.locationSize;Ce++)I($.location+Ce,he/$.locationSize,xe,re,Te*be,(ae+he/$.locationSize*Ce)*be)}else{if(se.isInstancedBufferAttribute){for(let Me=0;Me<$.locationSize;Me++)T($.location+Me,se.meshPerAttribute);N.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let Me=0;Me<$.locationSize;Me++)A($.location+Me);e.bindBuffer(34962,ve);for(let Me=0;Me<$.locationSize;Me++)I($.location+Me,he/$.locationSize,xe,re,he*be,he/$.locationSize*Me*be)}}else if(K!==void 0){let re=K[j];if(re!==void 0)switch(re.length){case 2:e.vertexAttrib2fv($.location,re);break;case 3:e.vertexAttrib3fv($.location,re);break;case 4:e.vertexAttrib4fv($.location,re);break;default:e.vertexAttrib1fv($.location,re)}}}}E()}function C(){F();for(let N in o){let q=o[N];for(let ie in q){let Q=q[ie];for(let W in Q)m(Q[W].object),delete Q[W];delete q[ie]}delete o[N]}}function L(N){if(o[N.id]===void 0)return;let q=o[N.id];for(let ie in q){let Q=q[ie];for(let W in Q)m(Q[W].object),delete Q[W];delete q[ie]}delete o[N.id]}function z(N){for(let q in o){let ie=o[q];if(ie[N.id]===void 0)continue;let Q=ie[N.id];for(let W in Q)m(Q[W].object),delete Q[W];delete ie[N.id]}}function F(){G(),u=!0,c!==l&&(c=l,f(c.object))}function G(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:F,resetDefaultState:G,dispose:C,releaseStatesOfGeometry:L,releaseStatesOfProgram:z,initAttributes:_,enableAttribute:A,disableUnusedAttributes:E}}function Uve(e,t,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,f;if(n)d=e,f="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function Fve(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let I=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(I){if(I==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";I="mediump"}return I==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),f=e.getParameter(3379),m=e.getParameter(34076),v=e.getParameter(34921),g=e.getParameter(36347),x=e.getParameter(36348),S=e.getParameter(36349),_=d>0,A=a||t.has("OES_texture_float"),T=_&&A,E=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:g,maxVaryings:x,maxFragmentUniforms:S,vertexTextures:_,floatFragmentTextures:A,floatVertexTextures:T,maxSamples:E}}function kve(e){let t=this,i=null,r=0,n=!1,s=!1,a=new zo,o=new ns,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let f=h.length!==0||d||r!==0||n;return n=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,f){let m=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,x=e.get(h);if(!n||m===null||m.length===0||s&&!g)s?u(null):c();else{let S=s?0:r,_=S*4,A=x.clippingState||null;l.value=A,A=u(m,d,_,f);for(let T=0;T!==_;++T)A[T]=i[T];x.clippingState=A,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=S}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,f,m){let v=h!==null?h.length:0,g=null;if(v!==0){if(g=l.value,m!==!0||g===null){let x=f+v*4,S=d.matrixWorldInverse;o.getNormalMatrix(S),(g===null||g.length<x)&&(g=new Float32Array(x));for(let _=0,A=f;_!==v;++_,A+=4)a.copy(h[_]).applyMatrix4(S,o),a.normal.toArray(g,A),g[A+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,g}}function Vve(e){let t=new WeakMap;function i(a,o){return o===JI?a.mapping=Hg:o===$I&&(a.mapping=Gg),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===JI||o===$I)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new eme(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var $2=class extends Bp{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Cy=4,cV=[.125,.215,.35,.446,.526,.582],rg=20,ZD=new $2,uV=new fi,KD=null,Jm=(1+Math.sqrt(5))/2,G0=1/Jm,hV=[new k(1,1,1),new k(-1,1,1),new k(1,1,-1),new k(-1,1,-1),new k(0,Jm,G0),new k(0,Jm,-G0),new k(G0,0,Jm),new k(-G0,0,Jm),new k(Jm,G0,0),new k(-Jm,G0,0)],dV=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){KD=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=mV(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=pV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(KD),e.scissorTest=!1,cA(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Hg||e.mapping===Gg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),KD=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Fi,minFilter:Fi,generateMipmaps:!1,type:Id,format:hn,encoding:Qc,depthBuffer:!1},r=fV(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=fV(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Hve(n)),this._blurMaterial=Gve(n,e,t)}return r}_compileMaterial(e){let t=new qr(this._lodPlanes[0],e);this._renderer.compile(t,ZD)}_sceneToCubeUV(e,t,i,r){let n=new Ra(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(uV),o.toneMapping=Wu,o.autoClear=!1;let u=new Ld({name:"PMREM.Background",side:Ws,depthWrite:!1,depthTest:!1}),h=new qr(new Zc,u),d=!1,f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,d=!0):(u.color.copy(uV),d=!0);for(let m=0;m<6;m++){let v=m%3;v===0?(n.up.set(0,s[m],0),n.lookAt(a[m],0,0)):v===1?(n.up.set(0,0,s[m]),n.lookAt(0,a[m],0)):(n.up.set(0,s[m],0),n.lookAt(0,0,a[m]));let g=this._cubeSize;cA(r,v*g,m>2?g:0,g,g),o.setRenderTarget(r),d&&o.render(h,n),o.render(e,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===Hg||e.mapping===Gg;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=mV()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=pV());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new qr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;cA(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,ZD)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=hV[(r-1)%hV.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new qr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,f=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*rg-1),m=n/f,v=isFinite(n)?1+Math.floor(c*m):rg;v>rg&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${rg}`);let g=[],x=0;for(let E=0;E<rg;++E){let I=E/m,P=Math.exp(-I*I/2);g.push(P),E===0?x+=P:E<v&&(x+=2*P)}for(let E=0;E<g.length;E++)g[E]=g[E]/x;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=g,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:S}=this;h.dTheta.value=f,h.mipInt.value=S-i;let _=this._sizeLods[r],A=3*_*(r>S-Cy?r-S+Cy:0),T=4*(this._cubeSize-_);cA(t,A,T,3*_,2*_),o.setRenderTarget(t),o.render(u,ZD)}};function Hve(e){let t=[],i=[],r=[],n=e,s=e-Cy+1+cV.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-Cy?l=cV[a-e+Cy-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,m=6,v=3,g=2,x=1,S=new Float32Array(v*m*f),_=new Float32Array(g*m*f),A=new Float32Array(x*m*f);for(let E=0;E<f;E++){let I=E%3*2/3-1,P=E>2?0:-1,C=[I,P,0,I+2/3,P,0,I+2/3,P+1,0,I,P,0,I+2/3,P+1,0,I,P+1,0];S.set(C,v*m*E),_.set(d,g*m*E);let L=[E,E,E,E,E,E];A.set(L,x*m*E)}let T=new $t;T.setAttribute("position",new pi(S,v)),T.setAttribute("uv",new pi(_,g)),T.setAttribute("faceIndex",new pi(A,x)),t.push(T),n>Cy&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function fV(e,t,i){let r=new rr(e,t,i);return r.texture.mapping=B_,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function cA(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function Gve(e,t,i){let r=new Float32Array(rg),n=new k(0,1,0);return new nr({name:"SphericalGaussianBlur",defines:{n:rg,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:LB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:as,depthTest:!1,depthWrite:!1})}function pV(){return new nr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:LB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:as,depthTest:!1,depthWrite:!1})}function mV(){return new nr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:LB(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:as,depthTest:!1,depthWrite:!1})}function LB(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function jve(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===JI||l===$I,u=l===Hg||l===Gg;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new dV(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new dV(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function Wve(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function Xve(e,t,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let m in d.attributes)t.remove(d.attributes[m]);d.removeEventListener("dispose",a),delete n[d.id];let f=s.get(d);f&&(t.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let m in d)t.update(d[m],34962);let f=h.morphAttributes;for(let m in f){let v=f[m];for(let g=0,x=v.length;g<x;g++)t.update(v[g],34962)}}function c(h){let d=[],f=h.index,m=h.attributes.position,v=0;if(f!==null){let S=f.array;v=f.version;for(let _=0,A=S.length;_<A;_+=3){let T=S[_+0],E=S[_+1],I=S[_+2];d.push(T,E,E,I,I,T)}}else{let S=m.array;v=m.version;for(let _=0,A=S.length/3-1;_<A;_+=3){let T=_+0,E=_+1,I=_+2;d.push(T,E,E,I,I,T)}}let g=new(hq(d)?zy:vq)(d,1);g.version=v;let x=s.get(h);x&&t.remove(x),s.set(h,g)}function u(h){let d=s.get(h);if(d){let f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function qve(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,f){e.drawElements(s,f,o,d*l),i.update(f,s,1)}function h(d,f,m){if(m===0)return;let v,g;if(n)v=e,g="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](s,f,o,d*l,m),i.update(f,s,m)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function Yve(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function Qve(e,t){return e[0]-t[0]}function Zve(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Kve(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new Ti,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let f=c.morphTargetInfluences;if(t.isWebGL2===!0){let m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,v=m!==void 0?m.length:0,g=s.get(u);if(g===void 0||g.count!==v){let _=function(){N.dispose(),s.delete(u),u.removeEventListener("dispose",_)};g!==void 0&&g.texture.dispose();let A=u.morphAttributes.position!==void 0,T=u.morphAttributes.normal!==void 0,E=u.morphAttributes.color!==void 0,I=u.morphAttributes.position||[],P=u.morphAttributes.normal||[],C=u.morphAttributes.color||[],L=0;A===!0&&(L=1),T===!0&&(L=2),E===!0&&(L=3);let z=u.attributes.position.count*L,F=1;z>t.maxTextureSize&&(F=Math.ceil(z/t.maxTextureSize),z=t.maxTextureSize);let G=new Float32Array(z*F*4*v),N=new mq(G,z,F,v);N.type=Cr,N.needsUpdate=!0;let q=L*4;for(let ie=0;ie<v;ie++){let Q=I[ie],W=P[ie],ee=C[ie],K=z*F*4*ie;for(let j=0;j<Q.count;j++){let $=j*q;A===!0&&(a.fromBufferAttribute(Q,j),G[K+$+0]=a.x,G[K+$+1]=a.y,G[K+$+2]=a.z,G[K+$+3]=0),T===!0&&(a.fromBufferAttribute(W,j),G[K+$+4]=a.x,G[K+$+5]=a.y,G[K+$+6]=a.z,G[K+$+7]=0),E===!0&&(a.fromBufferAttribute(ee,j),G[K+$+8]=a.x,G[K+$+9]=a.y,G[K+$+10]=a.z,G[K+$+11]=ee.itemSize===4?a.w:1)}}g={count:v,texture:N,size:new Ee(z,F)},s.set(u,g),u.addEventListener("dispose",_)}let x=0;for(let _=0;_<f.length;_++)x+=f[_];let S=u.morphTargetsRelative?1:1-x;d.getUniforms().setValue(e,"morphTargetBaseInfluence",S),d.getUniforms().setValue(e,"morphTargetInfluences",f),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let m=f===void 0?0:f.length,v=r[u.id];if(v===void 0||v.length!==m){v=[];for(let A=0;A<m;A++)v[A]=[A,0];r[u.id]=v}for(let A=0;A<m;A++){let T=v[A];T[0]=A,T[1]=f[A]}v.sort(Zve);for(let A=0;A<8;A++)A<m&&v[A][1]?(o[A][0]=v[A][0],o[A][1]=v[A][1]):(o[A][0]=Number.MAX_SAFE_INTEGER,o[A][1]=0);o.sort(Qve);let g=u.morphAttributes.position,x=u.morphAttributes.normal,S=0;for(let A=0;A<8;A++){let T=o[A],E=T[0],I=T[1];E!==Number.MAX_SAFE_INTEGER&&I?(g&&u.getAttribute("morphTarget"+A)!==g[E]&&u.setAttribute("morphTarget"+A,g[E]),x&&u.getAttribute("morphNormal"+A)!==x[E]&&u.setAttribute("morphNormal"+A,x[E]),n[A]=I,S+=I):(g&&u.hasAttribute("morphTarget"+A)===!0&&u.deleteAttribute("morphTarget"+A),x&&u.hasAttribute("morphNormal"+A)===!0&&u.deleteAttribute("morphNormal"+A),n[A]=0)}let _=u.morphTargetsRelative?1:1-S;d.getUniforms().setValue(e,"morphTargetBaseInfluence",_),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function Jve(e,t,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=t.get(l,u);return n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var wq=new wn,bq=new mq,_q=new Fpe,Sq=new RB,gV=[],vV=[],yV=new Float32Array(16),xV=new Float32Array(9),wV=new Float32Array(4);function Ex(e,t,i){let r=e[0];if(r==null||r<=0||r>0)return e;let n=t*i,s=gV[n];if(s===void 0&&(s=new Float32Array(n),gV[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Cs(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Ps(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function eC(e,t){let i=vV[t];i===void 0&&(i=new Int32Array(t),vV[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function $ve(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function e0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Cs(i,t))return;e.uniform2fv(this.addr,t),Ps(i,t)}}function t0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Cs(i,t))return;e.uniform3fv(this.addr,t),Ps(i,t)}}function i0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Cs(i,t))return;e.uniform4fv(this.addr,t),Ps(i,t)}}function r0e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Cs(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ps(i,t)}else{if(Cs(i,r))return;wV.set(r),e.uniformMatrix2fv(this.addr,!1,wV),Ps(i,r)}}function n0e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Cs(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ps(i,t)}else{if(Cs(i,r))return;xV.set(r),e.uniformMatrix3fv(this.addr,!1,xV),Ps(i,r)}}function s0e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Cs(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ps(i,t)}else{if(Cs(i,r))return;yV.set(r),e.uniformMatrix4fv(this.addr,!1,yV),Ps(i,r)}}function a0e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function o0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Cs(i,t))return;e.uniform2iv(this.addr,t),Ps(i,t)}}function l0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Cs(i,t))return;e.uniform3iv(this.addr,t),Ps(i,t)}}function c0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Cs(i,t))return;e.uniform4iv(this.addr,t),Ps(i,t)}}function u0e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function h0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Cs(i,t))return;e.uniform2uiv(this.addr,t),Ps(i,t)}}function d0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Cs(i,t))return;e.uniform3uiv(this.addr,t),Ps(i,t)}}function f0e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Cs(i,t))return;e.uniform4uiv(this.addr,t),Ps(i,t)}}function p0e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||wq,n)}function m0e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||_q,n)}function g0e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||Sq,n)}function v0e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||bq,n)}function y0e(e){switch(e){case 5126:return $ve;case 35664:return e0e;case 35665:return t0e;case 35666:return i0e;case 35674:return r0e;case 35675:return n0e;case 35676:return s0e;case 5124:case 35670:return a0e;case 35667:case 35671:return o0e;case 35668:case 35672:return l0e;case 35669:case 35673:return c0e;case 5125:return u0e;case 36294:return h0e;case 36295:return d0e;case 36296:return f0e;case 35678:case 36198:case 36298:case 36306:case 35682:return p0e;case 35679:case 36299:case 36307:return m0e;case 35680:case 36300:case 36308:case 36293:return g0e;case 36289:case 36303:case 36311:case 36292:return v0e}}function x0e(e,t){e.uniform1fv(this.addr,t)}function w0e(e,t){let i=Ex(t,this.size,2);e.uniform2fv(this.addr,i)}function b0e(e,t){let i=Ex(t,this.size,3);e.uniform3fv(this.addr,i)}function _0e(e,t){let i=Ex(t,this.size,4);e.uniform4fv(this.addr,i)}function S0e(e,t){let i=Ex(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function M0e(e,t){let i=Ex(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function A0e(e,t){let i=Ex(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function E0e(e,t){e.uniform1iv(this.addr,t)}function T0e(e,t){e.uniform2iv(this.addr,t)}function C0e(e,t){e.uniform3iv(this.addr,t)}function P0e(e,t){e.uniform4iv(this.addr,t)}function D0e(e,t){e.uniform1uiv(this.addr,t)}function R0e(e,t){e.uniform2uiv(this.addr,t)}function I0e(e,t){e.uniform3uiv(this.addr,t)}function L0e(e,t){e.uniform4uiv(this.addr,t)}function O0e(e,t,i){let r=this.cache,n=t.length,s=eC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ps(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||wq,s[a])}function z0e(e,t,i){let r=this.cache,n=t.length,s=eC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ps(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||_q,s[a])}function B0e(e,t,i){let r=this.cache,n=t.length,s=eC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ps(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||Sq,s[a])}function N0e(e,t,i){let r=this.cache,n=t.length,s=eC(i,n);Cs(r,s)||(e.uniform1iv(this.addr,s),Ps(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||bq,s[a])}function U0e(e){switch(e){case 5126:return x0e;case 35664:return w0e;case 35665:return b0e;case 35666:return _0e;case 35674:return S0e;case 35675:return M0e;case 35676:return A0e;case 5124:case 35670:return E0e;case 35667:case 35671:return T0e;case 35668:case 35672:return C0e;case 35669:case 35673:return P0e;case 5125:return D0e;case 36294:return R0e;case 36295:return I0e;case 36296:return L0e;case 35678:case 36198:case 36298:case 36306:case 35682:return O0e;case 35679:case 36299:case 36307:return z0e;case 35680:case 36300:case 36308:case 36293:return B0e;case 36289:case 36303:case 36311:case 36292:return N0e}}var F0e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=y0e(t.type)}},k0e=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=U0e(t.type)}},V0e=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},JD=/(\w+)(\])?(\[|\.)?/g;function bV(e,t){e.seq.push(t),e.map[t.id]=t}function H0e(e,t,i){let r=e.name,n=r.length;for(JD.lastIndex=0;;){let s=JD.exec(r),a=JD.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){bV(i,c===void 0?new F0e(o,e,t):new k0e(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new V0e(o),bV(i,u)),i=u}}}var EE=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);H0e(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function _V(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var G0e=0;function j0e(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function W0e(e){switch(e){case Qc:return["Linear","( value )"];case Bi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function SV(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+j0e(e.getShaderSource(t),a)}else return n}function X0e(e,t){let i=W0e(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function q0e(e,t){let i;switch(t){case epe:i="Linear";break;case tpe:i="Reinhard";break;case ipe:i="OptimizedCineon";break;case rpe:i="ACESFilmic";break;case npe:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Y0e(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Nw).join(`
`)}function Q0e(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function Z0e(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Nw(e){return e!==""}function MV(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function AV(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var K0e=/^[ \t]*#include +<([\w\d./]+)>/gm;function sL(e){return e.replace(K0e,J0e)}function J0e(e,t){let i=Ui[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return sL(i)}var $0e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function EV(e){return e.replace($0e,eye)}function eye(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function TV(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function tye(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===EB?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Ife?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Bw&&(t="SHADOWMAP_TYPE_VSM"),t}function iye(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Hg:case Gg:t="ENVMAP_TYPE_CUBE";break;case B_:t="ENVMAP_TYPE_CUBE_UV";break}return t}function rye(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Gg:t="ENVMAP_MODE_REFRACTION";break}return t}function nye(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case rq:t="ENVMAP_BLENDING_MULTIPLY";break;case Jfe:t="ENVMAP_BLENDING_MIX";break;case $fe:t="ENVMAP_BLENDING_ADD";break}return t}function sye(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function aye(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=tye(i),c=iye(i),u=rye(i),h=nye(i),d=sye(i),f=i.isWebGL2?"":Y0e(i),m=Q0e(s),v=n.createProgram(),g,x,S=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[m].filter(Nw).join(`
`),g.length>0&&(g+=`
`),x=[f,m].filter(Nw).join(`
`),x.length>0&&(x+=`
`)):(g=[TV(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Nw).join(`
`),x=[f,TV(i),"#define SHADER_NAME "+i.shaderName,m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Wu?"#define TONE_MAPPING":"",i.toneMapping!==Wu?Ui.tonemapping_pars_fragment:"",i.toneMapping!==Wu?q0e("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ui.encodings_pars_fragment,X0e("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Nw).join(`
`)),a=sL(a),a=MV(a,i),a=AV(a,i),o=sL(o),o=MV(o,i),o=AV(o,i),a=EV(a),o=EV(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,x=["#define varying in",i.glslVersion===iL?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===iL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);let _=S+g+a,A=S+x+o,T=_V(n,35633,_),E=_V(n,35632,A);if(n.attachShader(v,T),n.attachShader(v,E),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){let C=n.getProgramInfoLog(v).trim(),L=n.getShaderInfoLog(T).trim(),z=n.getShaderInfoLog(E).trim(),F=!0,G=!0;if(n.getProgramParameter(v,35714)===!1){F=!1;let N=SV(n,T,"vertex"),q=SV(n,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+`

Program Info Log: `+C+`
`+N+`
`+q)}else C!==""?console.warn("THREE.WebGLProgram: Program Info Log:",C):(L===""||z==="")&&(G=!1);G&&(this.diagnostics={runnable:F,programLog:C,vertexShader:{log:L,prefix:g},fragmentShader:{log:z,prefix:x}})}n.deleteShader(T),n.deleteShader(E);let I;this.getUniforms=function(){return I===void 0&&(I=new EE(n,v)),I};let P;return this.getAttributes=function(){return P===void 0&&(P=Z0e(n,v)),P},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=G0e++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=T,this.fragmentShader=E,this}var oye=0,lye=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new cye(e),t.set(e,i)),i}},cye=class{constructor(e){this.id=oye++,this.code=e,this.usedTimes=0}};function uye(e,t,i,r,n,s,a){let o=new DB,l=new lye,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,f=n.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(P,C,L,z,F){let G=z.fog,N=F.geometry,q=P.isMeshStandardMaterial?z.environment:null,ie=(P.isMeshStandardMaterial?i:t).get(P.envMap||q),Q=ie&&ie.mapping===B_?ie.image.height:null,W=m[P.type];P.precision!==null&&(f=n.getMaxPrecision(P.precision),f!==P.precision&&console.warn("THREE.WebGLProgram.getParameters:",P.precision,"not supported, using",f,"instead."));let ee=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,K=ee!==void 0?ee.length:0,j=0;N.morphAttributes.position!==void 0&&(j=1),N.morphAttributes.normal!==void 0&&(j=2),N.morphAttributes.color!==void 0&&(j=3);let $,se,re,he;if(W){let Me=Lu[W];$=Me.vertexShader,se=Me.fragmentShader}else $=P.vertexShader,se=P.fragmentShader,l.update(P),re=l.getVertexShaderID(P),he=l.getFragmentShaderID(P);let oe=e.getRenderTarget(),ve=P.alphaTest>0,xe=P.clearcoat>0,be=P.iridescence>0;return{isWebGL2:u,shaderID:W,shaderName:P.type,vertexShader:$,fragmentShader:se,defines:P.defines,customVertexShaderID:re,customFragmentShaderID:he,isRawShaderMaterial:P.isRawShaderMaterial===!0,glslVersion:P.glslVersion,precision:f,instancing:F.isInstancedMesh===!0,instancingColor:F.isInstancedMesh===!0&&F.instanceColor!==null,supportsVertexTextures:d,outputEncoding:oe===null?e.outputEncoding:oe.isXRRenderTarget===!0?oe.texture.encoding:Qc,map:!!P.map,matcap:!!P.matcap,envMap:!!ie,envMapMode:ie&&ie.mapping,envMapCubeUVHeight:Q,lightMap:!!P.lightMap,aoMap:!!P.aoMap,emissiveMap:!!P.emissiveMap,bumpMap:!!P.bumpMap,normalMap:!!P.normalMap,objectSpaceNormalMap:P.normalMapType===wpe,tangentSpaceNormalMap:P.normalMapType===xpe,decodeVideoTexture:!!P.map&&P.map.isVideoTexture===!0&&P.map.encoding===Bi,clearcoat:xe,clearcoatMap:xe&&!!P.clearcoatMap,clearcoatRoughnessMap:xe&&!!P.clearcoatRoughnessMap,clearcoatNormalMap:xe&&!!P.clearcoatNormalMap,iridescence:be,iridescenceMap:be&&!!P.iridescenceMap,iridescenceThicknessMap:be&&!!P.iridescenceThicknessMap,displacementMap:!!P.displacementMap,roughnessMap:!!P.roughnessMap,metalnessMap:!!P.metalnessMap,specularMap:!!P.specularMap,specularIntensityMap:!!P.specularIntensityMap,specularColorMap:!!P.specularColorMap,opaque:P.transparent===!1&&P.blending===Dg,alphaMap:!!P.alphaMap,alphaTest:ve,gradientMap:!!P.gradientMap,sheen:P.sheen>0,sheenColorMap:!!P.sheenColorMap,sheenRoughnessMap:!!P.sheenRoughnessMap,transmission:P.transmission>0,transmissionMap:!!P.transmissionMap,thicknessMap:!!P.thicknessMap,combine:P.combine,vertexTangents:!!P.normalMap&&!!N.attributes.tangent,vertexColors:P.vertexColors,vertexAlphas:P.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,vertexUvs:!!P.map||!!P.bumpMap||!!P.normalMap||!!P.specularMap||!!P.alphaMap||!!P.emissiveMap||!!P.roughnessMap||!!P.metalnessMap||!!P.clearcoatMap||!!P.clearcoatRoughnessMap||!!P.clearcoatNormalMap||!!P.iridescenceMap||!!P.iridescenceThicknessMap||!!P.displacementMap||!!P.transmissionMap||!!P.thicknessMap||!!P.specularIntensityMap||!!P.specularColorMap||!!P.sheenColorMap||!!P.sheenRoughnessMap,uvsVertexOnly:!(P.map||P.bumpMap||P.normalMap||P.specularMap||P.alphaMap||P.emissiveMap||P.roughnessMap||P.metalnessMap||P.clearcoatNormalMap||P.iridescenceMap||P.iridescenceThicknessMap||P.transmission>0||P.transmissionMap||P.thicknessMap||P.specularIntensityMap||P.specularColorMap||P.sheen>0||P.sheenColorMap||P.sheenRoughnessMap)&&!!P.displacementMap,fog:!!G,useFog:P.fog===!0,fogExp2:G&&G.isFogExp2,flatShading:!!P.flatShading,sizeAttenuation:P.sizeAttenuation,logarithmicDepthBuffer:h,skinning:F.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:K,morphTextureStride:j,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:P.dithering,shadowMapEnabled:e.shadowMap.enabled&&L.length>0,shadowMapType:e.shadowMap.type,toneMapping:P.toneMapped?e.toneMapping:Wu,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:P.premultipliedAlpha,doubleSided:P.side===Oa,flipSided:P.side===Ws,useDepthPacking:!!P.depthPacking,depthPacking:P.depthPacking||0,index0AttributeName:P.index0AttributeName,extensionDerivatives:P.extensions&&P.extensions.derivatives,extensionFragDepth:P.extensions&&P.extensions.fragDepth,extensionDrawBuffers:P.extensions&&P.extensions.drawBuffers,extensionShaderTextureLOD:P.extensions&&P.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:P.customProgramCacheKey()}}function g(P){let C=[];if(P.shaderID?C.push(P.shaderID):(C.push(P.customVertexShaderID),C.push(P.customFragmentShaderID)),P.defines!==void 0)for(let L in P.defines)C.push(L),C.push(P.defines[L]);return P.isRawShaderMaterial===!1&&(x(C,P),S(C,P),C.push(e.outputEncoding)),C.push(P.customProgramCacheKey),C.join()}function x(P,C){P.push(C.precision),P.push(C.outputEncoding),P.push(C.envMapMode),P.push(C.envMapCubeUVHeight),P.push(C.combine),P.push(C.vertexUvs),P.push(C.fogExp2),P.push(C.sizeAttenuation),P.push(C.morphTargetsCount),P.push(C.morphAttributeCount),P.push(C.numDirLights),P.push(C.numPointLights),P.push(C.numSpotLights),P.push(C.numSpotLightMaps),P.push(C.numHemiLights),P.push(C.numRectAreaLights),P.push(C.numDirLightShadows),P.push(C.numPointLightShadows),P.push(C.numSpotLightShadows),P.push(C.numSpotLightShadowsWithMaps),P.push(C.shadowMapType),P.push(C.toneMapping),P.push(C.numClippingPlanes),P.push(C.numClipIntersection),P.push(C.depthPacking)}function S(P,C){o.disableAll(),C.isWebGL2&&o.enable(0),C.supportsVertexTextures&&o.enable(1),C.instancing&&o.enable(2),C.instancingColor&&o.enable(3),C.map&&o.enable(4),C.matcap&&o.enable(5),C.envMap&&o.enable(6),C.lightMap&&o.enable(7),C.aoMap&&o.enable(8),C.emissiveMap&&o.enable(9),C.bumpMap&&o.enable(10),C.normalMap&&o.enable(11),C.objectSpaceNormalMap&&o.enable(12),C.tangentSpaceNormalMap&&o.enable(13),C.clearcoat&&o.enable(14),C.clearcoatMap&&o.enable(15),C.clearcoatRoughnessMap&&o.enable(16),C.clearcoatNormalMap&&o.enable(17),C.iridescence&&o.enable(18),C.iridescenceMap&&o.enable(19),C.iridescenceThicknessMap&&o.enable(20),C.displacementMap&&o.enable(21),C.specularMap&&o.enable(22),C.roughnessMap&&o.enable(23),C.metalnessMap&&o.enable(24),C.gradientMap&&o.enable(25),C.alphaMap&&o.enable(26),C.alphaTest&&o.enable(27),C.vertexColors&&o.enable(28),C.vertexAlphas&&o.enable(29),C.vertexUvs&&o.enable(30),C.vertexTangents&&o.enable(31),C.uvsVertexOnly&&o.enable(32),P.push(o.mask),o.disableAll(),C.fog&&o.enable(0),C.useFog&&o.enable(1),C.flatShading&&o.enable(2),C.logarithmicDepthBuffer&&o.enable(3),C.skinning&&o.enable(4),C.morphTargets&&o.enable(5),C.morphNormals&&o.enable(6),C.morphColors&&o.enable(7),C.premultipliedAlpha&&o.enable(8),C.shadowMapEnabled&&o.enable(9),C.physicallyCorrectLights&&o.enable(10),C.doubleSided&&o.enable(11),C.flipSided&&o.enable(12),C.useDepthPacking&&o.enable(13),C.dithering&&o.enable(14),C.specularIntensityMap&&o.enable(15),C.specularColorMap&&o.enable(16),C.transmission&&o.enable(17),C.transmissionMap&&o.enable(18),C.thicknessMap&&o.enable(19),C.sheen&&o.enable(20),C.sheenColorMap&&o.enable(21),C.sheenRoughnessMap&&o.enable(22),C.decodeVideoTexture&&o.enable(23),C.opaque&&o.enable(24),P.push(o.mask)}function _(P){let C=m[P.type],L;if(C){let z=Lu[C];L=Ax.clone(z.uniforms)}else L=P.uniforms;return L}function A(P,C){let L;for(let z=0,F=c.length;z<F;z++){let G=c[z];if(G.cacheKey===C){L=G,++L.usedTimes;break}}return L===void 0&&(L=new aye(e,C,P,s),c.push(L)),L}function T(P){if(--P.usedTimes===0){let C=c.indexOf(P);c[C]=c[c.length-1],c.pop(),P.destroy()}}function E(P){l.remove(P)}function I(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:_,acquireProgram:A,releaseProgram:T,releaseShaderCache:E,programs:c,dispose:I}}function hye(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function dye(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function CV(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function PV(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,f,m,v,g){let x=e[t];return x===void 0?(x={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:v,group:g},e[t]=x):(x.id=h.id,x.object=h,x.geometry=d,x.material=f,x.groupOrder=m,x.renderOrder=h.renderOrder,x.z=v,x.group=g),t++,x}function o(h,d,f,m,v,g){let x=a(h,d,f,m,v,g);f.transmission>0?r.push(x):f.transparent===!0?n.push(x):i.push(x)}function l(h,d,f,m,v,g){let x=a(h,d,f,m,v,g);f.transmission>0?r.unshift(x):f.transparent===!0?n.unshift(x):i.unshift(x)}function c(h,d){i.length>1&&i.sort(h||dye),r.length>1&&r.sort(d||CV),n.length>1&&n.sort(d||CV)}function u(){for(let h=t,d=e.length;h<d;h++){let f=e[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function fye(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new PV,e.set(r,[a])):n>=s.length?(a=new PV,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function pye(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new k,color:new fi};break;case"SpotLight":i={position:new k,direction:new k,color:new fi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new k,color:new fi,distance:0,decay:0};break;case"HemisphereLight":i={direction:new k,skyColor:new fi,groundColor:new fi};break;case"RectAreaLight":i={color:new fi,position:new k,halfWidth:new k,halfHeight:new k};break}return e[t.id]=i,i}}}function mye(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var gye=0;function vye(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function yye(e,t){let i=new pye,r=mye(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new k);let s=new k,a=new St,o=new St;function l(u,h){let d=0,f=0,m=0;for(let z=0;z<9;z++)n.probe[z].set(0,0,0);let v=0,g=0,x=0,S=0,_=0,A=0,T=0,E=0,I=0,P=0;u.sort(vye);let C=h!==!0?Math.PI:1;for(let z=0,F=u.length;z<F;z++){let G=u[z],N=G.color,q=G.intensity,ie=G.distance,Q=G.shadow&&G.shadow.map?G.shadow.map.texture:null;if(G.isAmbientLight)d+=N.r*q*C,f+=N.g*q*C,m+=N.b*q*C;else if(G.isLightProbe)for(let W=0;W<9;W++)n.probe[W].addScaledVector(G.sh.coefficients[W],q);else if(G.isDirectionalLight){let W=i.get(G);if(W.color.copy(G.color).multiplyScalar(G.intensity*C),G.castShadow){let ee=G.shadow,K=r.get(G);K.shadowBias=ee.bias,K.shadowNormalBias=ee.normalBias,K.shadowRadius=ee.radius,K.shadowMapSize=ee.mapSize,n.directionalShadow[v]=K,n.directionalShadowMap[v]=Q,n.directionalShadowMatrix[v]=G.shadow.matrix,A++}n.directional[v]=W,v++}else if(G.isSpotLight){let W=i.get(G);W.position.setFromMatrixPosition(G.matrixWorld),W.color.copy(N).multiplyScalar(q*C),W.distance=ie,W.coneCos=Math.cos(G.angle),W.penumbraCos=Math.cos(G.angle*(1-G.penumbra)),W.decay=G.decay,n.spot[x]=W;let ee=G.shadow;if(G.map&&(n.spotLightMap[I]=G.map,I++,ee.updateMatrices(G),G.castShadow&&P++),n.spotLightMatrix[x]=ee.matrix,G.castShadow){let K=r.get(G);K.shadowBias=ee.bias,K.shadowNormalBias=ee.normalBias,K.shadowRadius=ee.radius,K.shadowMapSize=ee.mapSize,n.spotShadow[x]=K,n.spotShadowMap[x]=Q,E++}x++}else if(G.isRectAreaLight){let W=i.get(G);W.color.copy(N).multiplyScalar(q),W.halfWidth.set(G.width*.5,0,0),W.halfHeight.set(0,G.height*.5,0),n.rectArea[S]=W,S++}else if(G.isPointLight){let W=i.get(G);if(W.color.copy(G.color).multiplyScalar(G.intensity*C),W.distance=G.distance,W.decay=G.decay,G.castShadow){let ee=G.shadow,K=r.get(G);K.shadowBias=ee.bias,K.shadowNormalBias=ee.normalBias,K.shadowRadius=ee.radius,K.shadowMapSize=ee.mapSize,K.shadowCameraNear=ee.camera.near,K.shadowCameraFar=ee.camera.far,n.pointShadow[g]=K,n.pointShadowMap[g]=Q,n.pointShadowMatrix[g]=G.shadow.matrix,T++}n.point[g]=W,g++}else if(G.isHemisphereLight){let W=i.get(G);W.skyColor.copy(G.color).multiplyScalar(q*C),W.groundColor.copy(G.groundColor).multiplyScalar(q*C),n.hemi[_]=W,_++}}S>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Bt.LTC_FLOAT_1,n.rectAreaLTC2=Bt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Bt.LTC_HALF_1,n.rectAreaLTC2=Bt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=m;let L=n.hash;(L.directionalLength!==v||L.pointLength!==g||L.spotLength!==x||L.rectAreaLength!==S||L.hemiLength!==_||L.numDirectionalShadows!==A||L.numPointShadows!==T||L.numSpotShadows!==E||L.numSpotMaps!==I)&&(n.directional.length=v,n.spot.length=x,n.rectArea.length=S,n.point.length=g,n.hemi.length=_,n.directionalShadow.length=A,n.directionalShadowMap.length=A,n.pointShadow.length=T,n.pointShadowMap.length=T,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=A,n.pointShadowMatrix.length=T,n.spotLightMatrix.length=E+I-P,n.spotLightMap.length=I,n.numSpotLightShadowsWithMaps=P,L.directionalLength=v,L.pointLength=g,L.spotLength=x,L.rectAreaLength=S,L.hemiLength=_,L.numDirectionalShadows=A,L.numPointShadows=T,L.numSpotShadows=E,L.numSpotMaps=I,n.version=gye++)}function c(u,h){let d=0,f=0,m=0,v=0,g=0,x=h.matrixWorldInverse;for(let S=0,_=u.length;S<_;S++){let A=u[S];if(A.isDirectionalLight){let T=n.directional[d];T.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(x),d++}else if(A.isSpotLight){let T=n.spot[m];T.position.setFromMatrixPosition(A.matrixWorld),T.position.applyMatrix4(x),T.direction.setFromMatrixPosition(A.matrixWorld),s.setFromMatrixPosition(A.target.matrixWorld),T.direction.sub(s),T.direction.transformDirection(x),m++}else if(A.isRectAreaLight){let T=n.rectArea[v];T.position.setFromMatrixPosition(A.matrixWorld),T.position.applyMatrix4(x),o.identity(),a.copy(A.matrixWorld),a.premultiply(x),o.extractRotation(a),T.halfWidth.set(A.width*.5,0,0),T.halfHeight.set(0,A.height*.5,0),T.halfWidth.applyMatrix4(o),T.halfHeight.applyMatrix4(o),v++}else if(A.isPointLight){let T=n.point[f];T.position.setFromMatrixPosition(A.matrixWorld),T.position.applyMatrix4(x),f++}else if(A.isHemisphereLight){let T=n.hemi[g];T.direction.setFromMatrixPosition(A.matrixWorld),T.direction.transformDirection(x),g++}}}return{setup:l,setupView:c,state:n}}function DV(e,t){let i=new yye(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function xye(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new DV(e,t),i.set(s,[l])):a>=o.length?(l=new DV(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var Mq=class extends N_{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Fd,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},wye=class extends N_{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new k,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},bye=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,_ye=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Sye(e,t,i){let r=new IB,n=new Ee,s=new Ee,a=new Ti,o=new Mq({depthPacking:cq}),l=new wye,c={},u=i.maxTextureSize,h={[Yc]:Ws,[Ws]:Yc,[Oa]:Oa},d=new nr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ee},radius:{value:4}},vertexShader:bye,fragmentShader:_ye}),f=d.clone();f.defines.HORIZONTAL_PASS=1;let m=new $t;m.setAttribute("position",new pi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new qr(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=EB,this.render=function(A,T,E){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||A.length===0)return;let I=e.getRenderTarget(),P=e.getActiveCubeFace(),C=e.getActiveMipmapLevel(),L=e.state;L.setBlending(as),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let z=0,F=A.length;z<F;z++){let G=A[z],N=G.shadow;if(N===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(N.autoUpdate===!1&&N.needsUpdate===!1)continue;n.copy(N.mapSize);let q=N.getFrameExtents();if(n.multiply(q),s.copy(N.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/q.x),n.x=s.x*q.x,N.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/q.y),n.y=s.y*q.y,N.mapSize.y=s.y)),N.map===null){let Q=this.type!==Bw?{minFilter:qi,magFilter:qi}:{};N.map=new rr(n.x,n.y,Q),N.map.texture.name=G.name+".shadowMap",N.camera.updateProjectionMatrix()}e.setRenderTarget(N.map),e.clear();let ie=N.getViewportCount();for(let Q=0;Q<ie;Q++){let W=N.getViewport(Q);a.set(s.x*W.x,s.y*W.y,s.x*W.z,s.y*W.w),L.viewport(a),N.updateMatrices(G,Q),r=N.getFrustum(),_(T,E,N.camera,G,this.type)}N.isPointLightShadow!==!0&&this.type===Bw&&x(N,E),N.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(I,P,C)};function x(A,T){let E=t.update(v);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,f.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new rr(n.x,n.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,e.setRenderTarget(A.mapPass),e.clear(),e.renderBufferDirect(T,null,E,d,v,null),f.uniforms.shadow_pass.value=A.mapPass.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,e.setRenderTarget(A.map),e.clear(),e.renderBufferDirect(T,null,E,f,v,null)}function S(A,T,E,I,P,C){let L=null,z=E.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(z!==void 0)L=z;else if(L=E.isPointLight===!0?l:o,e.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){let F=L.uuid,G=T.uuid,N=c[F];N===void 0&&(N={},c[F]=N);let q=N[G];q===void 0&&(q=L.clone(),N[G]=q),L=q}return L.visible=T.visible,L.wireframe=T.wireframe,C===Bw?L.side=T.shadowSide!==null?T.shadowSide:T.side:L.side=T.shadowSide!==null?T.shadowSide:h[T.side],L.alphaMap=T.alphaMap,L.alphaTest=T.alphaTest,L.map=T.map,L.clipShadows=T.clipShadows,L.clippingPlanes=T.clippingPlanes,L.clipIntersection=T.clipIntersection,L.displacementMap=T.displacementMap,L.displacementScale=T.displacementScale,L.displacementBias=T.displacementBias,L.wireframeLinewidth=T.wireframeLinewidth,L.linewidth=T.linewidth,E.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(E.matrixWorld),L.nearDistance=I,L.farDistance=P),L}function _(A,T,E,I,P){if(A.visible===!1)return;if(A.layers.test(T.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&P===Bw)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,A.matrixWorld);let L=t.update(A),z=A.material;if(Array.isArray(z)){let F=L.groups;for(let G=0,N=F.length;G<N;G++){let q=F[G],ie=z[q.materialIndex];if(ie&&ie.visible){let Q=S(A,ie,I,E.near,E.far,P);e.renderBufferDirect(E,null,L,Q,A,q)}}}else if(z.visible){let F=S(A,z,I,E.near,E.far,P);e.renderBufferDirect(E,null,L,F,A,null)}}let C=A.children;for(let L=0,z=C.length;L<z;L++)_(C[L],T,E,I,P)}}function Mye(e,t,i){let r=i.isWebGL2;function n(){let me=!1,Ne=new Ti,ue=null,et=new Ti(0,0,0,0);return{setMask:function(at){ue!==at&&!me&&(e.colorMask(at,at,at,at),ue=at)},setLocked:function(at){me=at},setClear:function(at,Ze,bt,Ft,ui){ui===!0&&(at*=Ft,Ze*=Ft,bt*=Ft),Ne.set(at,Ze,bt,Ft),et.equals(Ne)===!1&&(e.clearColor(at,Ze,bt,Ft),et.copy(Ne))},reset:function(){me=!1,ue=null,et.set(-1,0,0,0)}}}function s(){let me=!1,Ne=null,ue=null,et=null;return{setTest:function(at){at?ve(2929):xe(2929)},setMask:function(at){Ne!==at&&!me&&(e.depthMask(at),Ne=at)},setFunc:function(at){if(ue!==at){switch(at){case Wfe:e.depthFunc(512);break;case Xfe:e.depthFunc(519);break;case qfe:e.depthFunc(513);break;case KI:e.depthFunc(515);break;case Yfe:e.depthFunc(514);break;case Qfe:e.depthFunc(518);break;case Zfe:e.depthFunc(516);break;case Kfe:e.depthFunc(517);break;default:e.depthFunc(515)}ue=at}},setLocked:function(at){me=at},setClear:function(at){et!==at&&(e.clearDepth(at),et=at)},reset:function(){me=!1,Ne=null,ue=null,et=null}}}function a(){let me=!1,Ne=null,ue=null,et=null,at=null,Ze=null,bt=null,Ft=null,ui=null;return{setTest:function(ci){me||(ci?ve(2960):xe(2960))},setMask:function(ci){Ne!==ci&&!me&&(e.stencilMask(ci),Ne=ci)},setFunc:function(ci,Qi,mi){(ue!==ci||et!==Qi||at!==mi)&&(e.stencilFunc(ci,Qi,mi),ue=ci,et=Qi,at=mi)},setOp:function(ci,Qi,mi){(Ze!==ci||bt!==Qi||Ft!==mi)&&(e.stencilOp(ci,Qi,mi),Ze=ci,bt=Qi,Ft=mi)},setLocked:function(ci){me=ci},setClear:function(ci){ui!==ci&&(e.clearStencil(ci),ui=ci)},reset:function(){me=!1,Ne=null,ue=null,et=null,at=null,Ze=null,bt=null,Ft=null,ui=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},f={},m=new WeakMap,v=[],g=null,x=!1,S=null,_=null,A=null,T=null,E=null,I=null,P=null,C=!1,L=null,z=null,F=null,G=null,N=null,q=e.getParameter(35661),ie=!1,Q=0,W=e.getParameter(7938);W.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL (\d)/.exec(W)[1]),ie=Q>=1):W.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL ES (\d)/.exec(W)[1]),ie=Q>=2);let ee=null,K={},j=e.getParameter(3088),$=e.getParameter(2978),se=new Ti().fromArray(j),re=new Ti().fromArray($);function he(me,Ne,ue){let et=new Uint8Array(4),at=e.createTexture();e.bindTexture(me,at),e.texParameteri(me,10241,9728),e.texParameteri(me,10240,9728);for(let Ze=0;Ze<ue;Ze++)e.texImage2D(Ne+Ze,0,6408,1,1,0,6408,5121,et);return at}let oe={};oe[3553]=he(3553,3553,1),oe[34067]=he(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ve(2929),l.setFunc(KI),Ve(!1),lt(_5),ve(2884),Ie(as);function ve(me){d[me]!==!0&&(e.enable(me),d[me]=!0)}function xe(me){d[me]!==!1&&(e.disable(me),d[me]=!1)}function be(me,Ne){return f[me]!==Ne?(e.bindFramebuffer(me,Ne),f[me]=Ne,r&&(me===36009&&(f[36160]=Ne),me===36160&&(f[36009]=Ne)),!0):!1}function Me(me,Ne){let ue=v,et=!1;if(me)if(ue=m.get(Ne),ue===void 0&&(ue=[],m.set(Ne,ue)),me.isWebGLMultipleRenderTargets){let at=me.texture;if(ue.length!==at.length||ue[0]!==36064){for(let Ze=0,bt=at.length;Ze<bt;Ze++)ue[Ze]=36064+Ze;ue.length=at.length,et=!0}}else ue[0]!==36064&&(ue[0]=36064,et=!0);else ue[0]!==1029&&(ue[0]=1029,et=!0);et&&(i.isWebGL2?e.drawBuffers(ue):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(ue))}function Te(me){return g!==me?(e.useProgram(me),g=me,!0):!1}let ae={[uy]:32774,[Ofe]:32778,[zfe]:32779};if(r)ae[E5]=32775,ae[T5]=32776;else{let me=t.get("EXT_blend_minmax");me!==null&&(ae[E5]=me.MIN_EXT,ae[T5]=me.MAX_EXT)}let Ce={[Bfe]:0,[Nfe]:1,[Ufe]:768,[tq]:770,[jfe]:776,[Hfe]:774,[kfe]:772,[Ffe]:769,[iq]:771,[Gfe]:775,[Vfe]:773};function Ie(me,Ne,ue,et,at,Ze,bt,Ft){if(me===as){x===!0&&(xe(3042),x=!1);return}if(x===!1&&(ve(3042),x=!0),me!==Lfe){if(me!==S||Ft!==C){if((_!==uy||E!==uy)&&(e.blendEquation(32774),_=uy,E=uy),Ft)switch(me){case Dg:e.blendFuncSeparate(1,771,1,771);break;case S5:e.blendFunc(1,1);break;case M5:e.blendFuncSeparate(0,769,0,1);break;case A5:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",me);break}else switch(me){case Dg:e.blendFuncSeparate(770,771,1,771);break;case S5:e.blendFunc(770,1);break;case M5:e.blendFuncSeparate(0,769,0,1);break;case A5:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",me);break}A=null,T=null,I=null,P=null,S=me,C=Ft}return}at=at||Ne,Ze=Ze||ue,bt=bt||et,(Ne!==_||at!==E)&&(e.blendEquationSeparate(ae[Ne],ae[at]),_=Ne,E=at),(ue!==A||et!==T||Ze!==I||bt!==P)&&(e.blendFuncSeparate(Ce[ue],Ce[et],Ce[Ze],Ce[bt]),A=ue,T=et,I=Ze,P=bt),S=me,C=!1}function Be(me,Ne){me.side===Oa?xe(2884):ve(2884);let ue=me.side===Ws;Ne&&(ue=!ue),Ve(ue),me.blending===Dg&&me.transparent===!1?Ie(as):Ie(me.blending,me.blendEquation,me.blendSrc,me.blendDst,me.blendEquationAlpha,me.blendSrcAlpha,me.blendDstAlpha,me.premultipliedAlpha),l.setFunc(me.depthFunc),l.setTest(me.depthTest),l.setMask(me.depthWrite),o.setMask(me.colorWrite);let et=me.stencilWrite;c.setTest(et),et&&(c.setMask(me.stencilWriteMask),c.setFunc(me.stencilFunc,me.stencilRef,me.stencilFuncMask),c.setOp(me.stencilFail,me.stencilZFail,me.stencilZPass)),je(me.polygonOffset,me.polygonOffsetFactor,me.polygonOffsetUnits),me.alphaToCoverage===!0?ve(32926):xe(32926)}function Ve(me){L!==me&&(me?e.frontFace(2304):e.frontFace(2305),L=me)}function lt(me){me!==Dfe?(ve(2884),me!==z&&(me===_5?e.cullFace(1029):me===Rfe?e.cullFace(1028):e.cullFace(1032))):xe(2884),z=me}function We(me){me!==F&&(ie&&e.lineWidth(me),F=me)}function je(me,Ne,ue){me?(ve(32823),(G!==Ne||N!==ue)&&(e.polygonOffset(Ne,ue),G=Ne,N=ue)):xe(32823)}function xt(me){me?ve(3089):xe(3089)}function Mt(me){me===void 0&&(me=33984+q-1),ee!==me&&(e.activeTexture(me),ee=me)}function de(me,Ne,ue){ue===void 0&&(ee===null?ue=33984+q-1:ue=ee);let et=K[ue];et===void 0&&(et={type:void 0,texture:void 0},K[ue]=et),(et.type!==me||et.texture!==Ne)&&(ee!==ue&&(e.activeTexture(ue),ee=ue),e.bindTexture(me,Ne||oe[me]),et.type=me,et.texture=Ne)}function V(){let me=K[ee];me!==void 0&&me.type!==void 0&&(e.bindTexture(me.type,null),me.type=void 0,me.texture=void 0)}function X(){try{e.compressedTexImage2D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function we(){try{e.compressedTexImage3D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function J(){try{e.texSubImage2D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function Le(){try{e.texSubImage3D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function qe(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function ct(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function Pe(){try{e.texStorage2D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function nt(){try{e.texStorage3D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function gt(){try{e.texImage2D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function Tt(){try{e.texImage3D.apply(e,arguments)}catch(me){console.error("THREE.WebGLState:",me)}}function rt(me){se.equals(me)===!1&&(e.scissor(me.x,me.y,me.z,me.w),se.copy(me))}function Dt(me){re.equals(me)===!1&&(e.viewport(me.x,me.y,me.z,me.w),re.copy(me))}function ge(me,Ne){let ue=h.get(Ne);ue===void 0&&(ue=new WeakMap,h.set(Ne,ue));let et=ue.get(me);et===void 0&&(et=e.getUniformBlockIndex(Ne,me.name),ue.set(me,et))}function $e(me,Ne){let ue=h.get(Ne).get(me);u.get(Ne)!==ue&&(e.uniformBlockBinding(Ne,ue,me.__bindingPointIndex),u.set(Ne,ue))}function mt(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},ee=null,K={},f={},m=new WeakMap,v=[],g=null,x=!1,S=null,_=null,A=null,T=null,E=null,I=null,P=null,C=!1,L=null,z=null,F=null,G=null,N=null,se.set(0,0,e.canvas.width,e.canvas.height),re.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:ve,disable:xe,bindFramebuffer:be,drawBuffers:Me,useProgram:Te,setBlending:Ie,setMaterial:Be,setFlipSided:Ve,setCullFace:lt,setLineWidth:We,setPolygonOffset:je,setScissorTest:xt,activeTexture:Mt,bindTexture:de,unbindTexture:V,compressedTexImage2D:X,compressedTexImage3D:we,texImage2D:gt,texImage3D:Tt,updateUBOMapping:ge,uniformBlockBinding:$e,texStorage2D:Pe,texStorage3D:nt,texSubImage2D:J,texSubImage3D:Le,compressedTexSubImage2D:qe,compressedTexSubImage3D:ct,scissor:rt,viewport:Dt,reset:mt}}function Aye(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,v,g=new WeakMap,x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(de,V){return x?new OffscreenCanvas(de,V):Yb("canvas")}function _(de,V,X,we){let J=1;if((de.width>we||de.height>we)&&(J=we/Math.max(de.width,de.height)),J<1||V===!0)if(typeof HTMLImageElement<"u"&&de instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&de instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&de instanceof ImageBitmap){let Le=V?uT:Math.floor,qe=Le(J*de.width),ct=Le(J*de.height);v===void 0&&(v=S(qe,ct));let Pe=X?S(qe,ct):v;return Pe.width=qe,Pe.height=ct,Pe.getContext("2d").drawImage(de,0,0,qe,ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+de.width+"x"+de.height+") to ("+qe+"x"+ct+")."),Pe}else return"data"in de&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+de.width+"x"+de.height+")."),de;return de}function A(de){return nL(de.width)&&nL(de.height)}function T(de){return o?!1:de.wrapS!==sn||de.wrapT!==sn||de.minFilter!==qi&&de.minFilter!==Fi}function E(de,V){return de.generateMipmaps&&V&&de.minFilter!==qi&&de.minFilter!==Fi}function I(de){e.generateMipmap(de)}function P(de,V,X,we,J=!1){if(o===!1)return V;if(de!==null){if(e[de]!==void 0)return e[de];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+de+"'")}let Le=V;return V===6403&&(X===5126&&(Le=33326),X===5131&&(Le=33325),X===5121&&(Le=33321)),V===33319&&(X===5126&&(Le=33328),X===5131&&(Le=33327),X===5121&&(Le=33323)),V===6408&&(X===5126&&(Le=34836),X===5131&&(Le=34842),X===5121&&(Le=we===Bi&&J===!1?35907:32856),X===32819&&(Le=32854),X===32820&&(Le=32855)),(Le===33325||Le===33326||Le===33327||Le===33328||Le===34842||Le===34836)&&t.get("EXT_color_buffer_float"),Le}function C(de,V,X){return E(de,X)===!0||de.isFramebufferTexture&&de.minFilter!==qi&&de.minFilter!==Fi?Math.log2(Math.max(V.width,V.height))+1:de.mipmaps!==void 0&&de.mipmaps.length>0?de.mipmaps.length:de.isCompressedTexture&&Array.isArray(de.image)?V.mipmaps.length:1}function L(de){return de===qi||de===C5||de===_D?9728:9729}function z(de){let V=de.target;V.removeEventListener("dispose",z),G(V),V.isVideoTexture&&m.delete(V)}function F(de){let V=de.target;V.removeEventListener("dispose",F),q(V)}function G(de){let V=r.get(de);if(V.__webglInit===void 0)return;let X=de.source,we=g.get(X);if(we){let J=we[V.__cacheKey];J.usedTimes--,J.usedTimes===0&&N(de),Object.keys(we).length===0&&g.delete(X)}r.remove(de)}function N(de){let V=r.get(de);e.deleteTexture(V.__webglTexture);let X=de.source,we=g.get(X);delete we[V.__cacheKey],a.memory.textures--}function q(de){let V=de.texture,X=r.get(de),we=r.get(V);if(we.__webglTexture!==void 0&&(e.deleteTexture(we.__webglTexture),a.memory.textures--),de.depthTexture&&de.depthTexture.dispose(),de.isWebGLCubeRenderTarget)for(let J=0;J<6;J++)e.deleteFramebuffer(X.__webglFramebuffer[J]),X.__webglDepthbuffer&&e.deleteRenderbuffer(X.__webglDepthbuffer[J]);else{if(e.deleteFramebuffer(X.__webglFramebuffer),X.__webglDepthbuffer&&e.deleteRenderbuffer(X.__webglDepthbuffer),X.__webglMultisampledFramebuffer&&e.deleteFramebuffer(X.__webglMultisampledFramebuffer),X.__webglColorRenderbuffer)for(let J=0;J<X.__webglColorRenderbuffer.length;J++)X.__webglColorRenderbuffer[J]&&e.deleteRenderbuffer(X.__webglColorRenderbuffer[J]);X.__webglDepthRenderbuffer&&e.deleteRenderbuffer(X.__webglDepthRenderbuffer)}if(de.isWebGLMultipleRenderTargets)for(let J=0,Le=V.length;J<Le;J++){let qe=r.get(V[J]);qe.__webglTexture&&(e.deleteTexture(qe.__webglTexture),a.memory.textures--),r.remove(V[J])}r.remove(V),r.remove(de)}let ie=0;function Q(){ie=0}function W(){let de=ie;return de>=l&&console.warn("THREE.WebGLTextures: Trying to use "+de+" texture units while this GPU supports only "+l),ie+=1,de}function ee(de){let V=[];return V.push(de.wrapS),V.push(de.wrapT),V.push(de.wrapR||0),V.push(de.magFilter),V.push(de.minFilter),V.push(de.anisotropy),V.push(de.internalFormat),V.push(de.format),V.push(de.type),V.push(de.generateMipmaps),V.push(de.premultiplyAlpha),V.push(de.flipY),V.push(de.unpackAlignment),V.push(de.encoding),V.join()}function K(de,V){let X=r.get(de);if(de.isVideoTexture&&xt(de),de.isRenderTargetTexture===!1&&de.version>0&&X.__version!==de.version){let we=de.image;if(we===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(we.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{xe(X,de,V);return}}i.bindTexture(3553,X.__webglTexture,33984+V)}function j(de,V){let X=r.get(de);if(de.version>0&&X.__version!==de.version){xe(X,de,V);return}i.bindTexture(35866,X.__webglTexture,33984+V)}function $(de,V){let X=r.get(de);if(de.version>0&&X.__version!==de.version){xe(X,de,V);return}i.bindTexture(32879,X.__webglTexture,33984+V)}function se(de,V){let X=r.get(de);if(de.version>0&&X.__version!==de.version){be(X,de,V);return}i.bindTexture(34067,X.__webglTexture,33984+V)}let re={[yd]:10497,[sn]:33071,[eL]:33648},he={[qi]:9728,[C5]:9984,[_D]:9986,[Fi]:9729,[spe]:9985,[rx]:9987};function oe(de,V,X){if(X?(e.texParameteri(de,10242,re[V.wrapS]),e.texParameteri(de,10243,re[V.wrapT]),(de===32879||de===35866)&&e.texParameteri(de,32882,re[V.wrapR]),e.texParameteri(de,10240,he[V.magFilter]),e.texParameteri(de,10241,he[V.minFilter])):(e.texParameteri(de,10242,33071),e.texParameteri(de,10243,33071),(de===32879||de===35866)&&e.texParameteri(de,32882,33071),(V.wrapS!==sn||V.wrapT!==sn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(de,10240,L(V.magFilter)),e.texParameteri(de,10241,L(V.minFilter)),V.minFilter!==qi&&V.minFilter!==Fi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let we=t.get("EXT_texture_filter_anisotropic");if(V.magFilter===qi||V.minFilter!==_D&&V.minFilter!==rx||V.type===Cr&&t.has("OES_texture_float_linear")===!1||o===!1&&V.type===Id&&t.has("OES_texture_half_float_linear")===!1)return;(V.anisotropy>1||r.get(V).__currentAnisotropy)&&(e.texParameterf(de,we.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,n.getMaxAnisotropy())),r.get(V).__currentAnisotropy=V.anisotropy)}}function ve(de,V){let X=!1;de.__webglInit===void 0&&(de.__webglInit=!0,V.addEventListener("dispose",z));let we=V.source,J=g.get(we);J===void 0&&(J={},g.set(we,J));let Le=ee(V);if(Le!==de.__cacheKey){J[Le]===void 0&&(J[Le]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,X=!0),J[Le].usedTimes++;let qe=J[de.__cacheKey];qe!==void 0&&(J[de.__cacheKey].usedTimes--,qe.usedTimes===0&&N(V)),de.__cacheKey=Le,de.__webglTexture=J[Le].texture}return X}function xe(de,V,X){let we=3553;(V.isDataArrayTexture||V.isCompressedArrayTexture)&&(we=35866),V.isData3DTexture&&(we=32879);let J=ve(de,V),Le=V.source;i.bindTexture(we,de.__webglTexture,33984+X);let qe=r.get(Le);if(Le.version!==qe.__version||J===!0){i.activeTexture(33984+X),e.pixelStorei(37440,V.flipY),e.pixelStorei(37441,V.premultiplyAlpha),e.pixelStorei(3317,V.unpackAlignment),e.pixelStorei(37443,0);let ct=T(V)&&A(V.image)===!1,Pe=_(V.image,ct,!1,u);Pe=Mt(V,Pe);let nt=A(Pe)||o,gt=s.convert(V.format,V.encoding),Tt=s.convert(V.type),rt=P(V.internalFormat,gt,Tt,V.encoding,V.isVideoTexture);oe(we,V,nt);let Dt,ge=V.mipmaps,$e=o&&V.isVideoTexture!==!0,mt=qe.__version===void 0||J===!0,me=C(V,Pe,nt);if(V.isDepthTexture)rt=6402,o?V.type===Cr?rt=36012:V.type===xd?rt=33190:V.type===Rg?rt=35056:rt=33189:V.type===Cr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),V.format===Ig&&rt===6402&&V.type!==sq&&V.type!==xd&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),V.type=xd,Tt=s.convert(V.type)),V.format===jg&&rt===6402&&(rt=34041,V.type!==Rg&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),V.type=Rg,Tt=s.convert(V.type))),mt&&($e?i.texStorage2D(3553,1,rt,Pe.width,Pe.height):i.texImage2D(3553,0,rt,Pe.width,Pe.height,0,gt,Tt,null));else if(V.isDataTexture)if(ge.length>0&&nt){$e&&mt&&i.texStorage2D(3553,me,rt,ge[0].width,ge[0].height);for(let Ne=0,ue=ge.length;Ne<ue;Ne++)Dt=ge[Ne],$e?i.texSubImage2D(3553,Ne,0,0,Dt.width,Dt.height,gt,Tt,Dt.data):i.texImage2D(3553,Ne,rt,Dt.width,Dt.height,0,gt,Tt,Dt.data);V.generateMipmaps=!1}else $e?(mt&&i.texStorage2D(3553,me,rt,Pe.width,Pe.height),i.texSubImage2D(3553,0,0,0,Pe.width,Pe.height,gt,Tt,Pe.data)):i.texImage2D(3553,0,rt,Pe.width,Pe.height,0,gt,Tt,Pe.data);else if(V.isCompressedTexture)if(V.isCompressedArrayTexture){$e&&mt&&i.texStorage3D(35866,me,rt,ge[0].width,ge[0].height,Pe.depth);for(let Ne=0,ue=ge.length;Ne<ue;Ne++)Dt=ge[Ne],V.format!==hn?gt!==null?$e?i.compressedTexSubImage3D(35866,Ne,0,0,0,Dt.width,Dt.height,Pe.depth,gt,Dt.data,0,0):i.compressedTexImage3D(35866,Ne,rt,Dt.width,Dt.height,Pe.depth,0,Dt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):$e?i.texSubImage3D(35866,Ne,0,0,0,Dt.width,Dt.height,Pe.depth,gt,Tt,Dt.data):i.texImage3D(35866,Ne,rt,Dt.width,Dt.height,Pe.depth,0,gt,Tt,Dt.data)}else{$e&&mt&&i.texStorage2D(3553,me,rt,ge[0].width,ge[0].height);for(let Ne=0,ue=ge.length;Ne<ue;Ne++)Dt=ge[Ne],V.format!==hn?gt!==null?$e?i.compressedTexSubImage2D(3553,Ne,0,0,Dt.width,Dt.height,gt,Dt.data):i.compressedTexImage2D(3553,Ne,rt,Dt.width,Dt.height,0,Dt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):$e?i.texSubImage2D(3553,Ne,0,0,Dt.width,Dt.height,gt,Tt,Dt.data):i.texImage2D(3553,Ne,rt,Dt.width,Dt.height,0,gt,Tt,Dt.data)}else if(V.isDataArrayTexture)$e?(mt&&i.texStorage3D(35866,me,rt,Pe.width,Pe.height,Pe.depth),i.texSubImage3D(35866,0,0,0,0,Pe.width,Pe.height,Pe.depth,gt,Tt,Pe.data)):i.texImage3D(35866,0,rt,Pe.width,Pe.height,Pe.depth,0,gt,Tt,Pe.data);else if(V.isData3DTexture)$e?(mt&&i.texStorage3D(32879,me,rt,Pe.width,Pe.height,Pe.depth),i.texSubImage3D(32879,0,0,0,0,Pe.width,Pe.height,Pe.depth,gt,Tt,Pe.data)):i.texImage3D(32879,0,rt,Pe.width,Pe.height,Pe.depth,0,gt,Tt,Pe.data);else if(V.isFramebufferTexture){if(mt)if($e)i.texStorage2D(3553,me,rt,Pe.width,Pe.height);else{let Ne=Pe.width,ue=Pe.height;for(let et=0;et<me;et++)i.texImage2D(3553,et,rt,Ne,ue,0,gt,Tt,null),Ne>>=1,ue>>=1}}else if(ge.length>0&&nt){$e&&mt&&i.texStorage2D(3553,me,rt,ge[0].width,ge[0].height);for(let Ne=0,ue=ge.length;Ne<ue;Ne++)Dt=ge[Ne],$e?i.texSubImage2D(3553,Ne,0,0,gt,Tt,Dt):i.texImage2D(3553,Ne,rt,gt,Tt,Dt);V.generateMipmaps=!1}else $e?(mt&&i.texStorage2D(3553,me,rt,Pe.width,Pe.height),i.texSubImage2D(3553,0,0,0,gt,Tt,Pe)):i.texImage2D(3553,0,rt,gt,Tt,Pe);E(V,nt)&&I(we),qe.__version=Le.version,V.onUpdate&&V.onUpdate(V)}de.__version=V.version}function be(de,V,X){if(V.image.length!==6)return;let we=ve(de,V),J=V.source;i.bindTexture(34067,de.__webglTexture,33984+X);let Le=r.get(J);if(J.version!==Le.__version||we===!0){i.activeTexture(33984+X),e.pixelStorei(37440,V.flipY),e.pixelStorei(37441,V.premultiplyAlpha),e.pixelStorei(3317,V.unpackAlignment),e.pixelStorei(37443,0);let qe=V.isCompressedTexture||V.image[0].isCompressedTexture,ct=V.image[0]&&V.image[0].isDataTexture,Pe=[];for(let Ne=0;Ne<6;Ne++)!qe&&!ct?Pe[Ne]=_(V.image[Ne],!1,!0,c):Pe[Ne]=ct?V.image[Ne].image:V.image[Ne],Pe[Ne]=Mt(V,Pe[Ne]);let nt=Pe[0],gt=A(nt)||o,Tt=s.convert(V.format,V.encoding),rt=s.convert(V.type),Dt=P(V.internalFormat,Tt,rt,V.encoding),ge=o&&V.isVideoTexture!==!0,$e=Le.__version===void 0||we===!0,mt=C(V,nt,gt);oe(34067,V,gt);let me;if(qe){ge&&$e&&i.texStorage2D(34067,mt,Dt,nt.width,nt.height);for(let Ne=0;Ne<6;Ne++){me=Pe[Ne].mipmaps;for(let ue=0;ue<me.length;ue++){let et=me[ue];V.format!==hn?Tt!==null?ge?i.compressedTexSubImage2D(34069+Ne,ue,0,0,et.width,et.height,Tt,et.data):i.compressedTexImage2D(34069+Ne,ue,Dt,et.width,et.height,0,et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ge?i.texSubImage2D(34069+Ne,ue,0,0,et.width,et.height,Tt,rt,et.data):i.texImage2D(34069+Ne,ue,Dt,et.width,et.height,0,Tt,rt,et.data)}}}else{me=V.mipmaps,ge&&$e&&(me.length>0&&mt++,i.texStorage2D(34067,mt,Dt,Pe[0].width,Pe[0].height));for(let Ne=0;Ne<6;Ne++)if(ct){ge?i.texSubImage2D(34069+Ne,0,0,0,Pe[Ne].width,Pe[Ne].height,Tt,rt,Pe[Ne].data):i.texImage2D(34069+Ne,0,Dt,Pe[Ne].width,Pe[Ne].height,0,Tt,rt,Pe[Ne].data);for(let ue=0;ue<me.length;ue++){let et=me[ue].image[Ne].image;ge?i.texSubImage2D(34069+Ne,ue+1,0,0,et.width,et.height,Tt,rt,et.data):i.texImage2D(34069+Ne,ue+1,Dt,et.width,et.height,0,Tt,rt,et.data)}}else{ge?i.texSubImage2D(34069+Ne,0,0,0,Tt,rt,Pe[Ne]):i.texImage2D(34069+Ne,0,Dt,Tt,rt,Pe[Ne]);for(let ue=0;ue<me.length;ue++){let et=me[ue];ge?i.texSubImage2D(34069+Ne,ue+1,0,0,Tt,rt,et.image[Ne]):i.texImage2D(34069+Ne,ue+1,Dt,Tt,rt,et.image[Ne])}}}E(V,gt)&&I(34067),Le.__version=J.version,V.onUpdate&&V.onUpdate(V)}de.__version=V.version}function Me(de,V,X,we,J){let Le=s.convert(X.format,X.encoding),qe=s.convert(X.type),ct=P(X.internalFormat,Le,qe,X.encoding);r.get(V).__hasExternalTextures||(J===32879||J===35866?i.texImage3D(J,0,ct,V.width,V.height,V.depth,0,Le,qe,null):i.texImage2D(J,0,ct,V.width,V.height,0,Le,qe,null)),i.bindFramebuffer(36160,de),je(V)?d.framebufferTexture2DMultisampleEXT(36160,we,J,r.get(X).__webglTexture,0,We(V)):(J===3553||J>=34069&&J<=34074)&&e.framebufferTexture2D(36160,we,J,r.get(X).__webglTexture,0),i.bindFramebuffer(36160,null)}function Te(de,V,X){if(e.bindRenderbuffer(36161,de),V.depthBuffer&&!V.stencilBuffer){let we=33189;if(X||je(V)){let J=V.depthTexture;J&&J.isDepthTexture&&(J.type===Cr?we=36012:J.type===xd&&(we=33190));let Le=We(V);je(V)?d.renderbufferStorageMultisampleEXT(36161,Le,we,V.width,V.height):e.renderbufferStorageMultisample(36161,Le,we,V.width,V.height)}else e.renderbufferStorage(36161,we,V.width,V.height);e.framebufferRenderbuffer(36160,36096,36161,de)}else if(V.depthBuffer&&V.stencilBuffer){let we=We(V);X&&je(V)===!1?e.renderbufferStorageMultisample(36161,we,35056,V.width,V.height):je(V)?d.renderbufferStorageMultisampleEXT(36161,we,35056,V.width,V.height):e.renderbufferStorage(36161,34041,V.width,V.height),e.framebufferRenderbuffer(36160,33306,36161,de)}else{let we=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let J=0;J<we.length;J++){let Le=we[J],qe=s.convert(Le.format,Le.encoding),ct=s.convert(Le.type),Pe=P(Le.internalFormat,qe,ct,Le.encoding),nt=We(V);X&&je(V)===!1?e.renderbufferStorageMultisample(36161,nt,Pe,V.width,V.height):je(V)?d.renderbufferStorageMultisampleEXT(36161,nt,Pe,V.width,V.height):e.renderbufferStorage(36161,Pe,V.width,V.height)}}e.bindRenderbuffer(36161,null)}function ae(de,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,de),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(V.depthTexture).__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),K(V.depthTexture,0);let X=r.get(V.depthTexture).__webglTexture,we=We(V);if(V.depthTexture.format===Ig)je(V)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,X,0,we):e.framebufferTexture2D(36160,36096,3553,X,0);else if(V.depthTexture.format===jg)je(V)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,X,0,we):e.framebufferTexture2D(36160,33306,3553,X,0);else throw new Error("Unknown depthTexture format")}function Ce(de){let V=r.get(de),X=de.isWebGLCubeRenderTarget===!0;if(de.depthTexture&&!V.__autoAllocateDepthBuffer){if(X)throw new Error("target.depthTexture not supported in Cube render targets");ae(V.__webglFramebuffer,de)}else if(X){V.__webglDepthbuffer=[];for(let we=0;we<6;we++)i.bindFramebuffer(36160,V.__webglFramebuffer[we]),V.__webglDepthbuffer[we]=e.createRenderbuffer(),Te(V.__webglDepthbuffer[we],de,!1)}else i.bindFramebuffer(36160,V.__webglFramebuffer),V.__webglDepthbuffer=e.createRenderbuffer(),Te(V.__webglDepthbuffer,de,!1);i.bindFramebuffer(36160,null)}function Ie(de,V,X){let we=r.get(de);V!==void 0&&Me(we.__webglFramebuffer,de,de.texture,36064,3553),X!==void 0&&Ce(de)}function Be(de){let V=de.texture,X=r.get(de),we=r.get(V);de.addEventListener("dispose",F),de.isWebGLMultipleRenderTargets!==!0&&(we.__webglTexture===void 0&&(we.__webglTexture=e.createTexture()),we.__version=V.version,a.memory.textures++);let J=de.isWebGLCubeRenderTarget===!0,Le=de.isWebGLMultipleRenderTargets===!0,qe=A(de)||o;if(J){X.__webglFramebuffer=[];for(let ct=0;ct<6;ct++)X.__webglFramebuffer[ct]=e.createFramebuffer()}else{if(X.__webglFramebuffer=e.createFramebuffer(),Le)if(n.drawBuffers){let ct=de.texture;for(let Pe=0,nt=ct.length;Pe<nt;Pe++){let gt=r.get(ct[Pe]);gt.__webglTexture===void 0&&(gt.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&de.samples>0&&je(de)===!1){let ct=Le?V:[V];X.__webglMultisampledFramebuffer=e.createFramebuffer(),X.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,X.__webglMultisampledFramebuffer);for(let Pe=0;Pe<ct.length;Pe++){let nt=ct[Pe];X.__webglColorRenderbuffer[Pe]=e.createRenderbuffer(),e.bindRenderbuffer(36161,X.__webglColorRenderbuffer[Pe]);let gt=s.convert(nt.format,nt.encoding),Tt=s.convert(nt.type),rt=P(nt.internalFormat,gt,Tt,nt.encoding,de.isXRRenderTarget===!0),Dt=We(de);e.renderbufferStorageMultisample(36161,Dt,rt,de.width,de.height),e.framebufferRenderbuffer(36160,36064+Pe,36161,X.__webglColorRenderbuffer[Pe])}e.bindRenderbuffer(36161,null),de.depthBuffer&&(X.__webglDepthRenderbuffer=e.createRenderbuffer(),Te(X.__webglDepthRenderbuffer,de,!0)),i.bindFramebuffer(36160,null)}}if(J){i.bindTexture(34067,we.__webglTexture),oe(34067,V,qe);for(let ct=0;ct<6;ct++)Me(X.__webglFramebuffer[ct],de,V,36064,34069+ct);E(V,qe)&&I(34067),i.unbindTexture()}else if(Le){let ct=de.texture;for(let Pe=0,nt=ct.length;Pe<nt;Pe++){let gt=ct[Pe],Tt=r.get(gt);i.bindTexture(3553,Tt.__webglTexture),oe(3553,gt,qe),Me(X.__webglFramebuffer,de,gt,36064+Pe,3553),E(gt,qe)&&I(3553)}i.unbindTexture()}else{let ct=3553;(de.isWebGL3DRenderTarget||de.isWebGLArrayRenderTarget)&&(o?ct=de.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(ct,we.__webglTexture),oe(ct,V,qe),Me(X.__webglFramebuffer,de,V,36064,ct),E(V,qe)&&I(ct),i.unbindTexture()}de.depthBuffer&&Ce(de)}function Ve(de){let V=A(de)||o,X=de.isWebGLMultipleRenderTargets===!0?de.texture:[de.texture];for(let we=0,J=X.length;we<J;we++){let Le=X[we];if(E(Le,V)){let qe=de.isWebGLCubeRenderTarget?34067:3553,ct=r.get(Le).__webglTexture;i.bindTexture(qe,ct),I(qe),i.unbindTexture()}}}function lt(de){if(o&&de.samples>0&&je(de)===!1){let V=de.isWebGLMultipleRenderTargets?de.texture:[de.texture],X=de.width,we=de.height,J=16384,Le=[],qe=de.stencilBuffer?33306:36096,ct=r.get(de),Pe=de.isWebGLMultipleRenderTargets===!0;if(Pe)for(let nt=0;nt<V.length;nt++)i.bindFramebuffer(36160,ct.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+nt,36161,null),i.bindFramebuffer(36160,ct.__webglFramebuffer),e.framebufferTexture2D(36009,36064+nt,3553,null,0);i.bindFramebuffer(36008,ct.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,ct.__webglFramebuffer);for(let nt=0;nt<V.length;nt++){Le.push(36064+nt),de.depthBuffer&&Le.push(qe);let gt=ct.__ignoreDepthValues!==void 0?ct.__ignoreDepthValues:!1;if(gt===!1&&(de.depthBuffer&&(J|=256),de.stencilBuffer&&(J|=1024)),Pe&&e.framebufferRenderbuffer(36008,36064,36161,ct.__webglColorRenderbuffer[nt]),gt===!0&&(e.invalidateFramebuffer(36008,[qe]),e.invalidateFramebuffer(36009,[qe])),Pe){let Tt=r.get(V[nt]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,Tt,0)}e.blitFramebuffer(0,0,X,we,0,0,X,we,J,9728),f&&e.invalidateFramebuffer(36008,Le)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Pe)for(let nt=0;nt<V.length;nt++){i.bindFramebuffer(36160,ct.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+nt,36161,ct.__webglColorRenderbuffer[nt]);let gt=r.get(V[nt]).__webglTexture;i.bindFramebuffer(36160,ct.__webglFramebuffer),e.framebufferTexture2D(36009,36064+nt,3553,gt,0)}i.bindFramebuffer(36009,ct.__webglMultisampledFramebuffer)}}function We(de){return Math.min(h,de.samples)}function je(de){let V=r.get(de);return o&&de.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&V.__useRenderToTexture!==!1}function xt(de){let V=a.render.frame;m.get(de)!==V&&(m.set(de,V),de.update())}function Mt(de,V){let X=de.encoding,we=de.format,J=de.type;return de.isCompressedTexture===!0||de.isVideoTexture===!0||de.format===rL||X!==Qc&&(X===Bi?o===!1?t.has("EXT_sRGB")===!0&&we===hn?(de.format=rL,de.minFilter=Fi,de.generateMipmaps=!1):V=fq.sRGBToLinear(V):(we!==hn||J!==Ua)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",X)),V}this.allocateTextureUnit=W,this.resetTextureUnits=Q,this.setTexture2D=K,this.setTexture2DArray=j,this.setTexture3D=$,this.setTextureCube=se,this.rebindTextures=Ie,this.setupRenderTarget=Be,this.updateRenderTargetMipmap=Ve,this.updateMultisampleRenderTarget=lt,this.setupDepthRenderbuffer=Ce,this.setupFrameBufferTexture=Me,this.useMultisampledRTT=je}function Eye(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Ua)return 5121;if(s===cpe)return 32819;if(s===upe)return 32820;if(s===ape)return 5120;if(s===ope)return 5122;if(s===sq)return 5123;if(s===lpe)return 5124;if(s===xd)return 5125;if(s===Cr)return 5126;if(s===Id)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===hpe)return 6406;if(s===hn)return 6408;if(s===dpe)return 6409;if(s===fpe)return 6410;if(s===Ig)return 6402;if(s===jg)return 34041;if(s===rL)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===ME)return 6403;if(s===ppe)return 36244;if(s===sT)return 33319;if(s===mpe)return 33320;if(s===aq)return 36249;if(s===SD||s===MD||s===AD||s===ED)if(a===Bi)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===SD)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===MD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===AD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===ED)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===SD)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===MD)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===AD)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===ED)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===P5||s===D5||s===R5||s===I5)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===P5)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===D5)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===R5)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===I5)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===gpe)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===L5||s===O5)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===L5)return a===Bi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===O5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===z5||s===B5||s===N5||s===U5||s===F5||s===k5||s===V5||s===H5||s===G5||s===j5||s===W5||s===X5||s===q5||s===Y5)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===z5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===B5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===N5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===U5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===F5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===k5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===V5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===H5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===G5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===j5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===W5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===X5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===q5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===Y5)return a===Bi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===TD)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===TD)return a===Bi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===vpe||s===Q5||s===Z5||s===K5)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===TD)return o.COMPRESSED_RED_RGTC1_EXT;if(s===Q5)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===Z5)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===K5)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Rg?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var Tye=class extends Ra{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},bd=class extends Mr{constructor(){super(),this.isGroup=!0,this.type="Group"}},Cye={type:"move"},$D=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new bd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new bd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new bd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let m of e.hand.values()){let v=t.getJointPose(m,i),g=this._getHandJoint(l,m);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=v.radius),g.visible=v!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,f=.005;l.inputState.pinching&&h>d+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Cye)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new bd;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},sx=class extends wn{constructor(e,t,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:Ig,c!==Ig&&c!==jg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Ig&&(i=xd),i===void 0&&c===jg&&(i=Rg),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:qi,this.minFilter=o!==void 0?o:qi,this.flipY=!1,this.generateMipmaps=!1}},Pye=class extends va{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,f=null,m=t.getContextAttributes(),v=null,g=null,x=[],S=[],_=new Set,A=new Map,T=new Ra;T.layers.enable(1),T.viewport=new Ti;let E=new Ra;E.layers.enable(2),E.viewport=new Ti;let I=[T,E],P=new Tye;P.layers.enable(1),P.layers.enable(2);let C=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let $=x[j];return $===void 0&&($=new $D,x[j]=$),$.getTargetRaySpace()},this.getControllerGrip=function(j){let $=x[j];return $===void 0&&($=new $D,x[j]=$),$.getGripSpace()},this.getHand=function(j){let $=x[j];return $===void 0&&($=new $D,x[j]=$),$.getHandSpace()};function z(j){let $=S.indexOf(j.inputSource);if($===-1)return;let se=x[$];se!==void 0&&se.dispatchEvent({type:j.type,data:j.inputSource})}function F(){r.removeEventListener("select",z),r.removeEventListener("selectstart",z),r.removeEventListener("selectend",z),r.removeEventListener("squeeze",z),r.removeEventListener("squeezestart",z),r.removeEventListener("squeezeend",z),r.removeEventListener("end",F),r.removeEventListener("inputsourceschange",G);for(let j=0;j<x.length;j++){let $=S[j];$!==null&&(S[j]=null,x[j].disconnect($))}C=null,L=null,e.setRenderTarget(v),d=null,h=null,u=null,r=null,g=null,K.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){n=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(j){l=j},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(j){if(r=j,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",z),r.addEventListener("selectstart",z),r.addEventListener("selectend",z),r.addEventListener("squeeze",z),r.addEventListener("squeezestart",z),r.addEventListener("squeezeend",z),r.addEventListener("end",F),r.addEventListener("inputsourceschange",G),m.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let $={antialias:r.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,$),r.updateRenderState({baseLayer:d}),g=new rr(d.framebufferWidth,d.framebufferHeight,{format:hn,type:Ua,encoding:e.outputEncoding,stencilBuffer:m.stencil})}else{let $=null,se=null,re=null;m.depth&&(re=m.stencil?35056:33190,$=m.stencil?jg:Ig,se=m.stencil?Rg:xd);let he={colorFormat:32856,depthFormat:re,scaleFactor:n};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(he),r.updateRenderState({layers:[h]}),g=new rr(h.textureWidth,h.textureHeight,{format:hn,type:Ua,depthTexture:new sx(h.textureWidth,h.textureHeight,se,void 0,void 0,void 0,void 0,void 0,void 0,$),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0});let oe=e.properties.get(g);oe.__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),K.setContext(r),K.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function G(j){for(let $=0;$<j.removed.length;$++){let se=j.removed[$],re=S.indexOf(se);re>=0&&(S[re]=null,x[re].disconnect(se))}for(let $=0;$<j.added.length;$++){let se=j.added[$],re=S.indexOf(se);if(re===-1){for(let oe=0;oe<x.length;oe++)if(oe>=S.length){S.push(se),re=oe;break}else if(S[oe]===null){S[oe]=se,re=oe;break}if(re===-1)break}let he=x[re];he&&he.connect(se)}}let N=new k,q=new k;function ie(j,$,se){N.setFromMatrixPosition($.matrixWorld),q.setFromMatrixPosition(se.matrixWorld);let re=N.distanceTo(q),he=$.projectionMatrix.elements,oe=se.projectionMatrix.elements,ve=he[14]/(he[10]-1),xe=he[14]/(he[10]+1),be=(he[9]+1)/he[5],Me=(he[9]-1)/he[5],Te=(he[8]-1)/he[0],ae=(oe[8]+1)/oe[0],Ce=ve*Te,Ie=ve*ae,Be=re/(-Te+ae),Ve=Be*-Te;$.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(Ve),j.translateZ(Be),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();let lt=ve+Be,We=xe+Be,je=Ce-Ve,xt=Ie+(re-Ve),Mt=be*xe/We*lt,de=Me*xe/We*lt;j.projectionMatrix.makePerspective(je,xt,Mt,de,lt,We)}function Q(j,$){$===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices($.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(r===null)return;P.near=E.near=T.near=j.near,P.far=E.far=T.far=j.far,(C!==P.near||L!==P.far)&&(r.updateRenderState({depthNear:P.near,depthFar:P.far}),C=P.near,L=P.far);let $=j.parent,se=P.cameras;Q(P,$);for(let he=0;he<se.length;he++)Q(se[he],$);P.matrixWorld.decompose(P.position,P.quaternion,P.scale),j.matrix.copy(P.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale);let re=j.children;for(let he=0,oe=re.length;he<oe;he++)re[he].updateMatrixWorld(!0);se.length===2?ie(P,T,E):P.projectionMatrix.copy(T.projectionMatrix)},this.getCamera=function(){return P},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(j){o=j,h!==null&&(h.fixedFoveation=j),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=j)},this.getPlanes=function(){return _};let W=null;function ee(j,$){if(c=$.getViewerPose(l||s),f=$,c!==null){let se=c.views;d!==null&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let re=!1;se.length!==P.cameras.length&&(P.cameras.length=0,re=!0);for(let he=0;he<se.length;he++){let oe=se[he],ve=null;if(d!==null)ve=d.getViewport(oe);else{let be=u.getViewSubImage(h,oe);ve=be.viewport,he===0&&(e.setRenderTargetTextures(g,be.colorTexture,h.ignoreDepthValues?void 0:be.depthStencilTexture),e.setRenderTarget(g))}let xe=I[he];xe===void 0&&(xe=new Ra,xe.layers.enable(he),xe.viewport=new Ti,I[he]=xe),xe.matrix.fromArray(oe.transform.matrix),xe.projectionMatrix.fromArray(oe.projectionMatrix),xe.viewport.set(ve.x,ve.y,ve.width,ve.height),he===0&&P.matrix.copy(xe.matrix),re===!0&&P.cameras.push(xe)}}for(let se=0;se<x.length;se++){let re=S[se],he=x[se];re!==null&&he!==void 0&&he.update(re,$,l||s)}if(W&&W(j,$),$.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:$.detectedPlanes});let se=null;for(let re of _)$.detectedPlanes.has(re)||(se===null&&(se=[]),se.push(re));if(se!==null)for(let re of se)_.delete(re),A.delete(re),i.dispatchEvent({type:"planeremoved",data:re});for(let re of $.detectedPlanes)if(!_.has(re))_.add(re),A.set(re,$.lastChangedTime),i.dispatchEvent({type:"planeadded",data:re});else{let he=A.get(re);re.lastChangedTime>he&&(A.set(re,re.lastChangedTime),i.dispatchEvent({type:"planechanged",data:re}))}}f=null}let K=new xq;K.setAnimationLoop(ee),this.setAnimationLoop=function(j){W=j},this.dispose=function(){}}};function Dye(e,t){function i(v,g){g.color.getRGB(v.fogColor.value,yq(e)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,x,S,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(v,g):g.isMeshToonMaterial?(n(v,g),u(v,g)):g.isMeshPhongMaterial?(n(v,g),c(v,g)):g.isMeshStandardMaterial?(n(v,g),h(v,g),g.isMeshPhysicalMaterial&&d(v,g,_)):g.isMeshMatcapMaterial?(n(v,g),f(v,g)):g.isMeshDepthMaterial?n(v,g):g.isMeshDistanceMaterial?(n(v,g),m(v,g)):g.isMeshNormalMaterial?n(v,g):g.isLineBasicMaterial?(s(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?o(v,g,x,S):g.isSpriteMaterial?l(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.bumpMap&&(v.bumpMap.value=g.bumpMap,v.bumpScale.value=g.bumpScale,g.side===Ws&&(v.bumpScale.value*=-1)),g.displacementMap&&(v.displacementMap.value=g.displacementMap,v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap),g.normalMap&&(v.normalMap.value=g.normalMap,v.normalScale.value.copy(g.normalScale),g.side===Ws&&v.normalScale.value.negate()),g.specularMap&&(v.specularMap.value=g.specularMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let x=t.get(g).envMap;if(x&&(v.envMap.value=x,v.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;let A=e.physicallyCorrectLights!==!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*A}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity);let S;g.map?S=g.map:g.specularMap?S=g.specularMap:g.displacementMap?S=g.displacementMap:g.normalMap?S=g.normalMap:g.bumpMap?S=g.bumpMap:g.roughnessMap?S=g.roughnessMap:g.metalnessMap?S=g.metalnessMap:g.alphaMap?S=g.alphaMap:g.emissiveMap?S=g.emissiveMap:g.clearcoatMap?S=g.clearcoatMap:g.clearcoatNormalMap?S=g.clearcoatNormalMap:g.clearcoatRoughnessMap?S=g.clearcoatRoughnessMap:g.iridescenceMap?S=g.iridescenceMap:g.iridescenceThicknessMap?S=g.iridescenceThicknessMap:g.specularIntensityMap?S=g.specularIntensityMap:g.specularColorMap?S=g.specularColorMap:g.transmissionMap?S=g.transmissionMap:g.thicknessMap?S=g.thicknessMap:g.sheenColorMap?S=g.sheenColorMap:g.sheenRoughnessMap&&(S=g.sheenRoughnessMap),S!==void 0&&(S.isWebGLRenderTarget&&(S=S.texture),S.matrixAutoUpdate===!0&&S.updateMatrix(),v.uvTransform.value.copy(S.matrix));let _;g.aoMap?_=g.aoMap:g.lightMap&&(_=g.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uv2Transform.value.copy(_.matrix))}function s(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function o(v,g,x,S){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*x,v.scale.value=S*.5,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let _;g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),v.uvTransform.value.copy(_.matrix))}function l(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map),g.alphaMap&&(v.alphaMap.value=g.alphaMap),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uvTransform.value.copy(x.matrix))}function c(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function u(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function h(v,g){v.roughness.value=g.roughness,v.metalness.value=g.metalness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function d(v,g,x){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),v.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Ws&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=x.texture,v.transmissionSamplerSize.value.set(x.width,x.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap)}function f(v,g){g.matcap&&(v.matcap.value=g.matcap)}function m(v,g){v.referencePosition.value.copy(g.referencePosition),v.nearDistance.value=g.nearDistance,v.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function Rye(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(S,_){let A=_.program;r.uniformBlockBinding(S,A)}function c(S,_){let A=n[S.id];A===void 0&&(m(S),A=u(S),n[S.id]=A,S.addEventListener("dispose",g));let T=_.program;r.updateUBOMapping(S,T);let E=t.render.frame;s[S.id]!==E&&(d(S),s[S.id]=E)}function u(S){let _=h();S.__bindingPointIndex=_;let A=e.createBuffer(),T=S.__size,E=S.usage;return e.bindBuffer(35345,A),e.bufferData(35345,T,E),e.bindBuffer(35345,null),e.bindBufferBase(35345,_,A),A}function h(){for(let S=0;S<o;S++)if(a.indexOf(S)===-1)return a.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(S){let _=n[S.id],A=S.uniforms,T=S.__cache;e.bindBuffer(35345,_);for(let E=0,I=A.length;E<I;E++){let P=A[E];if(f(P,E,T)===!0){let C=P.__offset,L=Array.isArray(P.value)?P.value:[P.value],z=0;for(let F=0;F<L.length;F++){let G=L[F],N=v(G);typeof G=="number"?(P.__data[0]=G,e.bufferSubData(35345,C+z,P.__data)):G.isMatrix3?(P.__data[0]=G.elements[0],P.__data[1]=G.elements[1],P.__data[2]=G.elements[2],P.__data[3]=G.elements[0],P.__data[4]=G.elements[3],P.__data[5]=G.elements[4],P.__data[6]=G.elements[5],P.__data[7]=G.elements[0],P.__data[8]=G.elements[6],P.__data[9]=G.elements[7],P.__data[10]=G.elements[8],P.__data[11]=G.elements[0]):(G.toArray(P.__data,z),z+=N.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,C,P.__data)}}e.bindBuffer(35345,null)}function f(S,_,A){let T=S.value;if(A[_]===void 0){if(typeof T=="number")A[_]=T;else{let E=Array.isArray(T)?T:[T],I=[];for(let P=0;P<E.length;P++)I.push(E[P].clone());A[_]=I}return!0}else if(typeof T=="number"){if(A[_]!==T)return A[_]=T,!0}else{let E=Array.isArray(A[_])?A[_]:[A[_]],I=Array.isArray(T)?T:[T];for(let P=0;P<E.length;P++){let C=E[P];if(C.equals(I[P])===!1)return C.copy(I[P]),!0}}return!1}function m(S){let _=S.uniforms,A=0,T=16,E=0;for(let I=0,P=_.length;I<P;I++){let C=_[I],L={boundary:0,storage:0},z=Array.isArray(C.value)?C.value:[C.value];for(let F=0,G=z.length;F<G;F++){let N=z[F],q=v(N);L.boundary+=q.boundary,L.storage+=q.storage}if(C.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),C.__offset=A,I>0){E=A%T;let F=T-E;E!==0&&F-L.boundary<0&&(A+=T-E,C.__offset=A)}A+=L.storage}return E=A%T,E>0&&(A+=T-E),S.__size=A,S.__cache={},this}function v(S){let _={boundary:0,storage:0};return typeof S=="number"?(_.boundary=4,_.storage=4):S.isVector2?(_.boundary=8,_.storage=8):S.isVector3||S.isColor?(_.boundary=16,_.storage=12):S.isVector4?(_.boundary=16,_.storage=16):S.isMatrix3?(_.boundary=48,_.storage=48):S.isMatrix4?(_.boundary=64,_.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),_}function g(S){let _=S.target;_.removeEventListener("dispose",g);let A=a.indexOf(_.__bindingPointIndex);a.splice(A,1),e.deleteBuffer(n[_.id]),delete n[_.id],delete s[_.id]}function x(){for(let S in n)e.deleteBuffer(n[S]);a=[],n={},s={}}return{bind:l,update:c,dispose:x}}function Iye(){let e=Yb("canvas");return e.style.display="block",e}function Aq(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:Iye(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,f=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Qc,this.physicallyCorrectLights=!1,this.toneMapping=Wu,this.toneMappingExposure=1;let v=this,g=!1,x=0,S=0,_=null,A=-1,T=null,E=new Ti,I=new Ti,P=null,C=t.width,L=t.height,z=1,F=null,G=null,N=new Ti(0,0,C,L),q=new Ti(0,0,C,L),ie=!1,Q=new IB,W=!1,ee=!1,K=null,j=new St,$=new Ee,se=new k,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function he(){return _===null?z:1}let oe=i;function ve(fe,Ye){for(let ut=0;ut<fe.length;ut++){let Xe=fe[ut],ft=t.getContext(Xe,Ye);if(ft!==null)return ft}return null}try{let fe={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Sx}`),t.addEventListener("webglcontextlost",rt,!1),t.addEventListener("webglcontextrestored",Dt,!1),t.addEventListener("webglcontextcreationerror",ge,!1),oe===null){let Ye=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&Ye.shift(),oe=ve(Ye,fe),oe===null)throw ve(Ye)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}oe.getShaderPrecisionFormat===void 0&&(oe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(fe){throw console.error("THREE.WebGLRenderer: "+fe.message),fe}let xe,be,Me,Te,ae,Ce,Ie,Be,Ve,lt,We,je,xt,Mt,de,V,X,we,J,Le,qe,ct,Pe,nt;function gt(){xe=new Wve(oe),be=new Fve(oe,xe,e),xe.init(be),ct=new Eye(oe,xe,be),Me=new Mye(oe,xe,be),Te=new Yve,ae=new hye,Ce=new Aye(oe,xe,Me,ae,be,ct,Te),Ie=new Vve(v),Be=new jve(v),Ve=new rme(oe,be),Pe=new Nve(oe,xe,Ve,be),lt=new Xve(oe,Ve,Te,Pe),We=new Jve(oe,lt,Ve,Te),J=new Kve(oe,be,Ce),V=new kve(ae),je=new uye(v,Ie,Be,xe,be,Pe,V),xt=new Dye(v,ae),Mt=new fye,de=new xye(xe,be),we=new Bve(v,Ie,Be,Me,We,u,a),X=new Sye(v,We,be),nt=new Rye(oe,Te,be,Me),Le=new Uve(oe,xe,Te,be),qe=new qve(oe,xe,Te,be),Te.programs=je.programs,v.capabilities=be,v.extensions=xe,v.properties=ae,v.renderLists=Mt,v.shadowMap=X,v.state=Me,v.info=Te}gt();let Tt=new Pye(v,oe);this.xr=Tt,this.getContext=function(){return oe},this.getContextAttributes=function(){return oe.getContextAttributes()},this.forceContextLoss=function(){let fe=xe.get("WEBGL_lose_context");fe&&fe.loseContext()},this.forceContextRestore=function(){let fe=xe.get("WEBGL_lose_context");fe&&fe.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(fe){fe!==void 0&&(z=fe,this.setSize(C,L,!1))},this.getSize=function(fe){return fe.set(C,L)},this.setSize=function(fe,Ye,ut){if(Tt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}C=fe,L=Ye,t.width=Math.floor(fe*z),t.height=Math.floor(Ye*z),ut!==!1&&(t.style.width=fe+"px",t.style.height=Ye+"px"),this.setViewport(0,0,fe,Ye)},this.getDrawingBufferSize=function(fe){return fe.set(C*z,L*z).floor()},this.setDrawingBufferSize=function(fe,Ye,ut){C=fe,L=Ye,z=ut,t.width=Math.floor(fe*ut),t.height=Math.floor(Ye*ut),this.setViewport(0,0,fe,Ye)},this.getCurrentViewport=function(fe){return fe.copy(E)},this.getViewport=function(fe){return fe.copy(N)},this.setViewport=function(fe,Ye,ut,Xe){fe.isVector4?N.set(fe.x,fe.y,fe.z,fe.w):N.set(fe,Ye,ut,Xe),Me.viewport(E.copy(N).multiplyScalar(z).floor())},this.getScissor=function(fe){return fe.copy(q)},this.setScissor=function(fe,Ye,ut,Xe){fe.isVector4?q.set(fe.x,fe.y,fe.z,fe.w):q.set(fe,Ye,ut,Xe),Me.scissor(I.copy(q).multiplyScalar(z).floor())},this.getScissorTest=function(){return ie},this.setScissorTest=function(fe){Me.setScissorTest(ie=fe)},this.setOpaqueSort=function(fe){F=fe},this.setTransparentSort=function(fe){G=fe},this.getClearColor=function(fe){return fe.copy(we.getClearColor())},this.setClearColor=function(){we.setClearColor.apply(we,arguments)},this.getClearAlpha=function(){return we.getClearAlpha()},this.setClearAlpha=function(){we.setClearAlpha.apply(we,arguments)},this.clear=function(fe=!0,Ye=!0,ut=!0){let Xe=0;fe&&(Xe|=16384),Ye&&(Xe|=256),ut&&(Xe|=1024),oe.clear(Xe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",rt,!1),t.removeEventListener("webglcontextrestored",Dt,!1),t.removeEventListener("webglcontextcreationerror",ge,!1),Mt.dispose(),de.dispose(),ae.dispose(),Ie.dispose(),Be.dispose(),We.dispose(),Pe.dispose(),nt.dispose(),je.dispose(),Tt.dispose(),Tt.removeEventListener("sessionstart",et),Tt.removeEventListener("sessionend",at),K&&(K.dispose(),K=null),Ze.stop()};function rt(fe){fe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function Dt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let fe=Te.autoReset,Ye=X.enabled,ut=X.autoUpdate,Xe=X.needsUpdate,ft=X.type;gt(),Te.autoReset=fe,X.enabled=Ye,X.autoUpdate=ut,X.needsUpdate=Xe,X.type=ft}function ge(fe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",fe.statusMessage)}function $e(fe){let Ye=fe.target;Ye.removeEventListener("dispose",$e),mt(Ye)}function mt(fe){me(fe),ae.remove(fe)}function me(fe){let Ye=ae.get(fe).programs;Ye!==void 0&&(Ye.forEach(function(ut){je.releaseProgram(ut)}),fe.isShaderMaterial&&je.releaseShaderCache(fe))}this.renderBufferDirect=function(fe,Ye,ut,Xe,ft,Yt){Ye===null&&(Ye=re);let oi=ft.isMesh&&ft.matrixWorld.determinant()<0,gi=bn(fe,Ye,ut,Xe,ft);Me.setMaterial(Xe,oi);let le=ut.index,Oe=1;Xe.wireframe===!0&&(le=lt.getWireframeAttribute(ut),Oe=2);let ke=ut.drawRange,Ge=ut.attributes.position,Ue=ke.start*Oe,Rt=(ke.start+ke.count)*Oe;Yt!==null&&(Ue=Math.max(Ue,Yt.start*Oe),Rt=Math.min(Rt,(Yt.start+Yt.count)*Oe)),le!==null?(Ue=Math.max(Ue,0),Rt=Math.min(Rt,le.count)):Ge!=null&&(Ue=Math.max(Ue,0),Rt=Math.min(Rt,Ge.count));let Xt=Rt-Ue;if(Xt<0||Xt===1/0)return;Pe.setup(ft,Xe,gi,ut,le);let ri,Pt=Le;if(le!==null&&(ri=Ve.get(le),Pt=qe,Pt.setIndex(ri)),ft.isMesh)Xe.wireframe===!0?(Me.setLineWidth(Xe.wireframeLinewidth*he()),Pt.setMode(1)):Pt.setMode(4);else if(ft.isLine){let zt=Xe.linewidth;zt===void 0&&(zt=1),Me.setLineWidth(zt*he()),ft.isLineSegments?Pt.setMode(1):ft.isLineLoop?Pt.setMode(2):Pt.setMode(3)}else ft.isPoints?Pt.setMode(0):ft.isSprite&&Pt.setMode(4);if(ft.isInstancedMesh)Pt.renderInstances(Ue,Xt,ft.count);else if(ut.isInstancedBufferGeometry){let zt=ut._maxInstanceCount!==void 0?ut._maxInstanceCount:1/0,ni=Math.min(ut.instanceCount,zt);Pt.renderInstances(Ue,Xt,ni)}else Pt.render(Ue,Xt)},this.compile=function(fe,Ye){function ut(Xe,ft,Yt){Xe.transparent===!0&&Xe.side===Oa&&Xe.forceSinglePass===!1?(Xe.side=Ws,Xe.needsUpdate=!0,mi(Xe,ft,Yt),Xe.side=Yc,Xe.needsUpdate=!0,mi(Xe,ft,Yt),Xe.side=Oa):mi(Xe,ft,Yt)}d=de.get(fe),d.init(),m.push(d),fe.traverseVisible(function(Xe){Xe.isLight&&Xe.layers.test(Ye.layers)&&(d.pushLight(Xe),Xe.castShadow&&d.pushShadow(Xe))}),d.setupLights(v.physicallyCorrectLights),fe.traverse(function(Xe){let ft=Xe.material;if(ft)if(Array.isArray(ft))for(let Yt=0;Yt<ft.length;Yt++){let oi=ft[Yt];ut(oi,fe,Xe)}else ut(ft,fe,Xe)}),m.pop(),d=null};let Ne=null;function ue(fe){Ne&&Ne(fe)}function et(){Ze.stop()}function at(){Ze.start()}let Ze=new xq;Ze.setAnimationLoop(ue),typeof self<"u"&&Ze.setContext(self),this.setAnimationLoop=function(fe){Ne=fe,Tt.setAnimationLoop(fe),fe===null?Ze.stop():Ze.start()},Tt.addEventListener("sessionstart",et),Tt.addEventListener("sessionend",at),this.render=function(fe,Ye){if(Ye!==void 0&&Ye.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),Ye.parent===null&&Ye.matrixWorldAutoUpdate===!0&&Ye.updateMatrixWorld(),Tt.enabled===!0&&Tt.isPresenting===!0&&(Tt.cameraAutoUpdate===!0&&Tt.updateCamera(Ye),Ye=Tt.getCamera()),fe.isScene===!0&&fe.onBeforeRender(v,fe,Ye,_),d=de.get(fe,m.length),d.init(),m.push(d),j.multiplyMatrices(Ye.projectionMatrix,Ye.matrixWorldInverse),Q.setFromProjectionMatrix(j),ee=this.localClippingEnabled,W=V.init(this.clippingPlanes,ee),h=Mt.get(fe,f.length),h.init(),f.push(h),bt(fe,Ye,0,v.sortObjects),h.finish(),v.sortObjects===!0&&h.sort(F,G),W===!0&&V.beginShadows();let ut=d.state.shadowsArray;if(X.render(ut,fe,Ye),W===!0&&V.endShadows(),this.info.autoReset===!0&&this.info.reset(),we.render(h,fe),d.setupLights(v.physicallyCorrectLights),Ye.isArrayCamera){let Xe=Ye.cameras;for(let ft=0,Yt=Xe.length;ft<Yt;ft++){let oi=Xe[ft];Ft(h,fe,oi,oi.viewport)}}else Ft(h,fe,Ye);_!==null&&(Ce.updateMultisampleRenderTarget(_),Ce.updateRenderTargetMipmap(_)),fe.isScene===!0&&fe.onAfterRender(v,fe,Ye),Pe.resetDefaultState(),A=-1,T=null,m.pop(),m.length>0?d=m[m.length-1]:d=null,f.pop(),f.length>0?h=f[f.length-1]:h=null};function bt(fe,Ye,ut,Xe){if(fe.visible===!1)return;if(fe.layers.test(Ye.layers)){if(fe.isGroup)ut=fe.renderOrder;else if(fe.isLOD)fe.autoUpdate===!0&&fe.update(Ye);else if(fe.isLight)d.pushLight(fe),fe.castShadow&&d.pushShadow(fe);else if(fe.isSprite){if(!fe.frustumCulled||Q.intersectsSprite(fe)){Xe&&se.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(j);let Yt=We.update(fe),oi=fe.material;oi.visible&&h.push(fe,Yt,oi,ut,se.z,null)}}else if((fe.isMesh||fe.isLine||fe.isPoints)&&(fe.isSkinnedMesh&&fe.skeleton.frame!==Te.render.frame&&(fe.skeleton.update(),fe.skeleton.frame=Te.render.frame),!fe.frustumCulled||Q.intersectsObject(fe))){Xe&&se.setFromMatrixPosition(fe.matrixWorld).applyMatrix4(j);let Yt=We.update(fe),oi=fe.material;if(Array.isArray(oi)){let gi=Yt.groups;for(let le=0,Oe=gi.length;le<Oe;le++){let ke=gi[le],Ge=oi[ke.materialIndex];Ge&&Ge.visible&&h.push(fe,Yt,Ge,ut,se.z,ke)}}else oi.visible&&h.push(fe,Yt,oi,ut,se.z,null)}}let ft=fe.children;for(let Yt=0,oi=ft.length;Yt<oi;Yt++)bt(ft[Yt],Ye,ut,Xe)}function Ft(fe,Ye,ut,Xe){let ft=fe.opaque,Yt=fe.transmissive,oi=fe.transparent;d.setupLightsView(ut),W===!0&&V.setGlobalState(v.clippingPlanes,ut),Yt.length>0&&ui(ft,Ye,ut),Xe&&Me.viewport(E.copy(Xe)),ft.length>0&&ci(ft,Ye,ut),Yt.length>0&&ci(Yt,Ye,ut),oi.length>0&&ci(oi,Ye,ut),Me.buffers.depth.setTest(!0),Me.buffers.depth.setMask(!0),Me.buffers.color.setMask(!0),Me.setPolygonOffset(!1)}function ui(fe,Ye,ut){let Xe=be.isWebGL2;K===null&&(K=new rr(1,1,{generateMipmaps:!0,type:xe.has("EXT_color_buffer_half_float")?Id:Ua,minFilter:rx,samples:Xe&&s===!0?4:0})),v.getDrawingBufferSize($),Xe?K.setSize($.x,$.y):K.setSize(uT($.x),uT($.y));let ft=v.getRenderTarget();v.setRenderTarget(K),v.clear();let Yt=v.toneMapping;v.toneMapping=Wu,ci(fe,Ye,ut),v.toneMapping=Yt,Ce.updateMultisampleRenderTarget(K),Ce.updateRenderTargetMipmap(K),v.setRenderTarget(ft)}function ci(fe,Ye,ut){let Xe=Ye.isScene===!0?Ye.overrideMaterial:null;for(let ft=0,Yt=fe.length;ft<Yt;ft++){let oi=fe[ft],gi=oi.object,le=oi.geometry,Oe=Xe===null?oi.material:Xe,ke=oi.group;gi.layers.test(ut.layers)&&Qi(gi,Ye,ut,le,Oe,ke)}}function Qi(fe,Ye,ut,Xe,ft,Yt){fe.onBeforeRender(v,Ye,ut,Xe,ft,Yt),fe.modelViewMatrix.multiplyMatrices(ut.matrixWorldInverse,fe.matrixWorld),fe.normalMatrix.getNormalMatrix(fe.modelViewMatrix),ft.onBeforeRender(v,Ye,ut,Xe,fe,Yt),ft.transparent===!0&&ft.side===Oa&&ft.forceSinglePass===!1?(ft.side=Ws,ft.needsUpdate=!0,v.renderBufferDirect(ut,Ye,Xe,ft,fe,Yt),ft.side=Yc,ft.needsUpdate=!0,v.renderBufferDirect(ut,Ye,Xe,ft,fe,Yt),ft.side=Oa):v.renderBufferDirect(ut,Ye,Xe,ft,fe,Yt),fe.onAfterRender(v,Ye,ut,Xe,ft,Yt)}function mi(fe,Ye,ut){Ye.isScene!==!0&&(Ye=re);let Xe=ae.get(fe),ft=d.state.lights,Yt=d.state.shadowsArray,oi=ft.state.version,gi=je.getParameters(fe,ft.state,Yt,Ye,ut),le=je.getProgramCacheKey(gi),Oe=Xe.programs;Xe.environment=fe.isMeshStandardMaterial?Ye.environment:null,Xe.fog=Ye.fog,Xe.envMap=(fe.isMeshStandardMaterial?Be:Ie).get(fe.envMap||Xe.environment),Oe===void 0&&(fe.addEventListener("dispose",$e),Oe=new Map,Xe.programs=Oe);let ke=Oe.get(le);if(ke!==void 0){if(Xe.currentProgram===ke&&Xe.lightsStateVersion===oi)return Or(fe,gi),ke}else gi.uniforms=je.getUniforms(fe),fe.onBuild(ut,gi,v),fe.onBeforeCompile(gi,v),ke=je.acquireProgram(gi,le),Oe.set(le,ke),Xe.uniforms=gi.uniforms;let Ge=Xe.uniforms;(!fe.isShaderMaterial&&!fe.isRawShaderMaterial||fe.clipping===!0)&&(Ge.clippingPlanes=V.uniform),Or(fe,gi),Xe.needsLights=Qs(fe),Xe.lightsStateVersion=oi,Xe.needsLights&&(Ge.ambientLightColor.value=ft.state.ambient,Ge.lightProbe.value=ft.state.probe,Ge.directionalLights.value=ft.state.directional,Ge.directionalLightShadows.value=ft.state.directionalShadow,Ge.spotLights.value=ft.state.spot,Ge.spotLightShadows.value=ft.state.spotShadow,Ge.rectAreaLights.value=ft.state.rectArea,Ge.ltc_1.value=ft.state.rectAreaLTC1,Ge.ltc_2.value=ft.state.rectAreaLTC2,Ge.pointLights.value=ft.state.point,Ge.pointLightShadows.value=ft.state.pointShadow,Ge.hemisphereLights.value=ft.state.hemi,Ge.directionalShadowMap.value=ft.state.directionalShadowMap,Ge.directionalShadowMatrix.value=ft.state.directionalShadowMatrix,Ge.spotShadowMap.value=ft.state.spotShadowMap,Ge.spotLightMatrix.value=ft.state.spotLightMatrix,Ge.spotLightMap.value=ft.state.spotLightMap,Ge.pointShadowMap.value=ft.state.pointShadowMap,Ge.pointShadowMatrix.value=ft.state.pointShadowMatrix);let Ue=ke.getUniforms(),Rt=EE.seqWithValue(Ue.seq,Ge);return Xe.currentProgram=ke,Xe.uniformsList=Rt,ke}function Or(fe,Ye){let ut=ae.get(fe);ut.outputEncoding=Ye.outputEncoding,ut.instancing=Ye.instancing,ut.skinning=Ye.skinning,ut.morphTargets=Ye.morphTargets,ut.morphNormals=Ye.morphNormals,ut.morphColors=Ye.morphColors,ut.morphTargetsCount=Ye.morphTargetsCount,ut.numClippingPlanes=Ye.numClippingPlanes,ut.numIntersection=Ye.numClipIntersection,ut.vertexAlphas=Ye.vertexAlphas,ut.vertexTangents=Ye.vertexTangents,ut.toneMapping=Ye.toneMapping}function bn(fe,Ye,ut,Xe,ft){Ye.isScene!==!0&&(Ye=re),Ce.resetTextureUnits();let Yt=Ye.fog,oi=Xe.isMeshStandardMaterial?Ye.environment:null,gi=_===null?v.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Qc,le=(Xe.isMeshStandardMaterial?Be:Ie).get(Xe.envMap||oi),Oe=Xe.vertexColors===!0&&!!ut.attributes.color&&ut.attributes.color.itemSize===4,ke=!!Xe.normalMap&&!!ut.attributes.tangent,Ge=!!ut.morphAttributes.position,Ue=!!ut.morphAttributes.normal,Rt=!!ut.morphAttributes.color,Xt=Xe.toneMapped?v.toneMapping:Wu,ri=ut.morphAttributes.position||ut.morphAttributes.normal||ut.morphAttributes.color,Pt=ri!==void 0?ri.length:0,zt=ae.get(Xe),ni=d.state.lights;if(W===!0&&(ee===!0||fe!==T)){let ce=fe===T&&Xe.id===A;V.setState(Xe,fe,ce)}let Lt=!1;Xe.version===zt.__version?(zt.needsLights&&zt.lightsStateVersion!==ni.state.version||zt.outputEncoding!==gi||ft.isInstancedMesh&&zt.instancing===!1||!ft.isInstancedMesh&&zt.instancing===!0||ft.isSkinnedMesh&&zt.skinning===!1||!ft.isSkinnedMesh&&zt.skinning===!0||zt.envMap!==le||Xe.fog===!0&&zt.fog!==Yt||zt.numClippingPlanes!==void 0&&(zt.numClippingPlanes!==V.numPlanes||zt.numIntersection!==V.numIntersection)||zt.vertexAlphas!==Oe||zt.vertexTangents!==ke||zt.morphTargets!==Ge||zt.morphNormals!==Ue||zt.morphColors!==Rt||zt.toneMapping!==Xt||be.isWebGL2===!0&&zt.morphTargetsCount!==Pt)&&(Lt=!0):(Lt=!0,zt.__version=Xe.version);let Zi=zt.currentProgram;Lt===!0&&(Zi=mi(Xe,Ye,ft));let Vr=!1,$i=!1,lr=!1,Z=Zi.getUniforms(),te=zt.uniforms;if(Me.useProgram(Zi.program)&&(Vr=!0,$i=!0,lr=!0),Xe.id!==A&&(A=Xe.id,$i=!0),Vr||T!==fe){if(Z.setValue(oe,"projectionMatrix",fe.projectionMatrix),be.logarithmicDepthBuffer&&Z.setValue(oe,"logDepthBufFC",2/(Math.log(fe.far+1)/Math.LN2)),T!==fe&&(T=fe,$i=!0,lr=!0),Xe.isShaderMaterial||Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshStandardMaterial||Xe.envMap){let ce=Z.map.cameraPosition;ce!==void 0&&ce.setValue(oe,se.setFromMatrixPosition(fe.matrixWorld))}(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial)&&Z.setValue(oe,"isOrthographic",fe.isOrthographicCamera===!0),(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial||Xe.isShadowMaterial||ft.isSkinnedMesh)&&Z.setValue(oe,"viewMatrix",fe.matrixWorldInverse)}if(ft.isSkinnedMesh){Z.setOptional(oe,ft,"bindMatrix"),Z.setOptional(oe,ft,"bindMatrixInverse");let ce=ft.skeleton;ce&&(be.floatVertexTextures?(ce.boneTexture===null&&ce.computeBoneTexture(),Z.setValue(oe,"boneTexture",ce.boneTexture,Ce),Z.setValue(oe,"boneTextureSize",ce.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let _e=ut.morphAttributes;if((_e.position!==void 0||_e.normal!==void 0||_e.color!==void 0&&be.isWebGL2===!0)&&J.update(ft,ut,Xe,Zi),($i||zt.receiveShadow!==ft.receiveShadow)&&(zt.receiveShadow=ft.receiveShadow,Z.setValue(oe,"receiveShadow",ft.receiveShadow)),Xe.isMeshGouraudMaterial&&Xe.envMap!==null&&(te.envMap.value=le,te.flipEnvMap.value=le.isCubeTexture&&le.isRenderTargetTexture===!1?-1:1),$i&&(Z.setValue(oe,"toneMappingExposure",v.toneMappingExposure),zt.needsLights&&Yl(te,lr),Yt&&Xe.fog===!0&&xt.refreshFogUniforms(te,Yt),xt.refreshMaterialUniforms(te,Xe,z,L,K),EE.upload(oe,zt.uniformsList,te,Ce)),Xe.isShaderMaterial&&Xe.uniformsNeedUpdate===!0&&(EE.upload(oe,zt.uniformsList,te,Ce),Xe.uniformsNeedUpdate=!1),Xe.isSpriteMaterial&&Z.setValue(oe,"center",ft.center),Z.setValue(oe,"modelViewMatrix",ft.modelViewMatrix),Z.setValue(oe,"normalMatrix",ft.normalMatrix),Z.setValue(oe,"modelMatrix",ft.matrixWorld),ft.previousModelViewMatrix&&Z.setValue(oe,"previousModelViewMatrix",ft.previousModelViewMatrix),fe.previousProjectionMatrix&&Z.setValue(oe,"previousProjectionMatrix",fe.previousProjectionMatrix),Xe.isShaderMaterial||Xe.isRawShaderMaterial){let ce=Xe.uniformsGroups;for(let De=0,_t=ce.length;De<_t;De++)if(be.isWebGL2){let Hr=ce[De];nt.update(Hr,Zi),nt.bind(Hr,Zi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Zi}function Yl(fe,Ye){fe.ambientLightColor.needsUpdate=Ye,fe.lightProbe.needsUpdate=Ye,fe.directionalLights.needsUpdate=Ye,fe.directionalLightShadows.needsUpdate=Ye,fe.pointLights.needsUpdate=Ye,fe.pointLightShadows.needsUpdate=Ye,fe.spotLights.needsUpdate=Ye,fe.spotLightShadows.needsUpdate=Ye,fe.rectAreaLights.needsUpdate=Ye,fe.hemisphereLights.needsUpdate=Ye}function Qs(fe){return fe.isMeshLambertMaterial||fe.isMeshToonMaterial||fe.isMeshPhongMaterial||fe.isMeshStandardMaterial||fe.isShadowMaterial||fe.isShaderMaterial&&fe.lights===!0}this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(fe,Ye,ut){ae.get(fe.texture).__webglTexture=Ye,ae.get(fe.depthTexture).__webglTexture=ut;let Xe=ae.get(fe);Xe.__hasExternalTextures=!0,Xe.__hasExternalTextures&&(Xe.__autoAllocateDepthBuffer=ut===void 0,Xe.__autoAllocateDepthBuffer||xe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Xe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(fe,Ye){let ut=ae.get(fe);ut.__webglFramebuffer=Ye,ut.__useDefaultFramebuffer=Ye===void 0},this.setRenderTarget=function(fe,Ye=0,ut=0){_=fe,x=Ye,S=ut;let Xe=!0,ft=null,Yt=!1,oi=!1;if(fe){let gi=ae.get(fe);gi.__useDefaultFramebuffer!==void 0?(Me.bindFramebuffer(36160,null),Xe=!1):gi.__webglFramebuffer===void 0?Ce.setupRenderTarget(fe):gi.__hasExternalTextures&&Ce.rebindTextures(fe,ae.get(fe.texture).__webglTexture,ae.get(fe.depthTexture).__webglTexture);let le=fe.texture;(le.isData3DTexture||le.isDataArrayTexture||le.isCompressedArrayTexture)&&(oi=!0);let Oe=ae.get(fe).__webglFramebuffer;fe.isWebGLCubeRenderTarget?(ft=Oe[Ye],Yt=!0):be.isWebGL2&&fe.samples>0&&Ce.useMultisampledRTT(fe)===!1?ft=ae.get(fe).__webglMultisampledFramebuffer:ft=Oe,E.copy(fe.viewport),I.copy(fe.scissor),P=fe.scissorTest}else E.copy(N).multiplyScalar(z).floor(),I.copy(q).multiplyScalar(z).floor(),P=ie;if(Me.bindFramebuffer(36160,ft)&&be.drawBuffers&&Xe&&Me.drawBuffers(fe,ft),Me.viewport(E),Me.scissor(I),Me.setScissorTest(P),Yt){let gi=ae.get(fe.texture);oe.framebufferTexture2D(36160,36064,34069+Ye,gi.__webglTexture,ut)}else if(oi){let gi=ae.get(fe.texture),le=Ye||0;oe.framebufferTextureLayer(36160,36064,gi.__webglTexture,ut||0,le)}A=-1},this.readRenderTargetPixels=function(fe,Ye,ut,Xe,ft,Yt,oi){if(!(fe&&fe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let gi=ae.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&oi!==void 0&&(gi=gi[oi]),gi){Me.bindFramebuffer(36160,gi);try{let le=fe.texture,Oe=le.format,ke=le.type;if(Oe!==hn&&ct.convert(Oe)!==oe.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ge=ke===Id&&(xe.has("EXT_color_buffer_half_float")||be.isWebGL2&&xe.has("EXT_color_buffer_float"));if(ke!==Ua&&ct.convert(ke)!==oe.getParameter(35738)&&!(ke===Cr&&(be.isWebGL2||xe.has("OES_texture_float")||xe.has("WEBGL_color_buffer_float")))&&!Ge){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ye>=0&&Ye<=fe.width-Xe&&ut>=0&&ut<=fe.height-ft&&oe.readPixels(Ye,ut,Xe,ft,ct.convert(Oe),ct.convert(ke),Yt)}finally{let le=_!==null?ae.get(_).__webglFramebuffer:null;Me.bindFramebuffer(36160,le)}}},this.readRenderTargetPixelsAsync=async function(fe,Ye,ut,Xe,ft,Yt,oi){if(!(fe&&fe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let gi=ae.get(fe).__webglFramebuffer;if(fe.isWebGLCubeRenderTarget&&oi!==void 0&&(gi=gi[oi]),gi){let le=fe.texture,Oe=le.format,ke=le.type;if(Ye>=0&&Ye<=fe.width-Xe&&ut>=0&&ut<=fe.height-ft){Me.bindFramebuffer(oe.FRAMEBUFFER,gi);let Ge=oe.createBuffer();oe.bindBuffer(oe.PIXEL_PACK_BUFFER,Ge),oe.bufferData(oe.PIXEL_PACK_BUFFER,Yt.byteLength,oe.STREAM_READ),oe.readPixels(Ye,ut,Xe,ft,ct.convert(Oe),ct.convert(ke),0);let Ue=_!==null?ae.get(_).__webglFramebuffer:null;Me.bindFramebuffer(oe.FRAMEBUFFER,Ue);let Rt=oe.fenceSync(oe.SYNC_GPU_COMMANDS_COMPLETE,0);return oe.flush(),await Npe(oe,Rt,4),oe.bindBuffer(oe.PIXEL_PACK_BUFFER,Ge),oe.getBufferSubData(oe.PIXEL_PACK_BUFFER,0,Yt),oe.deleteBuffer(Ge),oe.deleteSync(Rt),Yt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(fe,Ye,ut=0){let Xe=Math.pow(2,-ut),ft=Math.floor(Ye.image.width*Xe),Yt=Math.floor(Ye.image.height*Xe);Ce.setTexture2D(Ye,0),oe.copyTexSubImage2D(3553,ut,0,0,fe.x,fe.y,ft,Yt),Me.unbindTexture()},this.copyTextureToTexture=function(fe,Ye,ut,Xe=0){let ft=Ye.image.width,Yt=Ye.image.height,oi=ct.convert(ut.format),gi=ct.convert(ut.type);Ce.setTexture2D(ut,0),oe.pixelStorei(37440,ut.flipY),oe.pixelStorei(37441,ut.premultiplyAlpha),oe.pixelStorei(3317,ut.unpackAlignment),Ye.isDataTexture?oe.texSubImage2D(3553,Xe,fe.x,fe.y,ft,Yt,oi,gi,Ye.image.data):Ye.isCompressedTexture?oe.compressedTexSubImage2D(3553,Xe,fe.x,fe.y,Ye.mipmaps[0].width,Ye.mipmaps[0].height,oi,Ye.mipmaps[0].data):oe.texSubImage2D(3553,Xe,fe.x,fe.y,oi,gi,Ye.image),Xe===0&&ut.generateMipmaps&&oe.generateMipmap(3553),Me.unbindTexture()},this.copyTextureToTexture3D=function(fe,Ye,ut,Xe,ft=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Yt=fe.max.x-fe.min.x+1,oi=fe.max.y-fe.min.y+1,gi=fe.max.z-fe.min.z+1,le=ct.convert(Xe.format),Oe=ct.convert(Xe.type),ke;if(Xe.isData3DTexture)Ce.setTexture3D(Xe,0),ke=32879;else if(Xe.isDataArrayTexture)Ce.setTexture2DArray(Xe,0),ke=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}oe.pixelStorei(37440,Xe.flipY),oe.pixelStorei(37441,Xe.premultiplyAlpha),oe.pixelStorei(3317,Xe.unpackAlignment);let Ge=oe.getParameter(3314),Ue=oe.getParameter(32878),Rt=oe.getParameter(3316),Xt=oe.getParameter(3315),ri=oe.getParameter(32877),Pt=ut.isCompressedTexture?ut.mipmaps[0]:ut.image;oe.pixelStorei(3314,Pt.width),oe.pixelStorei(32878,Pt.height),oe.pixelStorei(3316,fe.min.x),oe.pixelStorei(3315,fe.min.y),oe.pixelStorei(32877,fe.min.z),ut.isDataTexture||ut.isData3DTexture?oe.texSubImage3D(ke,ft,Ye.x,Ye.y,Ye.z,Yt,oi,gi,le,Oe,Pt.data):ut.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),oe.compressedTexSubImage3D(ke,ft,Ye.x,Ye.y,Ye.z,Yt,oi,gi,le,Pt.data)):oe.texSubImage3D(ke,ft,Ye.x,Ye.y,Ye.z,Yt,oi,gi,le,Oe,Pt),oe.pixelStorei(3314,Ge),oe.pixelStorei(32878,Ue),oe.pixelStorei(3316,Rt),oe.pixelStorei(3315,Xt),oe.pixelStorei(32877,ri),ft===0&&Xe.generateMipmaps&&oe.generateMipmap(ke),Me.unbindTexture()},this.initRenderTarget=function(fe){ae.get(fe).__webglFramebuffer===void 0&&Ce.setupRenderTarget(fe)},this.initTexture=function(fe){fe.isCubeTexture?Ce.setTextureCube(fe,0):fe.isData3DTexture?Ce.setTexture3D(fe,0):fe.isDataArrayTexture||fe.isCompressedArrayTexture?Ce.setTexture2DArray(fe,0):Ce.setTexture2D(fe,0),Me.unbindTexture()},this.resetState=function(){x=0,S=0,_=null,Me.reset(),Pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Lye=class extends Aq{};Lye.prototype.isWebGL1Renderer=!0;var Eq=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new fi(e),this.near=t,this.far=i}clone(){return new Eq(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Ho=class extends Mr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},Oye=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=tL,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Hl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Ja=new k,aL=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ja.fromBufferAttribute(this,t),Ja.applyMatrix4(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ja.fromBufferAttribute(this,t),Ja.applyNormalMatrix(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ja.fromBufferAttribute(this,t),Ja.transformDirection(e),this.setXYZ(t,Ja.x,Ja.y,Ja.z);return this}setX(e,t){return this.normalized&&(t=Xr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Xr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Xr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Xr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=wd(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=wd(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=wd(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=wd(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Xr(t,this.array),i=Xr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Xr(t,this.array),i=Xr(i,this.array),r=Xr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Xr(t,this.array),i=Xr(i,this.array),r=Xr(r,this.array),n=Xr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new pi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new aL(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Tq=class extends Mr{constructor(){super(),this.isBone=!0,this.type="Bone"}},lo=class extends wn{constructor(e=null,t=1,i=1,r,n,s,a,o,l=qi,c=qi,u,h){super(null,s,a,o,l,c,r,n,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},RV=new St,zye=new St,OB=class{constructor(e=[],t=[]){this.uuid=Hl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new St)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new St;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:zye;RV.multiplyMatrices(a,t[n]),RV.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new OB(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=uq(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new lo(t,e,e,hn,Cr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new Tq),this.bones.push(s),this.boneInverses.push(new St().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},Qb=class extends pi{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},IV=new St,LV=new St,uA=[],Bye=new St,aw=new qr,Nye=class extends qr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Qb(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Bye)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(aw.geometry=this.geometry,aw.material=this.material,aw.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,IV),LV.multiplyMatrices(i,IV),aw.matrixWorld=LV,aw.raycast(e,uA);for(let s=0,a=uA.length;s<a;s++){let o=uA[s];o.instanceId=n,o.object=this,t.push(o)}uA.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Qb(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Np=class extends N_{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new fi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},OV=new k,zV=new k,BV=new St,e3=new Mx,hA=new jo,hT=class extends Mr{constructor(e=new $t,t=new Np){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)OV.fromBufferAttribute(t,r-1),zV.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=OV.distanceTo(zV);e.setAttribute("lineDistance",new kt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),hA.copy(i.boundingSphere),hA.applyMatrix4(r),hA.radius+=n,e.ray.intersectsSphere(hA)===!1)return;BV.copy(r).invert(),e3.copy(e.ray).applyMatrix4(BV);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new k,c=new k,u=new k,h=new k,d=this.isLineSegments?2:1,f=i.index,m=i.attributes.position;if(f!==null){let v=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count);for(let x=v,S=g-1;x<S;x+=d){let _=f.getX(x),A=f.getX(x+1);if(l.fromBufferAttribute(m,_),c.fromBufferAttribute(m,A),e3.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let T=e.ray.origin.distanceTo(h);T<e.near||T>e.far||t.push({distance:T,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{let v=Math.max(0,s.start),g=Math.min(m.count,s.start+s.count);for(let x=v,S=g-1;x<S;x+=d){if(l.fromBufferAttribute(m,x),c.fromBufferAttribute(m,x+1),e3.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(h);_<e.near||_>e.far||t.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},NV=new k,UV=new k,U_=class extends hT{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)NV.fromBufferAttribute(t,r),UV.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+NV.distanceTo(UV);e.setAttribute("lineDistance",new kt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Uye=class extends wn{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:Fi,this.magFilter=n!==void 0?n:Fi,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Fye=class extends wn{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},rh=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new Ee:new k);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new k,r=[],n=[],s=[],a=new k,o=new St;for(let d=0;d<=e;d++){let f=d/e;r[d]=this.getTangentAt(f,new k)}n[0]=new k,s[0]=new k;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let f=Math.acos(ts(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,f))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(ts(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let f=1;f<=e;f++)n[f].applyMatrix4(o.makeRotationAxis(r[f],d*f)),s[f].crossVectors(r[f],n[f])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},tC=class extends rh{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new Ee,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},kye=class extends tC{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function zB(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,n(a,o,d,f)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var dA=new k,t3=new zB,i3=new zB,r3=new zB,Vye=class extends rh{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new k){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(dA.subVectors(r[0],r[1]).add(r[0]),l=dA);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(dA.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=dA),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,f=Math.pow(l.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(c),d);m<1e-4&&(m=1),f<1e-4&&(f=m),v<1e-4&&(v=m),t3.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,f,m,v),i3.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,f,m,v),r3.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,f,m,v)}else this.curveType==="catmullrom"&&(t3.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),i3.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),r3.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(t3.calc(o),i3.calc(o),r3.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new k().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function FV(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function Hye(e,t){let i=1-e;return i*i*t}function Gye(e,t){return 2*(1-e)*e*t}function jye(e,t){return e*e*t}function ab(e,t,i,r){return Hye(e,t)+Gye(e,i)+jye(e,r)}function Wye(e,t){let i=1-e;return i*i*i*t}function Xye(e,t){let i=1-e;return 3*i*i*e*t}function qye(e,t){return 3*(1-e)*e*e*t}function Yye(e,t){return e*e*e*t}function ob(e,t,i,r,n){return Wye(e,t)+Xye(e,i)+qye(e,r)+Yye(e,n)}var Fc=class extends rh{constructor(e=new Ee,t=new Ee,i=new Ee,r=new Ee){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Ee){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(ob(e,r.x,n.x,s.x,a.x),ob(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},TE=class extends rh{constructor(e=new k,t=new k,i=new k,r=new k){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new k){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(ob(e,r.x,n.x,s.x,a.x),ob(e,r.y,n.y,s.y,a.y),ob(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Xc=class extends rh{constructor(e=new Ee,t=new Ee){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ee){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new Ee;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Cq=class extends rh{constructor(e=new k,t=new k){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new k){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Mp=class extends rh{constructor(e=new Ee,t=new Ee,i=new Ee){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Ee){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(ab(e,r.x,n.x,s.x),ab(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Qye=class extends rh{constructor(e=new k,t=new k,i=new k){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new k){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(ab(e,r.x,n.x,s.x),ab(e,r.y,n.y,s.y),ab(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},BB=class extends rh{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ee){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(FV(a,o.x,l.x,c.x,u.x),FV(a,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new Ee().fromArray(r))}return this}},Zye=Object.freeze({__proto__:null,ArcCurve:kye,CatmullRomCurve3:Vye,CubicBezierCurve:Fc,CubicBezierCurve3:TE,EllipseCurve:tC,LineCurve:Xc,LineCurve3:Cq,QuadraticBezierCurve:Mp,QuadraticBezierCurve3:Qye,SplineCurve:BB}),Pq=class extends rh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Xc(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new Zye[r.type]().fromJSON(r))}return this}},dT=class extends Pq{constructor(e){super(),this.type="Path",this.currentPoint=new Ee,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Xc(this.currentPoint.clone(),new Ee(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new Mp(this.currentPoint.clone(),new Ee(e,t),new Ee(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new Fc(this.currentPoint.clone(),new Ee(e,t),new Ee(i,r),new Ee(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new BB(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new tC(e,t,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Dq=class extends $t{constructor(e=[new Ee(0,-.5),new Ee(.5,0),new Ee(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=ts(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/t,u=new k,h=new Ee,d=new k,f=new k,m=new k,v=0,g=0;for(let x=0;x<=e.length-1;x++)switch(x){case 0:v=e[x+1].x-e[x].x,g=e[x+1].y-e[x].y,d.x=g*1,d.y=-v,d.z=g*0,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(m.x,m.y,m.z);break;default:v=e[x+1].x-e[x].x,g=e[x+1].y-e[x].y,d.x=g*1,d.y=-v,d.z=g*0,f.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(f)}for(let x=0;x<=t;x++){let S=i+x*c*r,_=Math.sin(S),A=Math.cos(S);for(let T=0;T<=e.length-1;T++){u.x=e[T].x*_,u.y=e[T].y,u.z=e[T].x*A,s.push(u.x,u.y,u.z),h.x=x/t,h.y=T/(e.length-1),a.push(h.x,h.y);let E=o[3*T+0]*_,I=o[3*T+1],P=o[3*T+0]*A;l.push(E,I,P)}}for(let x=0;x<t;x++)for(let S=0;S<e.length-1;S++){let _=S+x*e.length,A=_,T=_+e.length,E=_+e.length+1,I=_+1;n.push(A,T,I),n.push(E,I,T)}this.setIndex(n),this.setAttribute("position",new kt(s,3)),this.setAttribute("uv",new kt(a,2)),this.setAttribute("normal",new kt(l,3))}static fromJSON(e){return new Dq(e.points,e.segments,e.phiStart,e.phiLength)}},NB=class extends $t{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],f=0,m=[],v=i/2,g=0;x(),s===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(c),this.setAttribute("position",new kt(u,3)),this.setAttribute("normal",new kt(h,3)),this.setAttribute("uv",new kt(d,2));function x(){let _=new k,A=new k,T=0,E=(t-e)/i;for(let I=0;I<=n;I++){let P=[],C=I/n,L=C*(t-e)+e;for(let z=0;z<=r;z++){let F=z/r,G=F*o+a,N=Math.sin(G),q=Math.cos(G);A.x=L*N,A.y=-C*i+v,A.z=L*q,u.push(A.x,A.y,A.z),_.set(N,E,q).normalize(),h.push(_.x,_.y,_.z),d.push(F,1-C),P.push(f++)}m.push(P)}for(let I=0;I<r;I++)for(let P=0;P<n;P++){let C=m[P][I],L=m[P+1][I],z=m[P+1][I+1],F=m[P][I+1];c.push(C,L,F),c.push(L,z,F),T+=6}l.addGroup(g,T,0),g+=T}function S(_){let A=f,T=new Ee,E=new k,I=0,P=_===!0?e:t,C=_===!0?1:-1;for(let z=1;z<=r;z++)u.push(0,v*C,0),h.push(0,C,0),d.push(.5,.5),f++;let L=f;for(let z=0;z<=r;z++){let F=z/r*o+a,G=Math.cos(F),N=Math.sin(F);E.x=P*N,E.y=v*C,E.z=P*G,u.push(E.x,E.y,E.z),h.push(0,C,0),T.x=G*.5+.5,T.y=N*.5*C+.5,d.push(T.x,T.y),f++}for(let z=0;z<r;z++){let F=A+z,G=L+z;_===!0?c.push(G,G+1,F):c.push(G+1,G,F),I+=3}l.addGroup(g,I,_===!0?1:2),g+=I}}static fromJSON(e){return new NB(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},UB=class extends NB{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new UB(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},FB=class extends $t{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new kt(n,3)),this.setAttribute("normal",new kt(n.slice(),3)),this.setAttribute("uv",new kt(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(x){let S=new k,_=new k,A=new k;for(let T=0;T<t.length;T+=3)d(t[T+0],S),d(t[T+1],_),d(t[T+2],A),o(S,_,A,x)}function o(x,S,_,A){let T=A+1,E=[];for(let I=0;I<=T;I++){E[I]=[];let P=x.clone().lerp(_,I/T),C=S.clone().lerp(_,I/T),L=T-I;for(let z=0;z<=L;z++)z===0&&I===T?E[I][z]=P:E[I][z]=P.clone().lerp(C,z/L)}for(let I=0;I<T;I++)for(let P=0;P<2*(T-I)-1;P++){let C=Math.floor(P/2);P%2===0?(h(E[I][C+1]),h(E[I+1][C]),h(E[I][C])):(h(E[I][C+1]),h(E[I+1][C+1]),h(E[I+1][C]))}}function l(x){let S=new k;for(let _=0;_<n.length;_+=3)S.x=n[_+0],S.y=n[_+1],S.z=n[_+2],S.normalize().multiplyScalar(x),n[_+0]=S.x,n[_+1]=S.y,n[_+2]=S.z}function c(){let x=new k;for(let S=0;S<n.length;S+=3){x.x=n[S+0],x.y=n[S+1],x.z=n[S+2];let _=v(x)/2/Math.PI+.5,A=g(x)/Math.PI+.5;s.push(_,1-A)}f(),u()}function u(){for(let x=0;x<s.length;x+=6){let S=s[x+0],_=s[x+2],A=s[x+4],T=Math.max(S,_,A),E=Math.min(S,_,A);T>.9&&E<.1&&(S<.2&&(s[x+0]+=1),_<.2&&(s[x+2]+=1),A<.2&&(s[x+4]+=1))}}function h(x){n.push(x.x,x.y,x.z)}function d(x,S){let _=x*3;S.x=e[_+0],S.y=e[_+1],S.z=e[_+2]}function f(){let x=new k,S=new k,_=new k,A=new k,T=new Ee,E=new Ee,I=new Ee;for(let P=0,C=0;P<n.length;P+=9,C+=6){x.set(n[P+0],n[P+1],n[P+2]),S.set(n[P+3],n[P+4],n[P+5]),_.set(n[P+6],n[P+7],n[P+8]),T.set(s[C+0],s[C+1]),E.set(s[C+2],s[C+3]),I.set(s[C+4],s[C+5]),A.copy(x).add(S).add(_).divideScalar(3);let L=v(A);m(T,C+0,x,L),m(E,C+2,S,L),m(I,C+4,_,L)}}function m(x,S,_,A){A<0&&x.x===1&&(s[S]=x.x-1),_.x===0&&_.z===0&&(s[S]=A/2/Math.PI+.5)}function v(x){return Math.atan2(x.z,-x.x)}function g(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}static fromJSON(e){return new FB(e.vertices,e.indices,e.radius,e.details)}},Rq=class extends FB{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Rq(e.radius,e.detail)}},fT=class extends dT{constructor(e){super(e),this.uuid=Hl(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new dT().fromJSON(r))}return this}},Kye={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=Iq(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=ixe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let m=i;m<n;m+=i)h=e[m],d=e[m+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=f!==0?32767/f:0}return Zb(s,a,i,o,l,f,0),a}};function Iq(e,t,i,r,n){let s,a;if(n===fxe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=kV(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=kV(s,e[s],e[s+1],a);return a&&iC(a,a.next)&&(Jb(a),a=a.next),a}function Wg(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(iC(i,i.next)||xn(i.prev,i,i.next)===0)){if(Jb(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Zb(e,t,i,r,n,s,a){if(!e)return;!a&&s&&oxe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?$ye(e,r,n,s):Jye(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),Jb(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=exe(Wg(e),t,i),Zb(e,t,i,r,n,s,2)):a===2&&txe(e,t,i,r,n,s):Zb(Wg(e),t,i,r,n,s,1);break}}}function Jye(e){let t=e.prev,i=e,r=e.next;if(xn(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c,m=r.next;for(;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=f&&Py(n,o,s,l,a,c,m.x,m.y)&&xn(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function $ye(e,t,i,r){let n=e.prev,s=e,a=e.next;if(xn(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,m=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,x=oL(f,m,t,i,r),S=oL(v,g,t,i,r),_=e.prevZ,A=e.nextZ;for(;_&&_.z>=x&&A&&A.z<=S;){if(_.x>=f&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&Py(o,u,l,h,c,d,_.x,_.y)&&xn(_.prev,_,_.next)>=0||(_=_.prevZ,A.x>=f&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&Py(o,u,l,h,c,d,A.x,A.y)&&xn(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;_&&_.z>=x;){if(_.x>=f&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==a&&Py(o,u,l,h,c,d,_.x,_.y)&&xn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;A&&A.z<=S;){if(A.x>=f&&A.x<=v&&A.y>=m&&A.y<=g&&A!==n&&A!==a&&Py(o,u,l,h,c,d,A.x,A.y)&&xn(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function exe(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!iC(n,s)&&Lq(n,r,r.next,s)&&Kb(n,s)&&Kb(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Jb(r),Jb(r.next),r=e=s),r=r.next}while(r!==e);return Wg(r)}function txe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&uxe(a,o)){let l=Oq(a,o);a=Wg(a,a.next),l=Wg(l,l.next),Zb(a,t,i,r,n,s,0),Zb(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function ixe(e,t,i,r){let n=[],s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=Iq(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(cxe(c));for(n.sort(rxe),s=0;s<n.length;s++)i=nxe(n[s],i);return i}function rxe(e,t){return e.x-t.x}function nxe(e,t){let i=sxe(e,t);if(!i)return t;let r=Oq(i,e);return Wg(r,r.next),Wg(i,i.next)}function sxe(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Py(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Kb(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&axe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function axe(e,t){return xn(e.prev,e,t.prev)<0&&xn(t.next,e,e.next)<0}function oxe(e,t,i,r){let n=e;do n.z===0&&(n.z=oL(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,lxe(n)}function lxe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function oL(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function cxe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Py(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function uxe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!hxe(e,t)&&(Kb(e,t)&&Kb(t,e)&&dxe(e,t)&&(xn(e.prev,e,t.prev)||xn(e,t.prev,t))||iC(e,t)&&xn(e.prev,e,e.next)>0&&xn(t.prev,t,t.next)>0)}function xn(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function iC(e,t){return e.x===t.x&&e.y===t.y}function Lq(e,t,i,r){let n=pA(xn(e,t,i)),s=pA(xn(e,t,r)),a=pA(xn(i,r,e)),o=pA(xn(i,r,t));return!!(n!==s&&a!==o||n===0&&fA(e,i,t)||s===0&&fA(e,r,t)||a===0&&fA(i,e,r)||o===0&&fA(i,t,r))}function fA(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function pA(e){return e>0?1:e<0?-1:0}function hxe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Lq(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Kb(e,t){return xn(e.prev,e,e.next)<0?xn(e,t,e.next)>=0&&xn(e,e.prev,t)>=0:xn(e,t,e.prev)<0||xn(e,e.next,t)<0}function dxe(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function Oq(e,t){let i=new lL(e.i,e.x,e.y),r=new lL(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function kV(e,t,i,r){let n=new lL(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Jb(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function lL(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fxe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var zq=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return zq.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];VV(e),HV(i,e);let s=e.length;t.forEach(VV);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,HV(i,t[o]);let a=Kye.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function VV(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function HV(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var Bq=class extends FB{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Bq(e.radius,e.detail)}},By=class extends $t{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new k,h=new k,d=[],f=[],m=[],v=[];for(let g=0;g<=i;g++){let x=[],S=g/i,_=0;g==0&&s==0?_=.5/t:g==i&&o==Math.PI&&(_=-.5/t);for(let A=0;A<=t;A++){let T=A/t;u.x=-e*Math.cos(r+T*n)*Math.sin(s+S*a),u.y=e*Math.cos(s+S*a),u.z=e*Math.sin(r+T*n)*Math.sin(s+S*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),m.push(h.x,h.y,h.z),v.push(T+_,1-S),x.push(l++)}c.push(x)}for(let g=0;g<i;g++)for(let x=0;x<t;x++){let S=c[g][x+1],_=c[g][x],A=c[g+1][x],T=c[g+1][x+1];(g!==0||s>0)&&d.push(S,_,T),(g!==i-1||o<Math.PI)&&d.push(_,A,T)}this.setIndex(d),this.setAttribute("position",new kt(f,3)),this.setAttribute("normal",new kt(m,3)),this.setAttribute("uv",new kt(v,2))}static fromJSON(e){return new By(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Nq=class extends $t{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new k,u=new k,h=new k;for(let d=0;d<=i;d++)for(let f=0;f<=r;f++){let m=f/r*n,v=d/i*Math.PI*2;u.x=(e+t*Math.cos(v))*Math.cos(m),u.y=(e+t*Math.cos(v))*Math.sin(m),u.z=t*Math.sin(v),a.push(u.x,u.y,u.z),c.x=e*Math.cos(m),c.y=e*Math.sin(m),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(f/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let f=1;f<=r;f++){let m=(r+1)*d+f-1,v=(r+1)*(d-1)+f-1,g=(r+1)*(d-1)+f,x=(r+1)*d+f;s.push(m,v,x),s.push(v,g,x)}this.setIndex(s),this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(o,3)),this.setAttribute("uv",new kt(l,2))}static fromJSON(e){return new Nq(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},Uq=class extends $t{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new k,h=new k,d=new k,f=new k,m=new k,v=new k,g=new k;for(let S=0;S<=i;++S){let _=S/i*n*Math.PI*2;x(_,n,s,e,d),x(_+.01,n,s,e,f),v.subVectors(f,d),g.addVectors(f,d),m.crossVectors(v,g),g.crossVectors(m,v),m.normalize(),g.normalize();for(let A=0;A<=r;++A){let T=A/r*Math.PI*2,E=-t*Math.cos(T),I=t*Math.sin(T);u.x=d.x+(E*g.x+I*m.x),u.y=d.y+(E*g.y+I*m.y),u.z=d.z+(E*g.z+I*m.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(S/i),c.push(A/r)}}for(let S=1;S<=i;S++)for(let _=1;_<=r;_++){let A=(r+1)*(S-1)+(_-1),T=(r+1)*S+(_-1),E=(r+1)*S+_,I=(r+1)*(S-1)+_;a.push(A,T,I),a.push(T,E,I)}this.setIndex(a),this.setAttribute("position",new kt(o,3)),this.setAttribute("normal",new kt(l,3)),this.setAttribute("uv",new kt(c,2));function x(S,_,A,T,E){let I=Math.cos(S),P=Math.sin(S),C=A/_*S,L=Math.cos(C);E.x=T*(2+L)*.5*I,E.y=T*(2+L)*P*.5,E.z=T*Math.sin(C)*.5}}static fromJSON(e){return new Uq(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},pxe=class extends nr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Lf(e,t,i){return Fq(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function mA(e,t,i){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function Fq(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function mxe(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function GV(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function kq(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var rC=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},gxe=class extends rC{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ey,endingEnd:Ey}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case Ty:n=e,a=2*t-i;break;case lT:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case Ty:s=e,o=2*i-t;break;case lT:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(i-t)/(r-t),m=f*f,v=m*f,g=-h*v+2*h*m-h*f,x=(1+h)*v+(-1.5-2*h)*m+(-.5+h)*f+1,S=(-1-d)*v+(1.5+d)*m+.5*f,_=d*v-d*m;for(let A=0;A!==a;++A)n[A]=g*s[c+A]+x*s[l+A]+S*s[o+A]+_*s[u+A];return n}},Vq=class extends rC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},vxe=class extends rC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},nh=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mA(t,this.TimeBufferType),this.values=mA(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:mA(e.times,Array),values:mA(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new vxe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Vq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new gxe(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case aT:t=this.InterpolantFactoryMethodDiscrete;break;case oT:t=this.InterpolantFactoryMethodLinear;break;case CD:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return aT;case this.InterpolantFactoryMethodLinear:return oT;case this.InterpolantFactoryMethodSmooth:return CD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Lf(i,n,s),this.values=Lf(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&Fq(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Lf(this.times),t=Lf(this.values),i=this.getValueSize(),r=this.getInterpolation()===CD,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let f=0;f!==i;++f){let m=t[u+f];if(m!==t[h+f]||m!==t[d+f]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=Lf(e,0,s),this.values=Lf(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Lf(this.times,0),t=Lf(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};nh.prototype.TimeBufferType=Float32Array;nh.prototype.ValueBufferType=Float32Array;nh.prototype.DefaultInterpolation=oT;var Tx=class extends nh{};Tx.prototype.ValueTypeName="bool";Tx.prototype.ValueBufferType=Array;Tx.prototype.DefaultInterpolation=aT;Tx.prototype.InterpolantFactoryMethodLinear=void 0;Tx.prototype.InterpolantFactoryMethodSmooth=void 0;var Hq=class extends nh{};Hq.prototype.ValueTypeName="color";var pT=class extends nh{};pT.prototype.ValueTypeName="number";var yxe=class extends rC{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let c=l+a;l!==c;l+=4)Ai.slerpFlat(n,0,s,l-a,s,l,o);return n}},F_=class extends nh{InterpolantFactoryMethodLinear(e){return new yxe(this.times,this.values,this.getValueSize(),e)}};F_.prototype.ValueTypeName="quaternion";F_.prototype.DefaultInterpolation=oT;F_.prototype.InterpolantFactoryMethodSmooth=void 0;var Cx=class extends nh{};Cx.prototype.ValueTypeName="string";Cx.prototype.ValueBufferType=Array;Cx.prototype.DefaultInterpolation=aT;Cx.prototype.InterpolantFactoryMethodLinear=void 0;Cx.prototype.InterpolantFactoryMethodSmooth=void 0;var mT=class extends nh{};mT.prototype.ValueTypeName="vector";var cL=class{constructor(e,t=-1,i,r=CB){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Hl(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(wxe(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(nh.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=mxe(o);o=GV(o,1,c),l=GV(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new pT(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,f){if(h.length!==0){let m=[],v=[];kq(h,m,v,d),m.length!==0&&f.push(new c(u,m,v))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let f=0;f<u[d].morphTargets.length;f++)h[u[d].morphTargets[f]]=-1;for(let f in h){let m=[],v=[];for(let g=0;g!==u[d].morphTargets.length;++g){let x=u[d];m.push(x.time),v.push(x.morphTarget===f?1:0)}r.push(new pT(".morphTargetInfluence["+f+"]",m,v))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(mT,h+".position",u,"pos",r),i(F_,h+".quaternion",u,"rot",r),i(mT,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function xxe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pT;case"vector":case"vector2":case"vector3":case"vector4":return mT;case"color":return Hq;case"quaternion":return F_;case"bool":case"boolean":return Tx;case"string":return Cx}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function wxe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=xxe(e.type);if(e.times===void 0){let i=[],r=[];kq(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var gT={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Gq=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],f=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return f}return null}}},bxe=new Gq,k_=class{constructor(e){this.manager=e!==void 0?e:bxe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Qh={},_xe=class extends Error{constructor(e,t){super(e),this.response=t}},uL=class extends k_{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=gT.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(Qh[e]!==void 0){Qh[e].push({onLoad:t,onProgress:i,onError:r});return}Qh[e]=[],Qh[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=Qh[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,f=d!==0,m=0,v=new ReadableStream({start(g){x();function x(){u.read().then(({done:S,value:_})=>{if(S)g.close();else{m+=_.byteLength;let A=new ProgressEvent("progress",{lengthComputable:f,loaded:m,total:d});for(let T=0,E=c.length;T<E;T++){let I=c[T];I.onProgress&&I.onProgress(A)}g.enqueue(_),x()}})}}});return new Response(v)}else throw new _xe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{gT.add(e,l);let c=Qh[e];delete Qh[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=Qh[e];if(c===void 0)throw this.manager.itemError(e),l;delete Qh[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Sxe=class extends k_{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=gT.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=Yb("img");function o(){c(),gT.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(u){c(),r&&r(u),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},Mxe=class extends k_{constructor(e){super(e)}load(e,t,i,r){let n=new wn,s=new Sxe(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},V_=class extends Mr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new fi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},Axe=class extends V_{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Mr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new fi(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},n3=new St,jV=new k,WV=new k,kB=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ee(512,512),this.map=null,this.mapPass=null,this.matrix=new St,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new IB,this._frameExtents=new Ee(1,1),this._viewportCount=1,this._viewports=[new Ti(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;jV.setFromMatrixPosition(e.matrixWorld),t.position.copy(jV),WV.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(WV),t.updateMatrixWorld(),n3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n3),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(n3)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Exe=class extends kB{constructor(){super(new Ra(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=qb*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Txe=class extends V_{constructor(e,t,i=0,r=Math.PI/3,n=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Mr.DEFAULT_UP),this.updateMatrix(),this.target=new Mr,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new Exe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},XV=new St,ow=new k,s3=new k,Cxe=class extends kB{constructor(){super(new Ra(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ee(4,2),this._viewportCount=6,this._viewports=[new Ti(2,1,1,1),new Ti(0,1,1,1),new Ti(3,1,1,1),new Ti(1,1,1,1),new Ti(3,0,1,1),new Ti(1,0,1,1)],this._cubeDirections=[new k(1,0,0),new k(-1,0,0),new k(0,0,1),new k(0,0,-1),new k(0,1,0),new k(0,-1,0)],this._cubeUps=[new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,0,1),new k(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),ow.setFromMatrixPosition(e.matrixWorld),i.position.copy(ow),s3.copy(i.position),s3.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(s3),i.updateMatrixWorld(),r.makeTranslation(-ow.x,-ow.y,-ow.z),XV.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(XV)}},Pxe=class extends V_{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Cxe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},Dxe=class extends kB{constructor(){super(new $2(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Rxe=class extends V_{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Mr.DEFAULT_UP),this.updateMatrix(),this.target=new Mr,this.shadow=new Dxe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},jq=class extends $t{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},Wq=class extends k_{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new uL(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let f=h.interleavedBuffers[d],m=n(h,f.buffer),v=WM(f.type,m),g=new Oye(v,f.stride);return g.uuid=f.uuid,t[d]=g,g}function n(h,d){if(i[d]!==void 0)return i[d];let f=h.arrayBuffers[d],m=new Uint32Array(f).buffer;return i[d]=m,m}let s=e.isInstancedBufferGeometry?new jq:new $t,a=e.data.index;if(a!==void 0){let h=WM(a.type,a.array);s.setIndex(new pi(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],f;if(d.isInterleavedBufferAttribute){let m=r(e.data,d.data);f=new aL(m,d.itemSize,d.offset,d.normalized)}else{let m=WM(d.type,d.array),v=d.isInstancedBufferAttribute?Qb:pi;f=new v(m,d.itemSize,d.normalized)}d.name!==void 0&&(f.name=d.name),d.usage!==void 0&&f.setUsage(d.usage),d.updateRange!==void 0&&(f.updateRange.offset=d.updateRange.offset,f.updateRange.count=d.updateRange.count),s.setAttribute(h,f)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],f=[];for(let m=0,v=d.length;m<v;m++){let g=d[m],x;if(g.isInterleavedBufferAttribute){let S=r(e.data,g.data);x=new aL(S,g.itemSize,g.offset,g.normalized)}else{let S=WM(g.type,g.array);x=new pi(S,g.itemSize,g.normalized)}g.name!==void 0&&(x.name=g.name),f.push(x)}s.morphAttributes[h]=f}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let f=c[h];s.addGroup(f.start,f.count,f.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new k;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new jo(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},Ixe=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=qV(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=qV();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function qV(){return(typeof performance>"u"?Date:performance).now()}var Lxe=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){Ai.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;Ai.multiplyQuaternionsFlat(e,s,e,t,e,i),Ai.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},VB="\\[\\]\\.:\\/",Oxe=new RegExp("["+VB+"]","g"),HB="[^"+VB+"]",zxe="[^"+VB.replace("\\.","")+"]",Bxe=/((?:WC+[\/:])*)/.source.replace("WC",HB),Nxe=/(WCOD+)?/.source.replace("WCOD",zxe),Uxe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",HB),Fxe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",HB),kxe=new RegExp("^"+Bxe+Nxe+Uxe+Fxe+"$"),Vxe=["material","materials","bones","map"],Hxe=class{constructor(e,t,i){let r=i||Ur.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Ur=class{constructor(e,t,i){this.path=t,this.parsedPath=i||Ur.parseTrackName(t),this.node=Ur.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Ur.Composite(e,t,i):new Ur(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Oxe,"")}static parseTrackName(e){let t=kxe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);Vxe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=Ur.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Ur.Composite=Hxe;Ur.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ur.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ur.prototype.GetterByBindingType=[Ur.prototype._getValue_direct,Ur.prototype._getValue_array,Ur.prototype._getValue_arrayElement,Ur.prototype._getValue_toArray];Ur.prototype.SetterByBindingTypeAndVersioning=[[Ur.prototype._setValue_direct,Ur.prototype._setValue_direct_setNeedsUpdate,Ur.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ur.prototype._setValue_array,Ur.prototype._setValue_array_setNeedsUpdate,Ur.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ur.prototype._setValue_arrayElement,Ur.prototype._setValue_arrayElement_setNeedsUpdate,Ur.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ur.prototype._setValue_fromArray,Ur.prototype._setValue_fromArray_setNeedsUpdate,Ur.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Gxe=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:Ey,endingEnd:Ey};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=lq,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case ype:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case CB:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===TB;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===oq){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=Ty,r.endingEnd=Ty):(e?r.endingStart=this.zeroSlopeAtStart?Ty:Ey:r.endingStart=lT,t?r.endingEnd=this.zeroSlopeAtEnd?Ty:Ey:r.endingEnd=lT)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},jxe=new Float32Array(1),Wxe=class extends va{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,f=c[d];if(f!==void 0)++f.referenceCount,s[u]=f;else{if(f=s[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,o,d));continue}let m=t&&t._propertyBindings[u].binding.parsedPath;f=new Lxe(Ur.create(i,d,m),h.ValueTypeName,h.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,o,d),s[u]=f}a[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new Vq(new Float32Array(2),new Float32Array(2),1,jxe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?cL.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=CB),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new Gxe(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?cL.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},vt=class{constructor(e){this.value=e}clone(){return new vt(this.value.clone===void 0?this.value:this.value.clone())}},Xq=class{constructor(e,t,i=0,r=1/0){this.ray=new Mx(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new DB,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return hL(e,this,i,t),i.sort(YV),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)hL(e[r],this,i,t);return i.sort(YV),i}};function YV(e,t){return e.distance-t.distance}function hL(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)hL(n[s],t,i,!0)}}var QV=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ts(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},ZV=new Ee,GB=class{constructor(e=new Ee(1/0,1/0),t=new Ee(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=ZV.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ZV.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},KV=new k,gA=new k,Gl=class{constructor(e=new k,t=new k){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){KV.subVectors(e,this.start),gA.subVectors(this.end,this.start);let i=gA.dot(gA),r=gA.dot(KV)/i;return t&&(r=ts(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},JV=new k,Xxe=class extends Mr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new $t,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new kt(r,3));let n=new Np({fog:!1,toneMapped:!1});this.cone=new U_(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),JV.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(JV),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},qxe=class extends qr{constructor(e,t,i){let r=new By(t,4,2),n=new Ld({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},$V=new k,vA=new k,eH=new k,Yxe=class extends Mr{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new $t;r.setAttribute("position",new kt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new Np({fog:!1,toneMapped:!1});this.lightPlane=new hT(r,n),this.add(this.lightPlane),r=new $t,r.setAttribute("position",new kt([0,0,0,0,0,1],3)),this.targetLine=new hT(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),$V.setFromMatrixPosition(this.light.matrixWorld),vA.setFromMatrixPosition(this.light.target.matrixWorld),eH.subVectors(vA,$V),this.lightPlane.lookAt(vA),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vA),this.targetLine.scale.z=eH.length()}},yA=new k,En=new Bp,vT=class extends U_{constructor(e){let t=new $t,i=new Np({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,m){o(f),o(m)}function o(f){r.push(0,0,0),n.push(0,0,0),s[f]===void 0&&(s[f]=[]),s[f].push(r.length/3-1)}t.setAttribute("position",new kt(r,3)),t.setAttribute("color",new kt(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new fi(16755200),c=new fi(16711680),u=new fi(43775),h=new fi(16777215),d=new fi(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;En.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Bn("c",t,e,En,0,0,-1),Bn("t",t,e,En,0,0,1),Bn("n1",t,e,En,-1,-1,-1),Bn("n2",t,e,En,i,-1,-1),Bn("n3",t,e,En,-1,r,-1),Bn("n4",t,e,En,i,r,-1),Bn("f1",t,e,En,-1,-1,1),Bn("f2",t,e,En,i,-1,1),Bn("f3",t,e,En,-1,r,1),Bn("f4",t,e,En,i,r,1),Bn("u1",t,e,En,i*.7,r*1.1,-1),Bn("u2",t,e,En,-1*.7,r*1.1,-1),Bn("u3",t,e,En,0,r*2,-1),Bn("cf1",t,e,En,-1,0,1),Bn("cf2",t,e,En,i,0,1),Bn("cf3",t,e,En,0,-1,1),Bn("cf4",t,e,En,0,r,1),Bn("cn1",t,e,En,-1,0,-1),Bn("cn2",t,e,En,i,0,-1),Bn("cn3",t,e,En,0,-1,-1),Bn("cn4",t,e,En,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Bn(e,t,i,r,n,s,a){yA.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],yA.x,yA.y,yA.z)}}var yT=class extends U_{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new $t;n.setIndex(new pi(i,1)),n.setAttribute("position",new kt(r,3)),super(n,new Np({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Qxe=class extends U_{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new $t;r.setAttribute("position",new kt(t,3)),r.setAttribute("color",new kt(i,3));let n=new Np({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new fi,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},pd=Zxe();function Zxe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Kxe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ts(e,-65504,65504),pd.floatView[0]=e;let t=pd.uint32View[0],i=t>>23&511;return pd.baseTable[i]+((t&8388607)>>pd.shiftTable[i])}function Jxe(e){let t=e>>10;return pd.uint32View[0]=pd.mantissaTable[pd.offsetTable[t]+(e&1023)]+pd.exponentTable[t],pd.floatView[0]}var $xe=Object.freeze({__proto__:null,fromHalfFloat:Jxe,toHalfFloat:Kxe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Sx}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Sx);var lw=".",jB=Symbol("target"),qq=Symbol("unsubscribe");function dL(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function e1e(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var zu=Array.isArray;function WB(e){return typeof e=="symbol"}var t1e={after:(e,t)=>zu(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>zu(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=lw),WB(t)?e+t.toString():e+t):e,initial:e=>{if(zu(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(lw);return t===-1?"":e.slice(0,t)},last:e=>{if(zu(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(lw);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(zu(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(lw);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(lw,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Bl=t1e;function i1e(e){return typeof e=="object"&&typeof e.next=="function"}function r1e(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[jB].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function tH(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&WB(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var n1e=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Bl.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function fL(e){return toString.call(e)==="[object Object]"}function xA(){return!0}function j0(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var Yq=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),s1e=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),Qq={push:xA,pop:xA,shift:xA,unshift:xA,copyWithin:j0,reverse:j0,sort:j0,splice:j0,flat:j0,fill:j0},a1e=new Set([...Yq,...s1e,...Object.keys(Qq)]);function wA(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var Zq=["keys","values","entries"],Kq=new Set(["has","toString"]),Jq={add:wA,clear:wA,delete:wA,forEach:wA},o1e=new Set([...Kq,...Object.keys(Jq),...Zq]);function bA(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var l1e=new Set([...Kq,"get"]),$q={set:bA,clear:bA,delete:bA,forEach:bA},c1e=new Set([...l1e,...Object.keys($q),...Zq]),Ap=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return Yq.has(e)}_shallowClone(e){let t=e;if(fL(e))t={...e};else if(zu(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(zu(r)?this._onIsChanged=Qq[t]:r instanceof Set?this._onIsChanged=Jq[t]:r instanceof Map&&(this._onIsChanged=$q[t]),r):i}update(e,t,i){let r=Bl.after(e,this._path);if(t!=="length"){let n=this.clone;Bl.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Bl.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},iH=class extends Ap{static isHandledMethod(e){return a1e.has(e)}},u1e=class extends Ap{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},rH=class extends Ap{static isHandledMethod(e){return o1e.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},nH=class extends Ap{static isHandledMethod(e){return c1e.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},h1e=class extends Ap{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},d1e=class extends Ap{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},hy=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return fL(e)||zu(e)||dL(e)}static isHandledMethod(e,t){return fL(e)?Ap.isHandledMethod(t):zu(e)?iH.isHandledMethod(t):e instanceof Set?rH.isHandledMethod(t):e instanceof Map?nH.isHandledMethod(t):dL(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=Ap;zu(e)?r=iH:e instanceof Date?r=u1e:e instanceof Set?r=rH:e instanceof Map?r=nH:e instanceof WeakSet?r=h1e:e instanceof WeakMap&&(r=d1e),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=hy.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},f1e={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},XB=(e,t,i={})=>{i={...f1e,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new n1e(n),c=typeof i.onValidate=="function",u=new hy(c),h=(S,_,A,T,E)=>!c||u.isCloning||i.onValidate(Bl.concat(l.getPath(S),_),A,T,E)===!0,d=(S,_,A,T)=>{!tH(l,i,_)&&!(a&&l.isDetached(S,e))&&f(l.getPath(S),_,A,T)},f=(S,_,A,T,E)=>{u.isCloning?u.update(S,_,T):t(Bl.concat(S,_),A,T,E)},m=S=>S&&(S[r]||S),v=(S,_,A,T)=>e1e(S)||A==="constructor"||s&&!hy.isHandledMethod(_,A)||tH(l,i,A)||l.isGetInvariant(_,A)||a&&l.isDetached(_,e)?S:(T===void 0&&(T=l.getPath(_)),l.getProxy(S,Bl.concat(T,A),g,r)),g={get(S,_,A){if(WB(_)){if(_===r||_===jB)return S;if(_===qq&&!l.isUnsubscribed&&l.getPath(S).length===0)return l.unsubscribe(),S}let T=dL(S)?Reflect.get(S,_):Reflect.get(S,_,A);return v(T,S,_)},set(S,_,A,T){A=m(A);let E=S[r]||S,I=E[_];if(n(I,A)&&_ in S)return!0;let P=h(S,_,A,I);return P&&l.setProperty(E,_,A,T,I)?(d(S,_,S[_],I),!0):!P},defineProperty(S,_,A){if(!l.isSameDescriptor(A,S,_)){let T=S[_];h(S,_,A.value,T)&&l.defineProperty(S,_,A,T)&&d(S,_,A.value,T)}return!0},deleteProperty(S,_){if(!Reflect.has(S,_))return!0;let A=Reflect.get(S,_),T=h(S,_,void 0,A);return T&&l.deleteProperty(S,_,A)?(d(S,_,void 0,A),!0):!T},apply(S,_,A){let T=_[r]||_;if(l.isUnsubscribed)return Reflect.apply(S,T,A);if((o===!1||o!==!0&&!o.includes(S.name))&&hy.isHandledType(T)){let E=Bl.initial(l.getPath(S)),I=hy.isHandledMethod(T,S.name);u.start(T,E,A);let P=Reflect.apply(S,u.preferredThisArg(S,_,T),I?A.map(z=>m(z)):A),C=u.isChanged(T,n),L=u.stop();if(hy.isHandledType(P)&&I&&(_ instanceof Map&&S.name==="get"&&(E=Bl.concat(E,A[0])),P=l.getProxy(P,E,g)),C){let z={name:S.name,args:A,result:P},F=u.isCloning?Bl.initial(E):E,G=u.isCloning?Bl.last(E):"";h(Bl.get(e,F),G,T,L,z)?f(F,G,T,L,z):u.undo(T)}return(_ instanceof Map||_ instanceof Set)&&i1e(P)?r1e(P,S,_,E,v):P}return Reflect.apply(S,_,A)}},x=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(x),c&&(i.onValidate=i.onValidate.bind(x)),x};XB.target=e=>e&&e[jB]||e;XB.unsubscribe=e=>e[qq]||e;var sH=XB,p1e=typeof global=="object"&&global&&global.Object===Object&&global,eY=p1e,m1e=typeof self=="object"&&self&&self.Object===Object&&self,g1e=eY||m1e||Function("return this")(),eu=g1e,v1e=eu.Symbol,Xl=v1e,tY=Object.prototype,y1e=tY.hasOwnProperty,x1e=tY.toString,cw=Xl?Xl.toStringTag:void 0;function w1e(e){var t=y1e.call(e,cw),i=e[cw];try{e[cw]=void 0;var r=!0}catch{}var n=x1e.call(e);return r&&(t?e[cw]=i:delete e[cw]),n}var b1e=w1e,_1e=Object.prototype,S1e=_1e.toString;function M1e(e){return S1e.call(e)}var A1e=M1e,E1e="[object Null]",T1e="[object Undefined]",aH=Xl?Xl.toStringTag:void 0;function C1e(e){return e==null?e===void 0?T1e:E1e:aH&&aH in Object(e)?b1e(e):A1e(e)}var av=C1e;function P1e(e){return e!=null&&typeof e=="object"}var Od=P1e,D1e="[object Symbol]";function R1e(e){return typeof e=="symbol"||Od(e)&&av(e)==D1e}var H_=R1e;function I1e(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var iY=I1e,L1e=Array.isArray,$u=L1e,oH=Xl?Xl.prototype:void 0,lH=oH?oH.toString:void 0;function rY(e){if(typeof e=="string")return e;if($u(e))return iY(e,rY)+"";if(H_(e))return lH?lH.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var O1e=rY,z1e=/\s/;function B1e(e){for(var t=e.length;t--&&z1e.test(e.charAt(t)););return t}var N1e=B1e,U1e=/^\s+/;function F1e(e){return e&&e.slice(0,N1e(e)+1).replace(U1e,"")}var k1e=F1e;function V1e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Kc=V1e,cH=NaN,H1e=/^[-+]0x[0-9a-f]+$/i,G1e=/^0b[01]+$/i,j1e=/^0o[0-7]+$/i,W1e=parseInt;function X1e(e){if(typeof e=="number")return e;if(H_(e))return cH;if(Kc(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Kc(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=k1e(e);var i=G1e.test(e);return i||j1e.test(e)?W1e(e.slice(2),i?2:8):H1e.test(e)?cH:+e}var uH=X1e;function q1e(e){return e}var nY=q1e,Y1e="[object AsyncFunction]",Q1e="[object Function]",Z1e="[object GeneratorFunction]",K1e="[object Proxy]";function J1e(e){if(!Kc(e))return!1;var t=av(e);return t==Q1e||t==Z1e||t==Y1e||t==K1e}var sY=J1e,$1e=eu["__core-js_shared__"],a3=$1e,hH=function(){var e=/[^.]+$/.exec(a3&&a3.keys&&a3.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function ewe(e){return!!hH&&hH in e}var twe=ewe,iwe=Function.prototype,rwe=iwe.toString;function nwe(e){if(e!=null){try{return rwe.call(e)}catch{}try{return e+""}catch{}}return""}var ov=nwe,swe=/[\\^$.*+?()[\]{}|]/g,awe=/^\[object .+?Constructor\]$/,owe=Function.prototype,lwe=Object.prototype,cwe=owe.toString,uwe=lwe.hasOwnProperty,hwe=RegExp("^"+cwe.call(uwe).replace(swe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function dwe(e){if(!Kc(e)||twe(e))return!1;var t=sY(e)?hwe:awe;return t.test(ov(e))}var fwe=dwe;function pwe(e,t){return e==null?void 0:e[t]}var mwe=pwe;function gwe(e,t){var i=mwe(e,t);return fwe(i)?i:void 0}var lv=gwe,vwe=lv(eu,"WeakMap"),pL=vwe,dH=Object.create,ywe=function(){function e(){}return function(t){if(!Kc(t))return{};if(dH)return dH(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),xwe=ywe;function wwe(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var bwe=wwe;function _we(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var Swe=_we,Mwe=800,Awe=16,Ewe=Date.now;function Twe(e){var t=0,i=0;return function(){var r=Ewe(),n=Awe-(r-i);if(i=r,n>0){if(++t>=Mwe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Cwe=Twe;function Pwe(e){return function(){return e}}var Dwe=Pwe,Rwe=function(){try{var e=lv(Object,"defineProperty");return e({},"",{}),e}catch{}}(),xT=Rwe,Iwe=xT?function(e,t){return xT(e,"toString",{configurable:!0,enumerable:!1,value:Dwe(t),writable:!0})}:nY,Lwe=Iwe,Owe=Cwe(Lwe),zwe=Owe;function Bwe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var Nwe=Bwe,Uwe=9007199254740991,Fwe=/^(?:0|[1-9]\d*)$/;function kwe(e,t){var i=typeof e;return t=t??Uwe,!!t&&(i=="number"||i!="symbol"&&Fwe.test(e))&&e>-1&&e%1==0&&e<t}var qB=kwe;function Vwe(e,t,i){t=="__proto__"&&xT?xT(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var aY=Vwe;function Hwe(e,t){return e===t||e!==e&&t!==t}var YB=Hwe,Gwe=Object.prototype,jwe=Gwe.hasOwnProperty;function Wwe(e,t,i){var r=e[t];(!(jwe.call(e,t)&&YB(r,i))||i===void 0&&!(t in e))&&aY(e,t,i)}var QB=Wwe;function Xwe(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?aY(i,o,l):QB(i,o,l)}return i}var G_=Xwe,fH=Math.max;function qwe(e,t,i){return t=fH(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=fH(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),bwe(e,this,o)}}var Ywe=qwe,Qwe=9007199254740991;function Zwe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Qwe}var ZB=Zwe;function Kwe(e){return e!=null&&ZB(e.length)&&!sY(e)}var oY=Kwe,Jwe=Object.prototype;function $we(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||Jwe;return e===i}var KB=$we;function ebe(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var tbe=ebe,ibe="[object Arguments]";function rbe(e){return Od(e)&&av(e)==ibe}var pH=rbe,lY=Object.prototype,nbe=lY.hasOwnProperty,sbe=lY.propertyIsEnumerable,abe=pH(function(){return arguments}())?pH:function(e){return Od(e)&&nbe.call(e,"callee")&&!sbe.call(e,"callee")},JB=abe;function obe(){return!1}var lbe=obe,cY=typeof exports=="object"&&exports&&!exports.nodeType&&exports,mH=cY&&typeof module=="object"&&module&&!module.nodeType&&module,cbe=mH&&mH.exports===cY,gH=cbe?eu.Buffer:void 0,ube=gH?gH.isBuffer:void 0,hbe=ube||lbe,wT=hbe,dbe="[object Arguments]",fbe="[object Array]",pbe="[object Boolean]",mbe="[object Date]",gbe="[object Error]",vbe="[object Function]",ybe="[object Map]",xbe="[object Number]",wbe="[object Object]",bbe="[object RegExp]",_be="[object Set]",Sbe="[object String]",Mbe="[object WeakMap]",Abe="[object ArrayBuffer]",Ebe="[object DataView]",Tbe="[object Float32Array]",Cbe="[object Float64Array]",Pbe="[object Int8Array]",Dbe="[object Int16Array]",Rbe="[object Int32Array]",Ibe="[object Uint8Array]",Lbe="[object Uint8ClampedArray]",Obe="[object Uint16Array]",zbe="[object Uint32Array]",rn={};rn[Tbe]=rn[Cbe]=rn[Pbe]=rn[Dbe]=rn[Rbe]=rn[Ibe]=rn[Lbe]=rn[Obe]=rn[zbe]=!0;rn[dbe]=rn[fbe]=rn[Abe]=rn[pbe]=rn[Ebe]=rn[mbe]=rn[gbe]=rn[vbe]=rn[ybe]=rn[xbe]=rn[wbe]=rn[bbe]=rn[_be]=rn[Sbe]=rn[Mbe]=!1;function Bbe(e){return Od(e)&&ZB(e.length)&&!!rn[av(e)]}var Nbe=Bbe;function Ube(e){return function(t){return e(t)}}var $B=Ube,uY=typeof exports=="object"&&exports&&!exports.nodeType&&exports,lb=uY&&typeof module=="object"&&module&&!module.nodeType&&module,Fbe=lb&&lb.exports===uY,o3=Fbe&&eY.process,kbe=function(){try{var e=lb&&lb.require&&lb.require("util").types;return e||o3&&o3.binding&&o3.binding("util")}catch{}}(),ax=kbe,vH=ax&&ax.isTypedArray,Vbe=vH?$B(vH):Nbe,hY=Vbe,Hbe=Object.prototype,Gbe=Hbe.hasOwnProperty;function jbe(e,t){var i=$u(e),r=!i&&JB(e),n=!i&&!r&&wT(e),s=!i&&!r&&!n&&hY(e),a=i||r||n||s,o=a?tbe(e.length,String):[],l=o.length;for(var c in e)(t||Gbe.call(e,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||qB(c,l)))&&o.push(c);return o}var dY=jbe;function Wbe(e,t){return function(i){return e(t(i))}}var fY=Wbe,Xbe=fY(Object.keys,Object),qbe=Xbe,Ybe=Object.prototype,Qbe=Ybe.hasOwnProperty;function Zbe(e){if(!KB(e))return qbe(e);var t=[];for(var i in Object(e))Qbe.call(e,i)&&i!="constructor"&&t.push(i);return t}var Kbe=Zbe;function Jbe(e){return oY(e)?dY(e):Kbe(e)}var eN=Jbe;function $be(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var e_e=$be,t_e=Object.prototype,i_e=t_e.hasOwnProperty;function r_e(e){if(!Kc(e))return e_e(e);var t=KB(e),i=[];for(var r in e)r=="constructor"&&(t||!i_e.call(e,r))||i.push(r);return i}var n_e=r_e;function s_e(e){return oY(e)?dY(e,!0):n_e(e)}var gg=s_e,a_e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o_e=/^\w*$/;function l_e(e,t){if($u(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||H_(e)?!0:o_e.test(e)||!a_e.test(e)||t!=null&&e in Object(t)}var c_e=l_e,u_e=lv(Object,"create"),$b=u_e;function h_e(){this.__data__=$b?$b(null):{},this.size=0}var d_e=h_e;function f_e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var p_e=f_e,m_e="__lodash_hash_undefined__",g_e=Object.prototype,v_e=g_e.hasOwnProperty;function y_e(e){var t=this.__data__;if($b){var i=t[e];return i===m_e?void 0:i}return v_e.call(t,e)?t[e]:void 0}var x_e=y_e,w_e=Object.prototype,b_e=w_e.hasOwnProperty;function __e(e){var t=this.__data__;return $b?t[e]!==void 0:b_e.call(t,e)}var S_e=__e,M_e="__lodash_hash_undefined__";function A_e(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=$b&&t===void 0?M_e:t,this}var E_e=A_e;function Px(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Px.prototype.clear=d_e;Px.prototype.delete=p_e;Px.prototype.get=x_e;Px.prototype.has=S_e;Px.prototype.set=E_e;var yH=Px;function T_e(){this.__data__=[],this.size=0}var C_e=T_e;function P_e(e,t){for(var i=e.length;i--;)if(YB(e[i][0],t))return i;return-1}var nC=P_e,D_e=Array.prototype,R_e=D_e.splice;function I_e(e){var t=this.__data__,i=nC(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():R_e.call(t,i,1),--this.size,!0}var L_e=I_e;function O_e(e){var t=this.__data__,i=nC(t,e);return i<0?void 0:t[i][1]}var z_e=O_e;function B_e(e){return nC(this.__data__,e)>-1}var N_e=B_e;function U_e(e,t){var i=this.__data__,r=nC(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var F_e=U_e;function Dx(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Dx.prototype.clear=C_e;Dx.prototype.delete=L_e;Dx.prototype.get=z_e;Dx.prototype.has=N_e;Dx.prototype.set=F_e;var sC=Dx,k_e=lv(eu,"Map"),e_=k_e;function V_e(){this.size=0,this.__data__={hash:new yH,map:new(e_||sC),string:new yH}}var H_e=V_e;function G_e(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var j_e=G_e;function W_e(e,t){var i=e.__data__;return j_e(t)?i[typeof t=="string"?"string":"hash"]:i.map}var aC=W_e;function X_e(e){var t=aC(this,e).delete(e);return this.size-=t?1:0,t}var q_e=X_e;function Y_e(e){return aC(this,e).get(e)}var Q_e=Y_e;function Z_e(e){return aC(this,e).has(e)}var K_e=Z_e;function J_e(e,t){var i=aC(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var $_e=J_e;function Rx(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Rx.prototype.clear=H_e;Rx.prototype.delete=q_e;Rx.prototype.get=Q_e;Rx.prototype.has=K_e;Rx.prototype.set=$_e;var oC=Rx,eSe="Expected a function";function tN(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(eSe);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(tN.Cache||oC),i}tN.Cache=oC;var tSe=tN,iSe=500;function rSe(e){var t=tSe(e,function(r){return i.size===iSe&&i.clear(),r}),i=t.cache;return t}var nSe=rSe,sSe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,aSe=/\\(\\)?/g,oSe=nSe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(sSe,function(i,r,n,s){t.push(n?s.replace(aSe,"$1"):r||i)}),t}),lSe=oSe;function cSe(e){return e==null?"":O1e(e)}var uSe=cSe;function hSe(e,t){return $u(e)?e:c_e(e,t)?[e]:lSe(uSe(e))}var Ix=hSe;function dSe(e){if(typeof e=="string"||H_(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var lC=dSe;function fSe(e,t){t=Ix(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[lC(t[i++])];return i&&i==r?e:void 0}var pY=fSe;function pSe(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var iN=pSe,xH=Xl?Xl.isConcatSpreadable:void 0;function mSe(e){return $u(e)||JB(e)||!!(xH&&e&&e[xH])}var gSe=mSe;function mY(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=gSe),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?mY(o,t-1,i,r,n):iN(n,o):r||(n[n.length]=o)}return n}var vSe=mY;function ySe(e){var t=e==null?0:e.length;return t?vSe(e,1):[]}var xSe=ySe;function wSe(e){return zwe(Ywe(e,void 0,xSe),e+"")}var gY=wSe,bSe=fY(Object.getPrototypeOf,Object),rN=bSe,_Se="[object Object]",SSe=Function.prototype,MSe=Object.prototype,vY=SSe.toString,ASe=MSe.hasOwnProperty,ESe=vY.call(Object);function TSe(e){if(!Od(e)||av(e)!=_Se)return!1;var t=rN(e);if(t===null)return!0;var i=ASe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&vY.call(i)==ESe}var CSe=TSe;function PSe(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var DSe=PSe;function RSe(){this.__data__=new sC,this.size=0}var ISe=RSe;function LSe(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var OSe=LSe;function zSe(e){return this.__data__.get(e)}var BSe=zSe;function NSe(e){return this.__data__.has(e)}var USe=NSe,FSe=200;function kSe(e,t){var i=this.__data__;if(i instanceof sC){var r=i.__data__;if(!e_||r.length<FSe-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new oC(r)}return i.set(e,t),this.size=i.size,this}var VSe=kSe;function Lx(e){var t=this.__data__=new sC(e);this.size=t.size}Lx.prototype.clear=ISe;Lx.prototype.delete=OSe;Lx.prototype.get=BSe;Lx.prototype.has=USe;Lx.prototype.set=VSe;var CE=Lx;function HSe(e,t){return e&&G_(t,eN(t),e)}var GSe=HSe;function jSe(e,t){return e&&G_(t,gg(t),e)}var WSe=jSe,yY=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wH=yY&&typeof module=="object"&&module&&!module.nodeType&&module,XSe=wH&&wH.exports===yY,bH=XSe?eu.Buffer:void 0,_H=bH?bH.allocUnsafe:void 0;function qSe(e,t){if(t)return e.slice();var i=e.length,r=_H?_H(i):new e.constructor(i);return e.copy(r),r}var YSe=qSe;function QSe(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var ZSe=QSe;function KSe(){return[]}var xY=KSe,JSe=Object.prototype,$Se=JSe.propertyIsEnumerable,SH=Object.getOwnPropertySymbols,eMe=SH?function(e){return e==null?[]:(e=Object(e),ZSe(SH(e),function(t){return $Se.call(e,t)}))}:xY,nN=eMe;function tMe(e,t){return G_(e,nN(e),t)}var iMe=tMe,rMe=Object.getOwnPropertySymbols,nMe=rMe?function(e){for(var t=[];e;)iN(t,nN(e)),e=rN(e);return t}:xY,wY=nMe;function sMe(e,t){return G_(e,wY(e),t)}var aMe=sMe;function oMe(e,t,i){var r=t(e);return $u(e)?r:iN(r,i(e))}var bY=oMe;function lMe(e){return bY(e,eN,nN)}var mL=lMe;function cMe(e){return bY(e,gg,wY)}var _Y=cMe,uMe=lv(eu,"DataView"),gL=uMe,hMe=lv(eu,"Promise"),vL=hMe,dMe=lv(eu,"Set"),yL=dMe,MH="[object Map]",fMe="[object Object]",AH="[object Promise]",EH="[object Set]",TH="[object WeakMap]",CH="[object DataView]",pMe=ov(gL),mMe=ov(e_),gMe=ov(vL),vMe=ov(yL),yMe=ov(pL),$m=av;(gL&&$m(new gL(new ArrayBuffer(1)))!=CH||e_&&$m(new e_)!=MH||vL&&$m(vL.resolve())!=AH||yL&&$m(new yL)!=EH||pL&&$m(new pL)!=TH)&&($m=function(e){var t=av(e),i=t==fMe?e.constructor:void 0,r=i?ov(i):"";if(r)switch(r){case pMe:return CH;case mMe:return MH;case gMe:return AH;case vMe:return EH;case yMe:return TH}return t});var t_=$m,xMe=Object.prototype,wMe=xMe.hasOwnProperty;function bMe(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&wMe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var _Me=bMe,SMe=eu.Uint8Array,bT=SMe;function MMe(e){var t=new e.constructor(e.byteLength);return new bT(t).set(new bT(e)),t}var sN=MMe;function AMe(e,t){var i=t?sN(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var EMe=AMe,TMe=/\w*$/;function CMe(e){var t=new e.constructor(e.source,TMe.exec(e));return t.lastIndex=e.lastIndex,t}var PMe=CMe,PH=Xl?Xl.prototype:void 0,DH=PH?PH.valueOf:void 0;function DMe(e){return DH?Object(DH.call(e)):{}}var RMe=DMe;function IMe(e,t){var i=t?sN(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var LMe=IMe,OMe="[object Boolean]",zMe="[object Date]",BMe="[object Map]",NMe="[object Number]",UMe="[object RegExp]",FMe="[object Set]",kMe="[object String]",VMe="[object Symbol]",HMe="[object ArrayBuffer]",GMe="[object DataView]",jMe="[object Float32Array]",WMe="[object Float64Array]",XMe="[object Int8Array]",qMe="[object Int16Array]",YMe="[object Int32Array]",QMe="[object Uint8Array]",ZMe="[object Uint8ClampedArray]",KMe="[object Uint16Array]",JMe="[object Uint32Array]";function $Me(e,t,i){var r=e.constructor;switch(t){case HMe:return sN(e);case OMe:case zMe:return new r(+e);case GMe:return EMe(e,i);case jMe:case WMe:case XMe:case qMe:case YMe:case QMe:case ZMe:case KMe:case JMe:return LMe(e,i);case BMe:return new r;case NMe:case kMe:return new r(e);case UMe:return PMe(e);case FMe:return new r;case VMe:return RMe(e)}}var eAe=$Me;function tAe(e){return typeof e.constructor=="function"&&!KB(e)?xwe(rN(e)):{}}var iAe=tAe,rAe="[object Map]";function nAe(e){return Od(e)&&t_(e)==rAe}var sAe=nAe,RH=ax&&ax.isMap,aAe=RH?$B(RH):sAe,oAe=aAe,lAe="[object Set]";function cAe(e){return Od(e)&&t_(e)==lAe}var uAe=cAe,IH=ax&&ax.isSet,hAe=IH?$B(IH):uAe,dAe=hAe,fAe=1,pAe=2,mAe=4,SY="[object Arguments]",gAe="[object Array]",vAe="[object Boolean]",yAe="[object Date]",xAe="[object Error]",MY="[object Function]",wAe="[object GeneratorFunction]",bAe="[object Map]",_Ae="[object Number]",AY="[object Object]",SAe="[object RegExp]",MAe="[object Set]",AAe="[object String]",EAe="[object Symbol]",TAe="[object WeakMap]",CAe="[object ArrayBuffer]",PAe="[object DataView]",DAe="[object Float32Array]",RAe="[object Float64Array]",IAe="[object Int8Array]",LAe="[object Int16Array]",OAe="[object Int32Array]",zAe="[object Uint8Array]",BAe="[object Uint8ClampedArray]",NAe="[object Uint16Array]",UAe="[object Uint32Array]",Zr={};Zr[SY]=Zr[gAe]=Zr[CAe]=Zr[PAe]=Zr[vAe]=Zr[yAe]=Zr[DAe]=Zr[RAe]=Zr[IAe]=Zr[LAe]=Zr[OAe]=Zr[bAe]=Zr[_Ae]=Zr[AY]=Zr[SAe]=Zr[MAe]=Zr[AAe]=Zr[EAe]=Zr[zAe]=Zr[BAe]=Zr[NAe]=Zr[UAe]=!0;Zr[xAe]=Zr[MY]=Zr[TAe]=!1;function PE(e,t,i,r,n,s){var a,o=t&fAe,l=t&pAe,c=t&mAe;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!Kc(e))return e;var u=$u(e);if(u){if(a=_Me(e),!o)return Swe(e,a)}else{var h=t_(e),d=h==MY||h==wAe;if(wT(e))return YSe(e,o);if(h==AY||h==SY||d&&!n){if(a=l||d?{}:iAe(e),!o)return l?aMe(e,WSe(a,e)):iMe(e,GSe(a,e))}else{if(!Zr[h])return n?e:{};a=eAe(e,h,o)}}s||(s=new CE);var f=s.get(e);if(f)return f;s.set(e,a),dAe(e)?e.forEach(function(g){a.add(PE(g,t,i,g,e,s))}):oAe(e)&&e.forEach(function(g,x){a.set(x,PE(g,t,i,x,e,s))});var m=c?l?_Y:mL:l?gg:eN,v=u?void 0:m(e);return Nwe(v||e,function(g,x){v&&(x=g,g=e[x]),QB(a,x,PE(g,t,i,x,e,s))}),a}var EY=PE,FAe=1,kAe=4;function VAe(e){return EY(e,FAe|kAe)}var cC=VAe,HAe="__lodash_hash_undefined__";function GAe(e){return this.__data__.set(e,HAe),this}var jAe=GAe;function WAe(e){return this.__data__.has(e)}var XAe=WAe;function _T(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new oC;++t<i;)this.add(e[t])}_T.prototype.add=_T.prototype.push=jAe;_T.prototype.has=XAe;var qAe=_T;function YAe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var QAe=YAe;function ZAe(e,t){return e.has(t)}var KAe=ZAe,JAe=1,$Ae=2;function eEe(e,t,i,r,n,s){var a=i&JAe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,f=i&$Ae?new qAe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var m=e[h],v=t[h];if(r)var g=a?r(v,m,h,t,e,s):r(m,v,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!QAe(t,function(x,S){if(!KAe(f,S)&&(m===x||n(m,x,i,r,s)))return f.push(S)})){d=!1;break}}else if(!(m===v||n(m,v,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var TY=eEe;function tEe(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var iEe=tEe;function rEe(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var nEe=rEe,sEe=1,aEe=2,oEe="[object Boolean]",lEe="[object Date]",cEe="[object Error]",uEe="[object Map]",hEe="[object Number]",dEe="[object RegExp]",fEe="[object Set]",pEe="[object String]",mEe="[object Symbol]",gEe="[object ArrayBuffer]",vEe="[object DataView]",LH=Xl?Xl.prototype:void 0,l3=LH?LH.valueOf:void 0;function yEe(e,t,i,r,n,s,a){switch(i){case vEe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case gEe:return!(e.byteLength!=t.byteLength||!s(new bT(e),new bT(t)));case oEe:case lEe:case hEe:return YB(+e,+t);case cEe:return e.name==t.name&&e.message==t.message;case dEe:case pEe:return e==t+"";case uEe:var o=iEe;case fEe:var l=r&sEe;if(o||(o=nEe),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=aEe,a.set(e,t);var u=TY(o(e),o(t),r,n,s,a);return a.delete(e),u;case mEe:if(l3)return l3.call(e)==l3.call(t)}return!1}var xEe=yEe,wEe=1,bEe=Object.prototype,_Ee=bEe.hasOwnProperty;function SEe(e,t,i,r,n,s){var a=i&wEe,o=mL(e),l=o.length,c=mL(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:_Ee.call(t,d)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var v=!0;s.set(e,t),s.set(t,e);for(var g=a;++h<l;){d=o[h];var x=e[d],S=t[d];if(r)var _=a?r(S,x,d,t,e,s):r(x,S,d,e,t,s);if(!(_===void 0?x===S||n(x,S,i,r,s):_)){v=!1;break}g||(g=d=="constructor")}if(v&&!g){var A=e.constructor,T=t.constructor;A!=T&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof T=="function"&&T instanceof T)&&(v=!1)}return s.delete(e),s.delete(t),v}var MEe=SEe,AEe=1,OH="[object Arguments]",zH="[object Array]",_A="[object Object]",EEe=Object.prototype,BH=EEe.hasOwnProperty;function TEe(e,t,i,r,n,s){var a=$u(e),o=$u(t),l=a?zH:t_(e),c=o?zH:t_(t);l=l==OH?_A:l,c=c==OH?_A:c;var u=l==_A,h=c==_A,d=l==c;if(d&&wT(e)){if(!wT(t))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new CE),a||hY(e)?TY(e,t,i,r,n,s):xEe(e,t,l,i,r,n,s);if(!(i&AEe)){var f=u&&BH.call(e,"__wrapped__"),m=h&&BH.call(t,"__wrapped__");if(f||m){var v=f?e.value():e,g=m?t.value():t;return s||(s=new CE),n(v,g,i,r,s)}}return d?(s||(s=new CE),MEe(e,t,i,r,n,s)):!1}var CEe=TEe;function CY(e,t,i,r,n){return e===t?!0:e==null||t==null||!Od(e)&&!Od(t)?e!==e&&t!==t:CEe(e,t,i,r,CY,n)}var PEe=CY;function DEe(e,t){return e!=null&&t in Object(e)}var REe=DEe;function IEe(e,t,i){t=Ix(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=lC(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&ZB(n)&&qB(a,n)&&($u(e)||JB(e)))}var LEe=IEe;function OEe(e,t){return e!=null&&LEe(e,t,REe)}var zEe=OEe,BEe=function(){return eu.Date.now()},c3=BEe,NEe="Expected a function",UEe=Math.max,FEe=Math.min;function kEe(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(NEe);t=uH(t)||0,Kc(i)&&(u=!!i.leading,h="maxWait"in i,s=h?UEe(uH(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function f(E){var I=r,P=n;return r=n=void 0,c=E,a=e.apply(P,I),a}function m(E){return c=E,o=setTimeout(x,t),u?f(E):a}function v(E){var I=E-l,P=E-c,C=t-I;return h?FEe(C,s-P):C}function g(E){var I=E-l,P=E-c;return l===void 0||I>=t||I<0||h&&P>=s}function x(){var E=c3();if(g(E))return S(E);o=setTimeout(x,v(E))}function S(E){return o=void 0,d&&r?f(E):(r=n=void 0,a)}function _(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function A(){return o===void 0?a:S(c3())}function T(){var E=c3(),I=g(E);if(r=arguments,n=this,l=E,I){if(o===void 0)return m(l);if(h)return clearTimeout(o),o=setTimeout(x,t),f(l)}return o===void 0&&(o=setTimeout(x,t)),a}return T.cancel=_,T.flush=A,T}var i_=kEe;function VEe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var HEe=VEe;function GEe(e,t){return e>t}var jEe=GEe;function WEe(e,t){return t.length<2?e:pY(e,DSe(t,0,-1))}var XEe=WEe;function qEe(e,t){return PEe(e,t)}var aN=qEe;function YEe(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!H_(a):i(a,o)))var o=a,l=s}return l}var QEe=YEe;function ZEe(e){return e&&e.length?QEe(e,nY,jEe):void 0}var KEe=ZEe;function JEe(e,t){return t=Ix(t,e),e=XEe(e,t),e==null||delete e[lC(HEe(t))]}var $Ee=JEe;function eTe(e){return CSe(e)?void 0:e}var tTe=eTe,iTe=1,rTe=2,nTe=4,sTe=gY(function(e,t){var i={};if(e==null)return i;var r=!1;t=iY(t,function(s){return s=Ix(s,e),r||(r=s.length>1),s}),G_(e,_Y(e),i),r&&(i=EY(i,iTe|rTe|nTe,tTe));for(var n=t.length;n--;)$Ee(i,t[n]);return i}),xL=sTe;function aTe(e,t,i,r){if(!Kc(e))return e;t=Ix(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=lC(t[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=Kc(u)?u:qB(t[n+1])?[]:{})}QB(o,l,c),o=o[l]}return e}var oTe=aTe;function lTe(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=pY(e,a);i(o,a)&&oTe(s,Ix(a,e),o)}return s}var cTe=lTe;function uTe(e,t){return cTe(e,t,function(i,r){return zEe(e,r)})}var hTe=uTe,dTe=gY(function(e,t){return e==null?{}:hTe(e,t)}),Xu=dTe,fTe="Expected a function";function pTe(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(fTe);return Kc(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),i_(e,t,{leading:r,maxWait:t,trailing:n})}var mTe=pTe;function PY(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function ql(e,t){return Object.setPrototypeOf(e,t),e}var gTe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),vTe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),yTe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||uC&&"ontouchend"in document,xTe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,wTe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,bTe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},_Te=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},STe=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},DY=gTe();DY&&STe();var uC=vTe(),j_=yTe(),MTe=xTe(),dl=wTe(),NH=bTe(),ATe=Number(_Te());function RY(e){return Array.isArray(e)?e:[e]}function IY(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function SA(e){return uC?e.metaKey:e.ctrlKey}function ETe(e){return e.wheelDeltaY===0||e.deltaY===0?uC&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var wi=[],ST={},Uw={},DE={};function LY(e){wi.includes(e)||wi.push(e)}function Ny(e){delete ST[e.pointerId];for(let t=0;t<wi.length;t++)if(wi[t].pointerId===e.pointerId){wi.splice(t,1);break}}function TTe(){wi.splice(0,wi.length)}function MT(e){if(e.pointerType!=="touch")return;let t=ST[e.pointerId];t===void 0&&(t={x:0,y:0},ST[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function u3(e){let t=e.pointerId===wi[0].pointerId?wi[1]:wi[0];return ST[t.pointerId]}function OY(e){Uw[e.key]=!0,DE[e.key]=DE[e.key]===void 0?1:DE[e.key]+1}function zY(e){if(uC&&Uw.Meta)for(let t in Uw)Uw[t]=!1;else Uw[e.key]=!1;DE={}}function CTe(e){e.addEventListener("pointerdown",LY,!0),e.addEventListener("pointerdown",MT,!0),e.addEventListener("pointermove",MT,!0),e.addEventListener("pointerup",Ny,!0),e.addEventListener("pointercancel",Ny,!0),e.addEventListener("pointerleave",Ny,!0),window.addEventListener("keydown",OY,!0),window.addEventListener("keyup",zY,!0)}function PTe(e){e.removeEventListener("pointerdown",LY,!0),e.removeEventListener("pointerdown",MT,!0),e.removeEventListener("pointermove",MT,!0),e.removeEventListener("pointerup",Ny,!0),e.removeEventListener("pointercancel",Ny,!0),e.removeEventListener("pointerleave",Ny,!0),window.removeEventListener("keydown",OY,!0),window.removeEventListener("keyup",zY,!0)}var BY,DTe=new Promise(e=>{BY=e}),MA;function RTe(){if(MA)return MA;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.81/build",i=Lp(()=>import("./navmesh-BFd9Mv4x.js"),[],import.meta.url),[r,n]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});BY(a)}return MA=e(),MA}var NY,ITe=new Promise(e=>{NY=e}),AA;function LTe(){if(AA)return AA;async function e(){let t=await Lp(()=>import("./physics-BM4kW-A5.js"),[],import.meta.url);await t.init(),NY(t)}return AA=e(),AA}var di=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,di.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,di.prototype),{data:a,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,di.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function oN(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&oN(r)}return Object.freeze(e)}function OTe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var UY=class extends Error{};function h3(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function tp(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function lN(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function zTe(){return typeof process<"u"}function FY(e,t){for(let i of e)t(i.id,i.data)!==!0&&FY(i.children,t)}function kY(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)kY(i,t)}var da=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,da.prototype)}deepFreeze(){let e=0;for(;e<this.length;)oN(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&kY(i,t)}}traverse(e){FY(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,da.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new UY("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=t,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:u,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>OTe(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return tp(0,i,i);{let n=r[0].fi;return tp(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return tp(a,a+i,i)}else return tp(n.fi,s.fi,i)}}},AT;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(AT||(AT={}));var ti=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,ti.prototype)}deepFreeze(){let e=0;for(;e<this.length;)oN(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,ti.prototype);let t=e;return zTe()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return tp(0,t,t);{let r=i[0].fi;return tp(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return tp(s,s+t,t)}else return tp(r.fi,n.fi,t)}}};function ox(e){return e&&typeof e=="object"&&e instanceof os}var os=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!ox(i))return null;r+=1}i=i?h3(i):new os;for(let[o,l]of Object.entries(e.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=h3(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=h3(o);l[e.path[r-1]]=i,i=l}else{let l=new os;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,os.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},pp;(e=>{function t(n,s){return r_(n,s)??n}e.apply=t;function i(n,s){return uN(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=Ms.zoomOnce(l,o[a]),l===void 0)return s;if(!ox(l))return;a+=1}if(l===void 0)return s;if(ox(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=cN([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(pp||(pp={}));function cN(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=r_(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=cN(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function BTe(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=r_(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function r_(e,t){if(!ox(t))return t;if(e instanceof da){let i=cN(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof ti)return BTe(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=r_(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof os)return uN(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=r_(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function uN(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!ox(t))return t;if(!ox(e))return pp.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new os;for(let n of i){let s=uN(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function NTe(e,t){let i={cur:[],result:[],len:0};return e=n_(e,t,i)??e,[e,i.result]}function ET(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function TT(e){e&&(e.len-=1)}function UTe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function VY(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=n_(s.data,t,ET(i,a));TT(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=VY(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function FTe(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=n_(s.data,t,ET(i,a));return TT(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function n_(e,t,i){if(e instanceof da){let r=VY(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof ti)return FTe(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=n_(s,t,ET(i,a));return TT(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!lN(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=n_(a,t,ET(i,s));TT(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&UTe(i),r}else return}}var CT;(e=>{function t(i,r){let n=Ms.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(CT||(CT={}));var Gs;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}e.applySimple=i;function r(l,c){var d,f;let u=c.path;for(var h=[];;){let m;if(l instanceof os&&c.type===0&&(m=l.runOp({...c,path:u.slice(h.length)}),m===null&&(m=void 0)),m===void 0&&h.length===u.length&&(l instanceof da||l instanceof ti||l instanceof di?m=l.runOp(c):m=AT.runOp(l,c)),m!==void 0)if(m!==null){let x=m.data;for(let S=h.length-1;S>=0;S--){let _=u[S],A=h[S];if(A instanceof da){if(typeof _=="number")throw new Error("illegal arg");x=A.modifyById(_,x)}else if(A instanceof ti){if(typeof _=="number")throw new Error("illegal arg");x=A.modifyById(_,x)}else if(A instanceof di){if(typeof _=="number")throw new Error("illegal arg");x=A.modifyById(_,x)}else if(A instanceof os){let T={...A,[_]:x};x=Object.setPrototypeOf(T,os.prototype)}else if(typeof A=="object")if(Array.isArray(A)){if(typeof _=="string"&&(_=parseInt(_),isNaN(_)))throw new Error("Invalid path");let T=x;x=[...A],x[_]=T}else x={...A,[_]:x};else return null}return{data:x,actual:{...m.actual,path:u},reverse:{...m.reverse,path:u}}}else return null;let v=u[h.length],g;if(l instanceof da){if(typeof v=="number")throw new Error("");g=(d=l.get(v))==null?void 0:d.data}else if(l instanceof ti){if(typeof v=="number")throw new Error("");g=(f=l.get(v))==null?void 0:f.data}else l!==null&&(g=l[v]);if(g!==void 0)h.push(l),l=g;else return null}}e.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function a(l,c){return n(l.path,c.path)}e.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(Gs||(Gs={}));var wL;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[f,...m]=d.path;f===u&&h.push({...d,path:m})}return h}e.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=r;function n(c,u){return[...c,...u]}e.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>Gs.subsumed(h,d))),...u]}e.compress=s;function a(c,u){return c.every(h=>u.every(d=>Gs.commutative(h,d)))}e.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],f=[];for(let m of u)try{if(m.type===3||m.type===5&&m.path[m.path.length-1]==="variables"){let v,g,x;if(m.type===3?(v=Ms.zoom(h,[...m.path,m.id]),x=Gs.apply(h,{...m,type:2})):(v=Ms.zoom(h,[...m.path,m.id,"value"]),x=Gs.apply(h,m)),x!==null){h=x.data;let[S,_]=NTe(h,{[m.id]:v});h=S;for(let A=0;A<_.length;A++){let T=_[A],E=T.pop();if(typeof E=="number"){let I=[E];for(let C=A+1;C<_.length;C++){let L=_[C],z=L[L.length-1];if(typeof z=="number"&&Ms.equal(T,L.slice(0,L.length-1)))I.push(z),_.splice(C,1);else break}let P=Ms.zoom(h,T);g=P.map((C,L)=>I.includes(L)?m.id:C),v=P,E=T.pop()}else{if(E==="alphaOverride"||E==="alpha"){v/=100;let I=v,P=Ms.zoom(h,T.slice(0,T.length-2)),C=P.layers.map(L=>L.id===T[T.length-1]?{...L,data:{...L.data,[E]:I}}:L);Object.setPrototypeOf(C,Object.getPrototypeOf(P.layers)),P.layers=C}g=m.id}d.push({type:0,path:T,props:{[E]:v}}),f.push({type:0,path:T,props:{[E]:g}})}f.push(x.reverse),d.push(x.actual)}}else{let v=Gs.apply(h,m);v!==null&&(d.push(v.actual),h=v.data,f.push(v.reverse))}}catch(v){if(v instanceof UY)return null;throw v}return{data:h,actual:d,reverse:f.reverse()}}e.apply=l})(wL||(wL={}));var HY=Symbol(),kTe=Symbol(),hC=Symbol(),W_=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof jY);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[hC];i&&i(),delete this._children[e]}}}},VTe=class extends W_{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,AT.runOp(this._current,e),e.path)}},HTe=class extends W_{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,di.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},GY={get(e,t){if(t===hC)return()=>{e._parent=null};if(t===HY)return e._current;if(t===kTe)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=dC(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},GTe={...GY,set(e,t,i){let r={type:0,props:{[t]:Vn(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},jTe={...GY,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},hN=class extends W_{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[hC]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=dC(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},dN=class extends W_{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[hC]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=dC(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function d3(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Ms.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var jY=class extends W_{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){d3(this.ts,t,e),d3(this.actual,i,e),d3(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function dC(e,t,i){return i instanceof da?new hN(e,t,i):i instanceof ti?new dN(e,t,i):i instanceof di?new Proxy(new HTe(e,t,i),jTe):i!==null&&typeof i=="object"?lN(i)?i:new Proxy(new VTe(e,t,i),GTe):i}function WY(e){let t=new jY(e);return[dC(t,"",e),t]}function s_(e,t){let[i,r]=WY(e);return t(i),r.result()}function Vn(e){return e instanceof hN||e instanceof dN?e._current:e!==null&&typeof e=="object"?e[HY]:e}var Ms;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof da||s instanceof hN)&&typeof a=="string"||(s instanceof ti||s instanceof dN)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(Ms||(Ms={}));function WTe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function kr(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var XY=class{},UH=class extends XY{constructor(e){super(),this.id=e}},FH=class extends XY{constructor(e){super(),this.data=e}},bL;try{bL=new TextDecoder}catch{}var qt,mp,Je=0,Uo={},yr,ip,Nl=0,Bu=0,ul,Td,po=[],Sr,kH={useRecords:!1,mapsAsObjects:!0},qY=class{},YY=new qY;YY.name="MessagePack 0xC1";var lx=!1,PT=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(qt)return eQ(()=>(SL(),this?this.unpack(e,t):PT.prototype.unpack.call(kH,e,t)));mp=t>-1?t:e.length,Je=0,Bu=0,ip=null,ul=null,qt=e;try{Sr=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw qt=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof PT){if(Uo=this,this.structures)return yr=this.structures,EA();(!yr||yr.length>0)&&(yr=[])}else Uo=kH,(!yr||yr.length>0)&&(yr=[]);return EA()}unpackMultiple(e,t){let i,r=0;try{lx=!0;let n=e.length,s=this?this.unpack(e,n):pC.unpack(e,n);if(t){for(t(s);Je<n;)if(r=Je,t(EA())===!1)return}else{for(i=[s];Je<n;)r=Je,i.push(EA());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{lx=!1,SL()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function EA(){try{if(!Uo.trusted&&!lx){let t=yr.sharedLength||0;t<yr.length&&(yr.length=t)}let e=Pn();if(Je==mp)yr.restoreStructures&&VH(),yr=null,qt=null,Td&&(Td=null);else if(Je>mp){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!lx)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw yr.restoreStructures&&VH(),SL(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function VH(){for(let e in yr.restoreStructures)yr[e]=yr.restoreStructures[e];yr.restoreStructures=null}function Pn(){let e=qt[Je++];if(e<160)if(e<128){if(e<64)return e;{let t=yr[e&63]||Uo.getStructures&&QY()[e&63];return t?(t.read||(t.read=fN(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Uo.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[KY()]=Pn();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Pn(),Pn());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Pn();return t}else if(e<192){let t=e-160;if(Bu>=Je)return ip.slice(Je-Nl,(Je+=t)-Nl);if(Bu==0&&mp<140){let i=t<16?pN(t):ZY(t);if(i!=null)return i}return _L(t)}else{let t;switch(e){case 192:return null;case 193:return ul?(t=Pn(),t>0?ul[1].slice(ul.position1,ul.position1+=t):ul[0].slice(ul.position0,ul.position0-=t)):YY;case 194:return!1;case 195:return!0;case 196:return f3(qt[Je++]);case 197:return t=Sr.getUint16(Je),Je+=2,f3(t);case 198:return t=Sr.getUint32(Je),Je+=4,f3(t);case 199:return km(qt[Je++]);case 200:return t=Sr.getUint16(Je),Je+=2,km(t);case 201:return t=Sr.getUint32(Je),Je+=4,km(t);case 202:if(t=Sr.getFloat32(Je),Uo.useFloat32>2){let i=mN[(qt[Je]&127)<<1|qt[Je+1]>>7];return Je+=4,(i*t+(t>0?.5:-.5)>>0)/i}return Je+=4,t;case 203:return t=Sr.getFloat64(Je),Je+=8,t;case 204:return qt[Je++];case 205:return t=Sr.getUint16(Je),Je+=2,t;case 206:return t=Sr.getUint32(Je),Je+=4,t;case 207:return Uo.int64AsNumber?(t=Sr.getUint32(Je)*4294967296,t+=Sr.getUint32(Je+4)):t=Sr.getBigUint64(Je),Je+=8,t;case 208:return Sr.getInt8(Je++);case 209:return t=Sr.getInt16(Je),Je+=2,t;case 210:return t=Sr.getInt32(Je),Je+=4,t;case 211:return Uo.int64AsNumber?(t=Sr.getInt32(Je)*4294967296,t+=Sr.getUint32(Je+4)):t=Sr.getBigInt64(Je),Je+=8,t;case 212:if(t=qt[Je++],t==114)return XH(qt[Je++]&63);{let i=po[t];if(i)return i.read?(Je++,i.read(Pn())):i.noBuffer?(Je++,i()):i(qt.subarray(Je,++Je));throw new Error("Unknown extension "+t)}case 213:return t=qt[Je],t==114?(Je++,XH(qt[Je++]&63,qt[Je++])):km(2);case 214:return km(4);case 215:return km(8);case 216:return km(16);case 217:return t=qt[Je++],Bu>=Je?ip.slice(Je-Nl,(Je+=t)-Nl):qTe(t);case 218:return t=Sr.getUint16(Je),Je+=2,Bu>=Je?ip.slice(Je-Nl,(Je+=t)-Nl):YTe(t);case 219:return t=Sr.getUint32(Je),Je+=4,Bu>=Je?ip.slice(Je-Nl,(Je+=t)-Nl):QTe(t);case 220:return t=Sr.getUint16(Je),Je+=2,GH(t);case 221:return t=Sr.getUint32(Je),Je+=4,GH(t);case 222:return t=Sr.getUint16(Je),Je+=2,jH(t);case 223:return t=Sr.getUint32(Je),Je+=4,jH(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var XTe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function fN(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>XTe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Pn);return e.highByte===0&&(e.read=HH(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=Pn()}return r}return i.count=0,e.highByte===0?HH(t,i):i}var HH=(e,t)=>function(){let i=qt[Je++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=yr[r]||QY()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=fN(n,e)),n.read()};function QY(){let e=eQ(()=>(qt=null,Uo.getStructures()));return yr=Uo._mergeStructures(e,yr)}var _L=fC,qTe=fC,YTe=fC,QTe=fC;function fC(e){let t;if(e<16&&(t=pN(e)))return t;if(e>64&&bL)return bL.decode(qt.subarray(Je,Je+=e));let i=Je+e,r=[];for(t="";Je<i;){let n=qt[Je++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=qt[Je++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=qt[Je++]&63,a=qt[Je++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=qt[Je++]&63,a=qt[Je++]&63,o=qt[Je++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=Fs.apply(String,r),r.length=0)}return r.length>0&&(t+=Fs.apply(String,r)),t}function GH(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Pn();return t}function jH(e){if(Uo.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[KY()]=Pn();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Pn(),Pn());return t}}var Fs=String.fromCharCode;function ZY(e){let t=Je,i=new Array(e);for(let r=0;r<e;r++){let n=qt[Je++];if((n&128)>0){Je=t;return}i[r]=n}return Fs.apply(String,i)}function pN(e){if(e<4)if(e<2){if(e===0)return"";{let t=qt[Je++];if((t&128)>1){Je-=1;return}return Fs(t)}}else{let t=qt[Je++],i=qt[Je++];if((t&128)>0||(i&128)>0){Je-=2;return}if(e<3)return Fs(t,i);let r=qt[Je++];if((r&128)>0){Je-=3;return}return Fs(t,i,r)}else{let t=qt[Je++],i=qt[Je++],r=qt[Je++],n=qt[Je++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){Je-=4;return}if(e<6){if(e===4)return Fs(t,i,r,n);{let s=qt[Je++];if((s&128)>0){Je-=5;return}return Fs(t,i,r,n,s)}}else if(e<8){let s=qt[Je++],a=qt[Je++];if((s&128)>0||(a&128)>0){Je-=6;return}if(e<7)return Fs(t,i,r,n,s,a);let o=qt[Je++];if((o&128)>0){Je-=7;return}return Fs(t,i,r,n,s,a,o)}else{let s=qt[Je++],a=qt[Je++],o=qt[Je++],l=qt[Je++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){Je-=8;return}if(e<10){if(e===8)return Fs(t,i,r,n,s,a,o,l);{let c=qt[Je++];if((c&128)>0){Je-=9;return}return Fs(t,i,r,n,s,a,o,l,c)}}else if(e<12){let c=qt[Je++],u=qt[Je++];if((c&128)>0||(u&128)>0){Je-=10;return}if(e<11)return Fs(t,i,r,n,s,a,o,l,c,u);let h=qt[Je++];if((h&128)>0){Je-=11;return}return Fs(t,i,r,n,s,a,o,l,c,u,h)}else{let c=qt[Je++],u=qt[Je++],h=qt[Je++],d=qt[Je++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){Je-=12;return}if(e<14){if(e===12)return Fs(t,i,r,n,s,a,o,l,c,u,h,d);{let f=qt[Je++];if((f&128)>0){Je-=13;return}return Fs(t,i,r,n,s,a,o,l,c,u,h,d,f)}}else{let f=qt[Je++],m=qt[Je++];if((f&128)>0||(m&128)>0){Je-=14;return}if(e<15)return Fs(t,i,r,n,s,a,o,l,c,u,h,d,f,m);let v=qt[Je++];if((v&128)>0){Je-=15;return}return Fs(t,i,r,n,s,a,o,l,c,u,h,d,f,m,v)}}}}}function f3(e){return Uo.copyBuffers?Uint8Array.prototype.slice.call(qt,Je,Je+=e):qt.subarray(Je,Je+=e)}function km(e){let t=qt[Je++];if(po[t])return po[t](qt.subarray(Je,Je+=e));throw new Error("Unknown extension type "+t)}var WH=new Array(4096);function KY(){let e=qt[Je++];if(e>=160&&e<192){if(e=e-160,Bu>=Je)return ip.slice(Je-Nl,(Je+=e)-Nl);if(!(Bu==0&&mp<180))return _L(e)}else return Je--,Pn();let t=(e<<5^(e>1?Sr.getUint16(Je):e>0?qt[Je]:0))&4095,i=WH[t],r=Je,n=Je+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=Sr.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=qt[r++],s!=i[a++]){r=1879048192;break}if(r===n)return Je=r,i.string;n-=3,r=Je}for(i=[],WH[t]=i,i.bytes=e;r<n;)s=Sr.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=qt[r++],i.push(s);let o=e<16?pN(e):ZY(e);return o!=null?i.string=o:i.string=_L(e)}var XH=(e,t)=>{var i=Pn();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=yr[e];return n&&n.isShared&&((yr.restoreStructures||(yr.restoreStructures=[]))[e]=n),yr[e]=i,i.read=fN(i,r),i.read()},JY=typeof self=="object"?self:global;po[0]=()=>{};po[0].noBuffer=!0;po[101]=()=>{let e=Pn();return(JY[e[0]]||Error)(e[1])};po[105]=e=>{let t=Sr.getUint32(Je-4);Td||(Td=new Map);let i=qt[Je],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Td.set(t,n);let s=Pn();return n.used?Object.assign(r,s):(n.target=s,s)};po[112]=e=>{let t=Sr.getUint32(Je-4),i=Td.get(t);return i.used=!0,i.target};po[115]=()=>new Set(Pn());var $Y=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");po[116]=e=>{let t=e[0],i=$Y[t];if(!i)throw new Error("Could not find typed array for code "+t);return new JY[i](Uint8Array.prototype.slice.call(e,1).buffer)};po[120]=()=>{let e=Pn();return new RegExp(e[0],e[1])};po[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=Je;Je+=t-4,ul=[Pn(),Pn()],ul.position0=0,ul.position1=0;let r=Je;Je=i;try{return Pn()}finally{Je=r}};po[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function eQ(e){let t=mp,i=Je,r=Nl,n=Bu,s=ip,a=Td,o=ul,l=new Uint8Array(qt.slice(0,mp)),c=yr,u=yr.slice(0,yr.length),h=Uo,d=lx,f=e();return mp=t,Je=i,Nl=r,Bu=n,ip=s,Td=a,ul=o,qt=l,lx=d,yr=c,yr.splice(0,yr.length,...u),Uo=h,Sr=new DataView(qt.buffer,qt.byteOffset,qt.byteLength),f}function SL(){qt=null,Td=null,yr=null}function ZTe(e){e.unpack?po[e.type]=e.unpack:po[e.type]=e}var mN=new Array(147);for(let e=0;e<256;e++)mN[e]=+("1e"+Math.floor(45.15-e*.30103));var pC=new PT({useRecords:!1});pC.unpack;pC.unpackMultiple;pC.unpack;var KTe=new Float32Array(1);new Uint8Array(KTe.buffer,0,4);var RE;try{RE=new TextEncoder}catch{}var DT,gN,mC=typeof Buffer<"u",p3=mC?Buffer.allocUnsafeSlow:Uint8Array,tQ=mC?Buffer:Uint8Array,qH=mC?4294967296:2144337920,wt,Nn,ot=0,gu,vu=null,JTe=/[\u0080-\uFFFF]/,uw=Symbol("record-id"),iQ=class extends PT{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=tQ.prototype.utf8Write?function(E,I,P){return wt.utf8Write(E,I,P)}:RE&&RE.encodeInto?function(E,I){return RE.encodeInto(E,wt.subarray(I)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let f=h>32||d+h>64,m=h+64,v=h+d+64;if(v>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],x=0,S=0;this.pack=this.encode=function(E,I){if(wt||(wt=new p3(8192),Nn=new DataView(wt.buffer,0,8192),ot=0),gu=wt.length-10,gu-ot<2048?(wt=new p3(wt.length),Nn=new DataView(wt.buffer,0,wt.length),gu=wt.length-10,ot=0):ot=ot+7&2147483640,t=ot,s=l.structuredClone?new Map:null,l.bundleStrings?(vu=["",""],wt[ot++]=214,wt[ot++]=98,vu.position=ot-t,ot+=4):vu=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let P=i.sharedLength||0;if(P>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let C=0;C<P;C++){let L=i[C];if(!L)continue;let z,F=i.transitions;for(let G=0,N=L.length;G<N;G++){let q=L[G];z=F[q],z||(z=F[q]=Object.create(null)),F=z}F[uw]=C+64}a=P}c||(i.nextId=P+64)}r&&(r=!1),n=i||[];try{if(_(E),vu){Nn.setUint32(vu.position+t,ot-vu.position-t);let P=vu;vu=null,_(P[0]),_(P[1])}if(l.offset=ot,s&&s.idsToInsert){ot+=s.idsToInsert.length*6,ot>gu&&T(ot),l.offset=ot;let P=e2e(wt.subarray(t,ot),s.idsToInsert);return s=null,P}return I&t2e?(wt.start=t,wt.end=ot,wt):wt.subarray(t,ot)}finally{if(i){if(S<10&&S++,x>1e4)i.transitions=null,S=0,x=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let P=0,C=g.length;P<C;P++)g[P][uw]=0;g=[]}if(r&&l.saveStructures){let P=i.sharedLength||h;i.length>P&&(i=i.slice(0,P));let C=wt.subarray(t,ot);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(E)):(a=P,C)}}I&i2e&&(ot=t)}};let _=E=>{ot>gu&&(wt=T(ot));var I=typeof E,P;if(I==="string"){let C=E.length;if(vu&&C>=8&&C<4096){let F=JTe.test(E);vu[F?0:1]+=E,wt[ot++]=193,_(F?-C:C);return}let L;C<32?L=1:C<256?L=2:C<65536?L=3:L=5;let z=C*3;if(ot+z>gu&&(wt=T(ot+z)),C<64||!o){let F,G,N,q=ot+L;for(F=0;F<C;F++)G=E.charCodeAt(F),G<128?wt[q++]=G:G<2048?(wt[q++]=G>>6|192,wt[q++]=G&63|128):(G&64512)===55296&&((N=E.charCodeAt(F+1))&64512)===56320?(G=65536+((G&1023)<<10)+(N&1023),F++,wt[q++]=G>>18|240,wt[q++]=G>>12&63|128,wt[q++]=G>>6&63|128,wt[q++]=G&63|128):(wt[q++]=G>>12|224,wt[q++]=G>>6&63|128,wt[q++]=G&63|128);P=q-ot-L}else P=o(E,ot+L,z);P<32?wt[ot++]=160|P:P<256?(L<2&&wt.copyWithin(ot+2,ot+1,ot+1+P),wt[ot++]=217,wt[ot++]=P):P<65536?(L<3&&wt.copyWithin(ot+3,ot+2,ot+2+P),wt[ot++]=218,wt[ot++]=P>>8,wt[ot++]=P&255):(L<5&&wt.copyWithin(ot+5,ot+3,ot+3+P),wt[ot++]=219,Nn.setUint32(ot,P),ot+=4),ot+=P}else if(I==="number")if(E>>>0===E)E<64?wt[ot++]=E:E<256?(wt[ot++]=204,wt[ot++]=E):E<65536?(wt[ot++]=205,wt[ot++]=E>>8,wt[ot++]=E&255):(wt[ot++]=206,Nn.setUint32(ot,E),ot+=4);else if(E>>0===E)E>=-32?wt[ot++]=256+E:E>=-128?(wt[ot++]=208,wt[ot++]=E+256):E>=-32768?(wt[ot++]=209,Nn.setInt16(ot,E),ot+=2):(wt[ot++]=210,Nn.setInt32(ot,E),ot+=4);else{let C;if((C=this.useFloat32)>0&&E<4294967296&&E>=-2147483648){wt[ot++]=202,Nn.setFloat32(ot,E);let L;if(C<4||(L=E*mN[(wt[ot]&127)<<1|wt[ot+1]>>7])>>0===L){ot+=4;return}else ot--}wt[ot++]=203,Nn.setFloat64(ot,E),ot+=8}else if(I==="object")if(!E)wt[ot++]=192;else{if(s){let L=s.get(E);if(L){if(!L.id){let z=s.idsToInsert||(s.idsToInsert=[]);L.id=z.push(L)}wt[ot++]=214,wt[ot++]=112,Nn.setUint32(ot,L.id),ot+=4;return}else s.set(E,{offset:ot-t})}let C=E.constructor;if(C===Object)A(E,!0);else if(C===Array){P=E.length,P<16?wt[ot++]=144|P:P<65536?(wt[ot++]=220,wt[ot++]=P>>8,wt[ot++]=P&255):(wt[ot++]=221,Nn.setUint32(ot,P),ot+=4);for(let L=0;L<P;L++)_(E[L])}else if(C===Map){P=E.size,P<16?wt[ot++]=128|P:P<65536?(wt[ot++]=222,wt[ot++]=P>>8,wt[ot++]=P&255):(wt[ot++]=223,Nn.setUint32(ot,P),ot+=4);for(let[L,z]of E)_(L),_(z)}else{for(let L=0,z=DT.length;L<z;L++){let F=gN[L];if(E instanceof F){let G=DT[L];if(G.write){G.type&&(wt[ot++]=212,wt[ot++]=G.type,wt[ot++]=0),_(G.write.call(this,E));return}let N=wt,q=Nn,ie=ot;wt=null;let Q;try{Q=G.pack.call(this,E,W=>(wt=N,N=null,ot+=W,ot>gu&&T(ot),{target:wt,targetView:Nn,position:ot-W}),_)}finally{N&&(wt=N,Nn=q,ot=ie,gu=wt.length-10)}Q&&(Q.length+ot>gu&&T(Q.length+ot),ot=$Te(Q,wt,ot,G.type));return}}A(E,!E.hasOwnProperty)}}else if(I==="boolean")wt[ot++]=E?195:194;else if(I==="bigint"){if(E<BigInt(1)<<BigInt(63)&&E>=-(BigInt(1)<<BigInt(63)))wt[ot++]=211,Nn.setBigInt64(ot,E);else if(E<BigInt(1)<<BigInt(64)&&E>0)wt[ot++]=207,Nn.setBigUint64(ot,E);else if(this.largeBigIntToFloat)wt[ot++]=203,Nn.setFloat64(ot,Number(E));else throw new RangeError(E+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ot+=8}else if(I==="undefined")this.encodeUndefinedAsNil?wt[ot++]=192:(wt[ot++]=212,wt[ot++]=0,wt[ot++]=0);else if(I==="function")_(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+I)},A=this.useRecords===!1?this.variableMapSize?E=>{let I=Object.keys(E),P=I.length;P<16?wt[ot++]=128|P:P<65536?(wt[ot++]=222,wt[ot++]=P>>8,wt[ot++]=P&255):(wt[ot++]=223,Nn.setUint32(ot,P),ot+=4);let C;for(let L=0;L<P;L++)_(C=I[L]),_(E[C])}:(E,I)=>{wt[ot++]=222;let P=ot-t;ot+=2;let C=0;for(let L in E)(I||E.hasOwnProperty(L))&&(_(L),_(E[L]),C++);wt[P+++t]=C>>8,wt[P+t]=C&255}:E=>{let I=Object.keys(E),P,C=n.transitions||(n.transitions=Object.create(null)),L=0;for(let F=0,G=I.length;F<G;F++){let N=I[F];P=C[N],P||(P=C[N]=Object.create(null),L++),C=P}let z=C[uw];if(z)z>=96&&f?(wt[ot++]=((z-=96)&31)+96,wt[ot++]=z>>5):wt[ot++]=z;else{z=n.nextId,z||(z=64),z<m&&this.shouldShareStructure&&!this.shouldShareStructure(I)?(z=n.nextOwnId,z<v||(z=m),n.nextOwnId=z+1):(z>=v&&(z=m),n.nextId=z+1);let F=I.highByte=z>=96&&f?z-96>>5:-1;C[uw]=z,n[z-64]=I,z<m?(I.isShared=!0,n.sharedLength=z-63,r=!0,F>=0?(wt[ot++]=(z&31)+96,wt[ot++]=F):wt[ot++]=z):(F>=0?(wt[ot++]=213,wt[ot++]=114,wt[ot++]=(z&31)+96,wt[ot++]=F):(wt[ot++]=212,wt[ot++]=114,wt[ot++]=z),L&&(x+=S*L),g.length>=d&&(g.shift()[uw]=0),g.push(C),_(I))}for(let F=0,G=I.length;F<G;F++)_(E[I[F]])},T=E=>{let I;if(E>16777216){if(E-t>qH)throw new Error("Packed buffer would be larger than maximum buffer size");I=Math.min(qH,Math.round(Math.max((E-t)*(E>67108864?1.25:2),4194304)/4096)*4096)}else I=(Math.max(E-t<<2,wt.length-1)>>12)+1<<12;let P=new p3(I);return Nn=new DataView(P.buffer,0,I),wt.copy?wt.copy(P,0,t,E):P.set(wt.slice(t,E)),ot-=t,t=0,gu=P.length-10,wt=P}}useBuffer(e){wt=e,Nn=new DataView(wt.buffer,wt.byteOffset,wt.byteLength),ot=0}};gN=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,qY];DT=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?YH(e,16,t):QH(mC?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==tQ&&this.structuredClone?YH(e,$Y.indexOf(i.name),t):QH(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function YH(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function QH(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function $Te(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function e2e(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function Ox(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");gN.unshift(e.Class),DT.unshift(e)}ZTe(e)}var rQ=new iQ({useRecords:!1});rQ.pack;rQ.pack;var t2e=512,i2e=1024,ZH=new iQ({structuredClone:!0});Ox({Class:di.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,di.prototype),e}});Ox({Class:ti.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,ti.prototype),e}});Ox({Class:da.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,da.prototype),e}});Ox({Class:UH.prototype.constructor,type:4,write(e){return e.id},read(e){return new UH(e)}});Ox({Class:FH.prototype.constructor,type:5,write(e){return e.data},read(e){return new FH(e)}});Ox({Class:os.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,os.prototype),e}});function r2e(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function ML(e){if(lN(e))return e;if(Array.isArray(e))return e.map(ML);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=ML(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var AL;(e=>{function t(n){return ZH.pack(n)}e.serialize=t;function i(n){return ZH.unpack(n)}e.deserialize=i;function r(n){return r2e(t(ML(n))).toString()}e.checksum=r})(AL||(AL={}));var KH;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(KH||(KH={}));function JH(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var Da={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},$H;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new ti}:{type:r,disabled:!1,key:void 0,actions:new ti}}e.defaultData=i})($H||($H={}));var RT;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(RT||(RT={}));var EL;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:RT.propertyDefaultData(n),rOperand:{...RT.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(EL||(EL={}));var e6;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(e6||(e6={}));var t6;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new ti,outActions:new ti,condition:EL.distanceDefaultData(r)}}e.defaultData=i})(t6||(t6={}));var i6;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new ti,drop:new ti}})(i6||(i6={}));var TL;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new ti})(TL||(TL={}));var CL;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(CL||(CL={}));var r6;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new ti}}e.defaultData=i})(r6||(r6={}));var n6;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new ti}}e.defaultData=i})(n6||(n6={}));var s6;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new ti}}e.defaultData=i})(s6||(s6={}));var a6;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new ti}}e.defaultData=i})(a6||(a6={}));var o6;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new ti,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(o6||(o6={}));var PL;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new ti},o={size:"tablet",operator:"<",actions:new ti},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new ti},c=new ti;return c.push({id:Gt.generateUUID(),fi:0,data:a},{id:Gt.generateUUID(),fi:1,data:o},{id:Gt.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new ti}}e.defaultBreakpointData=s})(PL||(PL={}));var DL;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new ti,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(DL||(DL={}));var l6;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new ti,errorActions:new ti,userAPIId:""}}e.defaultData=i})(l6||(l6={}));var c6;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new ti,userWebhookId:""}}e.defaultData=i})(c6||(c6={}));var u6;(e=>{function t(r){return r.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new ti,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(u6||(u6={}));var h6;(e=>{function t(r){return r.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new ti}}e.defaultData=i})(h6||(h6={}));var zx="personal camera",cb="a218fcc3-276b-49b9-b485-49037fd14f5f",n2e=2960946,ml=5526619,_d;(e=>{function t(m,v){return m[0]===v[0]&&m[1]===v[1]}e.isEqual=t;function i(m,v,g){return[m[0]+(v[0]-m[0])*g,m[1]+(v[1]-m[1])*g]}e.lerp=i;function r(m,v){return[m[0]+v[0],m[1]+v[1]]}e.add=r;function n(m,v){return[m[0]-v[0],m[1]-v[1]]}e.sub=n;function s(m,v){return[m[0]*v[0],m[1]*v[1]]}e.multiply=s;function a(m,v){return[m[0]/v[0],m[1]/v[1]]}e.divide=a;function o(m,v){return Math.pow(v[0]-m[0],2)+Math.pow(v[1]-m[1],2)}e.distanceSquared=o;function l(m,v){return Math.sqrt(o(m,v))}e.distance=l;function c(m,v){return m[0]*v[0]+m[1]*v[1]}e.dot=c;function u(m,v){return[m[0]*v,m[1]*v]}e.scalarMultiply=u;function h(m,v,g){let x=e.sub(v,m),S=e.sub(g,m),_=e.dot(x,S)/e.dot(x,x),A=e.scalarMultiply(x,_);return e.add(m,A)}e.projectionOnto=h;function d(m,v,g){return l(m,h(m,v,g))}e.projectionOntoDistance=d;function f(m,v){return[(m[0]+v[0])*.5,(m[1]+v[1])*.5]}e.center=f})(_d||(_d={}));var Og;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(Og||(Og={}));var IT;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(IT||(IT={}));var d6;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(d6||(d6={}));var cx;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}e.applyMatrix4=r})(cx||(cx={}));var ua;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(ua||(ua={}));var Rr;(e=>{e.white={...ua.white,a:1},e.transparent={...ua.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...ua.fromHex(l),a:c}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function n(l,c){return ua.equals(l,c)&&l.a===c.a}e.equals=n;function s(l,c){return ua.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=a;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(Rr||(Rr={}));var RL;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(RL||(RL={}));var f6;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(f6||(f6={}));var p6;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(p6||(p6={}));var Xf;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(Xf||(Xf={}));function m6(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var Xg;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Xg||(Xg={}));var ux;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}e.getZoom=t})(ux||(ux={}));var rp;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(nQ.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;sQ.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;aQ.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;oQ.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;lQ.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;cQ.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(rp||(rp={}));var IL;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(IL||(IL={}));var nQ=["count"],sQ=["radius","start","end","position","scale","rotation"],aQ=["position","scale","rotation"],oQ=["count","size"],lQ=["count","position","scale","rotation"],cQ=["strength","scale","rotation","position","movement","seed","freqScale"],LL;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(LL||(LL={}));var OL;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:Rr.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:Rr.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Rr.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(OL||(OL={}));var LT;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(LT||(LT={}));var hx;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(hx||(hx={}));var zL;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(zL||(zL={}));var BL;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(BL||(BL={}));var NL;(e=>e.defaultData={...BL.defaultData,...zL.defaultData})(NL||(NL={}));var g6;(e=>{function t(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}e.getMaterialData=t})(g6||(g6={}));var OT;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(OT||(OT={}));var v6;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(v6||(v6={}));function s2e(e){return e.type!=="displace"}var y6;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(y6||(y6={}));var uQ=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],a2e=["wrapping","image","video","name","minFilter","magFilter"],ks;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,a){return s==="light"&&a?r(a):n(s)}e.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:OT.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:ua.fromHex(ml)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...ua.fromHex(6710886),a:1},colorB:{...ua.fromHex(6710886),a:1},colorC:{...ua.fromHex(16777215),a:1},colorD:{...ua.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:Rr.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Rr.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:Rr.fromHexAndA(0,1),contourColor:Rr.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...ua.fromHex(0),a:1},colorB:{...ua.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(ks||(ks={}));var js;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([f,m])=>{h+=`${f}${m}`,Array.isArray(m)?m.forEach(v=>h+=`${v}`):typeof m=="object"?Object.values(m).forEach(v=>{typeof v=="number"?h+=`${v.toFixed(4)}`:h+=`${v}`}):h+=`${m}`})}),h}e.getHash=i;function r(){return{layers:new ti}}e.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=n;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",d="layer2"){let f=new ti;return f.push({fi:0,data:ks.defaultData("light",u),id:h}),f.push({fi:1,data:ks.defaultData("color"),id:d}),{layers:f}}e.defaultTwoLayerData=a;function o(u){let h=ks.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new ti;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...ks.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...ks.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",f="layer2"){let m=ks.defaultData("texture");Object.assign(m.texture,{image:u});let v=new ti;return v.push({fi:0,data:m,id:d}),v.push({fi:1,data:ks.defaultData("light",h),id:f}),{layers:v}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",f="layer2"){let m=ks.defaultData("video");Object.assign(m.texture,{video:u});let v=new ti;return v.push({fi:0,data:m,id:d}),v.push({fi:1,data:ks.defaultData("light",h),id:f}),{layers:v}}e.defaultTwoLayerVideoTextureData=c})(js||(js={}));var zT;(e=>{function t(){return{points:new ti,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(zT||(zT={}));var BT;(e=>{function t(){return{points:new ti,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(BT||(BT={}));var hQ={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},UL;(e=>{function t(i,r){let n={...i};return fQ.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(UL||(UL={}));var dQ={shape:hQ,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},fQ=["depth","offset","angle","twist","startScale","endScale"],NT;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(NT||(NT={}));var FL;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,UL.merge(n.extrusion,r.extrusion))),n}e.merge=t})(FL||(FL={}));var Qf;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:BT.defaultData(),extrusion:dQ};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:zT.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(Qf||(Qf={}));var m3=["width","height","depth"],kL;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:ua.white,near:.1,far:2e3})(kL||(kL={}));var UT;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(UT||(UT={}));var VL;(e=>e.defaultData={softShadowQuality:"low"})(VL||(VL={}));var HL;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(HL||(HL={}));var GL;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(GL||(GL={}));var dx;(e=>e.defaultData={usePhysics:!1,gravity:-10})(dx||(dx={}));var jL;(e=>e.defaultData={playCamera:zx,gameControlObject:null})(jL||(jL={}));var WL;(e=>e.defaultData={backgroundColor:Rr.fromHexAndA(n2e,1),postprocessing:UT.defaultData,fog:kL.defaultData,globalPhysics:dx.defaultData,ambient:HL.defaultData,ao:GL.defaultData,shadow:VL.defaultData,publish:jL.defaultData})(WL||(WL={}));var XL;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(XL||(XL={}));var x6;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(x6||(x6={}));var fx;(e=>{e.identity={...RL.identity,hiddenMatrix:cx.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return PY({position:Og.isEqual(n.position,s.position)?void 0:s.position,rotation:Og.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:Og.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:cx.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(fx||(fx={}));var As;(e=>e.defaultData={states:new ti,events:new ti,visible:!0,raycastLock:!1,physics:hx.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...fx.identity,cloner:null})(As||(As={}));var qL;(e=>e.defaultData={type:"Empty",...As.defaultData})(qL||(qL={}));var w6;(e=>e.defaultData={type:"ParticleCollider",...XL.defaultData,...As.defaultData})(w6||(w6={}));var b6;(e=>e.defaultData={type:"Component",...As.defaultData})(b6||(b6={}));var _6;(e=>e.defaultData={type:"Particle",...As.defaultData,...LT.defaultData})(_6||(_6={}));var Zf;(e=>e.defaultData={type:"Mesh",...As.defaultData,...NL.defaultData})(Zf||(Zf={}));var a_;(e=>e.defaultData={...As.defaultData,...fx.identity,position:[0,0,ux.DefaultTargetOffset],...ux.defaultData})(a_||(a_={}));var YL;(e=>{function t(i){return{...As.defaultData,...OL.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(YL||(YL={}));var FT;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(FT||(FT={}));var np;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...As.defaultData,...n,component:r,overrides:new os,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=fx.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(np||(np={}));var px;(e=>{e.defaultData={type:"Page",...As.defaultData,physics:{...hx.defaultData,fusedBody:!1},...WL.defaultData,camera:a_.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(px||(px={}));var QL;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:cx.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:hx.defaultData,states:new ti,events:new ti,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...ux.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...As.defaultData,...Zf.defaultData,geometry:Qf.defaultData("RectangleGeometry"),material:js.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...As.defaultData,...Zf.defaultData,geometry:Qf.defaultData("BooleanGeometry"),material:js.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...As.defaultData,...Zf.defaultData,geometry:Qf.defaultData("ShapeBlendGeometry"),material:js.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...As.defaultData,...Zf.defaultData,geometry:Qf.defaultData("TextGeometry"),material:js.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...As.defaultData,...Zf.defaultData,geometry:Qf.defaultData("InputGeometry"),material:js.defaultTwoLayerData("phong","layer1","layer2")}))(QL||(QL={}));var vg;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new os}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new os})))):Xg.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=s_(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&ks.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=s_(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[f,m]of Object.entries(d.layers)){let v=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(f);v&&ks.patch(v,m)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[f,m]of Object.entries(d.layers)){let{texture:v,...g}=m;if(v!==void 0&&Object.keys(v).length>0){let x={path:[...h,"layers",f,"texture"],props:v,type:0};l.push(x)}if(Object.keys(g).length>0){let x={path:[...h,"layers",f],props:g,type:0};l.push(x)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...IL.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[f,m]of Object.entries(d))u(["materials",f],m);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let f={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(f),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let f={path:[h],props:d,type:0};l.push(f)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function n(s,a){var l,c,u,h,d,f;if(a===void 0)return s;let o={...s};if(Object.assign(o,fx.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),Xg.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let m=a;((d=m.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=m.orthographic.zoom),((f=m.perspective)==null?void 0:f.zoom)!==void 0&&(o.perspective.zoom=m.perspective.zoom),m.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=m.isUpVectorFlipped),m.targetOffset!==void 0&&(o.targetOffset=m.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:FL.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:rp.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:rp.merge(o.cloner,a.cloner)});else if(LL.is(s.type)){let m=a;m.intensity!==void 0&&(o.intensity=m.intensity),m.color!==void 0&&(typeof m.color=="string"?o.color=m.color:o.color=ua.clone(m.color))}return o}e.patch=n})(vg||(vg={}));var kT;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(kT||(kT={}));var sp;(e=>e.defaultData={orbitControls:kT.defaultData,playPage:cb,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(sp||(sp={}));var ZL;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(ZL||(ZL={}));var KL;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(KL||(KL={}));var yg;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...ZL.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:KL.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(yg||(yg={}));var o_;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=GT.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(o_||(o_={}));var xg;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:YL.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=QL.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new da;return l.push({fi:1,id:cb,data:{...px.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:sp.defaultData,styles:yg.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new da,publish:sp.defaultData,styles:yg.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:sp.defaultData,styles:yg.defaultData()}},e.emptyData=function(){return{objects:new da,publish:{...sp.defaultData},styles:yg.defaultData()}};function i(n){return{...e.defaultData,objects:ql(n,da.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(xg||(xg={}));var ub;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(ub||(ub={}));var JL;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new ti}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(JL||(JL={}));var S6;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new ti,queries:new ti,autoStart:!0}))(S6||(S6={}));var fa;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(fa||(fa={}));var $L;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])($L||($L={}));var M6;(e=>e.all=[...$L.all,"components"])(M6||(M6={}));var A6;(e=>{function t(){return{images:new di,videos:new di,colors:new di,audios:new di,particles:new di,fonts:new di,materials:new di,components:new di,variables:new di,userAPIs:new di,userWebhooks:new di}}e.defaultData=t})(A6||(A6={}));var zd;(e=>{function t(){return{images:new di,videos:new di,colors:new di,audios:new di,particles:new di,fonts:new di,materials:new di,components:new di,variables:new di,userAPIs:new di,userWebhooks:new di}}e.defaultData=t})(zd||(zd={}));var Ul;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},ql(a,di.prototype)}e.defaultColors=t;function i(){return ql({},di.prototype)}e.defaultImages=i;function r(){return{catelogs:new di,materials:new di,images:new di,videos:new di,colors:new di,audios:new di,particles:new di,fonts:new di,variables:new ti,userAPIs:new di,userWebhooks:new di,lib:zd.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(Ul||(Ul={}));var VT;(e=>e.list=["idle","move","jump","run"])(VT||(VT={}));var HT;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new ti,move:new ti,jump:new ti,run:new ti},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Rr.fromHexAndA(3728051,1)}}))(HT||(HT={}));function E6(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Xu(Vn(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...Vn(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Kf(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function Jf(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=js.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=js.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=js.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==os.prototype&&t(n.material)})})}function o2e(e){Object.assign(e.scene.publish,{orbitControls:{...kT.defaultData,...Vn(e.scene.publish.orbitControls)}})}function l2e(e){Object.assign(e.scene.publish.settings,{video:{...sp.defaultData.settings.video,...Vn(e.scene.publish.settings.video)}})}function c2e(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((uQ.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(a2e.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function u2e(e){e.scene.publish.withBackground=!0}function h2e(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function d2e(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function f2e(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function p2e(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=Vn(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Vn(i).booleanExclude!==!0)}})}function m2e(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function g2e(e){function t(r){Object.setPrototypeOf(r,os.prototype),r.texture&&Object.setPrototypeOf(r.texture,os.prototype)}function i(r){Object.setPrototypeOf(r,os.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=Vn(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=Vn(l).layers;i(c),l.layers=c}})})}function T6(e){e.layers===void 0&&Object.assign(e,js.defaultTwoLayerData("lambert"))}function g3(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...Vn(t),colors:i,steps:r};Object.assign(t,n)}})}function v2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function C6(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&g3(r)}):"material"in i&&typeof i.material!="string"&&g3(i.material)}),Object.values(e.shared.materials).forEach(t=>g3(t))}function y2e(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function x2e(e){e.shared.audios=ql({},di.prototype)}function w2e(e){e.shared.videos=ql({},di.prototype)}function b2e(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function _2e(e){Object.entries(Vn(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Vn(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function S2e(e){e.scene.publish.settings.web.preload=!1}function P6(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function D6(e){e.layers&&e.layers.forEach(t=>{s2e(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function M2e(e){e.shared.fonts=ql({},di.prototype)}function A2e(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function E2e(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=js.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=A2e(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...As.defaultData,...Zf.defaultData,flatShading:!1,wireframe:!1,geometry:{...Qf.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Vn(n.states),events:Vn(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=Vn(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function T2e(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new ti,move:new ti,jump:new ti}});else{let s=new ti;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Gt.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,Xu(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},f={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new ti({fi:0,id:Gt.generateUUID(),data:c},{fi:1,id:Gt.generateUUID(),data:d})};s.push({fi:l,id:o,data:f})}),delete n.targets)}})})}function C2e(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new ti,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...Xu(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...Xu(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Gt.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function R6(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=ks.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function I6(e){Kf(e,R6),Jf(e,R6)}function P2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function D2e(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function R2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=js.defaultTwoLayerData("phong"))})}function I2e(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function L2e(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function O2e(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function z2e(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function B2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function N2e(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function U2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=HT.defaultDataThirdPerson.navmesh)})})}function F2e(e){e.scene.styles||(e.scene.styles=yg.defaultData())}function L6(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function k2e(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Jf(e,L6),Kf(e,L6)}function V2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new ti})})})}function H2e(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}function O6(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function G2e(e,t){if(t<1&&(Jf(e,E6),Kf(e,E6),e.schema=1),t<2&&(o2e(e),e.schema=2),t<3&&(c2e(e),e.schema=3),t<4&&(u2e(e),e.schema=4),t<5&&(h2e(e),e.schema=5),t<6&&(d2e(e),e.schema=6),t<7&&(f2e(e),e.schema=7),t<8&&(e.schema=8),t<9&&(C6(e),e.schema=9),t<10&&(v2e(e),e.schema=10),t<11&&(y2e(e),e.schema=11),t<12&&(C6(e),e.schema=12),t<13&&(x2e(e),e.schema=13),t<14&&(b2e(e),e.schema=14),t<15&&(_2e(e),e.schema=15),t<16&&(S2e(e),e.schema=16),t<17&&(Jf(e,P6),Kf(e,P6),e.schema=17),t<18&&(Jf(e,T6),Kf(e,T6),e.schema=18),t<19&&(l2e(e),e.schema=19),t<20&&(M2e(e),E2e(e),e.schema=20),t<21&&(T2e(e),C2e(e),e.schema=21),t<22&&(I6(e),e.schema=22),t<23&&(P2e(e),e.schema=23),t<24&&(D2e(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(w2e(e),t<25&&(e.schema=25)),t<26&&(p2e(e),e.schema=26),t<27&&(m2e(e),e.schema=27),t<28&&(I6(e),e.schema=28),t<29&&(g2e(e),e.schema=29),t<30&&(R2e(e),e.schema=30),t<31&&(I2e(e),e.schema=31),t<33&&(L2e(e),e.schema=33),t<34&&(O2e(e),e.schema=34),t<35&&(z2e(e),e.schema=35),t<36&&(B2e(e),e.schema=36),t<37&&(N2e(e),e.schema=37),t<38&&(Jf(e,D6),Kf(e,D6),e.schema=38),t<39&&(U2e(e),e.schema=39),t<40&&(F2e(e),e.schema=40),t<41&&(k2e(e),e.schema=41),t<42&&(V2e(e),e.schema=42),t<43&&(H2e(e),e.schema=43),t<99){Jf(e,O6),Kf(e,O6),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=zx);let i=Vn(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=cb,r.insertBefore(null,null,[{id:cb,data:{...px.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Xu(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Xu(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...dx.defaultData,...Xu(e.scene.environment,"usePhysics","gravity")},camera:Vn(e.scene.ownerCamera)??px.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==xg.TRASH_CAN_ID&&r.move(cb,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,hx.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function z6(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function j2e(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function W2e(e){var t;Array.isArray(Vn(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var dy=180/Math.PI;function B6(e){e.rotation=e.rotation.slice(0,3).map(t=>t*dy)}function pQ(e){var i,r;B6(e),e.type==="Page"&&B6(e.camera),(i=e.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*dy))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*dy),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*dy),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=dy,t.extrusion.twist*=dy),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Vn(e.events))&&((r=e.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function X2e(e){e.shared.variables=ql({},di.prototype)}function q2e(e){let t=Vn(e.shared.variables);e.shared.variables=ql(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),ti.prototype)}var ld=115;function mQ(e,t){t(e.data);for(let i of e.children)mQ(i,t)}function Y2e(e){let t=e.schema??104;t!==ld&&t<105&&(mQ(e.asset,pQ),e.schema=105)}function Q2e(e){e.shared.particles=ql({},di.prototype),e.shared.lib&&(e.shared.lib.particles=zd.defaultData().particles)}function Z2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function K2e(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function J2e(e){e.scene.objects.traverse((t,i)=>{var r;Array.isArray(Vn(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,u,h,d,f,m,v,g;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(x=>{x.type==="Transition"&&(x.runMode=s??"Repeat"),(x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(x=>{(x.type==="Transition"||x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(x=>{var S;(S=n.gameActions[x])==null||S.forEach(_=>{_.type==="Transition"&&(_.runMode="Repeat"),_.type==="Animation"&&(_.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(x=>{(x.type==="Transition"||x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Toggle")}),(h=(u=n.dragDropActions)==null?void 0:u.drop)==null||h.forEach(x=>{(x.type==="Transition"||x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(x=>{var S;(S=x.actions)==null||S.forEach(_=>{(_.type==="Transition"||_.type==="Animation"||_.type==="SwitchCamera")&&(_.runMode="Toggle")})})):n.type==="Start"?(f=n.actions)==null||f.forEach(x=>{x.type==="Transition"&&(x.runMode="Once"),(x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(m=n.actions)==null||m.forEach(x=>{x.type==="Transition"&&(x.runMode="Repeat"),(x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(v=n.inActions)==null||v.forEach(x=>{x.type==="Transition"&&(x.runMode="Repeat"),(x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Normal")}),(g=n.outActions)==null||g.forEach(x=>{x.type==="Transition"&&(x.runMode="Repeat"),(x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Normal")}))}))})}function $2e(e){e.shared.userAPIs=ql({},di.prototype),e.shared.userWebhooks=ql({},di.prototype),e.shared.lib&&(e.shared.lib.userAPIs=zd.defaultData().userAPIs,e.shared.lib.userWebhooks=zd.defaultData().userWebhooks)}function gQ(e){let t=e.schema??0;if(t!==ld){console.warn("updating from ",t,"to ",ld),G2e(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=sp.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Jf(e,z6),Kf(e,z6),e.schema=101),t<102&&(j2e(e),e.schema=102),t<104&&(e.shared.catelogs=new di,e.shared.lib=zd.defaultData(),e.schema=104),t<105&&(X2e(e),e.scene.objects.traverse((i,r)=>{pQ(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))Y2e(i);t<106&&(q2e(e),e.schema=106),t<107&&(e.shared.lib.variables=zd.defaultData().variables,e.schema=107),t<109&&(Q2e(e),e.schema=109),t<110&&(Z2e(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{W2e(r)}),e.schema=111),t<112&&(K2e(e),e.schema=112),t<113&&(J2e(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&($2e(e),e.schema=115)}}var GT;(e=>{e.defaultData={schema:ld,scene:xg.defaultData,frames:new di().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ub.defaultData),shared:{...Ul.emptyData(),colors:Ul.defaultColors()}},e.emptyDataForImports=function(){let s=xg.emptyDataWithPage();return{schema:ld,scene:s,frames:new di().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ub.defaultData),shared:{...Ul.emptyData(),colors:Ul.defaultColors(),images:Ul.defaultImages()}}},e.emptyData=function(){return{schema:ld,scene:xg.emptyDataWithPage(),frames:new di().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ub.defaultData),shared:Ul.emptyData()}},e.clipboard2dData=function(){return{schema:ld,scene:xg.emptyData(),frames:new di,shared:Ul.emptyData()}},e.collabHelper={...wL,updateSchema(s){return(s.schema??0)<ld?s_(s,gQ):(s.schema??0)-ld}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:zd.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}e.hasSensitiveData=n})(GT||(GT={}));var eO;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(eO||(eO={}));var N6;(e=>{function t(i){return!0}e.is=t})(N6||(N6={}));var jT;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}e.merge=t;function i(r,n){return PY({position:_d.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:_d.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&_d.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(jT||(jT={}));var tO;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(tO||(tO={}));var U6;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(U6||(U6={}));var WT;(e=>e.defaultData={opacity:1,fill:{color:Rr.fromHexAndA(ml,1),enabled:!0},stroke:{color:Rr.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:Rr.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:Rr.from0to1([0,0,0,1]),enabled:!1,spread:0}})(WT||(WT={}));var wg;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,jT.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(wg||(wg={}));var l_;(e=>e.defaultData={...jT.defaultData,...tO.defaultData,states:new ti,events:new ti,visible:!0,raycastLock:!1})(l_||(l_={}));var mx;(e=>e.defaultData={...l_.defaultData,...WT.defaultData})(mx||(mx={}));var XT;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(XT||(XT={}));var iO;(e=>e.defaultData={...mx.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(iO||(iO={}));var c_;(e=>e.defaultData={...mx.defaultData,...XT.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(c_||(c_={}));var rO;(e=>e.defaultData={...mx.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(rO||(rO={}));var nO;(e=>e.defaultData={...mx.defaultData,type:"path2d",path:"",name:"Path"})(nO||(nO={}));var F6;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(F6||(F6={}));var qT;(e=>e.defaultData={...l_.defaultData,name:"Group",type:"group2d"})(qT||(qT={}));var sO;(e=>e.defaultData=()=>({...l_.defaultData,...XT.defaultData,...WT.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:Rr.fromHexAndA(4737101,1),enabled:!0},stroke:{color:Rr.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(sO||(sO={}));var zg;(e=>{function t(a){switch(a){case"rectangle2d":return{...c_.defaultData};case"ellipse2d":return{...iO.defaultData};case"text2d":return{...rO.defaultData};case"vector2d":return{...c_.defaultData};case"path2d":return{...nO.defaultData};case"frame2d":return{...sO.defaultData()};case"group2d":return{...qT.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(zg||(zg={}));var aO;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new da},e.emptyData=function(){return{type:"scene2d",objects:new da}}))(aO||(aO={}));function bg(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new $t,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let f in h.attributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(h.attributes[f]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let f in h.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(h.morphAttributes[f])}if(t){let f;if(i)f=h.index.count;else if(h.attributes.position!==void 0)f=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,u),c+=f}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let f=e[d].index;for(let m=0;m<f.count;++m)h.push(f.getX(m)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=k6(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let f=[];for(let v=0;v<a[u].length;++v)f.push(a[u][v][d]);let m=k6(f);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(m)}}return l}function k6(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new pi(s,i,r)}var eCe=Math.pow(2,-24),TA=class{constructor(){}};function Nu(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function V6(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function H6(e,t){t.set(e)}function G6(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function CA(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function hw(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function tCe(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new pi(n,1));for(let s=0;s<i;s++)n[s]=s}}function iCe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function v3(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,f=1/0,m=-1/0,v=-1/0,g=-1/0,x=n!==null;for(let S=t*6,_=(t+i)*6;S<_;S+=6){let A=e[S+0],T=e[S+1],E=A-T,I=A+T;E<s&&(s=E),I>l&&(l=I),x&&A<h&&(h=A),x&&A>m&&(m=A);let P=e[S+2],C=e[S+3],L=P-C,z=P+C;L<a&&(a=L),z>c&&(c=z),x&&P<d&&(d=P),x&&P>v&&(v=P);let F=e[S+4],G=e[S+5],N=F-G,q=F+G;N<o&&(o=N),q>u&&(u=q),x&&F<f&&(f=F),x&&F>g&&(g=F)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,x&&(n[0]=h,n[1]=d,n[2]=f,n[3]=m,n[4]=v,n[5]=g)}function rCe(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<n&&(n=d),d>o&&(o=d);let f=e[u+2];f<s&&(s=f),f>l&&(l=f);let m=e[u+4];m<a&&(a=m),m>c&&(c=m)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function nCe(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[a*3+c],e[a*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[a*6+c*2+0],t[a*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[a*6+c*2+1],t[a*6+c*2+1]=d}s++,a--}else return s}}var id=32,sCe=(e,t)=>e.candidate-t.candidate,Of=new Array(id).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),PA=new Float32Array(6);function aCe(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=V6(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=V6(e),a!==-1&&(o=oCe(i,r,n,a));else if(s===2){let l=hw(e),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let f=t[d],m=(t[d+3]-f)/id;if(n<id/4){let v=[...Of];v.length=n;let g=0;for(let S=u;S<h;S+=6,g++){let _=v[g];_.candidate=i[S+2*d],_.count=0;let{bounds:A,leftCacheBounds:T,rightCacheBounds:E}=_;for(let I=0;I<3;I++)E[I]=1/0,E[I+3]=-1/0,T[I]=1/0,T[I+3]=-1/0,A[I]=1/0,A[I+3]=-1/0;CA(S,i,A)}v.sort(sCe);let x=n;for(let S=0;S<x;S++){let _=v[S];for(;S+1<x&&v[S+1].candidate===_.candidate;)v.splice(S+1,1),x--}for(let S=u;S<h;S+=6){let _=i[S+2*d];for(let A=0;A<x;A++){let T=v[A];_>=T.candidate?CA(S,i,T.rightCacheBounds):(CA(S,i,T.leftCacheBounds),T.count++)}}for(let S=0;S<x;S++){let _=v[S],A=_.count,T=n-_.count,E=_.leftCacheBounds,I=_.rightCacheBounds,P=0;A!==0&&(P=hw(E)/l);let C=0;T!==0&&(C=hw(I)/l);let L=1+1.25*(P*A+C*T);L<c&&(a=d,c=L,o=_.candidate)}}else{for(let x=0;x<id;x++){let S=Of[x];S.count=0,S.candidate=f+m+x*m;let _=S.bounds;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0}for(let x=u;x<h;x+=6){let S=~~((i[x+2*d]-f)/m);S>=id&&(S=id-1);let _=Of[S];_.count++,CA(x,i,_.bounds)}let v=Of[id-1];H6(v.bounds,v.rightCacheBounds);for(let x=id-2;x>=0;x--){let S=Of[x],_=Of[x+1];G6(S.bounds,_.rightCacheBounds,S.rightCacheBounds)}let g=0;for(let x=0;x<id-1;x++){let S=Of[x],_=S.count,A=S.bounds,T=Of[x+1].rightCacheBounds;_!==0&&(g===0?H6(A,PA):G6(A,PA,PA)),g+=_;let E=0,I=0;g!==0&&(E=hw(PA)/l);let P=n-g;P!==0&&(I=hw(T)/l);let C=1+1.25*(E*g+I*P);C<c&&(a=d,c=C,o=S.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function oCe(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function lCe(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,f=h*6,m,v,g;a?(m=r[d+0],v=r[d+1],g=r[d+2]):(m=r[d+0]*c+l,v=r[d+1]*c+l,g=r[d+2]*c+l);for(let x=0;x<3;x++){let S,_,A;a?(S=i[u[x]](m),_=i[u[x]](v),A=i[u[x]](g)):(S=o[m+x],_=o[v+x],A=o[g+x]);let T=S;_<T&&(T=_),A<T&&(T=A);let E=S;_>E&&(E=_),A>E&&(E=A);let I=(E-T)/2,P=x*2;s[f+P+0]=T+I,s[f+P+1]=I+(Math.abs(T)+I)*eCe,T<t[x]&&(t[x]=T),E>t[x+3]&&(t[x+3]=E)}}return s}function cCe(e,t){function i(x){d&&d(x/f)}function r(x,S,_,A=null,T=0){if(!m&&T>=l&&(m=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),_<=u||T>=l)return i(S+_),x.offset=S,x.count=_,x;let E=aCe(x.boundingData,A,a,S,_,h);if(E.axis===-1)return i(S+_),x.offset=S,x.count=_,x;let I=nCe(o,a,S,_,E);if(I===S||I===S+_)i(S+_),x.offset=S,x.count=_;else{x.splitAxis=E.axis;let P=new TA,C=S,L=I-S;x.left=P,P.boundingData=new Float32Array(6),v3(a,C,L,P.boundingData,s),r(P,C,L,s,T+1);let z=new TA,F=I,G=_-L;x.right=z,z.boundingData=new Float32Array(6),v3(a,F,G,z.boundingData,s),r(z,F,G,s,T+1)}return x}tCe(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=lCe(e,n),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,f=e.index.count/3,m=!1,v=[],g=iCe(e);if(g.length===1){let x=g[0],S=new TA;S.boundingData=n,rCe(a,x.offset,x.count,s),r(S,x.offset,x.count,s),v.push(S)}else for(let x of g){let S=new TA;S.boundingData=new Float32Array(6),v3(a,x.offset,x.count,S.boundingData,s),r(S,x.offset,x.count,s),v.push(S)}return v}function uCe(e,t){let i=cCe(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),f=new o(32*d);r=new Float32Array(f),n=new Uint32Array(f),s=new Uint16Array(f),c(0,h),a.push(f)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,f=u/2,m=!!h.count,v=h.boundingData;for(let g=0;g<6;g++)r[d+g]=v[g];if(m){let g=h.offset,x=h.count;return n[d+6]=g,s[f+14]=x,s[f+15]=65535,u+32}else{let g=h.left,x=h.right,S=h.splitAxis,_;if(_=c(u+32,g),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=_/4,_=c(_,x),n[d+7]=S,_}}}var Bd=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};Bd.prototype.setFromBox=function(){let e=new k;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*c+n.z*(1-c);let u=t.dot(e);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var hCe=function(){let e=new k,t=new k,i=new k;return function(r,n,s){let a=r.start,o=e,l=n.start,c=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),f=i.dot(o),m=o.dot(o)*d-h*h,v,g;m!==0?v=(u*h-f*d)/m:v=0,g=(u+v*h)/d,s.x=v,s.y=g}}(),vN=function(){let e=new Ee,t=new k,i=new k;return function(r,n,s,a){hCe(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=t,d=i;if(r.closestPointToPoint(u,!0,t),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),dCe=function(){let e=new k,t=new k,i=new zo,r=new Gl;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),fCe=1e-15;function W0(e){return Math.abs(e)<fCe}var Nd=class extends ha{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new k),this.satBounds=new Array(4).fill().map(()=>new Bd),this.points=[this.a,this.b,this.c],this.sphere=new jo,this.plane=new zo,this.needsUpdate=!0}intersectsSphere(e){return dCe(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,r);let d=n[3],f=s[3];d.subVectors(i,e),f.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Nd.prototype.closestPointToSegment=function(){let e=new k,t=new k,i=new Gl;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),vN(i,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();Nd.prototype.intersectsTriangle=function(){let e=new Nd,t=new Array(3),i=new Array(3),r=new Bd,n=new Bd,s=new k,a=new k,o=new k,l=new k,c=new Gl,u=new Gl,h=new Gl;return function(d,f=null,m=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let v=this.plane,g=d.plane;if(Math.abs(v.normal.dot(g.normal))>1-1e-10){let x=this.satBounds,S=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let T=0;T<4;T++){let E=x[T],I=S[T];if(r.setFromPoints(I,i),E.isSeparated(r))return!1}let _=d.satBounds,A=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let T=0;T<4;T++){let E=_[T],I=A[T];if(r.setFromPoints(I,t),E.isSeparated(r))return!1}for(let T=0;T<4;T++){let E=S[T];for(let I=0;I<4;I++){let P=A[I];if(s.crossVectors(E,P),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return f&&(m||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{let x=this.points,S=!1,_=0;for(let G=0;G<3;G++){let N=x[G],q=x[(G+1)%3];c.start.copy(N),c.end.copy(q),c.delta(a);let ie=S?u.start:u.end,Q=W0(g.distanceToPoint(N));if(W0(g.normal.dot(a))&&Q){u.copy(c),_=2;break}if((g.intersectLine(c,ie)||Q)&&!W0(ie.distanceTo(q))){if(_++,S)break;S=!0}}if(_===1&&d.containsPoint(u.end))return f&&(f.start.copy(u.end),f.end.copy(u.end)),!0;if(_!==2)return!1;let A=d.points,T=!1,E=0;for(let G=0;G<3;G++){let N=A[G],q=A[(G+1)%3];c.start.copy(N),c.end.copy(q),c.delta(o);let ie=T?h.start:h.end,Q=W0(v.distanceToPoint(N));if(W0(v.normal.dot(o))&&Q){h.copy(c),E=2;break}if((v.intersectLine(c,ie)||Q)&&!W0(ie.distanceTo(q))){if(E++,T)break;T=!0}}if(E===1&&this.containsPoint(h.end))return f&&(f.start.copy(h.end),f.end.copy(h.end)),!0;if(E!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let G=h.start;h.start=h.end,h.end=G}let I=u.start.dot(a),P=u.end.dot(a),C=h.start.dot(a),L=h.end.dot(a),z=P<C,F=I<L;return I!==L&&C!==P&&z===F?!1:(f&&(l.subVectors(u.start,h.start),l.dot(a)>0?f.start.copy(u.start):f.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?f.end.copy(u.end):f.end.copy(h.end)),!0)}}}();Nd.prototype.distanceToPoint=function(){let e=new k;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Nd.prototype.distanceToTriangle=function(){let e=new k,t=new k,i=["a","b","c"],r=new Gl,n=new Gl;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],f=s[d];this.closestPointToPoint(f,e),h=f.distanceToSquared(e),h<c&&(c=h,a&&a.copy(e),o&&o.copy(f));let m=this[d];s.closestPointToPoint(m,e),h=m.distanceToSquared(e),h<c&&(c=h,a&&a.copy(m),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let f=0;f<3;f++){let m=i[f],v=i[(f+1)%3];n.set(s[m],s[v]),vN(r,n,e,t);let g=e.distanceToSquared(t);g<c&&(c=g,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var eh=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new k,this.max=new k,this.matrix=new St,this.invMatrix=new St,this.points=new Array(8).fill().map(()=>new k),this.satAxes=new Array(3).fill().map(()=>new k),this.satBounds=new Array(3).fill().map(()=>new Bd),this.alignedSatBounds=new Array(3).fill().map(()=>new Bd),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};eh.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();eh.prototype.intersectsBox=function(){let e=new Bd;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();eh.prototype.intersectsTriangle=function(){let e=new Nd,t=new Array(3),i=new Bd,r=new Bd,n=new k;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],f=o[h];if(i.setFromPoints(f,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],f=c[h];if(i.setFromPoints(f,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let f=0;f<4;f++){let m=c[f];if(n.crossVectors(d,m),i.setFromPoints(n,t),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}}();eh.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();eh.prototype.distanceToPoint=function(){let e=new k;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();eh.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Gl),i=new Array(12).fill().map(()=>new Gl),r=new k,n=new k;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,f=1/0;for(let v=0;v<8;v++){let g=d[v];n.copy(g).clamp(u,h);let x=g.distanceToSquared(n);if(x<f&&(f=x,o&&o.copy(g),l&&l.copy(n),x<c))return Math.sqrt(x)}let m=0;for(let v=0;v<3;v++)for(let g=0;g<=1;g++)for(let x=0;x<=1;x++){let S=(v+1)%3,_=(v+2)%3,A=g<<S|x<<_,T=1<<v|g<<S|x<<_,E=d[A],I=d[T];t[m].set(E,I);let P=e[v],C=e[S],L=e[_],z=i[m],F=z.start,G=z.end;F[P]=u[P],F[C]=g?u[C]:h[C],F[L]=x?u[L]:h[C],G[P]=h[P],G[C]=g?u[C]:h[C],G[L]=x?u[L]:h[C],m++}for(let v=0;v<=1;v++)for(let g=0;g<=1;g++)for(let x=0;x<=1;x++){n.x=v?h.x:u.x,n.y=g?h.y:u.y,n.z=x?h.z:u.z,this.closestPointToPoint(n,r);let S=n.distanceToSquared(r);if(S<f&&(f=S,o&&o.copy(r),l&&l.copy(n),S<c))return Math.sqrt(S)}for(let v=0;v<12;v++){let g=t[v];for(let x=0;x<12;x++){let S=i[x];vN(g,S,r,n);let _=r.distanceToSquared(n);if(_<f&&(f=_,o&&o.copy(r),l&&l.copy(n),_<c))return Math.sqrt(_)}}return Math.sqrt(f)}}();var X0=new k,q0=new k,Y0=new k,DA=new Ee,RA=new Ee,IA=new Ee,j6=new k,W6=new k,X6=new k,LA=new k;function pCe(e,t,i,r,n,s){let a;return s===Ws?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==Oa,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function mCe(e,t,i,r,n,s,a,o,l){X0.fromBufferAttribute(t,s),q0.fromBufferAttribute(t,a),Y0.fromBufferAttribute(t,o);let c=pCe(e,X0,q0,Y0,LA,l);if(c){r&&(DA.fromBufferAttribute(r,s),RA.fromBufferAttribute(r,a),IA.fromBufferAttribute(r,o),c.uv=ha.getInterpolation(LA,X0,q0,Y0,DA,RA,IA,new Ee)),n&&(DA.fromBufferAttribute(n,s),RA.fromBufferAttribute(n,a),IA.fromBufferAttribute(n,o),c.uv1=ha.getInterpolation(LA,X0,q0,Y0,DA,RA,IA,new Ee)),i&&(j6.fromBufferAttribute(i,s),W6.fromBufferAttribute(i,a),X6.fromBufferAttribute(i,o),c.normal=ha.getInterpolation(LA,X0,q0,Y0,j6,W6,X6,new k),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new k,materialIndex:0};ha.getNormal(X0,q0,Y0,u.normal),c.face=u,c.faceIndex=s}return c}function vQ(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,f=mCe(i,c,u,h,d,a,o,l,t);return f?(f.faceIndex=r,n&&n.push(f),f):null}function gCe(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)vQ(e,t,i,a,s)}function vCe(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=vQ(e,t,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function Ou(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function q6(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(Ou(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var yQ=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function $f(e,t){return t[e+15]===65535}function Uy(e,t){return t[e+6]}function u_(e,t){return t[e+14]}function h_(e){return e+8}function d_(e,t){return t[e+6]}function yCe(e,t){return t[e+7]}var Dy=new Gn,YT=new k,xCe=["x","y","z"];function oO(e,t,i,r,n){let s=e*2,a=Bx,o=gp,l=vp;if($f(s,o)){let c=Uy(e,l),u=u_(s,o);gCe(t,i,r,c,u,n)}else{let c=h_(e);QT(c,a,r,YT)&&oO(c,t,i,r,n);let u=d_(e,l);QT(u,a,r,YT)&&oO(u,t,i,r,n)}}function lO(e,t,i,r){let n=e*2,s=Bx,a=gp,o=vp;if($f(n,a)){let l=Uy(e,o),c=u_(n,a);return vCe(t,i,r,l,c)}else{let l=yCe(e,o),c=xCe[l],u=r.direction[c]>=0,h,d;u?(h=h_(e),d=d_(e,o)):(h=d_(e,o),d=h_(e));let f=QT(h,s,r,YT)?lO(h,t,i,r):null;if(f){let v=f.point[c];if(u?v<=s[d+l]:v>=s[d+l+3])return f}let m=QT(d,s,r,YT)?lO(d,t,i,r):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}var wCe=function(){let e,t,i=[],r=new yQ(()=>new Gn);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(S){let _=S*2,A=gp,T=vp;for(;!$f(_,A);)S=h_(S),_=S*2;return Uy(S,T)}function f(S){let _=S*2,A=gp,T=vp;for(;!$f(_,A);)S=d_(S,T),_=S*2;return Uy(S,T)+u_(_,A)}let m=s*2,v=Bx,g=gp,x=vp;if($f(m,g)){let S=Uy(s,x),_=u_(m,g);return Nu(s,v,e),l(S,_,!1,h,u+s,e)}else{let S=h_(s),_=d_(s,x),A=S,T=_,E,I,P,C;if(c&&(P=e,C=t,Nu(A,v,P),Nu(T,v,C),E=c(P),I=c(C),I<E)){A=_,T=S;let ie=E;E=I,I=ie,P=C}P||(P=e,Nu(A,v,P));let L=$f(A*2,g),z=o(P,L,E,h+1,u+A),F;if(z===2){let ie=d(A),Q=f(A)-ie;F=l(ie,Q,!0,h+1,u+A,P)}else F=z&&n(A,a,o,l,c,u,h+1);if(F)return!0;C=t,Nu(T,v,C);let G=$f(T*2,g),N=o(C,G,I,h+1,u+T),q;if(N===2){let ie=d(T),Q=f(T)-ie;q=l(ie,Q,!0,h+1,u+T,C)}else q=N&&n(T,a,o,l,c,u,h+1);return!!q}}}(),bCe=function(){let e=new Nd,t=new Nd,i=new St,r=new eh,n=new eh;return function s(a,o,l,c,u=null){let h=a*2,d=Bx,f=gp,m=vp;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),$f(h,f)){let v=o,g=v.index,x=v.attributes.position,S=l.index,_=l.attributes.position,A=Uy(a,m),T=u_(h,f);if(i.copy(c).invert(),l.boundsTree)return Nu(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:E=>n.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(c),E.b.applyMatrix4(c),E.c.applyMatrix4(c),E.needsUpdate=!0;for(let I=A*3,P=(T+A)*3;I<P;I+=3)if(Ou(t,I,g,x),t.needsUpdate=!0,E.intersectsTriangle(t))return!0;return!1}});for(let E=A*3,I=T+A*3;E<I;E+=3){Ou(e,E,g,x),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let P=0,C=S.count;P<C;P+=3)if(Ou(t,P,S,_),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let v=a+8,g=m[a+6];return Nu(v,d,Dy),!!(u.intersectsBox(Dy)&&s(v,o,l,c,u)||(Nu(g,d,Dy),u.intersectsBox(Dy)&&s(g,o,l,c,u)))}}}();function QT(e,t,i,r){return Nu(e,t,Dy),i.intersectBox(Dy,r)}var cO=[],IE,Bx,gp,vp;function Fw(e){IE&&cO.push(IE),IE=e,Bx=new Float32Array(e),gp=new Uint16Array(e),vp=new Uint32Array(e)}function OA(){IE=null,Bx=null,gp=null,vp=null,cO.length&&Fw(cO.pop())}var y3=Symbol("skip tree generation"),x3=new Gn,w3=new Gn,Q0=new St,Vm=new eh,dw=new eh,fw=new k,zA=new k,_Ce=new k,SCe=new k,MCe=new k,Y6=new Gn,yu=new yQ(()=>new Nd),hb=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),hb.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),hb.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new hb(t,{...i,[y3]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new pi(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[y3]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[y3]||(this._roots=uCe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Gn))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,f=!1){let m=h*2;if(a[m+15]===65535){let v=s[h+6],g=a[m+14],x=1/0,S=1/0,_=1/0,A=-1/0,T=-1/0,E=-1/0;for(let I=3*v,P=3*(v+g);I<P;I++){let C=i[I],L=r.getX(C),z=r.getY(C),F=r.getZ(C);L<x&&(x=L),L>A&&(A=L),z<S&&(S=z),z>T&&(T=z),F<_&&(_=F),F>E&&(E=F)}return o[h+0]!==x||o[h+1]!==S||o[h+2]!==_||o[h+3]!==A||o[h+4]!==T||o[h+5]!==E?(o[h+0]=x,o[h+1]=S,o[h+2]=_,o[h+3]=A,o[h+4]=T,o[h+5]=E,!0):!1}else{let v=h+8,g=s[h+6],x=v+d,S=g+d,_=f,A=!1,T=!1;e?_||(A=e.has(x),T=e.has(S),_=!A&&!T):(A=!0,T=!0);let E=_||A,I=_||T,P=!1;E&&(P=u(v,d,_));let C=!1;I&&(C=u(g,d,_));let L=P||C;if(L)for(let z=0;z<3;z++){let F=v+z,G=g+z,N=o[F],q=o[F+3],ie=o[G],Q=o[G+3];o[h+z]=N<ie?N:ie,o[h+z+3]=q>Q?q:Q}return L}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];e(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];e(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=Yc){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=a?t[o[c].materialIndex].side:l,d=n.length;if(Fw(i[c]),oO(0,r,h,e,n),OA(),a){let f=o[c].materialIndex;for(let m=d,v=n.length;m<v;m++)n[m].face.materialIndex=f}}return n}raycastFirst(e,t=Yc){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;Fw(i[c]);let d=lO(0,r,h,e);OA(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(Fw(n),r=bCe(0,i,e,t),OA(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,f,m,v)=>{let g=f*3;return h(d,g,g+1,g+2,m,v)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=yu.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,f,m,v,g)=>h(d,f,m,v,g)?!0:q6(d,f,r,l,m,v,n)}else o||(l?o=(h,d,f,m)=>q6(h,d,r,l,f,m,n):o=(h,d,f)=>f);let c=!1,u=0;for(let h of this._roots){if(Fw(h),c=wCe(0,r,a,o,s,u),OA(),c)break;u+=h.byteLength}return yu.releasePrimitive(n),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Q0.copy(t).invert();let c=yu.getPrimitive(),u=yu.getPrimitive();if(n){let d=function(f,m,v,g,x,S,_,A){for(let T=v,E=v+g;T<E;T++){Ou(u,T*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let I=f,P=f+m;I<P;I++)if(Ou(c,I*3,s,a),c.needsUpdate=!0,n(c,u,I,T,x,S,_,A))return!0}return!1};if(r){let f=r;r=function(m,v,g,x,S,_,A,T){return f(m,v,g,x,S,_,A,T)?!0:d(m,v,g,x,S,_,A,T)}}else r=d}e.getBoundingBox(w3),w3.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>w3.intersectsBox(d),intersectsRange:(d,f,m,v,g,x)=>(x3.copy(x),x3.applyMatrix4(Q0),e.shapecast({intersectsBounds:S=>x3.intersectsBox(S),intersectsRange:(S,_,A,T,E)=>r(d,f,S,_,v,g,T,E)}))});return yu.releasePrimitive(c),yu.releasePrimitive(u),h}intersectsBox(e,t){return Vm.set(e.min,e.max,t),Vm.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Vm.intersectsBox(i),intersectsTriangle:i=>Vm.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),Vm.set(e.boundingBox.min,e.boundingBox.max,t),Vm.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=yu.getPrimitive(),d=yu.getPrimitive(),f=zA,m=_Ce,v=null,g=null;r&&(v=SCe,g=MCe);let x=1/0,S=null,_=null;return Q0.copy(t).invert(),dw.matrix.copy(Q0),this.shapecast({boundsTraverseOrder:A=>Vm.distanceToBox(A),intersectsBounds:(A,T,E)=>E<x&&E<s?(T&&(dw.min.copy(A.min),dw.max.copy(A.max),dw.needsUpdate=!0),!0):!1,intersectsRange:(A,T)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:E=>dw.distanceToBox(E),intersectsBounds:(E,I,P)=>P<x&&P<s,intersectsRange:(E,I)=>{for(let P=E*3,C=(E+I)*3;P<C;P+=3){Ou(d,P,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let L=A*3,z=(A+T)*3;L<z;L+=3){Ou(h,L,l,o),h.needsUpdate=!0;let F=h.distanceToTriangle(d,f,v);if(F<x&&(m.copy(f),g&&g.copy(v),x=F,S=L/3,_=P/3),F<n)return!0}}}});{let E=u?u.count:c.count;for(let I=0,P=E;I<P;I+=3){Ou(d,I,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=A*3,L=(A+T)*3;C<L;C+=3){Ou(h,C,l,o),h.needsUpdate=!0;let z=h.distanceToTriangle(d,f,v);if(z<x&&(m.copy(f),g&&g.copy(v),x=z,S=C/3,_=I/3),z<n)return!0}}}}}),yu.releasePrimitive(h),yu.releasePrimitive(d),x===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=x,i.faceIndex=S,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(Q0),m.applyMatrix4(Q0),r.distance=m.sub(r.point).length(),r.faceIndex=_),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(fw.copy(e).clamp(c.min,c.max),fw.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,fw);let h=e.distanceToSquared(fw);return h<a&&(zA.copy(fw),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(zA):t.point=zA.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Nu(0,new Float32Array(t),Y6),e.union(Y6)}),e}},uO=zp(Afe()),ACe=.5*(Math.sqrt(3)-1),pw=(3-Math.sqrt(3))/6,ECe=1/3,xu=1/6,db=e=>Math.floor(e)|0,Q6=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),b3=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function TCe(e=Math.random){let t=xQ(e),i=new Float64Array(t).map(n=>Q6[n%12*2]),r=new Float64Array(t).map(n=>Q6[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*ACe,u=db(n+c),h=db(s+c),d=(u+h)*pw,f=u-d,m=h-d,v=n-f,g=s-m,x,S;v>g?(x=1,S=0):(x=0,S=1);let _=v-x+pw,A=g-S+pw,T=v-1+2*pw,E=g-1+2*pw,I=u&255,P=h&255,C=.5-v*v-g*g;if(C>=0){let F=I+t[P],G=i[F],N=r[F];C*=C,a=C*C*(G*v+N*g)}let L=.5-_*_-A*A;if(L>=0){let F=I+x+t[P+S],G=i[F],N=r[F];L*=L,o=L*L*(G*_+N*A)}let z=.5-T*T-E*E;if(z>=0){let F=I+1+t[P+1],G=i[F],N=r[F];z*=z,l=z*z*(G*T+N*E)}return 70*(a+o+l)}}function CCe(e=Math.random){let t=xQ(e),i=new Float64Array(t).map(s=>b3[s%12*3]),r=new Float64Array(t).map(s=>b3[s%12*3+1]),n=new Float64Array(t).map(s=>b3[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*ECe,f=db(s+d),m=db(a+d),v=db(o+d),g=(f+m+v)*xu,x=f-g,S=m-g,_=v-g,A=s-x,T=a-S,E=o-_,I,P,C,L,z,F;A>=T?T>=E?(I=1,P=0,C=0,L=1,z=1,F=0):A>=E?(I=1,P=0,C=0,L=1,z=0,F=1):(I=0,P=0,C=1,L=1,z=0,F=1):T<E?(I=0,P=0,C=1,L=0,z=1,F=1):A<E?(I=0,P=1,C=0,L=0,z=1,F=1):(I=0,P=1,C=0,L=1,z=1,F=0);let G=A-I+xu,N=T-P+xu,q=E-C+xu,ie=A-L+2*xu,Q=T-z+2*xu,W=E-F+2*xu,ee=A-1+3*xu,K=T-1+3*xu,j=E-1+3*xu,$=f&255,se=m&255,re=v&255,he=.6-A*A-T*T-E*E;if(he<0)l=0;else{let be=$+t[se+t[re]];he*=he,l=he*he*(i[be]*A+r[be]*T+n[be]*E)}let oe=.6-G*G-N*N-q*q;if(oe<0)c=0;else{let be=$+I+t[se+P+t[re+C]];oe*=oe,c=oe*oe*(i[be]*G+r[be]*N+n[be]*q)}let ve=.6-ie*ie-Q*Q-W*W;if(ve<0)u=0;else{let be=$+L+t[se+z+t[re+F]];ve*=ve,u=ve*ve*(i[be]*ie+r[be]*Q+n[be]*W)}let xe=.6-ee*ee-K*K-j*j;if(xe<0)h=0;else{let be=$+1+t[se+1+t[re+1]];xe*=xe,h=xe*xe*(i[be]*ee+r[be]*K+n[be]*j)}return 32*(l+c+u+h)}}function xQ(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var Mc=new ha,PCe=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;Mc.a.fromBufferAttribute(e,r),Mc.b.fromBufferAttribute(e,r+1),Mc.c.fromBufferAttribute(e,r+2),n*=Mc.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),Mc.a.fromBufferAttribute(this.positionAttribute,e*3),Mc.b.fromBufferAttribute(this.positionAttribute,e*3+1),Mc.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Mc.a,r).addScaledVector(Mc.b,n).addScaledVector(Mc.c,1-(r+n)),Mc.getNormal(i),this}},DCe=zp($X()),RCe=new St,ICe=new St,LCe=new St,qg;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(qg||(qg={}));var yN=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new St,this.copyPreviousMatrix=!0,this.hiddenMatrix=new St,this.matrixWorldRigid=new St,this.shearScale=new St,this.shearScaleInv=new St}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof Mr&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)qg.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)qg.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,DCe.SVD)(i),a=RCe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=ICe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=LCe.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new St().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof St?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},OCe=class extends yN(Mr){},zCe=e=>e.type==="Mesh",pa=class extends OCe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new pa(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return zCe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},ng=new k,sg=new k,Fy=new St,wQ=[new k(-1,1,1),new k(-1,-1,1),new k(1,-1,1),new k(1,1,1),new k(-1,1,-1),new k(-1,-1,-1),new k(1,-1,-1),new k(1,1,-1)],BCe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],NCe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Z6=(e,t,i)=>{e.updateEntityBoxSize(ng,sg),Fy.copy(t).multiply(e.matrixWorld),sg.x===0&&sg.y===0&&sg.z===0?i.push(new k(ng.x,ng.y,ng.z).applyMatrix4(Fy)):wQ.forEach(r=>{i.push(r.clone().multiply(sg).add(ng).applyMatrix4(Fy))})},K6=class extends Gn{constructor(){super(...arguments),this.matrix=new St,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new St().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new k);return}Z6(n,t,r)}}):Z6(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Fy.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(sg).multiplyScalar(.5),this.getCenter(ng),Fy.copy(this.matrix).setPosition(ng),this.vertices=wQ.map(e=>e.clone().multiply(sg).applyMatrix4(Fy))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=BCe.map(([e,t])=>new Gl(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new k))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=NCe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},ap={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},UCe=class extends Pq{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},hO=.001;function dO(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=hO}function _3(e,t){let i=new k(...e.position),r=new k(...e.controlNext.position),n=new k(...t.controlPrevious.position),s=new k(...t.position);return dO(i,r,s)&&dO(i,n,s)}function bQ(e){let t=e.points.map(u=>new k(...u.data.position)),i=[e.points[0]],r=new k(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)dO(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new k(...h.position),f=new k(...h.controlPrevious.position),m=new k(...h.controlNext.position),v={position:d,baseRoundness:h.roundness,controlPrevious:f,controlNext:m};if(h.roundness===0||!e.isClosed&&(u===0||u===a-1)){o[u]={...v,removedLength:0};continue}let g=n&&u==0?a-1:u-1,x=n&&u==a-1?0:u+1,S=i[g].data,_=i[x].data,A=new k(...S.position),T=new k(..._.position),E=A.clone().sub(d).normalize(),I=T.clone().sub(d).normalize();Object.assign(v,{prevDir:E,nextDir:I});let P=_3(S,h),C=_3(h,_);if(!P||!C)o[u]={...v,removedLength:0};else{let L=E.clone().add(I).normalize(),z=L.clone().cross(E).length()/E.dot(L);o[u]={...v,tan:z,removedLength:h.roundness/z}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,f=o[h],m=o[d];if(f.removedLength!==0||m.removedLength!==0){let v=f.position.distanceTo(m.position);f.removedLength=Math.min(f.removedLength,v/2),m.removedLength=Math.min(m.removedLength,v/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,f=o[h],m=o[d],v=null;if(!_3(i[h].data,i[d].data))f.position.distanceTo(m.position)>hO&&(v=new TE(f.position,f.controlNext,m.controlPrevious,m.position));else{let g=f.position.clone(),x=m.position.clone();(f.removedLength!==0||m.removedLength!==0)&&(f.nextDir&&g.add(f.nextDir.clone().setLength(f.removedLength)),m.prevDir&&x.add(m.prevDir.clone().setLength(m.removedLength))),g.distanceTo(x)>hO&&(v=new TE(g,g.clone().lerp(x,.3),x.clone().lerp(g,.3),x))}l[2*u+1]=v}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,f=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),m=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),v=h.tan*h.removedLength,g=h.prevDir.clone().add(h.nextDir).normalize(),x=f.clone().lerp(m,.5),S=f.distanceTo(m)/2,_=g.clone().multiplyScalar(Math.sqrt(Math.pow(v,2)-Math.pow(S,2))).add(x),A=g.clone().multiplyScalar(-v).add(_),T=d.distanceTo(A)/d.distanceTo(x),E=h.prevDir.clone().multiplyScalar(T*d.distanceTo(f)).add(d),I=E.clone().lerp(A,2),P=f.clone().lerp(E,4/3),C=m.clone().lerp(I,4/3);l[2*u]=new TE(f,P,C,m)}let c=new UCe;return l.forEach(u=>{u&&c.add(u)}),c}var tr;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(tr||(tr={}));var cd=e=>tr.is(e),FCe={type:"completeState",isfromEntity:!0},kCe=["x","y","z"],S3=new k,VCe=new k().set(0,1,0),xN=e=>class extends yN(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new K6,this._recursiveBBox=new K6,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(tr.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(tr.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(tr.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)vg.toOps(this.data,n.data).forEach(s=>{let a=CT.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=vg.patch(this.data,n),vg.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{cd(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(tr.is(i[r]))return i[r];if(tr.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&tr.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)cd(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{tr.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)cd(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)cd(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)cd(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>cd(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Gt.RAD2DEG,this.rotation.y*Gt.RAD2DEG,this.rotation.z*Gt.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return xL(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,t,kCe[s]]))??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(S3.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Gt.DEG2RAD),this.rotation.setFromVector3(S3),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??cx.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)tr.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{tr.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return xL(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=kr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Ms.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Ms.removeOverridden(t.path,t.props,l);a={...t,props:c}}}if(this.updateByPatchedOpBase(a,vg.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),kr(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(pp.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=Ms.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[f,m]of Object.entries(t.props))m===void 0&&(d===t.props&&(d={...t.props}),d[f]=h[f]);t={...t,props:d}}u.overrideData=FT.resolve(i.overrides,l),u.updateByOp(t,Gs.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of np.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of np.rootOverrideProps)if(kr(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=pp.filterOp(c.overrideData,l);u&&c.updateByOp(u,Gs.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=pp.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=Gs.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Xg.is(t.props.type)&&ap.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){ap.changeEntityProptotype(this,i,r);for(let n of this.children)tr.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){var n;if(t.path.length===0&&t.type===0?this.updateState(t.props,r):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,r),t.path[0]==="morphTargetInfluences"&&t.type===0){let s=(n=i.morphTargetInfluences.get(t.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",s]))}if(kr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),kr(t.path,["cloner"])!==null){let s=Gs.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var m,v,g,x,S;let i=((m=this._updatedPathSnapping)==null?void 0:m.pathId)??this.dataPatched.pathSnapping.pathId,r=((v=this._updatedPathSnapping)==null?void 0:v.slide)??this.dataPatched.pathSnapping.slide??0,n=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset??0,s=((x=this._updatedPathSnapping)==null?void 0:x.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=bQ(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?(S=this.parent)==null?void 0:S.matrixWorld:new St;a.updateMatrixWorld();let d=new St().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let f={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let _=new St().extractRotation(a.matrixWorld),A=l.getTangentAt(c).applyMatrix4(_).add(u),T=new St().lookAt(u,A,VCe),E=S3.setFromEuler(new Ss().setFromRotationMatrix(T)).multiplyScalar(Gt.RAD2DEG);f={...f,rotation:E.toArray()}}this.updateTransformState(f),this.traverseEntity(_=>{_._cameraType&&_.dispatchEvent(FCe)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof ap.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new ap.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},_Q=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var l,c;let i=(l=e.parameters)==null?void 0:l.radiusTop,r=(c=e.parameters)==null?void 0:c.radiusBottom,n=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);n.thetaLength=Gt.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let u=Math.max(a,o)*2;n.width=u,n.depth=u}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:f}=e.parameters,m;return l===0?(m=new $t,m.setAttribute("position",new kt([],3))):h||f?m=new SQ(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,f):m=new NB(c,u,r,n,s,a,o,l*Math.PI/180),m.scale(1,1,i/t),Object.assign(m,{userData:{...e,type:"CylinderGeometry"}})}};function zf(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function J6(e){return new Ee(e.y,-e.x)}var SQ=class extends $t{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let f=[],m=[],v=[],g=[],x=0,S=i/2,_=new k,A=new k;d&&e==0&&(e=l),d&&t==0&&(t=c);let T=new Ee(e,S),E=new Ee(t,-S),I=null,P=null,C=null,L=null,z=T.clone().sub(E),F=0,G=0,N=0;h>0&&(F=Math.min(e,t)*(1-h),G=e-F,N=t-F);let q=T.clone();q.x-=F;let ie=Math.PI-z.angle(),Q=z.angle(),W=Math.tan(Q/2),ee=Math.tan(ie/2),K=W+ee,j=h?K:ee,$=h?K:W;if(l=Math.min(l,(e-G)/j,z.length()/K),c=Math.min(c,(t-N)/$,z.length()/K),l>0){let xe=l/W;I=T.clone().sub(new Ee(xe,l)),h&&(C=I.clone(),C.x-=F-K*l),T.sub(z.clone().setLength(xe))}if(c>0){let xe=c/ee;P=E.clone().sub(new Ee(xe,-c)),E.add(z.clone().setLength(xe)),h&&(L=P.clone(),L.x-=F-K*c,q.sub(z.clone().setLength(xe)))}z=T.clone().sub(E);let se=z.length()<.5,re=[];for(let xe=0;xe<=r;xe++){let be=[],Me=xe/r,Te=Me*o+a,ae=new Ee(Math.sin(Te),Math.cos(Te));L&&P?(he(be,Me,ae,ie,c,L,-1,!0),he(be,Me,ae,Q,c,P,-1,!1)):P?(oe(be,ae,P.x,0,-1),he(be,Me,ae,Q,c,P,-1,!1)):s||oe(be,ae,t,N,-1);let Ce=J6(z).normalize();if(zf(Ce,ae,_),!se)for(let Ie=0;Ie<=n;Ie++){let Be=Ie/n,Ve=z.clone().multiplyScalar(Be).add(E);zf(Ve,ae,A),m.push(A.x,A.y,A.z),v.push(_.x,_.y,_.z),g.push(Me,.5+A.y/i),be.push(x++)}if(C&&I?(he(be,Me,ae,ie,l,I,1,!1),he(be,Me,ae,Q,l,C,1,!0)):I?(he(be,Me,ae,ie,l,I,1,!1),oe(be,ae,I.x,0,1)):s||oe(be,ae,e,G,1),h&&!se){let Ie=J6(z).multiplyScalar(-1).normalize();zf(Ie,ae,_);for(let Be=0;Be<=n;Be++){let Ve=Be/n,lt=z.clone().multiplyScalar(-Ve).add(q);zf(lt,ae,A),m.push(A.x,A.y,A.z),v.push(_.x,_.y,_.z),g.push(Me,.5+A.y/i),be.push(x++)}}h&&!s&&be.push(be[0]),re.push(be)}for(let xe=0;xe<re.length-1;xe++)for(let be=0;be<re[0].length-1;be++){if(s&&h&&be==n)continue;let Me=re[xe][be],Te=re[xe+1][be],ae=re[xe+1][be+1],Ce=re[xe][be+1],Ie=m[ae*3+0],Be=m[ae*3+2];f.push(Me,Te,Ce),(Ie!=0||Be!=0)&&f.push(Te,ae,Ce)}o<Math.PI*2&&(ve(-1,re[0],a),ve(1,re[re.length-1],a+o)),this.setIndex(f),this.setAttribute("position",new kt(m,3)),this.setAttribute("normal",new kt(v,3)),this.setAttribute("uv",new kt(g,2));function he(xe,be,Me,Te,ae,Ce,Ie,Be){for(let Ve=0;Ve<u+1;Ve++){let lt=Ve/u,We=Ie<0?lt:1-lt;Be&&(We-=1),We*=Te;let je=new Ee(Math.sin(We),Math.cos(We)*Ie),xt=je.clone().multiplyScalar(ae).add(Ce);zf(xt,Me,A),m.push(A.x,A.y,A.z),zf(je,Me,_),v.push(_.x,_.y,_.z),g.push(be,.5+A.y/i),xe.push(x++)}}function oe(xe,be,Me,Te,ae){let Ce=new k,Ie=new Ee,Be=[Me,Te];ae<0&&Be.reverse();for(let Ve of Be)Ie.set(Ve,S*ae),zf(Ie,be,Ce),m.push(Ce.x,Ce.y,Ce.z),v.push(0,ae,0),g.push(.5,.5),xe.push(x++)}function ve(xe,be,Me){let Te=new Ee(Math.sin(Me),Math.cos(Me)),ae=new Ee(-Math.cos(Me),Math.sin(Me)),Ce=new k,Ie=xe<0?(lt,We,je)=>f.push(lt,We,je):(lt,We,je)=>f.push(lt,je,We),Be=new Ee((e+t+G+N)/4,0);zf(Be,Te,Ce),m.push(Ce.x,Ce.y,Ce.z),v.push(ae.x,0,ae.y),g.push(.5,.5);let Ve=x++;for(let lt of be){let We=m.slice(lt*3,lt*3+3);m.push(...We),v.push(ae.x,0,ae.y);let je=g.slice(lt*2,lt*2+2);g.push(...je),x++}for(let lt=Ve+1;lt<x-1;lt++)Ie(Ve,lt,lt+1);Ie(Ve,x-1,Ve+1)}}},HCe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Gt.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new $t,d.setAttribute("position",new kt([],3))):c>0||u>0||l<360?d=new SQ(0,t/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new UB(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},GCe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o===0?c=new Zc(t,i,r,n,s,a):c=new jCe(t,i,r,n,s,a,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},M3=Math.PI/2,jCe=class extends $t{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],u=[],h=[],d=0;f("z","y","x",-1,-1,i,t,e,s,n),f("z","y","x",1,-1,i,t,-e,s,n),f("x","z","y",1,1,e,i,t,r,s),f("x","z","y",1,-1,e,i,-t,r,s),f("x","y","z",1,-1,e,t,i,r,n),f("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(m("z","y","x",-1,-1,1,i,t,e,s),m("z","y","x",1,-1,-1,i,t,e,s),m("z","y","x",-1,1,-1,i,t,e,s),m("z","y","x",1,1,1,i,t,e,s),m("x","y","z",-1,-1,-1,e,t,i,r),m("x","y","z",1,-1,1,e,t,i,r),m("x","y","z",-1,1,1,e,t,i,r),m("x","y","z",1,1,-1,e,t,i,r),m("y","x","z",-1,-1,1,t,e,i,n),m("y","x","z",1,-1,-1,t,e,i,n),m("y","x","z",1,1,1,t,e,i,n),m("y","x","z",-1,1,-1,t,e,i,n),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new kt(c,3)),this.setAttribute("normal",new kt(u,3)),this.setAttribute("uv",new kt(h,2));function f(g,x,S,_,A,T,E,I,P,C){let L=(T-2*a)/P,z=(E-2*a)/C,F=T/2-a,G=E/2-a,N=I/2,q=P+1,ie=C+1,Q=0,W=new k;for(let ee=0;ee<ie;ee++){let K=ee*z-G;for(let j=0;j<q;j++){let $=j*L-F;W[g]=$*_,W[x]=K*A,W[S]=N,c.push(W.x,W.y,W.z),W[g]=0,W[x]=0,W[S]=I>0?1:-1,u.push(W.x,W.y,W.z),h.push(j/P),h.push(1-ee/C),Q+=1}}for(let ee=0;ee<C;ee++)for(let K=0;K<P;K++){let j=d+K+q*ee,$=d+K+q*(ee+1),se=d+(K+1)+q*(ee+1),re=d+(K+1)+q*ee;l.push(j,$,re),l.push($,se,re)}d+=Q}function m(g,x,S,_,A,T,E,I,P,C){let L=(E-2*a)/C,z=E/2-a,F=I/2-a,G=P/2,N=C+1,q=0,ie=new k,Q=new k;for(let W=0;W<o+1;W++){let ee=W/o*M3,K=Math.sin(ee)*a,j=(1-Math.cos(ee))*a,$=Math.sin(ee),se=Math.cos(ee);ie[x]=(F+K)*A,ie[S]=(G-j)*T,Q[g]=0,Q[x]=$*Math.sign(ie[x]),Q[S]=se*Math.sign(ie[S]);for(let re=0;re<N;re++){let he=re*L-z;ie[g]=he*_,c.push(ie.x,ie.y,ie.z),u.push(Q.x,Q.y,Q.z),h.push(re/C),h.push(0),q+=1}}for(let W=0;W<o;W++)for(let ee=0;ee<C;ee++){let K=d+ee+N*W,j=d+ee+N*(W+1),$=d+(ee+1)+N*(W+1),se=d+(ee+1)+N*W;l.push(K,j,se),l.push(j,$,se)}d+=q}function v(g,x,S){let _=new k,A=new k(e/2,t/2,i/2);A.subScalar(a);let T=[],E=g*x*S>0?(P,C,L)=>l.push(P,C,L):(P,C,L)=>l.push(P,L,C);for(let P=0;P<=o;P++){let C=[],L=M3*(1-P/o),z=Math.cos(L),F=Math.sin(L),G=0;for(let N=0;N<=P;N++){let q=Math.cos(G),ie=Math.sin(G);_.x=z*q,_.y=F,_.z=z*ie;let Q=A.clone().addScaledVector(_,a);c.push(g*Q.x,x*Q.y,S*Q.z),u.push(g*_.x,x*_.y,S*_.z),h.push(0,0),C.push(d++),G+=M3/P}T.push(C)}let I=T.length-1;for(let P=0;P<I;P++){let C=T[P],L=T[P+1],z=C.length-1;E(C[0],L[1],L[0]);for(let F=1;F<=z;F++)E(C[F-1],C[F],L[F]),E(C[F],L[F+1],L[F])}}}},wN=class extends $t{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(l,3)),this.setAttribute("uv",new kt(o,2));return;function c(){var Q;n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new k,f=d.clone(),m=new ha,v=n*r,g=r-v,x=s+1,S=new k,_=(W,ee)=>S.subVectors(W,ee).normalize(),A=(W,ee)=>Array(W).fill(void 0).map(ee),T=A(e.length/3,(W,ee)=>new k().fromArray(e,ee*3).setLength(r)),E=[],I=1e6;for(let W=0;W<T.length;W++){let ee=T[W],K=[],j,$,se,re=1e10,he=-1;for(;(he=t.indexOf(W,he+1))!=-1;){let be=he-he%3;j=t[be+(he+1)%3],$=t[be+(he+2)%3],se=ee.distanceToSquared(T[j]),re=Math.min(re,se),K.push([j,$,se])}re+=1e-6;let oe=[],ve=0,xe=K.length;for(let be=0;be<xe;be++){[j,$,se]=K[ve];let Me=((Q=E[j])==null?void 0:Q.includes(W))==!0;se<=re&&oe.push(j+ +Me*I),ve=K.findIndex(Te=>Te[0]==$)}E.push(oe)}let P=[];{let W=0,ee=0,K,j,$=h==3;for(let se=0;se<=s;se++){K=se*(se+1)/2,j=(se+1)*(se+2)/2;for(let re=0;re<s-se;re++)[W,ee]=[K+re+se+2,j+re+se+3],P.push(K,j,...$?[ee,K]:[W,j],ee,W),[K,j]=[W,ee];P.push(K,j,K+s+2)}}let C=d.clone(),L=d.clone(),z=d.clone(),F=d.clone(),G=d.clone(),N=[],q=A(T.length,()=>A(h,()=>d.clone()));for(let W=0;W<T.length;W++){d.copy(T[W]).normalize(),C.copy(d).multiplyScalar(g);let ee=E[W];for(let oe=0;oe<ee.length;oe++){let ve=ee[oe],xe=ee[(oe+1)%h];m.setFromPointsAndIndices(T,W,ve%I,xe%I),m.b.sub(m.a).setLength(1e10).add(m.a),m.c.sub(m.a).setLength(1e10).add(m.a),m.closestPointToPoint(C,q[W][oe])}let K=[],j=[],$=[],se=new k;s==0&&[...q[W]].reduce((oe,ve)=>oe.add(ve),se).multiplyScalar(1/h);for(let oe=0;oe<h;oe++){let ve=[],xe=(oe-1+h)%h,be=q[W][xe],Me=q[W][oe];d.copy(be).sub(C),f.copy(Me).sub(C);let Te=C.angleTo(d),ae=d.angleTo(f),Ce=Math.cos(Te)*v;s==0?L.copy(se):L.copy(C).setLength(g+Ce),j.push(Ce);let Ie=[L,be,Me];for(let Be=0;Be<2;Be++){let Ve=Ie[Be],lt=Ie[Be+1];F.subVectors(Ve,C),G.subVectors(lt,C),z.crossVectors(F,G).normalize();for(let We=0;We<x;We++){let je=[Te,ae][Be]*We/x;d.copy(F).applyAxisAngle(z,je).add(C),K.push(d.clone()),Be&&(_(d,C),ve.push([We==0?Ve:d.clone(),S.clone()]))}Be&&(_(lt,C),ve.push([lt,S.clone()]))}$.push(ve)}N.push($);let re=2*x,he=2;for(let oe=0;oe<h;oe++){let ve=re*oe,xe=re*((oe+1)%h),be=[K[ve]];for(let Te=1;Te<x;Te++){F=K[ve+Te],G=K[xe+Te],be.push(F);for(let ae=1,Ce=Te-he+1;ae<=Ce;ae++)d.lerpVectors(F,G,ae/(Ce+1)),d.sub(C).setLength(j[oe]).add(C),be.push(d.clone());be.push(G)}for(let Te=0;Te<x;Te++)be.push(K[Te+x+ve]);be.push(K[xe+x]);let Me=P.map(Te=>be[Te]);a.push(...Me.map(Te=>[Te.x,Te.y,Te.z]).flat()),l.push(...Me.map(Te=>(_(Te,C),[S.x,S.y,S.z])).flat())}}let ie=[];for(let W=0;W<E.length;W++)for(let ee=0;ee<h;ee++){let K=E[W][ee];if(K<I){let j=E[K].findIndex(re=>re%I==W),$=N[W][ee],se=N[K][j];for(let re=0;re<x;re++){let he=$[re],oe=se[x-re],ve=$[re+1],xe=se[x-(re+1)];[he,oe,ve,ve,oe,xe].forEach(be=>{a.push(be[0].x,be[0].y,be[0].z),l.push(be[1].x,be[1].y,be[1].z)})}ie.push($[0][0],se[x][0],$[x][0],se[0][0])}}for(;ie.length;){let W,ee,K,j;[W,ee]=ie.splice(0,2);let $=[W];for(;W!=ee;)$.push(ee),K=ie.indexOf(ee),j=K%2,ee=ie.splice(K-j,2)[1-j];S.subVectors($[0],$[1]).cross(d.subVectors($[0],$[2])).normalize();let se=S.dot($[0])<0;se&&S.negate();for(let re=1;re<=$.length-2;re++)[$[re+ +se],$[re+1-+se],$[0]].forEach(he=>{a.push(he.x,he.y,he.z),l.push(S.x,S.y,S.z)})}}function u(){let h=new k;for(let E=0;E<a.length;E+=3){h.x=a[E+0],h.y=a[E+1],h.z=a[E+2];let I=A(h)/2/Math.PI+.5,P=T(h)/Math.PI+.5;o.push(I,1-P)}let d=new k,f=new k,m=new k,v=new k,g=new Ee,x=new Ee,S=new Ee,_=(E,I,P,C)=>{C<0&&E.x===1&&(o[I]=E.x-1),P.x===0&&P.z===0&&(o[I]=C/2/Math.PI+.5)};for(let E=0,I=0;E<a.length;E+=9,I+=6){d.set(a[E+0],a[E+1],a[E+2]),f.set(a[E+3],a[E+4],a[E+5]),m.set(a[E+6],a[E+7],a[E+8]),g.set(o[I+0],o[I+1]),x.set(o[I+2],o[I+3]),S.set(o[I+4],o[I+5]),v.copy(d).add(f).add(m).divideScalar(3);let P=A(v);_(g,I+0,d,P),_(x,I+2,f,P),_(S,I+4,m,P)}for(let E=0;E<o.length;E+=6){let I=o[E+0],P=o[E+2],C=o[E+4],L=Math.max(I,P,C),z=Math.min(I,P,C);L>.9&&z<.1&&(I<.2&&(o[E+0]+=1),P<.2&&(o[E+2]+=1),C<.2&&(o[E+4]+=1))}function A(E){return Math.atan2(E.z,-E.x)}function T(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}}static fromJSON(e){return new wN(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},WCe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new MQ(t*.5,s,a):new Rq(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},MQ=class extends wN{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new MQ(e.radius,e.corner,e.cornerSides)}},mw=1e-12,bN=class{constructor(e){this.position=new Ee,this.startPosition=new Ee,this.uuid=Gt.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new bN(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},fO=class extends bN{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new fO(this.parent).copy(this)}},ky=class extends bN{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new fO(this),new fO(this))}static create(e,t){let i=new ky(e,new Ee(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new ky(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new Ee,t=new Ee){let[i,r]=this.computeTangents();return i&&r&&($6(i,e),$6(r,t)),[e,t]}computeTangent(e=new Ee){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new Ee){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function $6(e,t=new Ee){let i=e.length();return t.set(-e.y/i,e.x/i)}var _N=e=>e,Nx=new Ee,gC=new Ee,XCe=new Ee,qCe=new Ee,YCe=new Ee,QCe=new Ee,AQ=new k,EQ=new k;function ZCe(e){let t=new Ee;t.addVectors(e.v0,Nx.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new Ee;return i.addVectors(e.v2,gC.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Fc(e.v0,t,i,e.v2)}function kw(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function KCe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function JCe(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function TQ(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function $Ce(e,t,i){return tG(e,t)&&tG(t,i)&&pO(e.position,t.position,i.position)}function pO(e,t,i){return Nx.copy(t).sub(e).cross(gC.copy(i).sub(e))===0}function ePe(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function tPe(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function iPe(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return TQ(t,e,i)>Math.PI&&(u*=-1),kw(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(t.x-h*o,t.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function eG(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function tG(e,t){return pO(e.position,e.controls[1].position,t.position)&&pO(e.position,t.controls[0].position,t.position)}function rPe(e,t,i,r,n=.5){let s=Nx.subVectors(t,e).multiplyScalar(n).add(e),a=gC.subVectors(i,t).multiplyScalar(n).add(t),o=XCe.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=qCe.subVectors(a,s).multiplyScalar(n).add(s),u=YCe.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=QCe.subVectors(u,c).multiplyScalar(n).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function nPe(e,t,i=12,r=!0){let n=EQ.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=_N(t[o]),c=Nx,u=Bg(l,i);for(let h=0;h<=u;h++)if(l instanceof Fc||l instanceof Mp||l instanceof Xc){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&JCe(s,n))continue;s===void 0&&(s=AQ),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function sPe(e,t,i,r=12,n=!0){let s=EQ.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=_N(t[l]),h=Nx,d=Bg(u,r);o.push(d);for(let f=0;f<=d;f++)if(u instanceof Fc||u instanceof Mp||u instanceof Xc){if(u.getPoint(f/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=AQ:(e.setXYZ(a,c.x,c.y,c.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function iG(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=Bg(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=Bg(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Bg(e[0].roundedCurveCorner,t)*.5),r}function Bg(e,t=12){return e&&e instanceof tC?t*2:e&&(e instanceof Xc||e instanceof Cq)?1:e&&e instanceof BB?t*e.points.length:t}function aPe(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=_N(t[a]),l=Bg(o,i),c=Nx;for(let u=0;u<=l;u++)if(o instanceof Fc||o instanceof Mp||o instanceof Xc){if(o.getPoint(u/l,c),n!==void 0&&KCe(n,c,mw))continue;n===void 0&&(n=gC),n.copy(c),e.push(c.x,c.y),s++}}return kw(e[0],e[e.length-2],mw)&&kw(e[1],e[e.length-1],mw)&&(e.pop(),e.pop()),r&&s>1&&!(kw(e[s-1],e[1],mw)&&kw(e[s-2],e[0],mw))&&(e.push(e[0],e[1]),s++),e}var A3=new Ee,oPe=new Ee,lPe=new Ee,cPe=new Ee,uPe=new Ee,hPe=new Ee,Dn=class extends fT{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new zo(new k(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Gt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Dn;return r.isClosed=e.isClosed,r.points=e.points.map(n=>ky.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>Dn.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=A3.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Gt.generateUUID()){let r;e instanceof Ee?r=e:r=new Ee(e,t);let n=new ky(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return nPe(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=iG(this.points,e,!1),this.roundedCurveDivisions=iG(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return sPe(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),aPe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=Bg(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(eG(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(A3.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){eG(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&$Ce(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,f=c.getLength(),m=u.getLength(),v=Math.min(o,f*.499),g=Math.min(o,m*.499),x=Math.min(v,g),S=1-x/f,_=x/m,A=c.getPointAt(S,A3),T=u.getPointAt(_,oPe);this._subSplitCurve(c,h,S,A,void 0),this._subSplitCurve(u,d,_,void 0,T);let E;if(this.useCubicForRoundedCorners){let I=TQ(A,n.position,T)/2,P=Math.tan(I)*A.distanceTo(n.position),[C,L]=ePe(A,T,P,lPe,cPe),z=tPe(C,L,n.position),[F,G]=iPe(z,A,T,P,uPe,hPe);E=new Fc(A.clone(),F.clone(),G.clone(),T.clone())}else E=new Mp(A.clone(),n.position.clone(),T.clone());n.roundedCurveCorner=E,this.roundedCurves.splice(i+t,0,E),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof Xc)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=rPe(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new Dn(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],c=e.points[n+4],u=e.points[n+5],h=e.points[n+6],d=new ky(Gt.generateUUID(),new Ee(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new Dn;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(n,s)=>{s instanceof Fc&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof Mp&&(n[a]=ZCe(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof Fc?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof Xc&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof Fc?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Xc&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(e.curves),e instanceof fT&&(this.shapeHoles=e.holes.map(n=>{let s=new Dn;return s.fromShape(n),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},CQ=Math.PI*2;function E3({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function dPe(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function rG(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function fPe(e,t,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),f=Math.pow(o,2),m=u*h-u*f-h*d;m<0&&(m=0),m/=u*f+h*d,m=Math.sqrt(m)*(l===c?-1:1);let v=m*n/s*o,g=m*-s/n*a,x=v+(e+i)/2,S=g+(t+r)/2,_=(a-v)/n,A=(o-g)/s,T=(-a-v)/n,E=(-o-g)/s,I=rG(1,0,_,A),P=rG(_,A,T,E);return P<0&&(P+=CQ),{centerx:x,centery:S,ang1:I,ang2:P}}function pPe({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=fPe(e,t,i,r,n,s,c,u,a,o),{ang1:f,ang2:m}=d,{centerx:v,centery:g}=d,x=Math.abs(m)/(CQ/4);Math.abs(1-x)<1e-7&&(x=1);let S=Math.max(Math.ceil(x),1);m/=S;for(let _=0;_<S;_++)l.push(dPe(f,m)),f+=m;return l.map(_=>{let{x:A,y:T}=E3(_[0],n,s,v,g),{x:E,y:I}=E3(_[1],n,s,v,g),{x:P,y:C}=E3(_[2],n,s,v,g);return{x1:A,y1:T,x2:E,y2:I,x:P,y:C}})}var Dr;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Dr||(Dr={}));var is;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(is||(is={}));function Mi(e,t){if(!e)throw t||"Assertion Failed!"}var hi=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){Mi(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){Mi(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){Mi(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){Mi(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),gw=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),BA=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),fy=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),nG=function(){function e(){var t=new fy,i=new gw,r=new BA(0),n=new BA(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new BA(0),r=new BA(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;Mi(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;Mi(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new fy,i=new fy,r=new gw,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new fy;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new gw;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new gw;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new fy;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new gw;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&hi.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&hi.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=t,s=t;(n=s.next)!==t;s=n){Mi(n.prev===s),l=n.anEdge;do Mi(l.Sym!==l),Mi(l.Sym.Sym===l),Mi(l.Lnext.Onext.Sym===l),Mi(l.Onext.Sym.Lnext===l),Mi(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(Mi(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Mi(a.prev===o),l=a.anEdge;do Mi(l.Sym!==l),Mi(l.Sym.Sym===l),Mi(l.Lnext.Onext.Sym===l),Mi(l.Onext.Sym.Lnext===l),Mi(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Mi(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)Mi(l.Sym.next===c.Sym),Mi(l.Sym!==l),Mi(l.Sym.Sym===l),Mi(l.Org!==null),Mi(l.Dst!==null),Mi(l.Lnext.Onext.Sym===l),Mi(l.Onext.Sym.Lnext===l);Mi(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),sG=function(){function e(){this.handle=null}return e}(),aG=function(){function e(){this.key=null,this.node=0}return e}(),mPe=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new sG,this.handles[r]=new aG;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,Mi(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new sG;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new aG}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;Mi(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),T3=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),oG=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),gPe=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new oG,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new oG;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),vPe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?hi.vertLeq(s.Org,a.Org)?hi.edgeSign(a.Dst,s.Org,a.Org)<=0:hi.edgeSign(s.Dst,a.Org,s.Org)>=0:hi.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return hi.edgeSign(s.Dst,n,s.Org)>=0;var o=hi.edgeEval(s.Dst,n,s.Org),l=hi.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&Mi(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){Mi(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new T3;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case Dr.ODD:return(i&1)!==0;case Dr.NONZERO:return i!==0;case Dr.POSITIVE:return i>0;case Dr.NEGATIVE:return i<0;case Dr.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do Mi(hi.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,Mi(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=hi.vertL1dist(i,t),s=hi.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(hi.vertLeq(n.Org,s.Org)){if(hi.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;hi.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(hi.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(Mi(!hi.vertEq(n.Dst,s.Dst)),hi.vertLeq(n.Dst,s.Dst)){if(hi.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(hi.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new fy,f,m;if(Mi(!hi.vertEq(c,l)),Mi(hi.edgeSign(l,t.event,a)<=0),Mi(hi.edgeSign(c,t.event,o)>=0),Mi(a!==t.event&&o!==t.event),Mi(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(hi.vertLeq(a,o)){if(hi.edgeSign(c,a,o)>0)return!1}else if(hi.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),hi.intersect(l,a,c,o,d),Mi(Math.min(a.t,l.t)<=d.t),Mi(d.t<=Math.max(o.t,c.t)),Mi(Math.min(c.s,l.s)<=d.s),Mi(d.s<=Math.max(o.s,a.s)),hi.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),f=hi.vertLeq(a,o)?a:o,hi.vertLeq(f,d)&&(d.s=f.s,d.t=f.t),hi.vertEq(d,a)||hi.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!hi.vertEq(l,t.event)&&hi.edgeSign(l,t.event,d)>=0||!hi.vertEq(c,t.event)&&hi.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),m=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,m,!0),!0):(hi.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),hi.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),hi.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),hi.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}hi.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,hi.vertEq(n.Org,r)){Mi(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!hi.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}Mi(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Mi(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),hi.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,c=new T3;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,hi.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=hi.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);Mi(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new T3,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new gPe(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(Mi(i.fixUpperEdge),Mi(++r===1)),Mi(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,hi.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new mPe(s,hi.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,Mi(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!hi.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),yPe=function(){function e(){this.mesh=new nG,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Dr.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],f=[null,null,null],m=[null,null,null],v=this.mesh.vHead;i=v.next;for(var g=0;g<3;++g)s=i.coords[g],c[g]=s,m[g]=i,l[g]=s,f[g]=i;for(i=v.next;i!==v;i=i.next)for(var x=0;x<3;++x)s=i.coords[x],s<c[x]&&(c[x]=s,m[x]=i),s>l[x]&&(l[x]=s,f[x]=i);var S=0;if(l[1]-c[1]>l[0]-c[0]&&(S=1),l[2]-c[2]>l[S]-c[S]&&(S=2),c[S]>=l[S]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=m[S],n=f[S],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=v.next;i!==v;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;hi.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;hi.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(hi.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(hi.edgeGoesLeft(n.Lnext)||hi.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(hi.edgeGoesRight(r.Lprev)||hi.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===is.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1;if(i===is.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var m=l;m<r;++m)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new nG),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=Dr.ODD),i===void 0&&(i=is.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),vPe.computeInterior(this,a);var o=this.mesh;return i===is.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===is.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function op(e){var t=e.windingRule,i=t===void 0?Dr.ODD:t,r=e.elementType,n=r===void 0?is.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,f=e.strict,m=f===void 0?!0:f,v=e.debug,g=v===void 0?!1:v;if(!d&&m)throw new Error("Contours can't be empty");if(d){var x=new yPe;e.edgeCreateCallback&&(x.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(x.vertexIdCallback=e.vertexIdCallback);for(var S=0;S<d.length;S++)x.addContour(l||2,d[S]);return x.tesselate(i,n,a,l,u,m),{vertices:x.vertices,vertexIndices:x.vertexIndices,vertexCount:x.vertexCount,elements:x.elements,elementCount:x.elementCount,mesh:g?x.mesh:void 0}}}Dr.ODD;Dr.NONZERO;Dr.POSITIVE;Dr.NEGATIVE;Dr.ABS_GEQ_TWO;is.POLYGONS;is.CONNECTED_POLYGONS;is.BOUNDARY_CONTOURS;var mO=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*mO.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} → ${e}`);let i=e*mO.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},PQ=mO;PQ.eSize=8*Float32Array.BYTES_PER_ELEMENT;var xPe=class{constructor(e=[],t=(i,r)=>i<r?-1:i>r?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,s=t[n];if(i(r,s)>=0)break;t[e]=s,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],n)>=0)break;t[e]=t[s],e=s}t[e]=n}};function wPe(e,t,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[S,_]of e[0])S<n&&(n=S),_<s&&(s=_),S>a&&(a=S),_>o&&(o=_);let l=a-n,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let S=[n,s];return S.distance=0,S.distance}let h=new xPe([],(S,_)=>_.max-S.max),d=_Pe(e),f=new ZT(n+l/2,s+c/2,0,e);f.d>d.d&&(d=f);let m=2;function v(S,_,A){let T=new ZT(S,_,A,e);if(m++,T.max>d.d+i&&h.push(T),T.d>d.d&&(d=T,r&&console.log(`found best ${Math.round(1e4*T.d)/1e4} after ${m} probes`),d.d>t))return t}let g=u/2;for(let S=n;S<a;S+=u)for(let _=s;_<o;_+=u)v(S+g,_+g,g);for(;h.length;){let{max:S,x:_,y:A,h:T}=h.pop();if(S-d.d<=i)break;g=T/2,v(_-g,A-g,g),v(_+g,A-g,g),v(_-g,A+g,g),v(_+g,A+g,g)}r&&console.log(`num probes: ${m}
best distance: ${d.d}`);let x=[d.x,d.y];return x.distance=d.d,x.distance}function ZT(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=bPe(e,t,r),this.max=this.d+this.h*Math.SQRT2}function bPe(e,t,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>t!=u[1]>t&&e<(u[0]-c[0])*(t-c[1])/(u[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,SPe(e,t,c,u))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function _Pe(e){let t=0,i=0,r=0,n=e[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,t+=h*3}let s=new ZT(i/t,r/t,0,e);return t===0||s.d<0?new ZT(n[0][0],n[0][1],0,e):s}function SPe(e,t,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((e-n)*a+(t-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=e-n,o=t-s,a*a+o*o}var SN={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},DQ={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},RQ={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},C3=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),MN=class extends $t{constructor(e,t,i=0,r=12,n=3,s=Dr.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(C=>{let L=C.extractShapePointsToFlatArray([],r),z=[];for(let F=L.length-1;F>=1;F-=2){let G=L[F-1],N=L[F-0];z.push(G,N)}return z}),c=[],u=[];for(let C=0;C<o.length;C+=2)u.push([o[C],o[C+1]]);c.push(u);for(let C=0;C<l.length;C++){let L=l[C],z=[];for(let F=0;F<L.length;F+=2)z.push([L[F],L[F+1]]);c.push(z)}let h;e.isText?h=new GB().setFromPoints(e.points.map(C=>C.position)).getSize(new Ee).length()*.1:c[0].length===0?h=i:i>0?h=wPe(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(n));let d;try{d=op({windingRule:s,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=SN}let f;try{f=op({windingRule:Dr.ODD,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{f=DQ}if(!d)throw new Error("error generating geometry");let m=d.elementCount;if(f){d.elementCount+=f.elementCount;for(let C=0;C<f.elements.length;C++){let L=f.elements[C],z=C%2===0?d.vertexCount:0;d.elements.push(L+z)}for(let C=0;C<f.vertexIndices.length;C++){let L=f.vertexIndices[C],z=d.vertexCount;d.vertexIndices.push(L+z)}for(let C=0;C<f.vertices.length;C++){let L=f.vertices[C];d.vertices.push(L)}}let v=1/0,g=-1/0,x=1/0,S=-1/0;for(let C=0,L=d.vertexCount;C<L;C++){let z=C*2,F=d.vertices[z+0],G=d.vertices[z+1];F<v&&(v=F),F>g&&(g=F),G<x&&(x=G),G>S&&(S=G)}this._minX=v,this._minY=x,this._width=g-v,this._height=S-x,this._buffer=new PQ(this._computeBufferEstimatedSize(d));let _=[],A=[];for(let C=d.elementCount-1;C>=0;C--){let L=C>=m,z=C*2,F=d.elements[z+0],G=d.elements[z+1],N=F+G,q={start:F,count:G,normals:[],continuous:[],concave:[]},ie=F,Q=N-1,W=F+1,ee=this._shape.roundedCurves.length;do{let re=ie-F,he=d.vertices[Q*2+0],oe=d.vertices[Q*2+1],ve=d.vertices[ie*2+0],xe=d.vertices[ie*2+1],be=d.vertices[W*2+0],Me=d.vertices[W*2+1],Te=ve-he,ae=xe-oe,Ce=Math.sqrt(Te*Te+ae*ae);Te/=Ce,ae/=Ce;let Ie=ve-be,Be=xe-Me,Ve=Math.sqrt(Ie*Ie+Be*Be);Ie/=Ve,Be/=Ve,q.normals[re*2+0]=-Be,q.normals[re*2+1]=Ie,q.concave[re]=Te*Be-ae*Ie>0;let lt=d.vertexIndices[ie];if(Array.isArray(lt))q.continuous[re]=!1;else{let[We,je]=this._shape.getCurveIndexFromVertexId(lt-1,!0);if(je>0&&je<1)q.continuous[re]=!0;else{let xt=je===1?We+1:We-1;xt=(xt+ee)%ee;let Mt=je===1?0:1,de=this._shape.roundedCurves[We].getTangent(je),V=this._shape.roundedCurves[xt].getTangent(Mt);q.continuous[re]=de.dot(V)>.95}}L&&(q.normals[re*2+0]*=-1,q.normals[re*2+1]*=-1),[Q,ie,W]=[ie,W,W+1],W>=N&&(W-=G)}while(W!==F+1);let K=[];K.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(F*2,N*2),vertexCount:G,vertexIndices:new Array(G).fill(!0).map((re,he)=>[he,he]),elements:[0,G],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(F*2,N*2)});let j=0;for(let re=1;re<=this._bevelSegments;re++){let he=re/this._bevelSegments*Math.PI/2,oe=(1-Math.cos(he))*this._bevel,ve=[],xe=[],be=0;for(let Te=0;Te<G;Te++){let ae=Te*2,Ce=(Te-1+G)%G*2,Ie=d.vertices[q.start*2+ae+0],Be=d.vertices[q.start*2+ae+1],Ve=-q.normals[Ce+0]*oe,lt=-q.normals[Ce+1]*oe,We=-q.normals[ae+0]*oe,je=-q.normals[ae+1]*oe;if(q.concave[Te]||!q.concave[Te]&&L){let xt=Math.atan2(lt,Ve),Mt=Math.atan2(je,We);Mt>xt&&(Mt-=Math.PI*2);let de=Mt-xt;if(q.continuous[Te]||L){let V=xt+de/2,X=Math.cos(V)*oe,we=Math.sin(V)*oe;ve[2*be+0]=Ie+X*(L?-1:1),ve[2*be+1]=Be+we*(L?-1:1),xe[be]=Te,be++}else{let V=Math.max(1,Math.floor(r/4*Math.abs(de)/Math.PI));for(let X=0;X<=V;X++){let we=xt+de*(X/V),J=Math.cos(we)*oe,Le=Math.sin(we)*oe;ve[2*be+0]=Ie+J,ve[2*be+1]=Be+Le,xe[be]=Te,be++}}}else ve[2*be+0]=Ie+Ve,ve[2*be+1]=Be+lt,xe[be]=Te,be++,ve[2*be+0]=Ie,ve[2*be+1]=Be,xe[be]=Te,be++,ve[2*be+0]=Ie+We,ve[2*be+1]=Be+je,xe[be]=Te,be++}let Me=op({windingRule:Dr.POSITIVE,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ve],edgeCreateCallback:Te=>{let ae=Te.Org.idx,Ce=xe[ae],Ie=xe[(ae+1)%xe.length];Te.idx=[Ce,Ie],Te.Sym.idx=[Ie,Ce]},vertexIdCallback:Te=>{let ae=Te.Lprev.idx;return[ae?ae[1]:0,Te.idx?Te.idx[0]:0]}});if(!Me)throw console.log("Error"),new Error(`error generating bevel geometry for ${re}'th loop`);if(!Me.vertexCount){let Te=(re-1)/this._bevelSegments*Math.PI/2;j=(1-Math.sin(Te))*this._bevel;break}for(let Te=0;Te<Me.vertexIndices.length;Te++){let[ae,Ce]=Me.vertexIndices[Te];if(ae===Ce)continue;let Ie=Ce;Ce<ae&&(Ie+=G);for(let Be=ae;Be<Ie;Be++){let Ve=Be%G,lt=(Be+1)%G;if(!q.continuous[Ve]||!q.continuous[lt]){Me.vertexIndices[Te]=[ae,Ve],Me.vertexIndices.splice(Te+1,0,[lt,Ce]),Me.vertices.splice((Te+1)*2,0,Me.vertices[Te*2],Me.vertices[Te*2+1]);break}}}K.push({bevelI:re,angle:he,size:oe,boundary:Me,reverseMap:xe,insetPoints:ve})}let $=(re,he,oe)=>{let ve=0,xe=re.boundary.vertexIndices.length;for(;ve<xe&&oe(re.boundary.vertexIndices[he]);)he=(he+1)%xe,ve++;return ve},se=_.length;for(let re=1;re<K.length;re++){let he=K[re-1],oe=K[re],ve=he.boundary.vertexIndices.length,xe=oe.boundary.vertexIndices.length;if(!ve||!xe)break;let be=q.concave.length,Me=0,Te=C3(Me,G);for(;!he.boundary.vertexIndices.filter(Te).length||!oe.boundary.vertexIndices.filter(Te).length;)Me++,Te=C3(Me,G);let ae=he.boundary.vertexIndices.findIndex(Te),Ce=oe.boundary.vertexIndices.findIndex(Te);do ae=(ae+1)%ve;while(Te(he.boundary.vertexIndices[ae]));do Ce=(Ce+1)%xe;while(Te(oe.boundary.vertexIndices[Ce]));Me=(Me+1)%G;let Ie=Me,Be=0,Ve=this._buildBevelVert(q,he,(ae-1+ve)%ve,void 0,Be),lt=this._buildBevelVert(q,oe,(Ce-1+xe)%xe,void 0,Be),We=Ve,je=lt,xt,Mt,de=!1;do{Be=(Me||be)/be,Te=C3(Me,G);let V=$(he,ae,Te),X=$(oe,Ce,Te),we=de;if(de=!1,V&&!X){for(let J=0;J<V;J++)xt=this._buildBevelVert(q,he,(ae+J)%ve,J/(V-1),Be),_.push(We.topN,xt.topP,je.topN),a===!1&&_.push(xt.bottomP,We.bottomN,je.bottomN),We=xt;de=!0}else if(!V&&X)for(let J=0;J<X;J++)Mt=this._buildBevelVert(q,oe,(Ce+J)%xe,J/(X-1),Be),_.push(je.topN,We.topP,Mt.topP),a===!1&&_.push(We.bottomP,je.bottomN,Mt.bottomP),je=Mt;else if(V&&X)if(xt=this._buildBevelVert(q,he,ae,0,Be),Mt=this._buildBevelVert(q,oe,Ce,0,Be),we?(_.push(We.topN,Mt.topP,je.topN),_.push(We.topN,xt.topP,Mt.topP),a===!1&&(_.push(Mt.bottomP,We.bottomN,je.bottomN),_.push(Mt.bottomP,xt.bottomP,We.bottomN))):(_.push(je.topN,We.topN,xt.topP),_.push(je.topN,xt.topP,Mt.topP),a===!1&&(_.push(xt.bottomP,We.bottomN,je.bottomN),_.push(xt.bottomP,je.bottomN,Mt.bottomP))),We=xt,je=Mt,V===X)for(let J=1;J<V;J++)xt=this._buildBevelVert(q,he,(ae+J)%ve,J/(V-1),Be),Mt=this._buildBevelVert(q,oe,(Ce+J)%xe,J/(X-1),Be),_.push(We.topN,xt.topP,je.topN),_.push(je.topN,xt.topP,Mt.topP),a===!1&&(_.push(xt.bottomP,We.bottomN,je.bottomN),_.push(xt.bottomP,je.bottomN,Mt.bottomP)),We=xt,je=Mt;else if(V>X){let J=V/X,Le=0;for(let qe=1;qe<V;qe++)xt=this._buildBevelVert(q,he,(ae+qe)%ve,qe/(V-1),Be),_.push(We.topN,xt.topP,je.topN),a===!1&&_.push(xt.bottomP,We.bottomN,je.bottomN),We=xt,qe>(Le+1)*J&&(Le++,Mt=this._buildBevelVert(q,oe,(Ce+Le)%xe,Le/(X-1),Be),_.push(je.topN,xt.topP,Mt.topP),a===!1&&_.push(xt.bottomP,je.bottomN,Mt.bottomP),je=Mt)}else{let J=X/V,Le=0;for(let qe=1;qe<X;qe++)Mt=this._buildBevelVert(q,oe,(Ce+qe)%xe,qe/(X-1),Be),_.push(je.topN,xt.topP,Mt.topP),a===!1&&_.push(xt.bottomP,je.bottomN,Mt.bottomP),je=Mt,qe>(Le+1)*J&&(Le++,xt=this._buildBevelVert(q,he,(ae+Le)%ve,Le/(V-1),Be),_.push(We.topN,xt.topP,je.topN),a===!1&&_.push(xt.bottomP,We.bottomN,je.bottomN),We=xt)}ae=(ae+V)%ve,Ce=(Ce+X)%xe,Me=(Me+1)%be}while(Me!==Ie)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(K,q,_),L){let re=[];for(let he=_.length-1;he>=se+2;he-=3){let oe=_[he-2],ve=_[he-1],xe=_[he-0];re.push(xe,ve,oe)}_.splice(se,_.length-se,...re)}if(L){let re=[];for(let he=K[K.length-1].boundary.vertices.length-1;he>=1;he-=2){let oe=K[K.length-1].boundary.vertices[he-1],ve=K[K.length-1].boundary.vertices[he-0];re.push(oe,ve)}A.push(re)}if(!L){let re=K[K.length-1],he;try{he=op({windingRule:K.length>1?Dr.POSITIVE:Dr.ODD,elementType:is.POLYGONS,vertexSize:2,strict:!0,contours:[re.insetPoints,...A]})}catch{he=RQ}if(!he)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let oe=0;oe<he.elementCount*3;oe+=3){let ve=this._buildSurfaceVert(he,he.elements[oe+0],j),xe=this._buildSurfaceVert(he,he.elements[oe+1],j),be=this._buildSurfaceVert(he,he.elements[oe+2],j);_.push(ve.top,xe.top,be.top),a===!1&&_.push(be.bottom,xe.bottom,ve.bottom)}}this.vertexCache={}}this._buffer.shrink();let T=new pi(Uint32Array.from(_),1),E=new pi(this._buffer.positions,3),I=new pi(this._buffer.normals,3),P=new pi(this._buffer.uvs,2);E.needsUpdate=!0,I.needsUpdate=!0,P.needsUpdate=!0,T.needsUpdate=!0,this.setAttribute("position",E),this.setAttribute("normal",I),this.setAttribute("uv",P),this.setIndex(T)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=a,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),f=Math.sin(t.angle),m=i*2,v=l*2,g=c*2,x=t.boundary.vertices[m+0],S=t.boundary.vertices[m+1],_=(1-f)*this._bevel,A=(x-this._minX)/this._width,T=(S-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(A=n),T=1);let E=e.normals[v+0],I=e.normals[v+1],P=e.normals[g+0],C=e.normals[g+1];if(h){let N=P-E,q=C-I;E=E+N*(1-r),I=I+q*(1-r);let ie=Math.sqrt(E*E+I*I);E/=ie,I/=ie}let L=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),z=L*3,F=L*2,G={i,fi:l,topP:L+0,topN:L+0,bottomP:L+1,bottomN:L+1,pathBevelUCoord:n};return this._buffer.positions[z+0]=x,this._buffer.positions[z+1]=S,this._buffer.positions[z+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[z+0]=E*d,this._buffer.normals[z+1]=I*d,this._buffer.normals[z+2]=f,this._buffer.uvs[F+0]=A,this._buffer.uvs[F+1]=T,this.forPathBevel===!1&&(this._buffer.positions[z+3]=x,this._buffer.positions[z+4]=S,this._buffer.positions[z+5]=_,this._buffer.normals[z+3]=E*d,this._buffer.normals[z+4]=I*d,this._buffer.normals[z+5]=-f,this._buffer.uvs[F+2]=T,this._buffer.uvs[F+3]=A),u||(this.forPathBevel?(L+=1,z+=3,F+=2):(L+=2,z+=6,F+=4),G.topP=L+0,G.bottomP=L+1,this._buffer.positions[z+0]=x,this._buffer.positions[z+1]=S,this._buffer.positions[z+2]=(this.forPathBevel?this._bevel:this._depth)-_,this._buffer.normals[z+0]=P*d,this._buffer.normals[z+1]=C*d,this._buffer.normals[z+2]=f,this._buffer.uvs[F+0]=A,this._buffer.uvs[F+1]=T,this.forPathBevel===!1&&(this._buffer.positions[z+3]=x,this._buffer.positions[z+4]=S,this._buffer.positions[z+5]=_,this._buffer.normals[z+3]=P*d,this._buffer.normals[z+4]=C*d,this._buffer.normals[z+5]=-f,this._buffer.uvs[F+2]=T,this._buffer.uvs[F+3]=A)),this.vertexCache[s]=G,G}clone(){let e=new MN(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=cC(this.userData),e}},IQ=class extends $t{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Dr.ODD,this.elementType=is.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Dr.ODD,elementType:is.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,f=r.length/2;d<f;d++){let m=d*2,v=r[m+0],g=r[m+1];if(l!==void 0&&v!==l&&(a=!1),c!==void 0&&g!==c&&(o=!1),l=v,c=g,!a&&!o)break}if(!a&&!o)try{s=op({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=SN}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new pi(new Float32Array(u*3),3),this._normalAttribute=new pi(new Float32Array(u*3),3),this._uvAttribute=new pi(new Float32Array(u*2),2),this._indexAttribute=new pi(new Uint32Array(h*3),1),s){let d=1/0,f=-1/0,m=1/0,v=-1/0;for(let S=0,_=u;S<_;S++){let A=S*2,T=s.vertices[A+0],E=s.vertices[A+1];T<d&&(d=T),T>f&&(f=T),E<m&&(m=E),E>v&&(v=E)}let g=f-d,x=v-m;for(let S=0,_=u;S<_;S++){let A=S*2,T=s.vertices[A+0],E=s.vertices[A+1],I=(T-d)/g,P=(E-m)/x;this._positionAttribute.setXYZ(S,T,E,0),this._normalAttribute.setXYZ(S,0,0,1),this._uvAttribute.setXY(S,I,P)}for(let S=0,_=h;S<_;S++){let A=S*3,T=s.elements[A+0],E=s.elements[A+1],I=s.elements[A+2];this._indexAttribute.setX(A+0,T),this._indexAttribute.setX(A+1,E),this._indexAttribute.setX(A+2,I)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new IQ(this._shape,this._curveSegments);return e.userData=cC(this.userData),e}},LQ=class extends MN{constructor(e,t,i=0,r=12,n=3,s=Dr.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new LQ(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=cC(this.userData),e}},cv=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Dr.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof Dn?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new Dn(r,n).fromJSON(a),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new Dn(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new IQ(e.shape,n,{windingRule:a}):o=new LQ(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},OQ=Math.PI*2,AN=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Gt.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Dn?e.shape:new Dn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=MPe(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let f;return n===0?(f=new $t,f.setAttribute("position",new kt([],3))):f=cv.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(f,{userData:{...e,type:"EllipseGeometry"}})}};function MPe(e,t,i,r,n,s){if(r>=OQ)return n>30||n%4===0?(EPe(e,t,i,s),Math.round(n/4)):lG(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=pPe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?APe(e,a.x,a.y,c,n,t,i,s):lG(e,r,n,t,i,s)}function APe(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(Vy(t,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=e.points[c],f=Vy(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),f.controls[0].position.set(h.x2,h.y2),e.addPoint(f)}return o>0?zQ(e,s,a,o):e.addPoint(Vy(0,0)),l}function lG(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;e.addPoint(Vy(c,u))}return t<OQ?s>0?zQ(e,r,n,s):e.addPoint(Vy(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&BQ(e,r,n,s)),1}function EPe(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(NA(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(NA(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(NA(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(NA(n,s-i,n+o,s-i,n-o,s-i)),r>0&&BQ(e,t,i,r)}function Vy(e,t){return new ky(Gt.generateUUID(),new Ee(e,t))}function NA(e,t,i,r,n,s){let a=Vy(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function zQ(e,t,i,r){NQ(e,t,i,r).forEach(n=>e.addPoint(n))}function BQ(e,t,i,r){let n=NQ(e,t,i,r),s=new Dn;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function NQ(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new Ee(n/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=Gt.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var TPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new UQ(!1,t,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},P3=new zy([0,0,0],1),UQ=class extends $t{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let f=()=>new k,m=new k,v=f(),g=f(),x=f(),S,_,A,T,E,I,P,C,L=f(),z=f(),F=f(),G=f(),N=f(),q=f(),ie=f(),Q=f(),W=i-2*o+.001,ee=W/s,K=Math.ceil(a*s),j=K+1,$=W/K,se=-W/2,re=c+1,he=2*Math.PI/c,oe=Math.PI/2/h,ve=.01,xe=Math.min((1-u/100)*o,o-ve),be=o-xe,Me=0,Te=2,ae=h*Te+Te,Ce=re*ae/Te,Ie=Ce+re*j,Be=Math.max(0,re*(j+ae)),[Ve,lt,We]=[3,3,2].map(Pe=>Array(Be*Pe).fill(0)),je=[],xt=n-o;function Mt(Pe,nt){let gt=Math.PI/2;I=nt*$,C=2*Math.PI*(I%ee)/ee+gt,I+=se,P=Math.sin(C)*xt,E=Math.cos(C)*xt,e?Pe.set(E,P,I):Pe.set(E,I,P)}Mt(m,-1e-10),Mt(v,0),L.copy(m),Mt(m,1);let de=m.distanceTo(v),V=d?0:be+xe,X=de*K+2*V,we=xe,J=X-V;for(let Pe=0;Pe<=K;Pe++){Mt(g,Pe),Q.subVectors(g,L).normalize(),L.copy(g),q.copy(g).setComponent(+e+1,0).normalize(),ie.crossVectors(Q,q).normalize();let nt=Pe===0,gt=Pe===K,Tt=nt?3*Math.PI/2:oe,rt=nt?we:J,Dt=nt?re:Ie,ge=nt?0:Be-re,$e=Q.clone().multiplyScalar(nt?-be:be).add(g),mt=Q.clone().multiplyScalar(nt?-1:1).normalize();for(let me=0;me<re;me++){let Ne=me*he;if(z.addVectors(m.copy(q).multiplyScalar(o*Math.cos(Ne)),v.copy(ie).multiplyScalar(o*Math.sin(Ne))),F.copy(z).normalize(),nt||gt){d||(Me=ge+me,[0,1,2].forEach(ue=>{Ve[Me*3+ue]=$e.getComponent(ue),lt[Me*3+ue]=mt.getComponent(ue)}),We[Me*2]=+gt,We[Me*2+1]=me/c),v.copy(F).multiplyScalar(xe),x.addVectors(g,v);for(let ue=0;ue<h;ue++){let et=ue*oe+Tt;G.addVectors(m.copy(Q).multiplyScalar(be*Math.sin(et)),v.copy(F).multiplyScalar(be*Math.cos(et))),N.copy(G).normalize(),v.addVectors(x,G),G.normalize(),Me=Dt+ue*re+me,[0,1,2].forEach(Ze=>{Ve[Me*3+Ze]=v.getComponent(Ze),lt[Me*3+Ze]=N.getComponent(Ze)});let at=+nt+Math.sin(et);We[Me*2]=(rt+be*at)/X,We[Me*2+1]=me/c}}v.addVectors(g,z),Me=Ce+Pe*re+me,[0,1,2].forEach(ue=>{Ve[Me*3+ue]=v.getComponent(ue),lt[Me*3+ue]=F.getComponent(ue)}),We[Me*2]=(V+Pe*de)/X,We[Me*2+1]=me/c}}let Le=j+2*h+Te,[qe,ct]=[+d,Le-1];for(let Pe=qe;Pe<=ct-1;Pe++){let nt=d&&Pe===ct-1;for(let gt=0;gt<re-1;gt++)S=Pe*re+gt,_=S+1,A=(nt?gt:S)+re,T=(nt?gt+1:_)+re,Pe===0?je.push(_,T,A):Pe===Le-2?je.push(S,_,A):je.push(S,_,A,_,T,A)}this.setIndex(je),this.setAttribute("position",new kt(Ve,3)),this.setAttribute("normal",new kt(lt,3)),this.setAttribute("uv",new kt(We,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,P3.array=r,P3.count=r.length,P3}},CPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new FQ(t*.5,s,a):new Bq(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},FQ=class extends wN{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new FQ(e.radius,e.corner,e.cornerSides)}},PPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new fT;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new Dq(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},wu=new St,D3=new Mr,UA=new k,KT=class extends va{constructor(){super(),this.uuid=Gt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new ns().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return wu.makeRotationX(e),this.applyMatrix4(wu),this}rotateY(e){return wu.makeRotationY(e),this.applyMatrix4(wu),this}rotateZ(e){return wu.makeRotationZ(e),this.applyMatrix4(wu),this}translate(e,t,i){return wu.makeTranslation(e,t,i),this.applyMatrix4(wu),this}scale(e,t,i){return wu.makeScale(e,t,i),this.applyMatrix4(wu),this}lookAt(e){return D3.lookAt(e),D3.updateMatrix(),this.applyMatrix4(D3.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)t.vertices.push(new k().fromBufferAttribute(n,h)),a!==void 0&&t.colors.push(new fi().fromBufferAttribute(a,h));function c(h,d,f,m){let v=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[f].clone()],g=s===void 0?[]:[new k().fromBufferAttribute(s,h),new k().fromBufferAttribute(s,d),new k().fromBufferAttribute(s,f)],x=new gO(h,d,f,g,v,m);t.faces.push(x),o!==void 0&&t.faceVertexUvs[0].push([new Ee().fromBufferAttribute(o,h),new Ee().fromBufferAttribute(o,d),new Ee().fromBufferAttribute(o,f)]),l!==void 0&&t.faceVertexUvs[1].push([new Ee().fromBufferAttribute(l,h),new Ee().fromBufferAttribute(l,d),new Ee().fromBufferAttribute(l,f)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],f=d.start,m=d.count;for(let v=f,g=f+m;v<g;v+=3)i!==void 0?c(i.getX(v),i.getX(v+1),i.getX(v+2),d.materialIndex):c(v,v+1,v+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(UA).negate(),this.translate(UA.x,UA.y,UA.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new St;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new k,t=new k;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new k;if(e){let i=new k,r=new k;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new KT;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new k,c={a:new k,b:new k,c:new k};n.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Gn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new jo),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new ns().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let f=a[h].clone();t!==void 0&&f.applyMatrix4(t),s.push(f)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let f=l[h],m,v,g=f.vertexNormals,x=f.vertexColors,S=new gO(f.a+n,f.b+n,f.c+n);S.normal.copy(f.normal),r!==void 0&&S.normal.applyMatrix3(r).normalize();for(let _=0,A=g.length;_<A;_++)m=g[_].clone(),r!==void 0&&m.applyMatrix3(r).normalize(),S.vertexNormals.push(m);S.color.copy(f.color);for(let _=0,A=x.length;_<A;_++)v=x[_],S.vertexColors.push(v.clone());S.materialIndex=f.materialIndex+i,o.push(S)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let f=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=f.length;m<v;m++){let g=f[m],x=[];for(let S=0,_=g.length;S<_;S++)x.push(g[S].clone());this.faceVertexUvs[h].push(x)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new k(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let f=this.parameters;for(let m in f)f[m]!==void 0&&(e[m]=f[m]);return e}let t=[];for(let f=0;f<this.vertices.length;f++){let m=this.vertices[f];t.push(m.x,m.y,m.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let f=0;f<this.faces.length;f++){let m=this.faces[f],v=!0,g=!1,x=this.faceVertexUvs[0][f]!==void 0,S=m.normal.length()>0,_=m.vertexNormals.length>0,A=m.color.r!==1||m.color.g!==1||m.color.b!==1,T=m.vertexColors.length>0,E=0;if(E=c(E,0,0),E=c(E,1,v),E=c(E,2,g),E=c(E,3,x),E=c(E,4,S),E=c(E,5,_),E=c(E,6,A),E=c(E,7,T),i.push(E),i.push(m.a,m.b,m.c),i.push(m.materialIndex),x){let I=this.faceVertexUvs[0][f];i.push(d(I[0]),d(I[1]),d(I[2]))}if(S&&i.push(u(m.normal)),_){let I=m.vertexNormals;i.push(u(I[0]),u(I[1]),u(I[2]))}if(A&&i.push(h(m.color)),T){let I=m.vertexColors;i.push(h(I[0]),h(I[1]),h(I[2]))}}function c(f,m,v){return v?f|1<<m:f&~(1<<m)}function u(f){let m=f.x.toString()+f.y.toString()+f.z.toString();return n[m]!==void 0||(n[m]=r.length/3,r.push(f.x,f.y,f.z)),n[m]}function h(f){let m=f.r.toString()+f.g.toString()+f.b.toString();return a[m]!==void 0||(a[m]=s.length,s.push(f.getHex())),a[m]}function d(f){let m=f.x.toString()+f.y.toString();return l[m]!==void 0||(l[m]=o.length/2,o.push(f.x,f.y)),l[m]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new KT().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let f=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=f.length;m<v;m++){let g=f[m],x=[];for(let S=0,_=g.length;S<_;S++){let A=g[S];x.push(A.clone())}this.faceVertexUvs[h].push(x)}}let n=e.morphTargets;for(let h=0,d=n.length;h<d;h++){let f={};if(f.name=n[h].name,n[h].vertices!==void 0){f.vertices=[];for(let m=0,v=n[h].vertices.length;m<v;m++)f.vertices.push(n[h].vertices[m].clone())}if(n[h].normals!==void 0){f.normals=[];for(let m=0,v=n[h].normals.length;m<v;m++)f.normals.push(n[h].normals[m].clone())}this.morphTargets.push(f)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let f={};if(s[h].vertexNormals!==void 0){f.vertexNormals=[];for(let m=0,v=s[h].vertexNormals.length;m<v;m++){let g=s[h].vertexNormals[m],x={};x.a=g.a.clone(),x.b=g.b.clone(),x.c=g.c.clone(),f.vertexNormals.push(x)}}if(s[h].faceNormals!==void 0){f.faceNormals=[];for(let m=0,v=s[h].faceNormals.length;m<v;m++)f.faceNormals.push(s[h].faceNormals[m].clone())}this.morphNormals.push(f)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new DPe().fromGeometry(this),t=new $t,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",FA.call(new pi(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",FA.call(new pi(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",cG.call(new pi(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",uG.call(new pi(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",uG.call(new pi(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new kt(l.data.length*3,3);c.name=l.name,n.push(FA.call(c,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new kt(e.skinIndices.length*4,4);t.setAttribute("skinIndex",hG.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new kt(e.skinWeights.length*4,4);t.setAttribute("skinWeight",hG.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new $t,i=e.geometry;if(e.isPoints||e.isLine){let r=new kt(i.vertices.length*3,3),n=new kt(i.colors.length*3,3);if(t.setAttribute("position",FA.call(r,i.vertices)),t.setAttribute("color",cG.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new kt(i.lineDistances.length,1);t.setAttribute("lineDistance",RPe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};KT.prototype.isGeometry=!0;var DPe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:a[g].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let g=0;g<u;g++)h[g]={name:c[g].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,f=e.skinWeights,m=d.length===i.length,v=f.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let x=t[g];this.vertices.push(i[x.a],i[x.b],i[x.c]);let S=x.vertexNormals;if(S.length===3)this.normals.push(S[0],S[1],S[2]);else{let A=x.normal;this.normals.push(A,A,A)}let _=x.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let A=x.color;this.colors.push(A,A,A)}if(n===!0){let A=r[0][g];A!==void 0?this.uvs.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new Ee,new Ee,new Ee))}if(s===!0){let A=r[1][g];A!==void 0?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new Ee,new Ee,new Ee))}for(let A=0;A<o;A++){let T=a[A].vertices;l[A].data.push(T[x.a],T[x.b],T[x.c])}for(let A=0;A<u;A++){let T=c[A].vertexNormals[g];h[A].data.push(T.a,T.b,T.c)}m&&this.skinIndices.push(d[x.a],d[x.b],d[x.c]),v&&this.skinWeights.push(f[x.a],f[x.b],f[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},gO=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new k,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new fi,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function RPe(e){return this.array.set(e),this}function cG(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new fi),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function uG(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Ee),t[i++]=s.x,t[i++]=s.y}return this}function FA(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new k),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function hG(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new Ti),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var IPe=["a","b","c"];function LPe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function R3(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function I3(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[e].edges.push(c),s[t].edges.push(c)}function OPe(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],I3(a.a,a.b,e,r,a,i),I3(a.b,a.c,e,r,a,i),I3(a.c,a.a,e,r,a,i)}function kA(e,t,i,r,n){e.push(new gO(t,i,r,void 0,void 0,n))}function Z0(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function VA(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var zPe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof $t?e=new KT().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new k,i,r,n,s,a,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;OPe(o,l,h,d);let f=[],m,v,g,x,S,_,A;for(let ve of Array.from(d.keys())){for(v=d.get(ve),g=new k,S=3/8,_=1/8,A=v.faces.length,A!=2&&(S=.5,_=0,A!=1),g.addVectors(v.a,v.b).multiplyScalar(S),t.set(0,0,0),s=0;s<A;s++){for(x=v.faces[s],a=0;a<3&&(m=o[LPe(x,IPe[a])],!(m!==v.a&&m!==v.b));a++);m&&t.add(m)}t.multiplyScalar(_),g.add(t),v.newEdge=f.length,f.push(g)}let T,E,I,P,C,L,z,F=[];for(r=0,n=o.length;r<n;r++){for(L=o[r],C=h[r].edges,i=C.length,i==3?T=3/16:i>3&&(T=3/(8*i)),E=1-i*Number(T),I=T,i<=2&&(i==2?(E=3/4,I=1/8):i==1||i==0),z=L.clone().multiplyScalar(E),t.set(0,0,0),s=0;s<i;s++)P=C[s],m=P.a!==L?P.a:P.b,t.add(m);t.multiplyScalar(Number(I)),z.add(t),F.push(z)}let G=F.concat(f),N=F.length,q,ie,Q,W=[],ee=[],K,j,$,se,re=new Ee,he=new Ee,oe=new Ee;for(r=0,n=l.length;r<n;r++)x=l[r],q=Number(R3(x.a,x.b,d).newEdge)+N,ie=Number(R3(x.b,x.c,d).newEdge)+N,Q=Number(R3(x.c,x.a,d).newEdge)+N,kA(W,q,ie,Q,x.materialIndex),kA(W,x.a,q,Q,x.materialIndex),kA(W,x.b,ie,q,x.materialIndex),kA(W,x.c,Q,ie,x.materialIndex),u&&(K=c[r],j=K[0],$=K[1],se=K[2],re.set(Z0(j.x,$.x),Z0(j.y,$.y)),he.set(Z0($.x,se.x),Z0($.y,se.y)),oe.set(Z0(j.x,se.x),Z0(j.y,se.y)),VA(ee,re,he,oe),VA(ee,j,re,oe),VA(ee,$,he,re),VA(ee,se,oe,he));e.vertices=G,e.faces=W,u&&(e.faceVertexUvs[0]=ee)}},ys=new k,BPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new $t().copy(new Zc(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(ys),r={width:ys.x,height:ys.y,depth:ys.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new $t().copy(new Zc(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(ys)):ys.set(a.width,a.height,a.depth),(t!==ys.x||i!==ys.y||r!==ys.z)&&s.scale(ys.x===0?1:t/ys.x,ys.y===0?1:i/ys.y,ys.z===0?1:r/ys.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new zPe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new Wq(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(ys);let s=100/ys.x;Object.assign(n.parameters,{width:100,height:ys.y*s,depth:ys.z*s}),t(this.build(n))})}},kQ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Dn?e.shape:new Dn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,f=2*Math.PI/r;for(let v=0;v<r;v++){let g=f*v,x=h+Math.sin(g)*c,S=d+Math.cos(g)*u;l.addPoint(l.createPoint(x,S))}l.isClosed=!0;for(let v=0,g=l.points.length;v<g;v++)l.points[v].roundness=n;l.roundness=n,l.update();let m=cv.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(m,{userData:{...e,type:"PolygonGeometry"}})}},NPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new FPe(t*.5,i,n,s,a,o,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function vw(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function L3(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function UPe(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var FPe=class extends $t{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=t/2,f=Math.PI/i,m=e*Math.cos(Math.PI/i),v=2*Math.PI/i,g=(i-2)*Math.PI/i,x=Math.PI-g,S=new k(0,-d,0),_=new k(0,d,0),A=new Ee(e,-d),T=new Ee(m,-d),E=new Ee(0,_.y).sub(T),I=new Ee(0,_.y).sub(A),P=new Ee(E.y,-E.x).normalize(),C=new Ee(I.y,-I.x).normalize(),L=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-E.angle())/2)-1e-8;s=Math.min(s,L);let z;{let Q=new k(P.x,P.y,0),W=new k(Math.cos(v)*Q.x,Q.y,Math.sin(v)*Q.x);z=Q.angleTo(W)}let F=s/Math.tan((Math.PI-E.angle())/2),G=s/Math.tan((Math.PI-z)/2),N=new k;if(!n){l.push(S.x,S.y,S.z),c.push(0,-1,0),u.push(0,0);let Q=h++,W=[],ee=A.clone(),K=F/Math.cos(Math.PI/i);ee.x-=K;for(let j=0;j<i;j++){let $=j/i*Math.PI*2+f,se=new Ee(Math.sin($),Math.cos($));vw(ee,se,N),l.push(N.x,N.y,N.z),c.push(0,-1,0),u.push(0,0),W.push(h++)}for(let j=0;j<W.length;j++)o.push(W[j],Q,W[(j+1)%W.length])}{let Q=new k,W=new k,ee=new k,K=new k,j=new k,$=new k;for(let se=0;se<i;se++){let re=se/i*Math.PI*2+f,he=(se+.5)/i*Math.PI*2+f,oe=(se+1)/i*Math.PI*2+f,ve=new Ee(Math.sin(re),Math.cos(re)),xe=new Ee(Math.sin(he),Math.cos(he)),be=new Ee(Math.sin(oe),Math.cos(oe));vw(A,ve,W),vw(A,be,ee),vw(P,xe,Q),L3(_,W,ee,G,G,K),l.push(K.x,K.y,K.z),L3(W,_,ee,G,F,j),l.push(j.x,j.y,j.z),L3(ee,W,_,F,G,$),l.push($.x,$.y,$.z),c.push(Q.x,Q.y,Q.z),c.push(Q.x,Q.y,Q.z),c.push(Q.x,Q.y,Q.z),u.push(0,0),u.push(0,0),u.push(0,0);let Me=h++,Te=h++,ae=h++;if(o.push(Me,Te,ae),s>0){{let Be=W.clone().add(ee).multiplyScalar(.5),Ve=_.clone().sub(Be).normalize(),lt=S.clone().sub(Be).normalize().add(Ve).normalize().multiplyScalar(-1),We=$.clone().sub(j);q(Be,We,lt,E.angle())}let Ce,Ie;{let Be=new k;vw(C,be,Be);let Ve=$.clone().add(K).multiplyScalar(.5);Ve=UPe(Ve,ee,_);let lt=$.clone().sub(K);[Ce,Ie]=q(Ve,lt,Be,z,K.y)}{let Be=Ce,Ve=Be.clone().setY(0).normalize(),lt=new k(0,-1,0),We=Ve.clone().cross(lt);ie(Be,Ve,lt,We)}{let Be=E.angle(),Ve=Math.PI-Be,lt=_.clone();lt.y-=s/Math.sin(Be-Math.PI/2);let We=new k,je=[];for(let Mt=0;Mt<a;Mt++){let de=[],V=Math.PI/2-Ve*Mt/a,X=Math.cos(V),we=Math.sin(V),J=he;for(let Le=0;Le<=Mt;Le++){let qe=Math.cos(J),ct=Math.sin(J);Q.x=X*ct,Q.y=we,Q.z=X*qe,We.copy(lt).addScaledVector(Q,s),l.push(We.x,We.y,We.z),c.push(Q.x,Q.y,Q.z),u.push(0,0),de.push(h++),J+=Math.PI*2/Mt/i}je.push(de)}Ie.reverse(),je.push(Ie);let xt=je.length-1;for(let Mt=0;Mt<xt;Mt++){let de=je[Mt],V=je[Mt+1],X=de.length-1;o.push(V[1],de[0],V[0]);for(let we=1;we<=X;we++)o.push(de[we],de[we-1],V[we]),o.push(V[we+1],de[we],V[we])}}}}}this.setIndex(o),this.setAttribute("position",new kt(l,3)),this.setAttribute("normal",new kt(c,3)),this.setAttribute("uv",new kt(u,2));function q(Q,W,ee,K,j){let $=-K/2,se=(Math.PI-K)/2,re=W.clone().normalize().cross(ee);Q.addScaledVector(ee,-s/Math.sin(se));let he=new k,oe=new k,ve=1,xe=h,be=[];for(let Me=0;Me<=a;Me++){let Te=$+Me/a*K;oe.set(0,0,0),oe.addScaledVector(re,Math.sin(Te)),oe.addScaledVector(ee,Math.cos(Te));for(let ae=0;ae<=ve;ae++){let Ce=ae/ve-.5;if(he.copy(Q),he.addScaledVector(W,Ce),he.addScaledVector(oe,s),j!=null){let Ie=Math.max(0,he.y-j);he.addScaledVector(W,-Ie/W.y)}l.push(he.x,he.y,he.z),c.push(oe.x,oe.y,oe.z),u.push(0,0),ae===0&&be.push(h),h++}}for(let Me=0;Me<a;Me++)for(let Te=0;Te<ve;Te++){let ae=xe+Te+(ve+1)*Me,Ce=ae+(ve+1),Ie=Ce+1,Be=ae+1;o.push(ae,Ce,Be),o.push(Ce,Ie,Be)}return[Q.clone().addScaledVector(W,.5),be]}function ie(Q,W,ee,K){let j=Math.PI/2,$=I.angle()-j,se=[],re=new k,he=new k;for(let ve=0;ve<=a;ve++){let xe=[],be=ve/a;for(let Me=0;Me<=ve;Me++){let Te=((ve?Me/ve:0)-.5)*x,ae=Math.cos(Te),Ce=Math.sin(Te),Ie=Math.atan(Math.tan($)*ae),Be=(j+Ie)*be,Ve=Math.cos(Be),lt=Math.sin(Be);re.set(0,0,0),re.addScaledVector(W,lt*ae),re.addScaledVector(ee,Ve),re.addScaledVector(K,lt*Ce),he.copy(Q).addScaledVector(re,s),l.push(he.x,he.y,he.z),c.push(re.x,re.y,re.z),u.push(0,0),xe.push(h++)}se.push(xe)}let oe=se.length-1;for(let ve=0;ve<oe;ve++){let xe=se[ve],be=se[ve+1],Me=xe.length-1;o.push(xe[0],be[1],be[0]);for(let Te=1;Te<=Me;Te++)o.push(xe[Te-1],xe[Te],be[Te]),o.push(xe[Te],be[Te+1],be[Te])}}}},EN=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Dn?e.shape:new Dn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(A,T,E){return T>i&&E>r?Math.min(A*i/T,A*r/E):T>i?A*i/T:E>r?A*r/E:A}let f=[];f[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),f[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),f[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),f[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let m=u.x,v=h.x,g=h.y,x=u.y;t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(v,g)),t.addPoint(t.createPoint(v,x)),t.addPoint(t.createPoint(m,x)),t.isClosed=!0;let S=!0;for(let A=0,T=t.points.length;A<T;A++)t.points[A].roundness=f[A],A>0&&f[A]!==f[A-1]&&(S=!1);S&&(t.roundness=f[0]),t.useCubicForRoundedCorners=s!==1,t.update();let _=cv.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(_,{userData:{...e,type:"RectangleGeometry"}})}},kPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Gt.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new $t,u.setAttribute("position",new kt([],3))):u=new By(.5*t,n,s,a,o,l,c*Gt.DEG2RAD),u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},VPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new Ju(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},HPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new GPe(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},GPe=class extends $t{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(ve=0,xe=0,be=0)=>new k(ve,xe,be),f=d(),m=d(),[v,g,x]=[t/2,e/2,i/2],S=-g,_=+g,[A,T,E]=[d(S,-v,+x),d(S,-v,-x),d(S,+v,-x)],I=(ve,xe=!1)=>Math.sin(ve-Math.PI/(1+ +xe)),P=(ve,xe=!1)=>Math.cos(ve-Math.PI/(1+ +xe));E.y=Math.sin(r)*t-v;let C=Math.cos(r)*t-x,L=A.z-c;r<=h?(E.z=Math.min(C,L),E.z==L&&(E.y-=(C-L)/Math.tan(h-r))):T.z=Math.min(T.z-C-x,A.z-c),f.subVectors(A,T),m.subVectors(E,T);let z=Math.min(f.length(),m.length())*n/100,F=z*Math.tan(r/2),G=z/Math.cos(r/2),N=f.clone().normalize().add(m.normalize()).setLength(G).add(T);f.set(0,I(r,!0),P(r,!0)),u.push([E,f.clone()]);let q=(Math.PI-r)/s;for(let ve=0;ve<=s;ve++){let xe=h+r+ve*q;f.set(0,Math.sin(xe)*F,Math.cos(xe)*F),f.add(N),m.set(0,I(xe),P(xe)),u.push([f.clone(),m.clone()])}u.push([A,d(0,1,0)]);let ie=Math.sin(q/2)*F*2,Q=u.length-1,W=u[0][0].distanceTo(u[1][0]),ee=u[Q-1][0].distanceTo(u[Q][0]),K=W+ie*s+ee;u[0].push(1);for(let ve=0;ve<=s;ve++)u[ve+1].push(1-(W+ve*ie)/K);u[Q].push(0);let[j,$,se]=u[0],re,he,oe;for(let ve=1;ve<u.length;ve++)[re,he,oe]=u[ve],a.push(S,j.y,j.z,S,re.y,re.z,_,j.y,j.z,_,j.y,j.z,S,re.y,re.z,_,re.y,re.z),o.push(0,$.y,$.z,0,he.y,he.z,0,$.y,$.z,0,$.y,$.z,0,he.y,he.z,0,he.y,he.z),l.push(0,se,0,oe,1,se,1,se,0,oe,1,oe),[j,$,se]=[re,he,oe];this.setAttribute("position",new kt(a,3)),this.setAttribute("normal",new kt(o,3)),this.setAttribute("uv",new kt(l,2))}},VQ=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Dn?e.shape:new Dn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,f=0,m=0,v=a*Math.PI/360/n,g=Math.PI/2*3*-1,x=h*r/100,S=d*r/100;if(n===3&&r===50){v=2*Math.PI/n;for(let A=0;A<n;A++){let T=v*A,E=f+Math.sin(T)*h,I=m+Math.cos(T)*d;u.addPoint(u.createPoint(E,I))}}else for(let A=0;A<n;A++){let T=f+Math.cos(g)*h,E=m+Math.sin(g)*d;u.addPoint(u.createPoint(T,E)),g+=v,T=f+Math.cos(g)*x,E=m+Math.sin(g)*S,u.addPoint(u.createPoint(T,E)),g+=v}u.isClosed=!0;for(let A=0,T=u.points.length;A<T;A++)u.points[A].roundness=s;u.roundness=s,u.update();let _=cv.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(_,{userData:{...e,type:"StarGeometry"}})}},jPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Ju(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},WPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=XPe(t,i,r,t*.5,a,s,0,0,n,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function XPe(e,t,i,r,n,s,a,o,l,c,u){[t,i]=[i,t],a=t/2;let h=Gt.clamp(n/360,0,1);if(h===0){let d=new $t;return d.setAttribute("position",new kt([],3)),d}return h===1&&(c=0),new UQ(!0,e,t,i,r,h,s,a,o,l,c,u)}var qPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new Uq(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},YPe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Dn?e.shape:new Dn,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,f=l.points.length;d<f;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=cv.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function QPe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function ZPe(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function KPe(e,t,i){let r,n,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),c=i*(1-o*t),u=i*(1-(1-o)*t);switch(a%6){case 0:r=i,n=u,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=c,s=i;break;case 4:r=u,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function JPe(e,t,i){e/=255,t/=255,i/=255;let r=Math.max(e,t,i),n=Math.min(e,t,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function $Pe(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function eDe(e,t,i){return(e<<16)+(t<<8)+i}function tDe(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function iDe(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var rDe={parseRgba:ZPe,hsvToRgb:KPe,rgbToHsv:JPe,hexToRgb:$Pe,rgbToHex:eDe,rgbToHexString:tDe,hexStringToRgb:iDe},nDe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},sDe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},dt=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+dt.version}static addUnaryOp(e){return dt.max_unop_len=Math.max(e.length,dt.max_unop_len),dt.unary_ops[e]=1,dt}static addBinaryOp(e,t,i){return dt.max_binop_len=Math.max(e.length,dt.max_binop_len),dt.binary_ops[e]=t,i?dt.right_associative.add(e):dt.right_associative.delete(e),dt}static addIdentifierChar(e){return dt.additional_identifier_chars.add(e),dt}static addLiteral(e,t){return dt.literals[e]=t,dt}static removeUnaryOp(e){return delete dt.unary_ops[e],e.length===dt.max_unop_len&&(dt.max_unop_len=dt.getMaxKeyLen(dt.unary_ops)),dt}static removeAllUnaryOps(){return dt.unary_ops={},dt.max_unop_len=0,dt}static removeIdentifierChar(e){return dt.additional_identifier_chars.delete(e),dt}static removeBinaryOp(e){return delete dt.binary_ops[e],e.length===dt.max_binop_len&&(dt.max_binop_len=dt.getMaxKeyLen(dt.binary_ops)),dt.right_associative.delete(e),dt}static removeAllBinaryOps(){return dt.binary_ops={},dt.max_binop_len=0,dt}static removeLiteral(e){return delete dt.literals[e],dt}static removeAllLiterals(){return dt.literals={},dt}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new dt(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return dt.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!dt.binary_ops[String.fromCharCode(e)]||dt.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return dt.isIdentifierStart(e)||dt.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(dt.hooks[e]){let i={context:this,node:t};return dt.hooks.run(e,i),i.node}return t}searchHook(e){if(dt.hooks[e]){let t={context:this};return dt.hooks[e].find(function(i){return i.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===dt.SPACE_CODE||e===dt.TAB_CODE||e===dt.LF_CODE||e===dt.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:dt.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===dt.SEMCOL_CODE||i===dt.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())t.push(r);else if(this.index<this.expr.length){if(i===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,dt.max_binop_len),t=e.length;for(;t>0;){if(dt.binary_ops.hasOwnProperty(e)&&(!dt.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!dt.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(t=this.gobbleBinaryOp(),!t))return s;for(n={value:t,prec:dt.binaryPrecedence(t),right_a:dt.right_associative.has(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),r=[s,n,a];t=this.gobbleBinaryOp();){if(i=dt.binaryPrecedence(t),i===0){this.index-=t.length;break}n={value:t,prec:i,right_a:dt.right_associative.has(t)},l=t;let c=u=>n.right_a&&u.right_a?i>u.prec:i<=u.prec;for(;r.length>2&&c(r[r.length-2]);)a=r.pop(),t=r.pop().value,s=r.pop(),e={type:dt.BINARY_EXP,operator:t,left:s,right:a},r.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),r.push(n,e)}for(o=r.length-1,e=r[o];o>1;)e={type:dt.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(e=this.code,dt.isDecimalDigit(e)||e===dt.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===dt.SQUOTE_CODE||e===dt.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(e===dt.OBRACK_CODE)r=this.gobbleArray();else{for(t=this.expr.substr(this.index,dt.max_unop_len),i=t.length;i>0;){if(dt.unary_ops.hasOwnProperty(t)&&(!dt.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!dt.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:dt.UNARY_EXP,operator:t,argument:n,prefix:!0})}t=t.substr(0,--i)}dt.isIdentifierStart(e)?(r=this.gobbleIdentifier(),dt.literals.hasOwnProperty(r.name)?r={type:dt.LITERAL,value:dt.literals[r.name],raw:r.name}:r.name===dt.this_str&&(r={type:dt.THIS_EXP})):e===dt.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===dt.PERIOD_CODE||t===dt.OBRACK_CODE||t===dt.OPAREN_CODE||t===dt.QUMARK_CODE;){let i;if(t===dt.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==dt.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===dt.OBRACK_CODE?(e={type:dt.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==dt.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===dt.OPAREN_CODE?e={type:dt.CALL_EXP,arguments:this.gobbleArguments(dt.CPAREN_CODE),callee:e}:(t===dt.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:dt.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e="",t,i;for(;dt.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===dt.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);dt.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));dt.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);dt.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return i=this.code,dt.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(i===dt.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===dt.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:dt.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=n}else e+=n}return r||this.throwError('Unclosed quote after "'+e+'"'),{type:dt.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(dt.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,dt.isIdentifierPart(e));)this.index++;return{type:dt.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===e){i=!0,this.index++,e===dt.CPAREN_CODE&&r&&r>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(n===dt.COMMA_CODE){if(this.index++,r++,r!==t.length){if(e===dt.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===dt.CBRACK_CODE)for(let s=t.length;s<r;s++)t.push(null)}}else if(t.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===dt.COMPOUND)&&this.throwError("Expected comma"),t.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(dt.CPAREN_CODE);if(this.code===dt.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:dt.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:dt.ARRAY_EXP,elements:this.gobbleArguments(dt.CBRACK_CODE)}}},aDe=new nDe;Object.assign(dt,{hooks:aDe,plugins:new sDe(dt),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});dt.max_unop_len=dt.getMaxKeyLen(dt.unary_ops);dt.max_binop_len=dt.getMaxKeyLen(dt.binary_ops);var gx=e=>new dt(e).parse(),oDe=Object.getOwnPropertyNames(dt);oDe.forEach(e=>{gx[e]===void 0&&e!=="prototype"&&(gx[e]=dt[e])});gx.Jsep=dt;var lDe="ConditionalExpression",cDe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:lDe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};gx.plugins.register(cDe);function vC(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var HQ=class{constructor(e,t,i){var r;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=vC(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await pDe(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=t==null?void 0:t.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=i_(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?i_(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Ms.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Ms.zoom(this.result,e):this.result;if(fDe(t))return Object.entries(t);if(dDe(t))return t.map((i,r)=>[r.toString(),i]);throw hDe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function uDe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function hDe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function dDe(e){return Array.isArray(e)}function fDe(e){return typeof e=="object"&&e!==null}async function pDe(e,t,i=new AbortController){var l,c,u,h;let r,n=e.url,s=((l=e.proxy)==null?void 0:l.enabled)??!1,a;if(((c=e.integration)==null?void 0:c.type)==="OpenAI"){let d=Vw(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),f=e.integration.behavior===""?[]:Vw(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${f}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let d;a!==void 0?d=a:e.method==="POST"&&e.body&&(d=Vw(JSON.parse(e.body),t)),d!==void 0&&(n+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((u=e.integration)==null?void 0:u.type)==="OpenAI"?r=a:e.method==="POST"&&e.body&&(r=Vw(JSON.parse(e.body),t));let o=await fetch(n,{method:s?"GET":e.method,headers:s?void 0:uDe(e),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((h=e.integration)==null?void 0:h.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var GQ=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return GQ(i,t)}return fa.isBoolean(e)?fa.getDisplayedValue(e).toLowerCase():fa.getDisplayedValue(e)},Vw=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+Vw(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return GQ(n,t)}}return""}).join(""),mDe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],gDe=["0","1","2","3","4","5","6","7","8","9","."],vDe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function yDe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}gx.addBinaryOp("^",11,!0);function jQ(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=t.getUserAPI(c);if(u!==void 0&&u instanceof HQ){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=t.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(t.scene.data.objects.traverse((u,h)=>{var f;let d=(f=h.events)==null?void 0:f.find(m=>m.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(u!==void 0){r+=u;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=fa.getDisplayedValue(c);i==="number"&&fa.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&fa.isBoolean(c)?u=c?"true":"false":i==="boolean"&&fa.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!yDe(o.name)&&!gDe.includes(o.name)&&!mDe.includes(o.name)&&!vDe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=gx(r)}catch(a){console.error(r,a);return}let s;try{s=hr(n)}catch(a){console.error(r,n,a)}return s}function hr(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(hr(e.left)===hr(e.right));case"!=":return+(hr(e.left)!==hr(e.right));case">":return+(hr(e.left)>hr(e.right));case">=":return+(hr(e.left)>=hr(e.right));case"<":return+(hr(e.left)<hr(e.right));case"<=":return+(hr(e.left)<=hr(e.right));case"+":return hr(e.left)+hr(e.right);case"-":return hr(e.left)-hr(e.right);case"*":return hr(e.left)*hr(e.right);case"/":return hr(e.left)/hr(e.right);case"%":return hr(e.left)%hr(e.right);case"&&":return hr(e.left)&&hr(e.right);case"||":return hr(e.left)||hr(e.right);case"^":return Math.pow(hr(e.left),hr(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-hr(e.argument);case"!":return+!hr(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=hr(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=hr(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(hr))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var xDe=new St,wDe=new St;function bDe(e,t,i){let r=[new k,new k,new k],n=[new k,new k,new k];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Gt.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new St().makeBasis(r[0],r[1],r[2])}var _De=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??AN.create({parameters:hQ}).userData.shape;return{path:e.path??BT.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...dQ,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new SDe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new $t,{userData:{...e,type:"PathGeometry"}})}},SDe=class extends $t{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!QPe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let Q=0;Q<o;Q++){let W=this.inputs.path.isClosed?(Q+s)%e.length:Math.min(Q+s,e.length-1);l.push(e[W].clone()),c.push(t[W].clone())}let u=(Q,W,ee)=>{l[Q]=l[Q].clone().lerp(l[W],ee),c[Q]=bDe(c[Q],c[W],ee)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let f=0,m=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&m&&(f=m,u(l.length-1,l.length-2,1-f)),i===0){let Q=l.length-1;l[Q].copy(l[0]),c[Q].copy(c[0])}this._applyPathModifiers(c,h,f);let{bevel:v,bevelSides:g}=this.inputs.parameters.extrusion,x=v>0?this.inputs.parameters.extrusion.capType:"flat",S=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(S=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:_,infos:A,vertices:T}=this._computeShapePoints(S),E=0,I;x==="round"&&(I=new MN(this.inputs.shapeData,2*v,v,S,g,void 0,!0),E=I.getAttribute("position").count);let P=0,C=0;A.sort((Q,W)=>Q.start-W.start),A.forEach(Q=>{Q.verticesStart=P,Q.verticesCount=Q.continuous.reduce((W,ee,K)=>W+(K===0||!ee?2:1),0),C+=Q.verticesCount,P=C});let L=C*o,z,F=0;if(this._isOpenEnded()&&x==="flat"){try{z=op({windingRule:Dr.ODD,elementType:is.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:_})}catch{z=RQ}F=z.vertexCount}let G=L+2*F+E*2,N=L+2*F,q={positions:new Float32Array(G*3),normals:new Float32Array(G*3),uvs:new Float32Array(G*2)},ie=[];if(A.forEach(Q=>{this._extrudeRegion(Q,T,c,l,q,ie,this._isGeometryClosed()&&!this._isOpenEnded())}),z&&(this._closeEnd(z,L,ie,q,c[0],l[0],!1),this._closeEnd(z,L+F,ie,q,c[c.length-1],l[l.length-1],!0)),I){q.positions.set(I.getAttribute("position").array,N*3),q.normals.set(I.getAttribute("normal").array,N*3),q.uvs.set(I.getAttribute("uv").array,N*2);for(let K=N;K<N+E;K++)q.uvs[K*2+1]=1e-4;let Q=ie.length;ie.push(...I.getIndex().array.map(K=>K+N)),N+=E,q.positions.set(I.getAttribute("position").array,N*3),q.normals.set(I.getAttribute("normal").array,N*3),q.uvs.set(I.getAttribute("uv").array,N*2);let W=ie.length;ie.push(...I.getIndex().array.map(K=>K+N)),this.setAttribute("position",new pi(q.positions,3)),this.setAttribute("normal",new pi(q.normals,3)),this.setAttribute("uv",new pi(q.uvs,2)),this.setIndex(ie);let ee=xDe;ee.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(ee,N,G),ee.copy(c[0]).setPosition(l[0]).multiply(wDe.makeScale(1,1,-1)),this.applyMatrix4OnRange(ee,N-E,N),this.reverseIndicesOnRange(Q,W)}else this.setAttribute("position",new pi(q.positions,3)),this.setAttribute("normal",new pi(q.normals,3)),this.setAttribute("uv",new pi(q.uvs,2)),this.setIndex(ie)}_extractPathPoints(){let e=bQ(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new k,s=new k,a=new k,o=new k,l=new k(0,1,0);for(let m=0;m<i;m++){let v=e[m],g;m===0?g=r?e[e.length-2]:v.clone().multiplyScalar(2).sub(e[1]):g=e[m-1];let x;m===i-1?x=r?e[1]:v.clone().multiplyScalar(2).sub(e[m-1]):x=e[m+1];let S=v.clone().sub(g).normalize(),_=x.clone().sub(v).normalize(),A=S.clone().add(_).normalize();a.copy(A),m===0&&(A.equals(l)||A.clone().negate().equals(l))&&l.set(0,0,1);let T=l.clone().cross(A).normalize(),E=A.clone().cross(T).normalize();l.copy(E),o.copy(T),m===0&&(n.copy(E),s.copy(A));let I=new St().makeBasis(T,E,A);t.push(I)}let c=r?s:a,u=r?n:new k(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let f=u.clone().cross(h);c.dot(f)>0&&(d*=-1);for(let m=1;m<t.length;m++){let v=new St().makeRotationZ(d*m/t.length);t[m].multiply(v)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new St,c=new St;return e.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(Gt.lerp(n,n+s,d)*Gt.DEG2RAD);let f=Gt.lerp(a,o,d);c.makeScale(f,f,f),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=Dr.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let f=u[d-1],m=u[d-0];h.push(f,m)}return h}),s;try{s=op({windingRule:t,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=SN}let a;try{a=op({windingRule:Dr.ODD,elementType:is.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=DQ}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],f=s.elements[h+1],m=d+f,v={start:d,count:f,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(v);let g=d,x=m-1,S=d+1,_=i.roundedCurves.length;do{let A=g-d;s.vertices[x*2+0],s.vertices[x*2+1];let T=s.vertices[g*2+0],E=s.vertices[g*2+1],I=s.vertices[S*2+0],P=s.vertices[S*2+1],C=T-I,L=E-P,z=Math.sqrt(C*C+L*L);C/=z,L/=z,v.normals[A*2+0]=-L,v.normals[A*2+1]=C;let F=s.vertexIndices[g];if(Array.isArray(F))v.continuous[A]=!1;else{let[G,N]=i.getCurveIndexFromVertexId(F-1,!0);if(N>0&&N<1)v.continuous[A]=!0;else{let q=N===1?G+1:G-1;q=(q+_)%_;let ie=N===1?0:1,Q=i.roundedCurves[G].getTangent(N),W=i.roundedCurves[q].getTangent(ie);v.continuous[A]=Q.dot(W)>.95}}u&&(v.normals[A*2+0]*=-1,v.normals[A*2+1]*=-1),[x,g,S]=[g,S,S+1],S>=m&&(S-=f)}while(S!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new k,l=new k,c=new k,u=new k,h=new Ee;i.forEach((f,m)=>{let v=r[m],g=e.verticesStart*i.length+e.verticesCount*m;for(let x=0;x<e.count;x++){let S=(e.start+x)*2;if(o.set(t[S+0],t[S+1],0),c.copy(o).applyMatrix4(f).add(v),e.continuous[x])u.set(e.normals[x*2+0],e.normals[x*2+1],0);else{let _=x===0?(e.start+e.count-1)*2:S-2;l.set(t[_+0],t[_+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(f).normalize(),h.set(x===0?1:x/e.count,m/(i.length-1)),this._insertVertex(n,g,c,u,h),g++,!e.continuous[x]||x===0){if(x===0)u.set(e.normals[x*2+0],e.normals[x*2+1],0),h.set(0,m/(i.length-1));else{let _=x===e.count-1?e.start*2:S+2;l.set(t[_+0],t[_+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(f).normalize(),this._insertVertex(n,g,c,u,h),g++}}});let d=i.length-1;for(let f=0;f<d;f++){let m=e.verticesStart*i.length+e.verticesCount*f,v=e.verticesStart*i.length+e.verticesCount*(f+1),g=0;for(let x=0;x<e.count;x++){(!e.continuous[x]||x===0)&&g++;let S=x===e.count-1?0:g+1,_=m+g,A=m+S,T=v+S,E=v+g;e.isHole?s.push(_,T,A,_,E,T):s.push(_,A,T,_,T,E),g++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new k(0,0,a?-1:1).applyMatrix4(n),c=new k,u=new Ee;for(let d=0;d<o;d++){let f=2*d;c.set(e.vertices[f+0],e.vertices[f+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let f=3*d,m=h[f+0]+t,v=h[f+(a?1:2)]+t,g=h[f+(a?2:1)]+t;i.push(m,v,g)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new ns().getNormalMatrix(e).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,f=c.itemSize;for(let m=t*f,v=i*f;m<v;m+=f){if(m===t)debugger;s=h[m+0],a=h[m+1],o=h[m+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[m+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[m+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[m+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[m+0],a=d[m+1],o=d[m+2],d[m+0]=n[0]*s+n[3]*a+n[6]*o,d[m+1]=n[1]*s+n[4]*a+n[7]*o,d[m+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function WQ(){let e=new $t;return e.setAttribute("position",new pi(new Float32Array([]),3)),e.setIndex(new pi(new Uint16Array([]),1)),e}var MDe=WQ().attributes,ADe=12,EDe=1,vO=class extends $t{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,MDe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=fa.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=TDe(e,t,u),{shapes:d,charWidths:f,charCoords:m}=t.generateShapes(h,e),v=(typeof i=="number"?i:1)*.5,g=(typeof r=="number"?r:1)*.5,x=d.map(A=>new Dn().fromShape(A,!0));this.vectorShapes=x;let S=x.map(A=>cv.create({shape:A,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?Dr.NONZERO:Dr.ODD,subdivisions:this.isLowResolution&&n>0?EDe:ADe}})),_=S.length?bg(S):WQ();_.translate(-v,g,0),this.dispose(),this.wrappedText=h,this.charCoords=m,this.charWidths=f,this.deleteAttribute("extrudeNormal"),Object.entries(_.attributes).forEach(([A,T])=>{this.setAttribute(A,T)}),this.setIndex(_.index),this.computeBoundingSphere()}clone(){let e=ql(new $t,vO.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function TDe(e,t,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var XQ,qQ=new Promise(e=>{XQ=e}),dG=!1,HA;function CDe(){if(dG)return;if(HA)return HA;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.81/build",i=Lp(()=>import("./process-DLQUZ-E7.js"),[],import.meta.url),[r,n]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});XQ(a),dG=!0}return HA=e(),HA}var PDe=["font"];function f_(e,t,i,r){var c,u;let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let h of a){let d=s;for(let f of h)d=d[f];for(n in d){let f=d[n];m6(f)&&!PDe.includes(n)&&(d[n]=t.getVariable(f,[r.uuid,"geometry",...h,n]),m6(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=Dn.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new Wq().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new no(s,i);return h.data=e,h}else{if(s.type==="TextGeometry")return new vO(s,t);if(s.type==="InputGeometry")return new vO(s,t);if(s.type==="UIGeometry")return EN.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=vG(o)}catch(h){console.error(h)}if(!l){let h=Dn.createFromState(zT.defaultData(),100,100);o.shape=h,l=vG(o)}return l}var DDe=new St;function yO(e,t,i,r){let n=e.position.array,s=e.normal.array,a=DDe.makeScale(t,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=t,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var GA=new Gn,K0=new k,yi;qQ.then(e=>{yi=e});var fG=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),pG=new Uint32Array([0,1,2,3]),mG=new Uint8Array([4]),no=class extends $t{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Og.div(t,i);this.subdividedGeometry&&yO(this.subdividedGeometry.attributes,...r),this.originalGeometry&&yO(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(K0.fromArray(r));let s=K0.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=no.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Zc(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(no.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new jo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;GA.setFromBufferAttribute(t),GA.getCenter(i),e.boundingSphere.radius=i.distanceTo(GA.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),GA.getSize(K0);let r={width:K0.x,height:K0.y,depth:K0.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(yi.free_bvh(t),yi.free_subdivision_surface(t));try{n=no.allocate(e,r)}catch(l){console.error(l,e),n=no.allocate({positionWASM:fG,indexWASM:pG,verticesPerFaceWASM:mG},r)}if(yi.set_destination_refinement_level(n,0),s=no.buildLevel(n,!0,o),e.subdivisions>0)try{yi.set_destination_refinement_level(n,e.subdivisions),a=no.buildLevel(n,!1,o)}catch{try{yi.set_destination_refinement_level(n,e.subdivisions-1),a=no.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:f_(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=yC(r.getAttribute("position"),n));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=YQ(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var _;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=fG,r=pG,n=mG);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,f=u*Float32Array.BYTES_PER_ELEMENT,m=yi._malloc(d),v=new Float32Array(yi.HEAPF32.buffer,m,u),g=new Uint32Array(yi.HEAPU32.buffer,m+f,h);v.set(i,0),v.set(s,i.length),v.set(a,i.length+s.length),g.set(r,0),g.set(n,r.length);let x;(_=e==null?void 0:e.scaleBaked)!=null&&_.some(A=>A!==1)&&(x=new St().makeScale(...e.scaleBaked)),t&&(x?x.premultiply(t):x=t);let S=x?yi.alloc_subdivision_surface2(m,o,m+f,l,m+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c,x.elements):yi.alloc_subdivision_surface(m,o,m+f,l,m+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return yi._free(m),S}static buildLevel(e,t,i,r,n){let s=n?yi.get_mesh_data2(e,t?yi.Level.CONTROL:yi.Level.REFINED,i,n.elements):yi.get_mesh_data(e,t?yi.Level.CONTROL:yi.Level.REFINED,i),a=8,o=yi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=yi.HEAPU32[o[c]>>2],h=yi.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=yi.HEAPU32[o[c]>>2],f=yi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let m=yi.HEAPU32[o[c]>>2],v=yi.HEAPU32.subarray(m>>2,(m>>2)+l[c]);c++;let g=yi.HEAPU32[o[c]>>2],x=yi.HEAPU32.subarray(g>>2,(g>>2)+l[c]);if(c++,r===void 0){let S=new $t;if(S.setIndex(new zy(x,1)),S.setAttribute("position",new kt(h,3)),S.setAttribute("normal",new kt(f,3)),t){S.setAttribute("faceMap",new zy(v,1));let _=new Float32Array(f.length/3*4).fill(0);S.setAttribute("color",new pi(_,4))}return yi.free_mesh_data(s),S.userData.type="SubdivGeometry",S}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(f),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,yi.free_mesh_data(s)}static freeSubdivPointer(e){yi.free_bvh(e),yi.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=yi.get_wireframe_data_for_base_level(e),n=4,s=yi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=yi.HEAPU32[s[o]>>2],c=yi.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=yi.HEAPU32[s[o]>>2],h=yi.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(t===void 0){let d=new $t;d.setAttribute("position",new kt(c,3));let f=new Float32Array(c.length);for(let m=0,v=c.length;m<v;)f[m++]=i.r,f[m++]=i.g,f[m++]=i.b;return d.setAttribute("color",new pi(f,3)),d.setIndex(new zy(h,1)),yi.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,yi.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||yi.set_destination_refinement_level(e,t);let n=i?yi.get_topological_data2(e,r?yi.Level.CONTROL:yi.Level.REFINED,i.elements):yi.get_topological_data(e,r?yi.Level.CONTROL:yi.Level.REFINED),s=6,a=yi.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=yi.HEAPU32[a[l]>>2],u=new Float32Array(yi.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=yi.HEAPU32[a[l]>>2],d=new Uint32Array(yi.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let f=yi.HEAPU32[a[l]>>2],m=new Uint8Array(yi.HEAPU32.subarray(f>>2,(f>>2)+o[l]));return yi.free_topological_data(n),{positions:u,indices:d,verticesPerFace:m}}},gG=["getX","getY","getZ"];function yC(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[gG[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[gG[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var jA=new k,O3=new k,z3=new k,B3=new k;function YQ(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((f,m)=>Math.floor(m/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){jA.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),O3.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),z3.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),B3.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),O3.sub(jA).normalize(),z3.sub(jA).normalize(),B3.sub(jA).normalize();let l=O3.cross(z3).dot(B3);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var sd={};Sfe(sd,{calcBoolean:()=>zDe,calcBooleanTopological:()=>ODe,freeMeshSet:()=>FDe,getMeshSet:()=>BDe,hasOpenEdges:()=>NDe,transformMeshSet:()=>UDe});var QQ,RDe=new Promise(e=>{QQ=e}),WA;function IDe(){if(WA)return WA;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.81/build",i=Lp(()=>import("./boolean-CynEgfvK.js"),[],import.meta.url),[r,n]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});QQ(a)}return WA=e(),WA}var er,Hy;RDe.then(e=>er=e);function LDe(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=yC(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:c}=YQ(s,a,e);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function ZQ(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=er._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(er.HEAPU32.buffer,s,t):new Float32Array(er.HEAPF32.buffer,s,t)).set(e,0),s}function KQ(e){switch(e){case 0:return er.OP.UNION;case 1:return er.OP.INTERSECTION;case 2:return er.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function ODe(e,t){Hy===void 0&&(Hy=er.init_csg());let i=ZQ(e),r=er.csg_calc_topological(Hy,i,e.length,KQ(t));er._free(i);let n=6,s=er.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=er.HEAPU32[s[o]>>2],c=new Float32Array(er.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=er.HEAPU32[s[o]>>2],h=new Uint32Array(er.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=er.HEAPU32[s[o]>>2],f=new Uint8Array(er.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return er.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:f}}function zDe(e,t,i,r){Hy===void 0&&(Hy=er.init_csg());let n=ZQ(e),s=er.csg_calc(Hy,n,e.length,r,KQ(t));er._free(n);let a=5,o=er.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=er.HEAPU32[o[c]>>2],h=er.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=er.HEAPU32[o[c]>>2],f=er.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let m=l[c];i.setAttribute("position",new kt(h,3)),i.setAttribute("normal",new kt(f,3));let v=er.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new jo),i.boundingSphere.center.set(v[0],v[1],v[2]),i.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,i.userData.parameters={width:v[3]*2,height:v[4]*2,depth:v[5]*2},er.free_mesh_data(s),m}function BDe(e,t,i){if(er===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let g=e.userData;s=g.verticesPerFace.length,r=g.positions,n=Array(g.verticesPerFace.reduce((x,S)=>x+S,0)+s);for(let x=0,S=0,_=0;x<g.verticesPerFace.length;x++){n[_++]=g.verticesPerFace[x];for(let A=0;A<g.verticesPerFace[x];A++)n[_++]=g.indices[S++]}}else({positions:r,faceIndices:n,nFaces:s}=LDe(e,t,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=er._malloc(u),f=new Float32Array(er.HEAPF32.buffer,d,l),m=new Uint32Array(er.HEAPU32.buffer,d+h,c);f.set(r,0),m.set(n,0);let v=er.get_csg_mesh(d,a,d+h,o,s);return er._free(d),v}function NDe(e){return er.has_open_edges(e)}function UDe(e,t){er.transform_csg_mesh(e,t.elements)}function FDe(e){er.free_csg_mesh(e)}var kDe={ConeGeometry:HCe,CubeGeometry:GCe,CylinderGeometry:_Q,DodecahedronGeometry:WCe,EllipseGeometry:AN,HelixGeometry:TPe,IcosahedronGeometry:CPe,LatheGeometry:PPe,NonParametricGeometry:BPe,PolygonGeometry:kQ,PyramidGeometry:NPe,RectangleGeometry:EN,SphereGeometry:kPe,PlaneGeometry:VPe,BackdropGeometry:HPe,StarGeometry:VQ,TextFrameGeometry:jPe,TorusGeometry:WPe,TorusKnotGeometry:qPe,TriangleGeometry:YPe,PathGeometry:_De,VectorGeometry:cv},vG=e=>kDe[e.type].create(e);function J0(e){return e!==null&&"booleanOp"in e}var JQ=class extends xN(qr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new St}updateVisible(e){super.updateVisible(e),this.visible=!J0(this.parent)&&this.visible,J0(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(sd.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),J0(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof JQ&&(e.freeBooleanPointer(),J0(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&J0(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),J0(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},XA=new Gn;function TN(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),f=e.getY(h),m=e.getZ(h);d<s&&(s=d),f<a&&(a=f),m<o&&(o=m),d>l&&(l=d),f>c&&(c=f),m>u&&(u=m)}XA.min.set(s,a,o),XA.max.set(l,c,u),XA.getCenter(r),XA.getSize(n).multiplyScalar(.5)}var VDe=new $t,HDe=new Ld,mo=class extends JQ{constructor(e,t){super(VDe,HDe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?TN(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},qf=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},qf.uuidContext===null)throw new Error("plz startContext");qf.uuidContext===qf.globalContext?this.uuid="_gid"+qf.uuidContext.nodeContextUuid++:this.uuid="_uid"+qf.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===qf.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},_s=qf;_s.globalContext={nodeContextUuid:0},_s.uuidContext=qf.globalContext;var yG=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},GDe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Fo=new GDe,Lr=class extends _s{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=Gt.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},qo=class extends Lr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},la=class extends qo{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof Ee?e:new Ee(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},zl=class extends qo{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof k?e:new k(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},ma=class extends fi{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},ad=class extends qo{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof ma?e:new ma(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},jDe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,xG=/[a-z_0-9]+/gi,Ut=class extends Lr{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=xG.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,f=h;if(this.keywords[h]||this.useKeywords&&d&&Fo.containsKeyword(h)){let m=this.keywords[h];if(!m){let v=Fo.getKeywordData(h);v.cache&&(m=e.keywords[h]),m=m||Fo.getKeyword(h,e),v.cache&&(e.keywords[h]=m)}f=m.build(e)}h!==f&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+f+o.substring(u.index+h.length+a),a+=f.length-h.length),this.getIncludeByName(f)===void 0&&Fo.contains(f)&&e.include(Fo.get(f))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=jDe.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(xG);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},WDe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,$Q=class extends Lr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||$Q.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=WDe.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},wr=$Q;wr.PI="PI",wr.PI2="PI2",wr.RECIPROCAL_PI="RECIPROCAL_PI",wr.RECIPROCAL_PI2="RECIPROCAL_PI2",wr.LOG2="LOG2",wr.EPSILON="EPSILON";var XDe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),qDe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),eZ=class extends Lr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=XDe.exec(e);if(t){let i=t[2],r;for(;r=qDe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},CN=class extends Lr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};Fo.addKeyword("uv",function(){return new CN});Fo.addKeyword("uv2",function(){return new CN(1)});var py=class extends Lr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??py.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Qc:return["Linear"];case Bi:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=py.Nodes[this.method],s=e.include(n);if(s===py.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=py.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=py.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Uu=py;Uu.Nodes={LinearToLinear:new Ut(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Ut(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Ut(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Uu.LINEAR_TO_LINEAR="LinearToLinear",Uu.SRGB_TO_LINEAR="sRGBToLinear",Uu.LINEAR_TO_SRGB="LinearTosRGB";var Jr=class extends Ut{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},md=class extends qo{constructor(e=new wn,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new CN,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Uu(new Jr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Wt=class extends qo{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},wG=class extends Lr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},tZ=class extends Lr{constructor(e,t,i=tZ.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Lo=tZ;Lo.ADD="+",Lo.SUB="-",Lo.MUL="*",Lo.DIV="/";var Er=class extends Lr{constructor(e,t=Er.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Er.MIX:case Er.CLAMP:case Er.REFRACT:case Er.SMOOTHSTEP:case Er.FACEFORWARD:return 3;case Er.MIN:case Er.MAX:case Er.MOD:case Er.STEP:case Er.REFLECT:case Er.DISTANCE:case Er.DOT:case Er.CROSS:case Er.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Er.LENGTH:case Er.DISTANCE:case Er.DOT:return"f";case Er.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case Er.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Er.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Er.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Er.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case Er.MIN:case Er.MAX:case Er.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case Er.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case Er.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},Oi=Er;Oi.RAD="radians",Oi.DEG="degrees",Oi.EXP="exp",Oi.EXP2="exp2",Oi.LOG="log",Oi.LOG2="log2",Oi.SQRT="sqrt",Oi.INV_SQRT="inversesqrt",Oi.FLOOR="floor",Oi.CEIL="ceil",Oi.NORMALIZE="normalize",Oi.FRACT="fract",Oi.SATURATE="saturate",Oi.SIN="sin",Oi.COS="cos",Oi.TAN="tan",Oi.ASIN="asin",Oi.ACOS="acos",Oi.ARCTAN="atan",Oi.ABS="abs",Oi.SIGN="sign",Oi.LENGTH="length",Oi.NEGATE="negate",Oi.INVERT="invert",Oi.MIN="min",Oi.MAX="max",Oi.MOD="mod",Oi.STEP="step",Oi.REFLECT="reflect",Oi.DISTANCE="distance",Oi.DOT="dot",Oi.CROSS="cross",Oi.POW="pow",Oi.MIX="mix",Oi.CLAMP="clamp",Oi.REFRACT="refract",Oi.SMOOTHSTEP="smoothstep",Oi.FACEFORWARD="faceforward";var Hw=class extends Lr{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new wG(Hw.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Uu(new Jr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Uu(new Jr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Uu(new Jr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Uu(new Jr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new Jr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Jr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Jr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Jr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new Jr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new wG(Hw.Nodes.roughnessToMip,[r]),s=new Oi(n,Hw.Nodes.m0,Hw.Nodes.cubeUV_maxMipLevel,Oi.CLAMP),a=new Oi(s,Oi.FLOOR),o=new Oi(s,Oi.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new Lo(a,new Wt(1).setReadonly(!0),Lo.ADD)),u=new Oi(l,c,o,Oi.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},xO=Hw;xO.Nodes=function(){let e=new eZ(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new wr("float cubeUV_maxMipLevel 8.0",!0),i=new wr("float cubeUV_minMipLevel 4.0",!0),r=new wr("float cubeUV_maxTileSize 256.0",!0),n=new wr("float cubeUV_minTileSize 16.0",!0),s=new Ut(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new Ut(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new Ut(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new wr("float r0 1.0",!0),c=new wr("float v0 0.339",!0),u=new wr("float m0 -2.0",!0),h=new wr("float r1 0.8",!0),d=new wr("float v1 0.276",!0),f=new wr("float m1 -1.0",!0),m=new wr("float r4 0.4",!0),v=new wr("float v4 0.046",!0),g=new wr("float m4 2.0",!0),x=new wr("float r5 0.305",!0),S=new wr("float v5 0.016",!0),_=new wr("float m5 3.0",!0),A=new wr("float r6 0.21",!0),T=new wr("float v6 0.0038",!0),E=new wr("float m6 4.0",!0),I=[l,c,u,h,d,f,m,v,g,x,S,_,A,T,E],P=new Ut(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,I);return{bilinearCubeUV:o,roughnessToMip:P,m0:u,cubeUV_maxMipLevel:t}}();var my=class extends Lr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??my.VIEW}getShared(){return this.scope===my.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case my.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case my.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case my.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},ko=my;ko.LOCAL="local",ko.WORLD="world",ko.VIEW="view",ko.NORMAL="normal";Fo.addKeyword("viewNormal",function(){return new ko(ko.VIEW)});Fo.addKeyword("localNormal",function(){return new ko(ko.NORMAL)});Fo.addKeyword("worldNormal",function(){return new ko(ko.WORLD)});var rd=class extends Lr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??rd.LOCAL}getType(){switch(this.scope){case rd.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case rd.LOCAL:case rd.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case rd.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case rd.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case rd.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case rd.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},kc=rd;kc.LOCAL="local",kc.WORLD="world",kc.VIEW="view",kc.PROJECTION="projection";Fo.addKeyword("position",function(){return new kc});Fo.addKeyword("worldPosition",function(){return new kc(kc.WORLD)});Fo.addKeyword("viewPosition",function(){return new kc(kc.VIEW)});var Cu=class extends Lr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Cu.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Cu.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Cu.VECTOR:{let n=new ko(ko.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new kc(kc.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case Cu.CUBE:{let n=new Cu(Cu.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case Cu.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new Cu(Cu.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Gy=Cu;Gy.CUBE="cube",Gy.SPHERE="sphere",Gy.VECTOR="vector";var YDe=class extends Lr{constructor(e=new md,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new xO(this.value,t??new Gy(Gy.VECTOR),i),this.irradianceNode=new xO(this.value,new ko(ko.WORLD),new Wt(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},QDe=class extends qo{constructor(e=new RB,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Gy,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Uu(new Jr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},ZDe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,KDe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,JDe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,$De=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,e3e=`
layout(location = 1) out vec4 gVelocity;
`,t3e=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,bG=["x","y","z","w"],i3e=["float","vec2","vec3","vec4"],r3e={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},n3e={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},iZ=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(ZDe),this.addFragmentParsCode(KDe),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(JDe),this.addFragmentFinalCode($De)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof _s?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new yG({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new yG({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?Fo.get(e):e,this.context.include===!1)return e.name;e instanceof Ut?r=this.includes.functions:e instanceof wr?r=this.includes.consts:e instanceof eZ&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof Ut&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return i3e[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Hg:case Gg:return new QDe(i);case B_:return new YDe(new md(i));default:return new md(i)}else{if(i.isVector2)return new la(i);if(i.isVector3)return new zl(i);if(i.isVector4)return new ad(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return r3e[e]||e}getFormatByType(e){return n3e[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return bG[e]}getIndexByElement(e){return bG.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Qc,t===Qc&&this.context.gamma&&(t=Bi),t}},Rn=class extends qo{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof ma?e:new ma(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},Fr=class extends qo{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},ao=class extends qo{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},eg=class extends qo{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},PN=class extends qo{},s3e=class extends PN{constructor(e){super("v3"),this.image=e,this._value=new k}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},wO=class extends PN{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},rZ=class extends qo{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new ns}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},th=class extends qo{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new St}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function _G(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new ns().makeRotation(r*Gt.DEG2RAD))}var a3e=class extends rZ{constructor(e,t,i=0){super(new ns),this.repeat=e,this.offset=t,this.rotation=i,_G(this.value,e,t,i)}updateMatrix(){_G(this.value,this.repeat,this.offset,this.rotation)}},tg=class extends qo{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Ti?new Array(e).fill(t):new Array(e).fill(new Ti(0))}},SG=class extends Lr{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},nZ=class extends Lr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(nZ.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bO=nZ;bO.Nodes=function(){return{customColor:new Ut(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var sZ=class extends Lr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(sZ.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},aZ=sZ;aZ.Nodes=function(){return{customNormal:new Ut(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var Gw=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(Gw.Nodes.cylindrical);break;case 2:r=e.include(Gw.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new Ut(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(Gw.Nodes.triplanar);break;default:r=e.include(Gw.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},DN=Gw;DN.Nodes=function(){let e=new Ut(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new Ut(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Ut(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Ut(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var jw=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Ut(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[jw.Nodes.vectorLinearWorldSpaceDepth,jw.Nodes.vectorLinearObjectSpaceDepth,jw.Nodes.vectorSphericalObjectSpaceDepth,jw.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},oZ=jw;oZ.Nodes=function(){let e=new Ut(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new Ut(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Ut(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Ut(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var o3e=class extends Lr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Ut(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},lZ=class extends Lr{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(lZ.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},cZ=lZ;cZ.Nodes=function(){return{gradient:new Ut(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var uZ=class extends Lr{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(uZ.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},hZ=uZ;hZ.Nodes=function(){return{matcap:new Ut(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var Bo=function(){let e=new Ut(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new Ut(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new wr("float F3 0.3333333"),t.keywords.G3=new wr("float G3 0.1666667");let i=new Ut(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new wr("float F3 0.3333333"),i.keywords.G3=new wr("float G3 0.1666667");let r=new Ut(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),n=new Ut("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Ut("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Ut(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new Ut("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new Ut("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new Ut(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new Ut(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new wr("int NUM_OCTAVES 5");let h=new Ut("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new Ut(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),f=new Ut(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),m=new Ut(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),v=new Ut(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),g=new Ut(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),x=new Ut(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),S=new Ut(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),_=new Ut(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[f,m,v,g,x,S]);return{simplexFast:t,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:u,perlin:d,voronoi:_}}(),dZ=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,f,m,v,g,x,S){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=f,this.highCut=m,this.lowCut=v,this.smoothness=g,this.seed=x,this.quality=S,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new Ut(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Bo.simplexFast,Bo.simplexFractal,Bo.simplexAshima,Bo.fbm,Bo.perlin,Bo.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};dZ.numOctaves=5;var fZ=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,f,m,v){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=f,this.pixelRatio=m,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(fZ.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},pZ=fZ;pZ.Nodes=function(){let e=new Ut(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Ut(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var nd=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,f,m,v,g,x){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=f,this.horizontal=m,this.sides=v,this.isMask=x,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new Ut(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new Ut(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new Ut(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,nd.DrawFunctions.circle,nd.DrawFunctions.ring,nd.DrawFunctions.polygon,nd.DrawFunctions.cross,nd.DrawFunctions.diamond,nd.DrawFunctions.checkerboard,nd.DrawFunctions.line,nd.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},mZ=nd;mZ.DrawFunctions=function(){let e=new Ut(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new Ut(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new Ut(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new Ut(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new Ut(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new Ut(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new Ut(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new Ut(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Ut(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new Ut(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var gZ=class extends Lr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(gZ.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},vZ=gZ;vZ.Nodes=function(){let e=new Ut(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[Bo.simplexFast]);return{rainbow:new Ut(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}}();var yZ=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(yZ.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},xZ=yZ;xZ.Nodes=function(){let e=new Ut(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new Ut(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Ut(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new Ut(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new Ut(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Ut(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Bo.simplexFast,e,i,n])}}();var l3e=function(){return{textureBicubic:new Ut(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function c3e(e,t){return e>=t?new Ee(t/e,1):new Ee(1,e/t)}var wZ=class extends Lr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,xi.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(wZ.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bZ=wZ;bZ.Nodes=function(){let e=new Ut(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new Ut(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Ut(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Ut(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[l3e.textureBicubic,i,e]),n=new Ut(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new Ut(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var _O=(e=>(e.NOISE="noise",e.MAP="map",e))(_O||{}),_Z=class extends Lr{constructor(e,t,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new Fr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(_O)[this.displacementTypeIndex.value]==="map"&&(this.mat=new rZ(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(_O)[this.displacementTypeIndex.value]){case"map":{i=e.include(_Z.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new Ut(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new Ut(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[Bo.simplexPrecise,Bo.simplexFractal,Bo.simplexAshima,Bo.fbm,Bo.perlin,Bo.voronoi]),l=new Ut(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},SZ=_Z;SZ.Nodes=function(){let e=new Ut(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new Ut(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Ut(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var xi={normalRenderTarget:new md,normalRenderTargetDepth:new md,transmissionRenderTarget:new md,aspectRatio:new la,transmissionSize:new la(2048,2048),transmissionRenderTargetDepth:new md,aoRenderTarget:new md,aoEnabled:new ao,pixelRatioNode:new Wt(1),resolution:new la,penumbraSize:new eg(5,.5),frameIndex:new Fr(0),transmissionLod:new Fr(2)};for(let e of Object.values(xi))e.isRenderGlobal=!0;var MZ={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.81/build/ui.wasm"},RN=class extends _s{constructor(){super("basic"),this.nodeType="Basic",this.color=new Rn(ml),this.shadingAlpha=new Wt(1),this.shadingBlend=new Fr(0),this.previousModelViewMatrix=new th,this.previouseProjectionMatrix=new th}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ax.merge([Bt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new Rn(ml)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},u3e=class extends _s{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Rn(ml),this.emissive=new Rn(0),this.emissiveIntensity=new Wt(1),this.previousModelViewMatrix=new th,this.previouseProjectionMatrix=new th,this.shadingAlpha=new Wt(1),this.shadingBlend=new Fr(0),this.occlusion=new ao(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ax.merge([Bt.fog,Bt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled}),this.color===void 0&&(this.color=new Rn(ml)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},vx=function(){let e=new Ut(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new Ut(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),h3e=class extends _s{constructor(){super("phong"),this.nodeType="Phong",this.color=new Rn(ml),this.specular=new Rn(1118481),this.shininess=new Wt(30),this.previousModelViewMatrix=new th,this.previouseProjectionMatrix=new th,this.shadingAlpha=new Wt(1),this.shadingBlend=new Fr(0),this.occlusion=new ao(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ax.merge([Bt.fog,Bt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled}),this.color===void 0&&(this.color=new Rn(ml)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(vx.dHdxy),e.include(vx.perturbNormalArb);let f=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${g}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},d3e=class extends _s{constructor(){super("standard"),this.nodeType="Standard",this.color=new Rn(ml),this.roughness=new Wt(.3),this.metalness=new Wt(0),this.reflectivity=new Wt(.5),this.previousModelViewMatrix=new th,this.previouseProjectionMatrix=new th,this.shadingAlpha=new Wt(1),this.shadingBlend=new Fr(0),this.occlusion=new ao(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ax.merge([Bt.fog,Bt.lights])),Bt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new Rn(ml)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let f=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(vx.dHdxy),e.include(vx.perturbNormalArb);let v=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),x=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",S="";this.bumpMap.projection.value===4?S=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${v.result}, uv0, ${x});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${v.result}, uv1, ${x});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${v.result}, uv2, ${x});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:S=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${v.result}, bumpMapCachedUv, ${x});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${S}
					`)}if(f.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let v=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),x="";this.roughnessMap.projection.value===4?x=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${v.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${v.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${v.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:x=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${v.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${x}
				`)}else f.push(s.code,"	float roughnessFactor = "+s.result+";");u&&f.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let m="1.0";this.mask&&(this.mask.analyze(e),m=`luminance(${this.mask.flow(e,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${m} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${m}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&f.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&f.push(`gl_FragColor.a *= ${h.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join(`
`)}return t}},f3e=class extends _s{constructor(){super("toon"),this.nodeType="Toon",this.color=new Rn(ml),this.specular=new Rn(1118481),this.shininess=new Wt(30),this.previousModelViewMatrix=new th,this.previouseProjectionMatrix=new th,this.shadingAlpha=new Wt(1),this.shadingBlend=new Fr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({resolution:xi.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Ax.merge([Bt.fog,Bt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:xi.penumbraSize}),e.mergeUniform({frameIndex:xi.frameIndex}),e.mergeUniform({aoMap:xi.aoRenderTarget}),e.mergeUniform({aoEnabled:xi.aoEnabled}),this.color===void 0&&(this.color=new Rn(ml)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(vx.dHdxy),e.include(vx.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${v}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},p3e=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},m3e=class extends p3e{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},N3;function g3e(e){return typeof e=="string"?e:(N3||(N3=new m3e),N3.load(e))}var v3e=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},y3e=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},AZ=class extends v3e{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=g3e(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){var n,s;let r=(s=(n=this._cache[e])==null?void 0:n[t])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new Uye(this.img,void 0,e,e):a=new wn(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},ep=class extends AZ{};function x3e(e,t){var i=S3e(t);return i.formatToParts?b3e(i,e):_3e(i,e)}var w3e={year:0,month:1,day:2,hour:3,minute:4,second:5};function b3e(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=w3e[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function _3e(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var U3={};function S3e(e){if(!U3[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";U3[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return U3[e]}function EZ(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var MG=36e5,M3e=6e4,F3={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function TZ(e,t,i){var r,n;if(!e||(r=F3.timezoneZ.exec(e),r))return 0;var s;if(r=F3.timezoneHH.exec(e),r)return s=parseInt(r[1],10),AG(s)?-(s*MG):NaN;if(r=F3.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return AG(s,a)?(n=Math.abs(s)*MG+a*M3e,s>0?-n:n):NaN}if(T3e(e)){t=new Date(t||Date.now());var o=i?t:A3e(t),l=SO(o,e),c=i?l:E3e(t,l,e);return-c}return NaN}function A3e(e){return EZ(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function SO(e,t){var i=x3e(e,t),r=EZ(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function E3e(e,t,i){var r=e.getTime(),n=r-t,s=SO(new Date(n),i);if(t===s)return t;n-=s-t;var a=SO(new Date(n),i);return s===a?s:Math.max(s,a)}function AG(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var EG={};function T3e(e){if(EG[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),EG[e]=!0,!0}catch{return!1}}var C3e=zp(Efe(),1),TG=zp(Tfe(),1),P3e=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,D3e=P3e,k3=36e5,CG=6e4,R3e=2,oo={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:D3e};function I3e(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},r=i.additionalDigits==null?R3e:(0,C3e.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=L3e(e),s=O3e(n.date,r),a=s.year,o=s.restDateString,l=z3e(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=B3e(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=TZ(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,TG.default)(new Date(c+u)),h=(0,TG.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function L3e(e){var t={},i=oo.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=oo.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=oo.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function O3e(e,t){var i=oo.YYY[t],r=oo.YYYYY[t],n;if(n=oo.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=oo.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function z3e(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=oo.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,DG(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=oo.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return F3e(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=oo.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return DG(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=oo.Www.exec(e),i)return s=parseInt(i[1],10)-1,RG(t,s)?PG(t,s):new Date(NaN);if(i=oo.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return RG(t,s,l)?PG(t,s,l):new Date(NaN)}return null}function B3e(e){var t,i,r;if(t=oo.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),V3(i)?i%24*k3:NaN;if(t=oo.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),V3(i,r)?i%24*k3+r*CG:NaN;if(t=oo.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return V3(i,r,n)?i%24*k3+r*CG+n*1e3:NaN}return null}function PG(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var N3e=[31,28,31,30,31,30,31,31,30,31,30,31],U3e=[31,29,31,30,31,30,31,31,30,31,30,31];function CZ(e){return e%400===0||e%4===0&&e%100!==0}function DG(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=CZ(e);if(r&&i>U3e[t]||!r&&i>N3e[t])return!1}return!0}function F3e(e,t){if(t<1)return!1;var i=CZ(e);return!(i&&t>366||!i&&t>365)}function RG(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function V3(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function k3e(e,t,i){var r=I3e(e,i),n=TZ(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function co(e,t){return t.color(e)}function IG(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=k3e(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function V3e(e,t){switch(e.type){case"fresnel":return j3e(e,t);case"gradient":return W3e(e,t);case"depth":return X3e(e,t);case"normal":return q3e(e,t);case"noise":return Y3e(e,t);case"rainbow":return Q3e(e,t);case"toon":return Z3e(e,t);case"outline":return K3e(e,t);case"transmission":return J3e(e,t);case"color":return G3e(e,t);case"pattern":return $3e(e,t)}}function H3e(e){return{type:e.type}}function tu(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...H3e(e),alpha:s,mode:r,isMask:n}}function G3e(e,t){return{...tu(e,t),color:co(e.color,t)}}function j3e(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...tu(e,t),color:co(a,t),bias:i,scale:r,intensity:n,factor:s}}function W3e(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...tu(e,t),gradientType:i,smooth:r,colors:n.map(c=>new Ti(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new Ee(...o),morph:new Ee(...l),angle:a}}function X3e(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...tu(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new k(...o),direction:l?new k(...l):new k(1,0,0),colors:c.map(d=>d!==void 0?new Ti(d[0],d[1],d[2],d[3]):new Ti(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function q3e(e,t){let{cnormal:i}=e;return{...tu(e,t),cnormal:new k(i[0],i[1],i[2])}}function Y3e(e,t){return{...tu(e,t),scale:e.scale,move:e.move,fA:new Ee(...e.fA),fB:new Ee(...e.fB),size:new k(...e.size),distortion:new Ee(...e.distortion),colorA:co(e.colorA,t),colorB:co(e.colorB,t),colorC:co(e.colorC,t),colorD:co(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function Q3e(e,t){return{...tu(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new k(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new k(...e.offset)}}function Z3e(e,t){return{...tu(e,t),positioning:e.positioning,colors:e.colors.map(i=>new Ti(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new k(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:co(e.shadowColor,t),offset:new k(...e.offset)}}function K3e(e,t){return{...tu(e,t),outlineColor:co(e.outlineColor,t),contourColor:co(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new k(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function J3e(e,t){return{...tu(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function $3e(e,t){return{...tu(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new Ee(...e.offset),colorA:co(e.colorA,t),colorB:co(e.colorB,t),frequency:new Ee(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new Ee(...e.vertical),horizontal:new Ee(...e.horizontal),sides:e.sides}}var JT=class extends ma{},eRe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},tRe={depth:["colors"]};function iRe(e,t,i){var s,a;if(t==="isMask")return!0;let r=eRe[e.type],n=tRe[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function PZ(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof ep||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof ep||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Gt.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function rRe(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(RZ(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof PN))switch(n=n||iRe(i,s,a),o.constructor){case Rn:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof JT?o.value=new ma(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case ad:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof JT?o.value=new ma(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case la:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case zl:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case md:{PZ(a,t,i);break}case tg:{o.value=a.map(l=>new Ti(...l));break}default:{o.value=a;break}}}return n}var Yg=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,X_=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)RZ(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return Ru.createLightLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new wO(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new s3e(n),o=new a3e(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Wt(i.crop?1:0),c=new Fr(i.projection??0),u=new Fr(["x","y","z"].indexOf(i.axis)??0),h=new Fr(i.side??0),d=new la(i.size?new Ee(i.size[0],i.size[1]):new Ee(100,100)),f=new Wt(i.blending??0),m=new Wt(Yg(i.alpha,r)),v=new Fr(i.mode??0),g=new ao(i.isMask??!1),x=new DN(s,a,l,c,u,h,d,f,o,m,v,g),S=new Jr(x.calpha,"f");return new Tn(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:f,mat:o,alpha:m,mode:v,isMask:g},x,v,S,g,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new wO(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Wt(Yg(i.alpha,r)),o=new Fr(i.mode??0),l=new ao(i.isMask??!1),c=new Wt((i.texture.rotation??0)*Gt.DEG2RAD),u=new hZ(s,a,o,l,c),h=new Jr(u.calpha,"f");return new Tn(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new zl(new k(...i.offset)),s=new Wt(i.scale??10),a=new Wt(i.intensity??8),o=new Wt(i.movement??1),l=new Fr(i.noiseType??0),c=new Fr(i.voronoiStyle??0),u=new Wt(i.smoothness??.5),h=new Wt(i.seed??0),d=new Wt(i.highCut??1),f=new Wt(i.lowCut??0),m=new Fr(i.quality??1),v=new SZ(a,o,n,c,u,h,d,f,m,s,l);return new DZ(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:f,quality:m},v,r)}else throw new Error;else return aRe(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):rRe(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?PZ(r.props,i.shared,this):!0;return!1}dispose(){if(nRe(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof ep||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Tn=class extends X_{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},DZ=class extends X_{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},Ru=class extends X_{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLightLayer(e,t,i,r){let n,s=new Wt(Yg(i.alpha,r)),a=new Fr(i.mode),o=new Wt(i.bumpMapIntensity),l=new Wt(Yg(i.alphaOverride,r)),c;if(!i.visible)n=new RN,c={};else if(i.category==="lambert"){n=new u3e;let u=new Rn(r.color(i.emissive)??0),h=new ao(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new f3e;let u=new Wt(i.shininess??30),h=new Rn(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new d3e;let u=new Wt(i.roughness??.3),h=new Wt(i.metalness??0),d=new Wt(i.reflectivity??.5),f=new ao(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:f},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=f}else{n=new h3e;let u=new Wt(i.shininess??30),h=new Rn(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new ao(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new Wt(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new Ru(e,t,i,n,c,r)}get category(){return this.node.category}};function nRe(e){let t=e instanceof X_?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Rl(e){return{alpha:new Wt(e.alpha??1),mode:new Fr(e.mode??0),isMask:new ao(e.isMask??!1)}}function sRe(e,t,i,r,n){switch(e.type){case"color":{let s=new Rn(r.color??ml),a=Rl(r),o=new bO(s,a.alpha),l=new Jr(o.calpha,"f");return new Tn(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new Rn(r.color??16777215),a=new Wt(r.bias??.1),o=new Wt(r.scale??1),l=new Wt(r.intensity??2),c=new Wt(r.factor??1),u=Rl(r),h=new o3e(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new Jr(h.calpha,"f");return new Tn(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new Wt(r.filmThickness??30),a=new Wt(r.movement??0),o=new zl(r.wavelengths??new k(0,0,0)),l=new Wt(r.noiseStrength??0),c=new Wt(r.noiseScale??1),u=new zl(r.offset??new k(0,0,0)),h=Rl(r),d=new vZ(s,a,o,l,c,u,h.alpha,h.isMask),f=new Jr(d.calpha,"f");return new Tn(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,f,h.isMask,n)}case"transmission":{let s=new Wt(r.thickness??10),a=new Wt(r.ior??1.5),o=new Wt(r.roughness??.5),l=xi.transmissionSize,c=xi.transmissionRenderTarget,u=xi.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,f=h>=d?new la(d/h,1):new la(1,h/d),m=Rl(r),v=new bZ(s,a,o,l,c,u,f,m.alpha),g=new Jr(v.calpha,"f");return new Tn(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:f,...m},v,m.mode,g,m.isMask,n)}case"toon":{let s=new Fr(r.positioning??0),a;r.colors?a=new tg(r.colors.length,r.colors):(a=new tg(10,new Ti(0,0,0,1)),a.value[1]=new Ti(1,1,1,1));let o;r.steps?o=new eg(r.steps.length,r.steps):(o=new eg(10,1),o.value[0]=0);let l=new zl(r.source??new k(0,0,0)),c=new ao(r.isWorldSpace??!0),u=new Wt(r.noiseStrength??0),h=new Wt(r.noiseScale??1),d=new ad(r.shadowColor),f=new zl(r.offset??new k(0,0,0)),m=Rl(r),v=new xZ(s,a,o,l,c,u,h,d,f,m.alpha),g=new Jr(v.calpha,"f");return new Tn(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:f,...m},v,m.mode,g,m.isMask,n)}case"outline":{let s=new Rn(r.outlineColor??16777215),a=new Rn(r.contourColor??16777215),o=new Wt(r.outlineWidth??.1),l=new Wt(r.contourWidth??.1),c=new Wt(r.outlineThreshold??.1),u=new Wt(r.contourThreshold??.1),h=new Wt(r.outlineSmoothing??.1),d=new Wt(r.contourFrequency??.1),f=new zl(r.contourDirection??new k(0,1,0)),m=new ao(r.positionalLines??!1),v=new ao(r.compensation??!0),g=xi.normalRenderTarget,x=xi.normalRenderTargetDepth,S=xi.pixelRatioNode,_=xi.resolution,A=Rl(r),T=new pZ(s,a,o,l,c,u,h,d,f,m,v,_,g,x,S,A.alpha),E=new Jr(T.calpha,"f");return new Tn(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:f,positionalLines:m,compensation:v,...A},T,A.mode,E,A.isMask,n)}case"depth":{let s=new Fr(r.gradientType??0),a=new ao(r.smooth??!1),o=new Wt(r.near??50),l=new Wt(r.far??200),c=new Wt(r.isVector??1),u=new Wt(r.isWorldSpace??0),h=new zl(r.origin??new k),d=new zl(r.direction??new k),f;r.colors?f=new tg(r.colors.length,r.colors):(f=new tg(2,new Ti(0,0,0,1)),f.value[1]=new Ti(1,1,1,1));let m;r.steps?m=new eg(r.steps.length,r.steps):(m=new eg(2,1),m.value[0]=0);let v=Rl(r),g=new oZ(s,a,o,l,c,u,h,d,f,m,v.alpha,v.isMask),x=new Jr(g.calpha,"f");return new Tn(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:f,steps:m,...v},g,v.mode,x,v.isMask,n)}case"noise":{let s=new Wt(r.scale??1),a=new zl(r.size??new k(100,100,100)),o=new Wt(r.move??1),l=new la(r.fA??new Ee(1.7,9.2)),c=new la(r.fB??new Ee(8.3,2.8)),u=new la(r.distortion??new Ee(1,1)),h=new ad(r.colorA),d=new ad(r.colorB),f=new ad(r.colorC),m=new ad(r.colorD),v=new Fr(r.noiseType??0),g=new Fr(r.voronoiStyle??0),x=new Wt(r.highCut??1),S=new Wt(r.lowCut??0),_=new Wt(r.smoothness??.5),A=new Wt(r.seed??.5),T=new Fr(r.quality??1),E=Rl(r),I=new dZ(s,a,o,l,c,u,h,d,f,m,E.alpha,v,E.isMask,g,x,S,_,A,T),P=new Jr(I.calpha,"f");return new Tn(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:f,colorD:m,noiseType:v,...E,voronoiStyle:g,highCut:x,lowCut:S,smoothness:_,seed:A,quality:T},I,E.mode,P,E.isMask,n)}case"normal":{let s=new zl(r.cnormal??new k(1,1,1)),a=Rl(r),o=new aZ(s,a.alpha),l=new Jr(o.calpha,"f");return new Tn(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new Fr(r.gradientType??0),a=new ao(r.smooth??!1),o;r.colors?o=new tg(r.colors.length,r.colors):(o=new tg(10,new Ti(0,0,0,1)),o.value[1]=new Ti(1,1,1,1));let l;r.steps?l=new eg(r.steps.length,r.steps):(l=new eg(10,1),l.value[0]=0);let c=new la(r.offset??new Ee(0,0)),u=new la(r.morph??new Ee(0,0)),h=new Wt(r.angle??0),d=Rl(r),f=new cZ(s,a,o,l,c,u,h,d.alpha,d.isMask),m=new Jr(f.calpha,"f");return new Tn(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},f,d.mode,m,d.isMask,n)}case"pattern":{let s=new Fr(r.style??0),a=new Fr(r.projection??0),o=new Fr(["x","y","z"].indexOf(r.axis)??0),l=new Wt(r.blending??0),c=new la(r.offset??new Ee(0,0)),u=new ad(r.colorA),h=new ad(r.colorB),d=new la(r.frequency??new Ee(10,10)),f=new Wt(r.size??.5),m=new Wt(r.variation??0),v=new Wt(r.smoothness??.5),g=new Wt(r.zigzag??0),x=new Wt(r.rotation??0),S=new la(r.vertical??new Ee(0,1)),_=new la(r.horizontal??new Ee(0,1)),A=new Fr(r.sides??6),T=Rl(r),E=new mZ(s,a,o,l,c,u,h,d,f,m,v,g,x,S,_,A,T.alpha,T.isMask),I=new Jr(E.calpha,"f");return new Tn(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:f,variation:m,smoothness:v,zigzag:g,rotation:x,vertical:S,horizontal:_,sides:A,...T},E,T.mode,I,T.isMask,n)}default:{let s=new Rn(1,0,0,1),a=Rl(r),o=new bO(s,a.alpha),l=new Jr(o.calpha,"f");return new Tn(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function aRe(e,t,i,r){let n=V3e(i,r);return sRe(i,e,t,n,r)}function RZ(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=Yg(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function Ry(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,c=t.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var Ep=class extends nr{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},oRe=class extends Ep{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,r){return this.root.getFlavor(e,t,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},IN=class extends Ep{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,_s.startContext(this),this.reset0(e,t),_s.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,r){let n=i?6:(e?3:0)+t;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new oRe(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){_s.startContext(this),(this.data!==e||i)&&this.reset0(e,t),_s.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??js.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>X_.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=Ry(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=Ry(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=Ry(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(n,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof Ru),this.lightLayer===void 0&&(this.lightLayer=new Ru(0,"",{...ks.defaultData("light","phong"),visible:!1},new RN,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof Ru);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof Tn&&s.color instanceof DN&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(_s.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=Ry(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:Yg(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:Yg(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);_s.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Tn?t.color.mask=void 0:t instanceof Ru&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Tn&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof Ru?r.node.mask=new Lo(t.color,t.alpha,Lo.MUL):r instanceof Tn&&(r.isMask.value||(r.color.mask=new Lo(t.color,t.alpha,Lo.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Tn),t=this.layers.findIndex(i=>i instanceof Ru);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof Tn){if(n.isMask.value)continue;i=new SG(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new Jr("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof Ru);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof Tn){if(r.isMask.value)continue;e=new SG(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof DZ);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Lo(t,e[i].position,Lo.ADD),t=new Lo(t,new Wt(.5).setReadonly(!0),Lo.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new iZ;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Tn){let t=e.params.texture;if(t instanceof wO&&!t.image.loaded)return!1}return!0}};Object.defineProperties(Ep.prototype,{properties:{get:function(){return this.fragment.properties}}});var MO=class extends IN{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},LG=new Map;function lRe(e){if(typeof e=="string")return e;let t=LG.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},LG.set(e,t)),t.url}var IZ,cRe=new Promise(e=>{IZ=e}),OG=!1,qA;function uRe(){if(OG)return;if(qA)return qA;async function e(){await Lp(()=>import("./howler-C9DI35r2.js").then(t=>t.h),[],import.meta.url),IZ(window!==void 0?window:global),OG=!0}return qA=e(),qA}var LZ;cRe.then(e=>LZ=e);function hRe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),t=t||n.some(a=>a.data.type==="Audio")})}),t}var Ww=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:lRe(e),format:"wav"},this.sound=new LZ.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},dRe=class{constructor(){this.type="ShapePath",this.color=new fi,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new dT,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(f,m,v,g){let x=f.x,S=m.x,_=v.x,A=g.x,T=f.y,E=m.y,I=v.y,P=g.y,C=(A-_)*(T-I)-(P-I)*(x-_),L=(S-x)*(T-I)-(E-T)*(x-_),z=(P-I)*(S-x)-(A-_)*(E-T),F=C/z,G=L/z;if(z===0&&C!==0||F<=0||F>=1||G<0||G>1)return null;if(C===0&&z===0){for(let N=0;N<2;N++)if(r(N===0?v:g,f,m),t.loc===e.ORIGIN){let q=N===0?v:g;return{x:q.x,y:q.y,t:t.t}}else if(t.loc===e.BETWEEN){let q=+(x+t.t*(S-x)).toPrecision(10),ie=+(T+t.t*(E-T)).toPrecision(10);return{x:q,y:ie,t:t.t}}return null}else{for(let ie=0;ie<2;ie++)if(r(ie===0?v:g,f,m),t.loc===e.ORIGIN){let Q=ie===0?v:g;return{x:Q.x,y:Q.y,t:t.t}}let N=+(x+F*(S-x)).toPrecision(10),q=+(T+F*(E-T)).toPrecision(10);return{x:N,y:q,t:F}}}function r(f,m,v){let g=v.x-m.x,x=v.y-m.y,S=f.x-m.x,_=f.y-m.y,A=g*_-S*x;if(f.x===m.x&&f.y===m.y){t.loc=e.ORIGIN,t.t=0;return}if(f.x===v.x&&f.y===v.y){t.loc=e.DESTINATION,t.t=1;return}if(A<-Number.EPSILON){t.loc=e.LEFT;return}if(A>Number.EPSILON){t.loc=e.RIGHT;return}if(g*S<0||x*_<0){t.loc=e.BEHIND;return}if(Math.sqrt(g*g+x*x)<Math.sqrt(S*S+_*_)){t.loc=e.BEYOND;return}let T;g!==0?T=S/g:T=_/x,t.loc=e.BETWEEN,t.t=T}function n(f,m){let v=[],g=[];for(let x=1;x<f.length;x++){let S=f[x-1],_=f[x];for(let A=1;A<m.length;A++){let T=m[A-1],E=m[A],I=i(S,_,T,E);I!==null&&v.find(P=>P.t<=I.t+Number.EPSILON&&P.t>=I.t-Number.EPSILON)===void 0&&(v.push(I),g.push(new Ee(I.x,I.y)))}}return g}function s(f,m,v){let g=new Ee;m.getCenter(g);let x=[];return v.forEach(S=>{S.boundingBox.containsPoint(g)&&n(f,S.points).forEach(_=>{x.push({identifier:S.identifier,isCW:S.isCW,point:_})})}),x.sort((S,_)=>S.point.x-_.point.x),x}function a(f,m,v,g,x){(x==null||x==="")&&(x="nonzero");let S=new Ee;f.boundingBox.getCenter(S);let _=[new Ee(v,S.y),new Ee(g,S.y)],A=s(_,f.boundingBox,m);A.sort((L,z)=>L.point.x-z.point.x);let T=[],E=[];A.forEach(L=>{L.identifier===f.identifier?T.push(L):E.push(L)});let I=T[0].point.x,P=[],C=0;for(;C<E.length&&E[C].point.x<I;)P.length>0&&P[P.length-1]===E[C].identifier?P.pop():P.push(E[C].identifier),C++;if(P.push(f.identifier),x==="evenodd"){let L=P.length%2===0,z=P[P.length-2];return{identifier:f.identifier,isHole:L,for:z}}else if(x==="nonzero"){let L=!0,z=null,F=null;for(let G=0;G<P.length;G++){let N=P[G];m[N]&&(L?(F=m[N].isCW,L=!1,z=N):F!==m[N].isCW&&(F=m[N].isCW,L=!0))}return{identifier:f.identifier,isHole:L,for:z}}else console.warn('fill-rule: "'+x+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(f=>{let m=f.getPoints(),v=-999999999,g=999999999,x=-999999999,S=999999999;for(let _=0;_<m.length;_++){let A=m[_];A.y>v&&(v=A.y),A.y<g&&(g=A.y),A.x>x&&(x=A.x),A.x<S&&(S=A.x)}c<=x&&(c=x+1),l>=S&&(l=S-1),m.length&&u.push({curves:f.curves,points:m,isCW:zq.isClockWise(m),identifier:o++,boundingBox:new GB(new Ee(S,g),new Ee(x,v))})});let h=u.map(f=>{var m;return a(f,u,l,c,(m=this.userData)==null?void 0:m.style.fillRule)}),d=[];return u.forEach(f=>{let m=h[f.identifier];if(m&&!m.isHole){let v=new fT;v.curves=f.curves,h.filter(g=>(g==null?void 0:g.isHole)&&g.for===f.identifier).forEach(g=>{if(g){let x=u[g.identifier],S=new dT;S.curves=x.curves,v.holes.push(S)}}),d.push(v)}}),d}},OZ=!1,zZ,zG=new Promise(e=>{zZ=e}),BG=!1,YA;function fRe(){if(OZ=!0,BG)return;if(YA)return YA;async function e(){let t=await Lp(()=>import("./opentype-LDE648lb.js"),[],import.meta.url);zZ(t),BG=!0}return YA=e(),YA}var pRe=class{async load(e,t,i=()=>{}){let{load:r}=await zG;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await zG;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function mRe(e){return await(await fetch(e)).arrayBuffer()}var gRe=new pRe;async function NG(e){let t,i,r=!1;if(e.url?(t=await mRe(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(OZ){let n=await gRe.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function vRe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var yRe=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=NG(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=NG(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if(vRe(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,f="",m=[h.state.glyphIndex],v=[],g=!1;for(;!g;)a++,f=t.charAt(a),d+=f,m.push(e.charToGlyphIndex(f)),v=e.stringToGlyphs(d),v.length===1&&v[0].index===c&&(g=!0),a>t.length&&(g=!0);s.push({char:u,index:c,replacements:m,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(x=>this.getTextWidth(x,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),d=[],f=e.map(x=>[]),m=e.map(x=>[]),v;for(let x=0;x<e.length;x++){let S=e[x],_={features:{liga:!0}},A=[];try{A=i.stringToGlyphs(S,_)}catch(E){console.warn(E)}u=this.getLineInitialOffsetX(s[x],a,t.horizontalAlign,S,o);let T=[];try{T=this.reverseLigaturesTable(i,S,A)}catch(E){console.warn(E)}c=this.computeSpaceWidthForLine(e,x,t);for(let E=0;E<A.length;E++){let I=A[E],P=I.index===0?`
`:I.unicode?String.fromCharCode(I.unicode):void 0,C=T[E],L=0,z=0;E===0&&t.horizontalAlign===2&&I.leftSideBearing!==void 0&&(z=-I.leftSideBearing*r),v&&(L=i.getKerningValue(I,v)*r),u+=z+L;let F=0;if(P===`
`)F=l;else if(P===" ")F=c;else{let G=this.createPath(I,r,u,h,t);G&&(F=G.offsetX-(L+z),d.push(G.path))}if(C.replacements.length===1)m[x].push([u,h]),f[x].push(F);else{let G=C.replacements.map(Q=>(i.glyphs.get(Q).advanceWidth??0)*r),N=G.reduce((Q,W)=>Q+=W,0),q=G.map(Q=>Q/N),ie=u;for(let Q=0;Q<q.length;Q++){let W=F*q[Q];m[x].push([ie,h]),f[x].push(W),ie+=W}}u+=F,v=I}h-=n}let g=[];for(let x=0,S=d.length;x<S;x++)g.push(...d[x].toShapes());return{shapes:g,charWidths:f,lineWidths:s,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new dRe,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=xRe(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function xRe(e){if(e.length){let t=e[0];if(t instanceof Xc)return t.v1;if(t instanceof Fc||t instanceof Mp)return t.v0}}var wRe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},UG=class extends wRe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=f_(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},bRe={markNeedsUpdateRendererDirty:()=>{}},LE=1e3,FG=512*LE;function _Re(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var SRe="https://hooks.spline.design",MRe=`${SRe}/events?hashFile=`,ARe=class{constructor(e,t){this.id=e,this.userWebhook=t,this.result=void 0,this._connected=!1,this.emitter=vC(),this.reconnectWaitFor=LE,this._onError=i=>{var r,n,s;(r=this.eventSource)==null||r.removeEventListener("message",this._onMessage),(n=this.eventSource)==null||n.removeEventListener("error",this._onError),(s=this.eventSource)==null||s.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=LE,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=LE,this._connected=!1},this._onMessage=i=>{let r=i.data,n;try{n=JSON.parse(r)}catch(s){console.error("Error parsing webhook message",s)}if(n){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{n[a.name]!==void 0&&_Re(n[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=n[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(MRe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var e,t,i,r;(e=this.eventSource)==null||e.removeEventListener("message",this._onMessage),(t=this.eventSource)==null||t.removeEventListener("error",this._onError),(i=this.eventSource)==null||i.removeEventListener("open",this._onConnected),(r=this.eventSource)==null||r.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>FG&&(this.reconnectWaitFor=FG),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(e){this.userWebhook=e}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(e=>e.data.name)}getParameterValue(e){var t;if(this.getParametersKeys().includes(e)){if(this.result)return(t=this.result)==null?void 0:t[e];for(let i of this.userWebhook.parametersSchemas)if(i.data.name===e)return JL.defaultParameterValueByType(i.data.type)}}},kG=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],ERe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],yp=[],LN=[];for(let e=1;e<=8;e++)for(let t=0;t<kG.length;t++){let i=kG[t];yp.push(i/Math.pow(2,8-e)),LN.push(ERe[t]+e)}var $T=[32,2e3],VG=yp.filter((e,t)=>yp[t]>$T[0]&&yp[t]<$T[1]),TRe=LN.filter((e,t)=>yp[t]>$T[0]&&yp[t]<$T[1]),CRe=class{static getFrequencies(e,t,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,c,u;if(r==="music"||r==="voice"){let d=r==="voice"?VG:yp,f=Array(d.length).fill(n);for(let m=0;m<i.length;m++){let v=m*o,g=i[m];for(let x=d.length-1;x>=0;x--)if(v>d[x]){f[x]=Math.max(f[x],g);break}}l=f,c=r==="voice"?VG:yp,u=r==="voice"?TRe:LN}else l=Array.from(i),c=l.map((d,f)=>o*f),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}},PRe="gpt-4o-realtime-preview-2024-12-17",DRe=()=>"https://relayserver.spline.design/";async function RRe(e){try{return(await(await fetch(DRe()+"session?uuidfile="+e)).json()).token}catch(t){console.error("Token generation error:",t)}}var IRe=class{constructor(e){this.value=0,this.frequencies=new Float32Array(0);let t=new AudioContext;this.source=t.createMediaStreamSource(e),this.analyser=t.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(e=-100,t=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return CRe.getFrequencies(this.analyser,44100,void 0,"voice",e,t)}update(){let e=this.getFrequencies(),t=e.values.reduce((i,r)=>i+r,0)/e.values.length;this.value=t,this.frequencies=e.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},HG=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.emitter=vC(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{var s;let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&((s=n.response)==null?void 0:s.output)){for(let a of n.response.output)if(a.type==="function_call")for(let[o,l]of this.tools)a.name===o.name&&(l(JSON.parse(a.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(e){this.data=e}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:r}=i,{r:n,g:s,b:a}=rDe.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let e=await RRe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new IRe(s)};let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(t.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${PRe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(e){this.events=[e,...this.events]}sendClientEvent(e){this.dc?(e.event_id=e.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(e)),this.appendEvent(e)):console.error("Failed to send message - no data channel available",e)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let e=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(e,t){this.tools.push([e,t])}disconnect(){var e,t,i,r,n,s;cancelAnimationFrame(this.rafId),(e=this.analyser)==null||e.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,(t=this.dc)==null||t.removeEventListener("message",this.onMessage),(i=this.dc)==null||i.removeEventListener("open",this.onOpen),(r=this.dc)==null||r.close(),(n=this.pc)==null||n.getSenders().forEach(a=>{a.track&&a.track.stop()}),(s=this.pc)==null||s.close(),this.pc=void 0}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,r)=>i+r,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function AO(e){return"variable_"+e}var LRe=class extends y3e{constructor(e){super(),this.shared=e}create(e){return new AZ(e,this.shared)}},ON=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new UG(!0),this.geometryCache2=new UG(!1),this.imageHolderCache=new LRe(this),this.thisContext={scene:bRe,shared:this},this.deletedMaterial=new MO(js.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new ep(eO.emptyImage,this),this.deletedVideo=new ep(OT.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new MO(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new IN(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new ep(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new ep(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new ep(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new JT(t.r,t.g,t.b,t.a):this.colors[e]=new JT(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new ma(0,0,0,0))}else return"a"in e?new ma(e.r,e.g,e.b,e.a):new ma(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof Ww)return t;{let i=new Ww({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof Ww&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new yRe(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof Ww&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(AO(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(AO(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Gt.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),tr.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,n;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=Gt.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>Ms.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var r;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(Gs.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let n=t.userAPIs[e.path[1]];if(n){let s=e.type===0&&e.props.debounce===void 0,a=this.getUserAPI(e.path[1]);a instanceof HG?a.update(n):a==null||a.update(n,this,s)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let n=t.userWebhooks[e.path[1]];n&&((r=this.getUserWebhook(e.path[1]))==null||r.update(n))}}else e.path[0]==="lib"&&this.updateLibByOp(Gs.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){var i,r;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===e?(this.openAIRealtime.update(t),!0):((r=t.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new HG(t,e,this),!1):(this.userAPIs[e]=new HQ(e,t,this),!1)}getUserAPI(e){var t;return((t=this.openAIRealtime)==null?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new ARe(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new ON(Ul.emptyData());var Ux=class extends mo{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),WTe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(kr(e.path,["material"])&&this.material instanceof Ep)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(Gs.drop(e,1),t.material,i);else if(kr(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(Gs.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var n,s;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=e.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),(((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&RY(this.material).forEach(e=>{e instanceof Ep&&(e instanceof MO||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},GG=new k,jG=new Ti,WG=new Ti,ORe=new k,XG=new St,ss=class extends Ux{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new St().fromArray(t.bindMatrix),this.bindMatrixInverse=new St)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof $t&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof ON){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return NT.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return NT.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),kr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Gs.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=f_(c,t,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&yO(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=f_(n,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof no&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,t.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[e];i!==void 0&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new Ti,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;jG.fromBufferAttribute(r.attributes.skinIndex,e),WG.fromBufferAttribute(r.attributes.skinWeight,e),GG.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=WG.getComponent(n);if(s!==0){let a=jG.getComponent(n);XG.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(ORe.copy(GG).applyMatrix4(XG),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function zRe(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new k(n[l],n[l+1],n[l+2]);t.has(c)?(a=t.get(c))==null||a.normals.push(u):t.set(c,{normals:[u],result:new k})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new kt(s,3))}function BRe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new k;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new kt(i,3))}function zN(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof Ep)||e.material.getLayersOfType("outline").length===0)return;e instanceof ss&&e.is2DAndNoDepth?BRe(e):zRe(e)}function BN(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[Gt.seededRandom(r),Gt.seededRandom(r+1e4),Gt.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new pi(i,3))}var bu=new Gn,yw=new k;function NRe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var p_=class extends ss{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new St,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=no.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,zN(this),BN(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){no.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&no.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=no.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=no.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,mo.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new jo,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;bu.setFromBufferAttribute(t),bu.getCenter(i),e.boundingSphere.radius=i.distanceTo(bu.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),bu.getSize(yw),this.hasNonUniformScale&&yw.divide(this.scale);let r={width:yw.x,height:yw.y,depth:yw.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;bu.min.set(e[0],e[2],e[4]),bu.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(bu.min.applyMatrix4(this.shearScaleInv),bu.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new jo);let i=t.boundingSphere.center;bu.getCenter(i),t.boundingSphere.radius=i.distanceTo(bu.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(no.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},qG=-1,URe=1,FRe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},kRe={polygon_center:0,edge:1,vertex:2},QA=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,zi=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-qG)*(i-r)/(URe-qG)+r},VRe=new k,ZA=new k,HRe=new k,GRe=new k;function jy(e,t){let i=HRe.fromArray(e),r=GRe.fromArray(t);ZA.copy(r).sub(i);let n=ZA.length();return ZA.normalize().multiplyScalar(n*.5),VRe.copy(i).add(ZA).toArray()}var Fl=new ha,KA=new k,e2=new k,ag=new k;function jRe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(KA.fromArray(e.index.array,i*3),Fl.setFromAttributeAndIndices(e.attributes.position,KA.x,KA.y,KA.z),Fl.getNormal(e2),Fl.getMidpoint(ag),!(isNaN(ag.x)||isNaN(ag.y)||isNaN(ag.z))){let{a:r,b:n,c:s}=Fl,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=jy(a,o),f=jy(o,l),m=jy(l,a),v=[c,u,h],g=Math.max(...v),x=v.filter(A=>Math.round(A)===Math.round(g)).length>1,S=[],_=Fl.getMidpoint(ag).toArray();g===c&&!x&&(S=[f,m,m],_=d),g===u&&!x&&(S=[d,m,m],_=f),g===h&&!x&&(S=[d,f,f],_=m),x&&(S=[d,f,m]),t.push({vertices:[a,o,l],faceCenters:S,midpoint:_,norm:Fl.getNormal(e2).toArray()})}return t}function WRe(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Fl.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Fl.getNormal(e2),Fl.getMidpoint(ag);let n=Fl.a.toArray(),s=Fl.b.toArray(),a=Fl.c.toArray();t.push({vertices:[n,s,a],faceCenters:[jy(n,s),jy(s,a),jy(a,n)],midpoint:ag.toArray(),norm:e2.toArray()})}return t}var XRe=4,qRe=.5,H3=e=>.5*(1-Math.cos(e*Math.PI)),YRe=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,c,u,h=0,d=.5,f,m,v;for(let g=0;g<XRe;g++){let x=r+(n<<4)+(s<<8);c=H3(a),u=H3(o),f=this.perlin[x&4095],f+=c*(this.perlin[x+1&4095]-f),m=this.perlin[x+16&4095],m+=c*(this.perlin[x+16+1&4095]-m),f+=u*(m-f),x+=256,m=this.perlin[x&4095],m+=c*(this.perlin[x+1&4095]-m),v=this.perlin[x+16&4095],v+=c*(this.perlin[x+16+1&4095]-v),m+=u*(v-m),f+=H3(l)*(m-f),h+=f*d,d*=qRe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},QRe=YRe,YG=new k,QG=new St,ZG=new Mx;function KG(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(t=!0)}),t}var NN=class extends ss{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(QG.copy(i).invert(),ZG.copy(e.ray).applyMatrix4(QG),ZG.intersectBox(this.singleBBox,YG))){let r=YG.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},$a=1e-4,_u,BZ,NZ,UZ,JG=new k,$G=new k;qQ.then(e=>{_u=e,BZ=[_u.get_face_center,_u.get_edge_midpoint,_u.get_vertex_position],NZ=[_u.get_face_normal,_u.get_edge_normal,_u.get_vertex_normal],UZ=[_u.face_count,_u.edge_count,_u.vertex_count]});var ZRe=new St,KRe=new St,Bf=new k,JA=new k,xw=new k,G3=new k,JRe=new k,$Re=new k,eIe=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new QRe,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):t?this.noise=CCe((0,uO.default)(e.seed)):this.noise=TCe((0,uO.default)(e.seed))}},Vl=class extends yN(Mr){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof pa&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof pa&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)t=0;else if(e===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,n=t-i.length;r<n;++r){let s=new pa(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-t;r<n;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let n=new pa(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[i])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new eIe(e,t)),this.random}_updateRadial(e){let t=e.radial,i=t.start*Gt.DEG2RAD,r=t.end*Gt.DEG2RAD,n=i-r,s=new Ss(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new k(0,0,1);break;case"y":a=new k(0,1,0);break;default:case"x":a=new k(1,0,0);break}let o=e.randomnessObject??rp.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=QA(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,f=l.noise(d,d,d),m=u+1;h.scale.x=t.scale[0]+c(m,zi(f,o.scale[0]))||$a,h.scale.y=t.scale[1]+c(m,zi(f,o.scale[1]))||$a,h.scale.z=t.scale[2]+c(m,zi(f,o.scale[2]))||$a,h.position.setScalar(0);let v=n/e.count*u-i;switch(t.axis){case"x":h.rotation.set(0,v,0);break;case"y":h.rotation.set(0,0,v);break;case"z":h.rotation.set(v,0,0);break}h.translateOnAxis(a,t.radius),h.position.x+=t.position[0]+c(m,zi(f,o.position[0])),h.position.y+=t.position[1]+c(m,zi(f,o.position[1])),h.position.z+=t.position[2]+c(m,zi(f,o.position[2]));let g=c(m,zi(f,o.rotation[0])),x=c(m,zi(f,o.rotation[1])),S=c(m,zi(f,o.rotation[2]));t.alignment===!0?(h.rotation.x+=s.x+g,h.rotation.y+=s.y+x,h.rotation.z+=s.z+S):h.rotation.set(s.x+g,s.y+x,s.z+S)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new Ss(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??rp.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=QA(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),u=a+1,h=s(u,zi(c,r.rotation[0])),d=s(u,zi(c,r.rotation[1])),f=s(u,zi(c,r.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(u,zi(c,r.scale[0]))||$a,o.scale.y=1+(t.scale[1]-1)*a+s(u,zi(c,r.scale[1]))||$a,o.scale.z=1+(t.scale[2]-1)*a+s(u,zi(c,r.scale[2]))||$a,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+f,o.position.x=t.position[0]*a+s(u,zi(c,r.position[0])),o.position.y=t.position[1]*a+s(u,zi(c,r.position[1])),o.position.z=t.position[2]*a+s(u,zi(c,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??rp.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=QA(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new k(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement),d=this.children[t++];d.scale.x=1+s(t,zi(h,r.scale[0]))||$a,d.scale.y=1+s(t,zi(h,r.scale[1]))||$a,d.scale.z=1+s(t,zi(h,r.scale[2]))||$a;let f=s(t,zi(h,r.rotation[0])),m=s(t,zi(h,r.rotation[1])),v=s(t,zi(h,r.rotation[2]));d.rotation.set(f,m,v),d.position.x=i.size[0]*l-o.x+s(t,zi(h,r.position[0])),d.position.y=i.size[1]*c-o.y+s(t,zi(h,r.position[1])),d.position.z=i.size[2]*u-o.z+s(t,zi(h,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),u=this.children[t++];u.scale.x=1+s(t,zi(c,r.scale[0]))||$a,u.scale.y=1+s(t,zi(c,r.scale[1]))||$a,u.scale.z=1+s(t,zi(c,r.scale[2]))||$a;let h=s(t,zi(c,r.rotation[0])),d=s(t,zi(c,r.rotation[1])),f=s(t,zi(c,r.rotation[2]));u.rotation.set(h,d,f),u.position.x=i.size[0]*a+s(t,zi(c,r.position[0])),u.position.y=-i.size[1]*o+s(t,zi(c,r.position[1])),u.position.z=-i.size[2]*l+s(t,zi(c,r.position[2]))}}_updateToObject(e){var u;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new Ss(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??rp.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=QA(r.strength,this.parameters.randomness);if(!t.object){for(let[,h]of this.children.entries())h.position.set(0,0,0),h.scale.setScalar(1),h.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof NN)if(!((u=this.objectForSample.font)!=null&&u.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let h=Math.round(a.length*t.count/100);this._updateCount(h)}else{let h=this.objectForSample.geometry.getAttribute("position");if(!h||isNaN(h.count)||h.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new PCe(this.objectForSample).build(),l=FRe[t.axis],c=this.children;o.setRandomGenerator((0,uO.default)(this.object.uuid+t.seed));for(let[h,d]of c.entries()){let f=h*(r.freqScale/10)+r.movement,m=n.noise(f,f,f),v=h+1,g=s(v,zi(m,r.rotation[0])),x=s(v,zi(m,r.rotation[1])),S=s(v,zi(m,r.rotation[2]));t.spreadType==="random"?o.sample(xw,G3):(a.length&&(xw.fromArray(a[h].pos),G3.fromArray(a[h].norm)),this.objectForSample instanceof p_&&xw.applyMatrix4(ZRe.copy(this.objectForSample.matrixWorld).invert())),xw.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(xw),Bf.fromArray(l);let _=t.align==="normal"?G3:this.object.getWorldDirection($Re),A=JA.fromArray(t.position);JA.x+=s(v,zi(m,r.position[0])),JA.y+=s(v,zi(m,r.position[1])),JA.z+=s(v,zi(m,r.position[2]));let T=Math.acos(_.dot(Bf)),E=JRe.crossVectors(Bf,_).normalize(),I=KRe.makeRotationAxis(E,T),P=_.clone().cross(this.object.up).normalize(),C=P.clone().cross(_).normalize(),L=new St().makeBasis(P,_,C),z=new k(Bf.y,Bf.z,Bf.x).normalize(),F=z.clone().cross(Bf).normalize(),G=new St().makeBasis(z,Bf,F).invert(),N=new St().multiplyMatrices(L,G);d.rotation.setFromRotationMatrix(N),A.applyMatrix4(I),d.position.add(A),d.rotation.x=d.rotation.x+i.x+g,d.rotation.y=d.rotation.y+i.y+x,d.rotation.z=d.rotation.z+i.z+S,d.scale.setScalar(1),d.scale.x=d.scale.x+t.scale[0]+s(v,zi(m,r.scale[0]))||$a,d.scale.y=d.scale.y+t.scale[1]+s(v,zi(m,r.scale[1]))||$a,d.scale.z=d.scale.z+t.scale[2]+s(v,zi(m,r.scale[2]))||$a,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=t.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...n],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof p_){let n=this.objectForSample,s=kRe[e],a=UZ[s],o=BZ[s],l=NZ[s],c=a(n.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(n.subdivPointerNew,u),d=l(n.subdivPointerNew,u);JG.fromArray(h).applyMatrix4(n.matrixWorld),$G.fromArray(d),i(JG.toArray(),$G.toArray())}}else(this.objectForSample.geometry.index?jRe(this.objectForSample.geometry):WRe(this.objectForSample.geometry)).forEach((n,s)=>{e==="polygon_center"&&i(n.midpoint,n.norm),e==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),e==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(t.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(e,t){var i;if(this.parameters=cC(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof mo?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new St,this.hiddenMatrix=new St,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},q_=e=>{var t;return t=class extends e{},t.geometryHelper=new Zc(30,30,30),t},$A=new Mx,j3=new jo,ej=new St,Y_=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),j3.copy(a.boundingSphere),j3.applyMatrix4(o),i.ray.intersectsSphere(j3)===!1||(ej.copy(o).invert(),$A.copy(i.ray).applyMatrix4(ej),a.boundingBox!==null&&$A.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,f=a.attributes.position,m=a.drawRange,v,g;if(n===!1){let S=Math.max(0,m.start),_=Math.min(d.count,m.start+m.count);for(v=S,g=_;v<g;v+=3)if(c=d.getX(v),u=d.getX(v+1),h=d.getX(v+2),l=x(e,i,$A,f,c,u,h),l){l.faceIndex=Math.floor(v/3),r.push(l);return}}else{let S=a.attributes.position,_=new k,A=new k,T=new k,E=new k,I=2,P=1/((s.scale.x+s.scale.y+s.scale.z)/3),C=P*P,L=Math.max(0,m.start),z=Math.min(S.count,m.start+m.count);for(let F=L,G=z-1;F<G;F+=I){if(_.fromBufferAttribute(S,F),A.fromBufferAttribute(S,F+1),$A.distanceSqToSegment(_,A,E,T)>C)continue;E.applyMatrix4(s.matrixWorld);let N=i.ray.origin.distanceTo(E);N<i.near||N>i.far||r.push({distance:N,point:T.clone().applyMatrix4(s.matrixWorld),object:e})}}function x(S,_,A,T,E,I,P){let C=new k,L=new k,z=new k,F=new k,G=new k;if(C.fromBufferAttribute(T,E),L.fromBufferAttribute(T,I),z.fromBufferAttribute(T,P),A.intersectTriangle(C,L,z,!1,F)===null)return null;G.copy(F),G.applyMatrix4(S.matrixWorld);let N=_.ray.origin.distanceTo(G);return N<_.near||N>_.far?null:{faceIndex:1,distance:N,point:G.clone(),object:S}}},eE=new k,Il=new Bp,tIe=class extends U_{constructor(e){let t=new $t,i=new Np({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new fi(15711266),o=new fi(15711266),l=new fi(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,f){u(h,f),u(d,f)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new kt(r,3)),t.setAttribute("color",new kt(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Il.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;Ac("n1",t,e,Il,-1,-1,n),Ac("n2",t,e,Il,i,-1,n),Ac("n3",t,e,Il,-1,r,n),Ac("n4",t,e,Il,i,r,n);let s=n;Ac("f1",t,e,Il,-1,-1,s),Ac("f2",t,e,Il,i,-1,s),Ac("f3",t,e,Il,-1,r,s),Ac("f4",t,e,Il,i,r,s);let a=s,o=.5;Ac("u1",t,e,Il,i*.7*o,r*1.1,a),Ac("u2",t,e,Il,-1*.7*o,r*1.1,a),Ac("u3",t,e,Il,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Ac(e,t,i,r,n,s,a){eE.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],eE.x,eE.y,eE.z)}}var iIe=class extends q_(tIe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Y_(this.object,this.geometry,e,t,!0)}},EO;(e=>e.is=t=>"objectHelper"in t)(EO||(EO={}));var Fx=(e,t)=>class extends xN(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof yT&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Zc?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof yT&&(r.visible=!1)}}},tj=790,$0=new k,W3=new k,X3=new Ai,q3=new k,ww=new k,Y3=new k,Na=class extends Fx(Bp,iIe){constructor(e="",t={...a_.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=ux.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new St,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new $2(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Ra(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new k(e,t,i)),super.lookAt(e),this.getWorldPosition($0),this.targetOffset=$0.distanceTo(e)}getTarget(e=new k){return this.getWorldDirection(W3),this.getWorldPosition($0),W3.multiplyScalar(this.targetOffset),e.copy($0).add(W3),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition($0),$0.distanceTo(e)}updateUp(){this.getWorldQuaternion(X3),q3.set(0,0,1).applyQuaternion(X3),ww.copy(Mr.DEFAULT_UP),this.isUpVectorFlipped&&ww.negate(),ww.applyQuaternion(X3),Y3.copy(Mr.DEFAULT_UP).projectOnPlane(q3),this.angleOffsetFromUp=Y3.angleTo(ww),this.angleOffsetFromUp*=Y3.cross(ww).dot(q3)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new k),i=e.getWorldDirection(new k).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new k).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new k;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-790*.5*r,this.right=tj*.5*r,this.top=tj*.5*(1/n),this.bottom=-790*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return xL(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},ey=new St,rIe=new St;function ij(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var Qg=class extends Ux{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new $t,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof Qg&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof mo&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){ey.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=sd.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;sd.transformMeshSet(s.booleanMeshSetAddress,ey),s.booleanMatrixInvOld.copy(ey).invert(),s.booleanWasTransformed=!1}else s instanceof Qg&&s.needsTransformForDownstream===!0?(sd.transformMeshSet(s.booleanMeshSetAddress,ey),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(sd.transformMeshSet(s.booleanMeshSetAddress,rIe.multiplyMatrices(ey,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(ey).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}sd.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new kt([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return sd.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new $t,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=sd.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,zN(this),BN(this)}dispose(){super.dispose(),this.geometry.dispose()}},TO;(e=>{function t(i){return tr.is(i)&&i instanceof V_}e.is=t})(TO||(TO={}));var UN=(e,t)=>class extends Fx(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},zc=e=>e instanceof mo,Sd=e=>e!==null&&e instanceof Qg,nIe=e=>e instanceof Na,sIe=e=>TO.is(e),CO=e=>EO.is(e),aIe=new k(1,1,1),rj=new k,oIe=new k,nj=new Ai,Q_=class extends q_(Qxe){constructor(e,t=15){super(t),this.object=e,this.dummy=new bd,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Y_(this.object,Q_.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(rj,nj,oIe),this.matrix.compose(rj,nj,aIe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},Wy=class extends Fx(bd,Q_){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},fb=class extends Fx(bd,Q_){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},FZ={RED:0,GREEN:1},Z_="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",lIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,tE=class extends nr{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new vt(null),kernel16:new vt(null),inputBuffer:new vt(null),cocBuffer:new vt(null),texelSize:new vt(new Ee),scale:new vt(1)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:lIe,vertexShader:Z_}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(t[r++]=u,t[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new Ti(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new Ti(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function sj(e,t,i){return e*(t-i)-t}function PO(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var cIe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,uIe=class extends nr{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new vt(null),focusDistance:new vt(0),focusRange:new vt(0),cameraNear:new vt(.3),cameraFar:new vt(1e3)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:cIe,vertexShader:Z_}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Fd){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-sj(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=PO(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-sj(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=PO(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ra?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},hIe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,dIe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",aj=class extends nr{constructor(e=new Ee){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new vt(null),texelSize:new vt(new Ee),halfTexelSize:new vt(new Ee),kernel:new vt(0),scale:new vt(1)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:hIe,vertexShader:dIe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},fIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,pIe=class extends nr{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new vt(null),opacity:new vt(1)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:fIe,vertexShader:Z_}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},mIe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,gIe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,xC={COLOR:2},vIe={DISABLED:0},yIe=class extends nr{constructor(e=new Ee,t=xC.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Sx.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new vt(null),depthBuffer:new vt(null),predicationBuffer:new vt(null),texelSize:new vt(e)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:mIe,vertexShader:gIe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Fd){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},xIe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,wIe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Ec={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},DO=class extends nr{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Sx.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new vt(null),depthBuffer:new vt(null),resolution:new vt(new Ee),texelSize:new vt(new Ee),cameraNear:new vt(.3),cameraFar:new vt(1e3),aspect:new vt(1),time:new vt(0)},blending:as,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Fd){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=xIe.replace(Ec.FRAGMENT_HEAD,e.get(Ec.FRAGMENT_HEAD)).replace(Ec.FRAGMENT_MAIN_UV,e.get(Ec.FRAGMENT_MAIN_UV)).replace(Ec.FRAGMENT_MAIN_IMAGE,e.get(Ec.FRAGMENT_MAIN_IMAGE)),this.vertexShader=wIe.replace(Ec.VERTEX_HEAD,e.get(Ec.VERTEX_HEAD)).replace(Ec.VERTEX_MAIN_SUPPORT,e.get(Ec.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ra?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Ec}},bIe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,_Ie=class extends nr{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Sx.replace(/\D+/g,"")},uniforms:{inputBuffer:new vt(null),threshold:new vt(0),smoothing:new vt(1),range:new vt(null)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:bIe,vertexShader:Z_}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},SIe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,kZ={DISCARD:0,MULTIPLY:1},MIe=class extends nr{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new vt(e),inputBuffer:new vt(null),strength:new vt(1)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:SIe,vertexShader:Z_}),this.toneMapped=!1,this.setColorChannel(FZ.RED),this.setMaskFunction(kZ.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Ua&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},AIe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,EIe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",TIe=class extends nr{constructor(e=new Ee,t=new Ee){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new vt(null),searchTexture:new vt(null),areaTexture:new vt(null),resolution:new vt(t),texelSize:new vt(e)},blending:as,depthWrite:!1,depthTest:!1,fragmentShader:AIe,vertexShader:EIe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},CIe=new Bp,Nf=null;function PIe(){if(Nf===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);Nf=new $t,Nf.setAttribute!==void 0?(Nf.setAttribute("position",new pi(e,3)),Nf.setAttribute("uv",new pi(t,2))):(Nf.addAttribute("position",new pi(e,3)),Nf.addAttribute("uv",new pi(t,2)))}return Nf}var vo=class{constructor(e="Pass",t=new Ho,i=CIe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new qr(PIe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ho),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Fd){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Ho||t===this.renderer)continue;this[e].dispose()}}}},RO=class extends vo{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new pIe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new rr(1,1,{minFilter:Fi,magFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Ua?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===Bi&&(this.renderTarget.texture.encoding=Bi))}},DIe=class extends vo{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},Q3=new fi,FN=class extends vo{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=a>=0;l?(Q3.copy(e.getClearColor(Q3)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Q3,o):c&&e.setClearAlpha(o)}},Uf=-1,Vo=class extends va{constructor(e,t=Uf,i=Uf,r=1){super(),this.resizable=e,this.base=new Ee(1,1),this.preferred=new Ee(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Uf?r=t.width:t.height!==Uf?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Uf?r=t.height:t.width!==Uf?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Uf),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Uf}},Z3=!1,oj=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Oa:i=this.materialsFlatShadedDoubleSide;break;case Ws:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Oa:i=this.materialsDoubleSide;break;case Ws:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Yc;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Ws,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Oa,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Ws,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Oa,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Z3){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Z3}static set workaroundEnabled(e){Z3=e}},RIe=class extends vo{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new FN,this.overrideMaterialManager=i===null?null:new oj(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new oj(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},lj=class extends vo{constructor(e,t,{resolutionScale:i=1,width:r=Vo.AUTO_SIZE,height:n=Vo.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new RIe(e,t,new Mq({depthPacking:cq}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new fi(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new rr(1,1,{minFilter:qi,magFilter:qi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Vo(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},or={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},IIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",LIe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",OIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",zIe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",BIe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",NIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",UIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",FIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",kIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",VIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",HIe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",GIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",jIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",WIe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",XIe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",qIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",YIe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",QIe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",ZIe=new Map([[or.SKIP,null],[or.ADD,IIe],[or.ALPHA,LIe],[or.AVERAGE,OIe],[or.COLOR_BURN,zIe],[or.COLOR_DODGE,BIe],[or.DARKEN,NIe],[or.DIFFERENCE,UIe],[or.EXCLUSION,FIe],[or.LIGHTEN,kIe],[or.MULTIPLY,VIe],[or.DIVIDE,HIe],[or.NEGATION,GIe],[or.NORMAL,jIe],[or.OVERLAY,WIe],[or.REFLECT,XIe],[or.SCREEN,qIe],[or.SOFT_LIGHT,YIe],[or.SUBTRACT,QIe]]),KIe=class extends va{constructor(e,t=1){super(),this.f=e,this.opacity=new vt(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return ZIe.get(this.blendFunction)}},qu={NONE:0,DEPTH:1,CONVOLUTION:2},sh=class extends va{constructor(e,t,{attributes:i=qu.NONE,blendFunction:r=or.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new KIe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Fd){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Ho||t===this.renderer)continue;this[e].dispose()}}}};function cj(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function JIe(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,f=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&(a&qu.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let m=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,v=DO.Section;if(c){let x=`	${e}MainUv(UV);
`;i.set(v.FRAGMENT_MAIN_UV,i.get(v.FRAGMENT_MAIN_UV)+x),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let x=`	${e}MainSupport(`;x+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(v.VERTEX_MAIN_SUPPORT,i.get(v.VERTEX_MAIN_SUPPORT)+x),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(S=>S[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(m)].map(S=>S[1]))}h=h.concat([...o.get("fragment").matchAll(m)].map(x=>x[1])),h=h.concat([...t.defines.keys()].map(x=>x.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((x,S)=>s.set(e+S.charAt(0).toUpperCase()+S.slice(1),x)),t.defines.forEach((x,S)=>n.set(e+S.charAt(0).toUpperCase()+S.slice(1),x)),cj(e,h,n),cj(e,h,o);let g=t.blendMode;if(r.set(g.blendFunction,g),l){let x=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,S=`${e}MainImage(color0, UV, `;(a&qu.DEPTH)!==0&&x.test(o.get("fragment"))&&(S+="depth, ",f=!0),S+=`color1);
	`;let _=e+"BlendOpacity";s.set(_,g.opacity),S+=`color0 = blend${g.blendFunction}(color0, color1, ${_});

	`,i.set(v.FRAGMENT_MAIN_IMAGE,i.get(v.FRAGMENT_MAIN_IMAGE)+S),S=`uniform float ${_};

`,i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+S)}i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(v.VERTEX_HEAD,i.get(v.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:f}}var t2=class extends vo{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new DO(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=DO.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===or.SKIP)l|=d.getAttributes()&qu.DEPTH;else if((l&d.getAttributes()&qu.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f="e"+a++,m=JIe(f,d,t,i,r,n,l);if(o+=m.varyings.length,c=c||m.transformedUv,u=u||m.readDepth,d.extensions!==null)for(let v of d.extensions)s.add(v)}let h=/\bblend\b/g;for(let d of i.values()){let f=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+f+`
`)}(l&qu.DEPTH)!==0?(u&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((d,f,m)=>m.set(f,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Fd){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Ua&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},$Ie=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],kN=class extends vo{constructor({resolutionScale:e=.5,width:t=Vo.AUTO_SIZE,height:i=Vo.AUTO_SIZE,kernelSize:r=wC.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new rr(1,1,{minFilter:Fi,magFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Vo(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new aj,this.ditheredBlurMaterial=new aj,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=$Ie[this.kernelSize],u=this.blurMaterial,h=t,d,f;for(this.fullscreenMaterial=u,d=0,f=c.length-1;d<f;++d){let m=(d&1)===0?o:l;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(m),e.render(s,a),h=m}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Ua?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===Bi&&(this.renderTargetA.texture.encoding=Bi,this.renderTargetB.texture.encoding=Bi))}static get AUTO_SIZE(){return Vo.AUTO_SIZE}},eLe=class extends vo{constructor({width:e=Vo.AUTO_SIZE,height:t=Vo.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new _Ie(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new rr(1,1,{minFilter:Fi,magFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Vo(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==Ua&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},tLe=class extends vo{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new FN(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},kl=class extends vo{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Ua&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},K3=1/1e3,iLe=1e3,rLe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*K3}getFixedDelta(){return this.fixedDelta*K3}setFixedDelta(e){return this.fixedDelta=e*iLe,this}getElapsed(){return this.elapsed*K3}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},wC={MEDIUM:2,LARGE:3,HUGE:5},nLe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,sLe=class extends sh{constructor({blendFunction:e=or.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=Vo.AUTO_SIZE,height:a=Vo.AUTO_SIZE,kernelSize:o=wC.LARGE}={}){super("BloomEffect",nLe,{blendFunction:e,uniforms:new Map([["map",new vt(null)],["intensity",new vt(n)]])}),this.renderTarget=new rr(1,1,{minFilter:Fi,magFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new eLe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new kN({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===Bi&&(this.renderTarget.texture.encoding=Bi))}},aLe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",oLe=class extends sh{constructor({blendFunction:e=or.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",aLe,{blendFunction:e,uniforms:new Map([["brightness",new vt(t)],["contrast",new vt(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},lLe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",cLe=class extends sh{constructor(e=or.NORMAL){super("ColorAverageEffect",lLe,{blendFunction:e})}},uLe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",hLe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",dLe=class extends sh{constructor({blendFunction:e=or.NORMAL,offset:t=new Ee(.001,5e-4)}={}){super("ChromaticAberrationEffect",uLe,{vertexShader:hLe,blendFunction:e,attributes:qu.CONVOLUTION,uniforms:new Map([["offset",new vt(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},fLe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,pLe=class extends sh{constructor(e,{blendFunction:t=or.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Vo.AUTO_SIZE,height:c=Vo.AUTO_SIZE}={}){super("DepthOfFieldEffect",fLe,{blendFunction:t,attributes:qu.DEPTH,uniforms:new Map([["nearColorBuffer",new vt(null)],["farColorBuffer",new vt(null)],["nearCoCBuffer",new vt(null)],["scale",new vt(1)]])}),this.camera=e,this.renderTarget=new rr(1,1,{minFilter:Fi,magFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new kl(new uIe(e));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new kN({kernelSize:wC.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",f=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new kl(new MIe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=kZ.MULTIPLY,d.colorChannel=FZ.GREEN,this.bokehNearBasePass=new kl(new tE(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new kl(new tE(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new kl(new tE(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new kl(new tE(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return PO(-i,t.near,t.far)}setDepthTexture(e,t=Fd){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,Ua),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===Bi&&(this.renderTarget.texture.encoding=Bi,this.renderTargetNear.texture.encoding=Bi,this.renderTargetFar.texture.encoding=Bi,this.renderTargetMasked.texture.encoding=Bi))}};new k;new St;var mLe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",gLe=class extends sh{constructor({blendFunction:e=or.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",mLe,{blendFunction:e,uniforms:new Map([["hue",new vt(new k)],["saturation",new vt(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new fi;var vLe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,yLe=class extends sh{constructor({blendFunction:e=or.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",vLe,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},xLe="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",wLe=class extends sh{constructor(e=30){super("PixelationEffect",xLe,{uniforms:new Map([["active",new vt(!1)],["d",new vt(new Ee)]])}),this.resolution=new Ee,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new k;new k;var uj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",hj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",bLe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",_Le="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",og={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},VZ=class extends sh{constructor({preset:e=og.MEDIUM,edgeDetectionMode:t=xC.COLOR,predicationMode:i=vIe.DISABLED}={}){super("SMAAEffect",bLe,{vertexShader:_Le,blendFunction:or.NORMAL,attributes:qu.CONVOLUTION|qu.DEPTH,uniforms:new Map([["weightMap",new vt(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new rr(1,1,{minFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new FN(!0,!1,!1),this.clearPass.overrideClearColor=new fi(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new kl(new yIe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new kl(new TIe);let s=new Gq;s.onLoad=()=>{let a=new wn(r);a.name="SMAA.Search",a.magFilter=qi,a.minFilter=qi,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new wn(n);o.name="SMAA.Area",o.magFilter=Fi,o.minFilter=Fi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=uj,n.src=hj),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case og.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case og.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case og.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case og.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=Fd){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return uj}static get areaImageDataURL(){return hj}},SLe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,iE={DEFAULT:0,ESKIL:1},MLe=class extends sh{constructor({blendFunction:e=or.NORMAL,technique:t=iE.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",SLe,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new vt(r)],["darkness",new vt(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===iE.ESKIL}set eskil(e){this.technique=e?iE.ESKIL:iE.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},kd=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=or.NORMAL}},ALe=class extends kd{constructor(){super(sLe),this.blendFunction=or.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},ELe=class extends kd{constructor(){super(oLe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},TLe=class extends kd{constructor(){super(dLe),this.effect.offset=new Ee(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},CLe=class extends kd{constructor(){super(cLe)}},PLe=class extends kd{constructor(){super(gLe),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},DLe=class extends kd{constructor(){super(yLe),this.blendFunction=or.OVERLAY}},RLe=class extends kd{constructor(){super(MLe)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},ILe=class extends kd{constructor(e){super(pLe)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},LLe=class extends kd{constructor(){super(wLe)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},OLe=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,zLe=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,BLe=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,NLe=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,IO=class extends nr{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new vt(null)},blending:as,depthWrite:!1,depthTest:!1,vertexShader:BLe,fragmentShader:NLe})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},ULe=class extends vo{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new IO,this.resolutionVector=new Ee,this.resolveMaterial=new nr({name:"TAAResolveMaterial",uniforms:{inputBuffer:new vt(null),historyBuffer:new vt(null),velocityBuffer:new vt(null),depthBuffer:new vt(null),resolution:new vt(new Ee)},blending:as,depthWrite:!1,depthTest:!1,vertexShader:OLe,fragmentShader:zLe}),this.historyRenderTarget=new rr(1024,1024,{minFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new rr(1024,1024,{minFilter:Fi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},FLe=class extends vo{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new lj(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new IO,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new IO,this.depthPass=new lj(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},dj=new Ho,kLe=new nr({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),LO=class extends vo{constructor(e,t,i){super("OpaquePass",t??dj,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??dj}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof mo&&(this.originalMaterials.push([r,r.material]),r.material=kLe)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},VLe=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new RO,this.depthTexture=null,this.timer=new rLe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new Ee),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===Ua&&e.outputEncoding===Bi&&(this.inputBuffer.texture[0].encoding=Bi,this.outputBuffer.texture[0].encoding=Bi,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new sx(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=jg,e.type=Rg):e.type=xd,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new Ee:a.getDrawingBufferSize(new Ee),l={minFilter:Fi,magFilter:Fi,wrapS:sn,wrapT:sn,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new rr(o.width,o.height,l),c.samples=r):(n?(c=new gq(o.width,o.height,2,l),c.texture[1].type=Id):c=new rr(o.width,o.height,l),c.depthTexture=new sx(2048,2048),c.depthTexture.type=Cr),i===Ua&&a!==null&&a.outputEncoding===Bi&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=Bi):c.texture.encoding=Bi),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new Ee),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof tLe?o=!0:d instanceof DIe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new Ee);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new Ee);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},HLe=new nr({name:"CombineMaterial",uniforms:{inputBufferA:new vt(null),inputBufferB:new vt(null)},blending:as,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),GLe=class extends vo{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=HLe,this.helperPass=new LO(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new LO(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new VZ({preset:og.LOW,edgeDetectionMode:xC.COLOR});this.effectPass=new t2(this.camera,t),this.rt=new rr(10,10,{minFilter:Fi,magFilter:Fi,wrapS:sn,wrapT:sn,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},jLe=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,WLe=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,XLe=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,qLe=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,YLe=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,QLe=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,bw=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],ZLe=new nr({vertexShader:jLe,fragmentShader:WLe}),ty=new nr({vertexShader:YLe,fragmentShader:QLe,uniforms:{texture_ao_lrez:new vt(null),texture_depth_lrez:new vt(null),texture_depth_hrez:new vt(null),near:new vt(null),far:new vt(null)}}),KLe=class extends vo{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new rr(i,r,{type:j_?Id:Cr,depthTexture:new sx(i,r),minFilter:Fi,magFilter:Fi}),this.depthBufferHighRes=new rr(i,r,{depthTexture:new sx(i,r)}),this.aoBuffer=new rr(i,r,{minFilter:Fi,magFilter:Fi}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(bw.length*2);for(let a=0;a<bw.length;a++){let o=a*2;n[o+0]=bw[a][0],n[o+1]=bw[a][1]}this.blueNoiseInDiskTexture=new lo(n,bw.length,1,sT,Cr),this.blueNoiseInDiskTexture.wrapS=yd,this.blueNoiseInDiskTexture.wrapT=yd,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new nr({vertexShader:XLe,fragmentShader:qLe,uniforms:{near:new vt(null),far:new vt(null),fov:new vt(null),proj_info:new vt(new Ti),is_ortho:new vt(!1),resolution:new vt(new Ee),radius_of_influence:new vt(8),radius_in_screen_space:new vt(1),exponent:new vt(1),ao_color:new vt(new k),bias:new vt(.5),texture_depth:new vt(null),texture_normals:new vt(null),texture_blue_noise:new vt(null),texture_blue_noise_in_disk:new vt(this.blueNoiseInDiskTexture),frame_index:new vt(0),fog_enabled:new vt(!1),fog_near:new vt(1),fog_far:new vt(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new rr(i,r,{minFilter:Fi,magFilter:Fi,wrapS:sn,wrapT:sn,depthBuffer:!1,type:Cr});let s=new VZ({preset:og.ULTRA,edgeDetectionMode:xC.COLOR});this.effectPass=new t2(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,ty.uniforms.texture_depth_hrez.value=e,ty.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=ZLe;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=ty,ty.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,ty.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,ty.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},JLe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,$Le=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,eOe=class extends kl{constructor(){super(new nr({vertexShader:JLe,fragmentShader:$Le,uniforms:{tInput:new vt(null),tMap:new vt(null),uResolution:new vt(new Ee),uSize:new vt(new Ee),uCoords:new vt(new Ee),uScale:new vt(1),uSceneColor:new vt(new fi(16711680)),uDPR:new vt(1),uCurrent:new vt(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},tOe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,iOe=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,rOe=[],nOe=class extends kl{constructor(){super(new nr({vertexShader:tOe,fragmentShader:iOe,uniforms:{toScene:new vt(null),fromScene:new vt(null),uResolution:new vt(new Ee),uDPR:new vt(1),mixRatio:new vt(0),threshold:new vt(.1),useTexture:new vt(0),tMixTexture:{value:rOe[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},sOe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,aOe=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,oOe=class extends kl{constructor(){super(new nr({vertexShader:sOe,fragmentShader:aOe,uniforms:{inputBuffer:new vt(null),blurredInputBuffer:new vt(null),overlay:new vt(null),uResolution:new vt(new Ee),uDPR:new vt(1),blurIntensity:new vt(0)}})),this._blurEnabled=!1,this.blurTarget=new rr(1,1,{minFilter:Fi,magFilter:Fi,wrapS:sn,wrapT:sn}),this.blurPass=new kN({width:window.innerWidth,height:window.innerHeight,kernelSize:wC.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},lOe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,cOe=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,uOe=class extends kl{constructor(){super(new nr({vertexShader:lOe,fragmentShader:cOe,uniforms:{tInput:new vt(null),tOverlayImage:new vt(null),uResolution:new vt(new Ee),uImageSize:new vt(new Ee),uRightBottom:new vt(new Ee(20,20)),uScale:new vt(.25),uDPR:new vt(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function fj(e,t){return t&&t.enabled&&e.push(t.effect),e}var hOe=e=>Object.values(or).includes(e)?e:or.NORMAL,dOe=class extends va{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=UT.defaultData,this._scene=new Ho,this._camera=new Na,this.effects=new Map,this.blueNoiseTexture=new lo,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new Ixe,this.renderer=e,this.debug=!1,this.effects.set("bloom",new ALe),this.effects.set("chromaticAberration",new TLe),this.effects.set("vignette",new RLe),this.effects.set("noise",new DLe),this.effects.set("colorAverage",new CLe),this.effects.set("hueSaturation",new PLe),this.effects.set("brightnessContrast",new ELe),this.effects.set("depthOfField",new ILe),this.effects.set("pixelation",new LLe),this.effectComposer=new VLe(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new LO(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new FLe(this.scene,this.camera,this.renderer),this.aoPass=new KLe(this.scene,this.camera),this.taaPass=new ULe,this.taaPass.renderToScreen=!1,this.helperPass=new GLe(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new eOe,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new oOe,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new uOe,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new nOe,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new lo(e,128,128),this.blueNoiseTexture.wrapS=yd,this.blueNoiseTexture.wrapT=yd,this.blueNoiseTexture.minFilter=qi,this.blueNoiseTexture.magFilter=qi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(fj,[]);r.length>0&&(this.uvEffectPass=new t2(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(fj,[]);if(n.length>0&&(this.effectPass=new t2(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new Ee;this.renderer.getDrawingBufferSize(e),this._rt=new rr(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:yd,wrapT:yd}),this._rt.samples=0,this._savePass=new RO(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new RO(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=hOe(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof Ti?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof Ti?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},fOe=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,pOe=Ui.lights_fragment_begin,mOe=Ui.shadowmask_pars_fragment,pj=null,gOe=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},vOe=(e="medium")=>{if(pj===e)return!1;pj=e;let t=gOe(e);Ui.shadowmap_pars_fragment=fOe(t);let i=pOe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Ui.lights_fragment_begin=i;let r=mOe.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Ui.shadowmask_pars_fragment=r,!0},yOe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,xOe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,J3=new nr({vertexShader:yOe,fragmentShader:xOe,uniforms:{depthContrast:{value:1}}}),mj=new wn,gj=new Ee,wOe=class extends Aq{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Ee,this.dummyCamera=new Na,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new dOe(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=EB,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new rr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Fi,magFilter:Fi,wrapS:sn,wrapT:sn,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return xi.transmissionLod.value===1}set hdTransmission(e){xi.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new rr(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:rx,magFilter:Fi,wrapS:sn,wrapT:sn,depthBuffer:!1}),this.transmissionDepthTarget=new rr(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:qi,magFilter:qi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new rr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:qi,magFilter:qi,type:Cr,depthTexture:new sx(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Na?J3.uniforms.depthContrast.value=(i.far-i.near)/1e4:J3.uniforms.depthContrast.value=1,t.overrideMaterial=J3,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?kO:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=e instanceof YN?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((f,m)=>{xi.penumbraSize.value[m]=f}),xi.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?xi.resolution.value.set(this.resolution.x,this.resolution.y):xi.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(xi.normalRenderTarget.value=s,xi.normalRenderTargetDepth.value=mj):l.needsNormal()&&(this.createNormalRenderTarget(),xi.normalRenderTarget.value=this.normalRenderTarget.texture,xi.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),xi.aoRenderTarget.value=this.aoRenderTarget.texture),xi.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!j_),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let f=this.getSize(gj),m=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==m)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},m),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(f.x,f.y,m),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let f=this.getSize(gj),m=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(f.x,f.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=m}let h=!1;if(n!==void 0)xi.transmissionRenderTarget.value=n,xi.transmissionRenderTargetDepth.value=mj,this.pipeline.setTransmissionPassEnabled(!1);else{let f=l.needsTransmission();f&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),xi.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,xi.aspectRatio.value=c3e(this.viewportWidth,this.viewportHeight),xi.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(f)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(f=>{f.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?kO:null,this.pipeline.render(),xi.frameIndex.value=(xi.frameIndex.value+1)%16,t instanceof Na&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},HZ=class extends q_(Yxe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Y_(this.object,HZ.geometryHelper,e,t)}},GZ=class extends q_(qxe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Y_(this.object,GZ.geometryHelper,e,t)}},OO=class extends q_(Xxe){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Y_(this.object,OO.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=OO._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},jZ=OO;jZ._vector=new k;var WZ=class extends bd{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new qr(new Ju(1,1),new Ld({transparent:!0,opacity:0,side:Oa})),this.add(this.caretMesh),this.selectionMesh=new qr(new Ju(1,1),new Ld({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:Oa})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=i2(i,e),[s,a]=e>0?i2(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=$3(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:f,depth:m}=this.object.geometry.userData.parameters,v=typeof d=="string"?0:d,g=typeof f=="string"?0:f;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-v*.5,l+h+g*.5,m),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=bOe(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[g,x,S]of s)if(x!==S){let[_,A]=$3(this.object,g,x),[T,E]=$3(this.object,g,S);A+=c,E+=c,E+=a;let I=r.length/3;r.push(_,A,0),r.push(T,A,0),r.push(T,E,0),r.push(_,E,0),n.push(I+0,I+1,I+2),n.push(I+2,I+3,I+0)}let u=new $t;u.setIndex(n),u.setAttribute("position",new kt(r,3));let{width:h,height:d,depth:f}=this.object.geometry.userData.parameters,m=typeof h=="string"?0:h,v=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-m*.5,this.selectionMesh.position.y=v*.5,this.selectionMesh.position.z=f,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-u,a),0)/s),n-1),d=this.object.charCoords[h],f=this.object.charWidths[h],m=0,v=!1;if(i==="previous"){for(let g=0;g<d.length;g++)if(d[g][0]+f[g]*.5-e>0){m=g,v=!0;break}}else if(i==="closest"){let g=1/0;for(let x=0;x<d.length;x++){let S=d[x][0]+f[x]*.5,_=Math.abs(S-e);_<g&&(g=_,m=x,v=!0)}}else for(let g=0;g<d.length;g++){let x=d[g][0],S=d[g][0]+f[g];if(e>=x&&e<S){m=g,v=!0;break}}return v||(m=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,m),lineIndex:h,characterIndex:m}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function $3(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let u=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:f}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=f*.5:h===2&&(u=f)),[u,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,c]}function i2(e,t){var r;let i=0;for(let n=0;n<e.length;n++){let s=e[n],a=t-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,e.length-1),((r=e[e.length-1])==null?void 0:r.length)??0]}function bOe(e,t,i){let[r,n]=i2(e,t),[s,a]=i2(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=e[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function _Oe(e,t){let i=ua.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=SOe(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=MOe(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function SOe(e,t){return typeof e=="string"?t.data.colors[e]:e}function MOe(e){return e.colors[0]}function AOe(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var XZ=class extends UN(Rxe,HZ){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new vT(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof vT&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&AOe(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},vj=new k,yj=new k,xj=new Ai,qZ=class extends UN(Txe,jZ){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Gt.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new vT(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof vT&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),yj.setFromMatrixPosition(this.matrixWorld),xj.setFromRotationMatrix(this.matrixWorld),vj.copy(this.up).applyQuaternion(xj).negate().multiplyScalar(this.distance),this.target.position.copy(yj).add(vj),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function EOe(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,t),h=(u-c)/2,d=(u+c)/2,f=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],m=[[o,0],[0,l]],v=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return f[0][0]*=-1,f[0][1]*=-1,v[0][0]*=-1,v[1][0]*=-1,[f,m,v]}function OE(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function wj(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function TOe(e){let[t,i,r]=EOe(e),n=OE(t,wj(r)),s=OE(OE(r,i),wj(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function COe({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=OE(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var dr;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(E,I=e.identity()){for(let P=0,C=E.length;P<C;P++)I[P]=E[P];return I}e.copy=i;function r(E,I,P,C,L,z){return e.setAbcdef(e.identity(),E,I,P,C,L,z)}e.create=r;function n(E,I,P,C,L,z,F){return E[0]=I,E[1]=C,E[2]=z,E[3]=P,E[4]=L,E[5]=F,E}e.setAbcdef=n;function s(E,I){let[P,C,L,z,F,G]=o(E),[N,q,ie,Q,W,ee]=o(I),K=N*P+q*L,j=N*C+q*z,$=ie*P+Q*L,se=ie*C+Q*z,re=W*P+ee*L+F,he=W*C+ee*z+G;return e.create(K,j,$,se,re,he)}e.append=s;function a(E,I){let[P,C,L,z,F,G]=o(E),[N,q,ie,Q,W,ee]=o(I),K=P,j=C,$=L,se=z;(N!==1||q!==0||ie!==0||Q!==1)&&(K=P*N+C*ie,j=P*q+C*Q,$=L*N+z*ie,se=L*q+z*Q);let re=F*N+G*ie+W,he=F*q+G*Q+ee;return e.create(K,j,$,se,re,he)}e.prepend=a;function o(E){return[E[0],E[3],E[1],E[4],E[2],E[5]]}e.getAbcdef=o;function l(E){let[I,P,C,L,z,F]=e.getAbcdef(E),G=I*L-P*C,N=L/G,q=-P/G,ie=-C/G,Q=I/G,W=(C*F-L*z)/G,ee=-(I*F-P*z)/G;return e.create(N,q,ie,Q,W,ee)}e.invert=l;function c([E,I],P){let[C,L,z,F,G,N]=e.getAbcdef(P);return[C*E+z*I+G,L*E+F*I+N]}e.apply=c;function u(E,I){let[P,C,L,z,F,G]=e.getAbcdef(I),N=1/(P*z+L*-C),[q,ie]=E;return[z*N*q+-L*N*ie+(G*L-F*z)*N,P*N*ie+-C*N*q+(-G*P+F*C)*N]}e.applyInverse=u;function h(E,I,P=I){let[C,L,z,F,G,N]=e.getAbcdef(E);return e.setAbcdef(E,C*I,L*P,z*I,F*P,G*I,N*P),E}e.scale=h;function d(E,I){let P=Math.cos(I),C=Math.sin(I),[L,z,F,G,N,q]=e.getAbcdef(E);return e.setAbcdef(E,L*P-z*C,L*C+z*P,F*P-G*C,F*C+G*P,N*P-q*C,N*C+q*P),E}e.rotate=d;function f(E,I,P){let[C,L]=P,z=e.translate(E,-C,-L);return z=e.rotate(z,I),z=e.translate(z,C,L),z}e.rotateAround=f;function m(E,I,P){let[C,L,z,F,G,N]=e.getAbcdef(E);return e.setAbcdef(E,C,L,z,F,G+I,N+P),E}e.translate=m;function v(E,I,P){let[C,L,z,F]=e.getAbcdef(E);return e.setAbcdef(E,C,L,z,F,I,P),E}e.setTranslate=v;function g(E,I,P){let[C,L,z,F]=e.getAbcdef(E);return e.setAbcdef(E,C,L,z,F,I,P),E}e.setPosition=g;function x(E){let[I,P,C,L]=e.getAbcdef(E),z=Math.sqrt(I*I+P*P),F=Math.sqrt(C*C+L*L);return[z,F]}e.getScale=x;function S(E){let[,,,,I,P]=e.getAbcdef(E);return[I,P]}e.getPosition=S;function _(E,I){return e.decompose(E,I).rotation}e.getRotation=_;function A(E,I){let[P,C,L,z,F,G]=e.getAbcdef(E),{rotation:N,scale:q,shear:ie}=TOe([[P,L],[C,z]]);return{position:[F+(I[0]*P+I[1]*L)-I[0],G+(I[0]*C+I[1]*z)-I[1]],scale:q,rotation:N,shear:ie,pivot:I}}e.decompose=A;function T(E,I,P,C,L=[0,0]){let[z,F]=E,[G,N]=C,[q,ie,Q,W]=COe({rotation:P,scale:I,shear:L}),ee=z-(G*q+N*Q)+G,K=F-(G*ie+N*W)+N;return e.create(q,ie,Q,W,ee,K)}e.compose=T})(dr||(dr={}));var POe=Math.PI/180;function DOe(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function ROe(e){return e*POe}var qs=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=dr.identity(),this.worldMatrix=dr.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new zO,this._recursiveBBox=new zO,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=vC(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=dr.append(t.worldMatrix,i)),dr.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=dr.compose(this.position,this.scale,ROe(this.rotation),zg.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=dr.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=dr.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return zg.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=kr(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Ms.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=Ms.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,wg.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)wg.toOps(this.data,r.data).forEach(n=>{let s=CT.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=wg.patch(this.data,r),wg.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new qs(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof qs&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Bc=class extends qs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Bc&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Bc?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof Bc&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof Bc&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Bc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Tp=class extends Bc{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Tp(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function IOe(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,c]]=t,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var YZ=[[-1,1],[-1,-1],[1,-1],[1,1]],bj=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=dr.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(dr.apply(r,s)):YZ.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(dr.apply(o,s))})},zO=class{constructor(){this.matrix=dr.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),dr.copy(e.worldMatrix,this.matrix);let i=dr.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Bc?e.traverse(n=>{n.visible&&bj(n,t,r)}):bj(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),dr.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[dr.apply([0,0],i),dr.apply([0,t],i),dr.apply([e,t],i),dr.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return dr.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=dr.getAbcdef(this.matrix),o=dr.create(r,n,s,a,i[0],i[1]);this.vertices=YZ.map(([l,c])=>dr.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=dr.append(t.worldMatrix,i)),dr.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if(IOe(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],dr.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new zO;return e.copy(this),e}},QZ,LOe=new Promise(e=>{QZ=e}),_j=!1,rE;function OOe(){if(_j)return;if(rE)return rE;async function e(){let t=await Lp(()=>import("./ui-Ds7EeOeb.js"),[],import.meta.url);QZ(t.default??t),_j=!0}return rE=e(),rE}function Sj(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var Di,eR;async function zOe(e){let t=await LOe;Di||(eR||(eR=t({locateFile:()=>e})),Di=await eR)}var Mj=dr.identity(),ZZ=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=Rr.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=Rr.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=Mj,this._currentTransform=new Float32Array(Mj)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await zOe(this.wasmURL),this._surface=Di.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new Di.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(Di.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(Di.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=Di.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(nE(e),Di.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(nE(e),Di.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(Di.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new Di.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=Di.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,Di.ClipOp.Intersect,!0);else{let h=Di.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,Di.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=dr.invert(this.currentTransform);this.ctx.concat(e);let t=dr.translate(dr.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(nE(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=Di.MaskFilter.MakeBlur(Di.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Di.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Di.ClipOp.Intersect,!0);let c=Di.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Di.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,Di.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=Di.MaskFilter.MakeBlur(Di.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new Di.Paint;c.setAntiAlias(!0),c.setStyle(Di.PaintStyle.Fill),c.setColor(nE(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=Di.MaskFilter.MakeBlur(Di.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,f,m,v]=h,g=m-d,x=v-f;this.ctx.save(),this.ctx.clipPath(this._currentPath,Di.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,Di.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Di.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+g+Math.abs(this._innerShadowOffsetX*2),2e3+x+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(Di.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?Di.ClipOp.Difference:Di.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(Di.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){var c;if(!Aj([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=Di.XYWHRect(e-i,t-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=Di.XYWHRect(e,t,i,r);if(Aj(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=Di.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return Di.TextAlign.Right;case 3:return Di.TextAlign.Center;case 4:return Di.TextAlign.Justify;case 1:default:return Di.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),f=l.copy();return f.setAlphaf(0),this._applyEffectsToPaint(d,m=>{t.pushPaintStyle(i,m,f),t.addText(e);let v=t.build();v.layout(s);let g=n;o===2?g+=(a-v.getHeight())/2:o===3&&(g+=a-v.getHeight()),h.drawParagraph(v,r,g),u=v.getHeight(),t.reset(),v.delete()},c),d.delete(),f.delete(),u}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new Di.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new Di.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=Di.XYWHRect(t.x,t.y,t.width,t.height),u=Di.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){var n;(n=this._currentPath)==null||n.quadTo(e,t,i,r)}setTransform(e,t=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=dr.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let c=dr.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=Di.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function Aj(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function nE({r:e,g:t,b:i,a:r}){return Di.Color4f(e,t,i,r)}var Ej=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Rr.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},Tj=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},BOe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Rr.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},NOe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Rr.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},Hs=class extends qs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new BOe(e+"-fill",t.fill,i),this.stroke=new NOe(e+"-stroke",t.stroke,i),this.dropShadow=new Ej(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new Ej(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new Tj(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new Tj(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Rr.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Rr.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=this.layerBlur.radius*5:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=this.backgroundBlur.radius*5:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=this.dropShadow.blurRadius*5,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=Rr.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=this.innerShadow.blurRadius*5,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=Rr.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(kr(e.path,["fill"])?this.fill.update(e.props):kr(e.path,["stroke"])?this.stroke.update(e.props):kr(e.path,["dropShadow"])?this.dropShadow.update(e.props):kr(e.path,["innerShadow"])?this.innerShadow.update(e.props):kr(e.path,["layerBlur"])?this.layerBlur.update(e.props):kr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new Hs(this.uuid,this.data,e);return t.parent=void 0,t}},VN=class extends Hs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return DOe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new VN(this.uuid,this.data,e);return t.parent=void 0,t}},K_=class extends Hs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new K_(this.uuid,this.data,e);return t.parent=void 0,t}},HN=class extends Hs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Rr.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Rr.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new HN(this.uuid,this.data,e);return t.parent=void 0,t}},KZ=class extends Hs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>r2.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,f={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};r2.derive(f),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new KZ(this.uuid,this.data,e);return t.parent=void 0,t}},r2;(e=>{function t(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],f=[3*(u[0]-c[0]),3*(u[1]-c[1])],m={start:h,cp:d,end:f};return a.derivative=m,m.derivative=BO.derive(m),m}e.derive=t;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,f=-(h+d)/u,m=-(-h+d)/u;return[f,m]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,f=l*u*3,m=o*u;return[h*a.start[0]+d*a.cp1[0]+f*a.cp2[0]+m*a.end[0],h*a.start[1]+d*a.cp1[1]+f*a.cp2[1]+m*a.end[1]]}e.compute=s})(r2||(r2={}));var BO;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=NO.derive(u),n.derivative=u,u}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}e.compute=r})(BO||(BO={}));var NO;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(NO||(NO={}));var Yu=class extends Bc{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new K_(e+"-background",c_.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(kr(e.path,["fill"])?this.fill.update(e.props):kr(e.path,["stroke"])?this.stroke.update(e.props):kr(e.path,["dropShadow"])?this.dropShadow.update(e.props):kr(e.path,["innerShadow"])?this.innerShadow.update(e.props):kr(e.path,["layerBlur"])?this.layerBlur.update(e.props):kr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Yu(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},UOe=zp(eq(),1),bC=class extends Hs{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new bC(this.uuid,this.data,e);return t.parent=void 0,t}};function FOe(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,UOe.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return kOe(r)}function kOe(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function VOe(e,t,i){switch(t.type){case"ellipse2d":return new VN(e,t,i);case"rectangle2d":return new K_(e,t,i);case"text2d":return new HN(e,t,i);case"vector2d":return new KZ(e,t,i);case"path2d":return new bC(e,t,i);case"frame2d":return new Yu(e,t,i);case"group2d":default:return new Tp(e,t,i)}}var JZ=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Tp(JZ.GROUP_ID,{...qT.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=VOe(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof Tp||a instanceof Yu)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Bc&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Bc){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof Bc||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>IY(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},GN=JZ;GN.GROUP_ID="scene2d";function $Z({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-r,h=i-n,d=s,f=a,m=o[0],v=o[1];if(l!==0){if(l===1)m+=u;else if(l===3)m+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let g=t/r;d*=g,m*=g}}if(c!==0){if(c===1)v+=h;else if(c===3)v+=h/2;else if(c===2)f=Math.max(1,f+h);else if(c===4){let g=i/n;f*=g,v*=g}}return{width:d,height:f,position:[m,v]}}zp(eq(),1);var HOe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,GOe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,jOe=new $2(-1,1,1,-1,0,1),WOe=class extends $t{constructor(){super(),this.setAttribute("position",new kt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new kt([0,2,0,0,2,0],2))}},XOe=new WOe,qOe=class{constructor(e){this._mesh=new qr(XOe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,jOe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},eK=new nr({defines:{},uniforms:{tDiffuse:new vt(null)},vertexShader:HOe,fragmentShader:GOe}),YOe=new qOe(eK),tR=null,iR=null,QOe=()=>(tR===null&&(tR=document.createElement("canvas")),tR),ZOe=e=>(iR===null&&(iR=new ZZ(e)),iR),KOe=dr.identity(),tK=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new GN(Gt.generateUUID(),aO.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=QOe(),this.renderer=ZOe(this.canvas),this.promise=this.init(),this.renderTarget=new rr(1,1,{type:Id,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new Fye(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof ZZ&&(this.renderer.wasmURL=MZ.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),eK.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),YOe.render(e),e.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=KOe,this.isScreenSpace&&(this.frameOverride.fill.color=Rr.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},iK({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),r=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,r;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Yu)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function iK({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof Yu&&t instanceof Yu||e instanceof Tp&&t instanceof Tp)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],c=t.children[a];l&&c&&l.uuid===c.uuid&&$Oe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function JOe(e){if(UO(e))return[e.width,e.height];if(e instanceof bC){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof Tp){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function $Oe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=JOe(t),{width:l,height:c,position:u}=$Z({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)eze({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(UO(e)||e instanceof Tp)UO(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),iK({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(e instanceof bC){let h=t,d=a!==0?l/a:1,f=o!==0?c/o:1;e.path=FOe(h.path,d,f),e.data={...e.data,path:e.path}}}function eze({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:f}=$Z({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:zg.isResizeable(l)?l.width:0,objectInitialHeight:zg.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:f}),zg.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function UO(e){return e instanceof K_||e instanceof Yu||e instanceof VN||e instanceof HN}var Vs=class extends xN(Ho){constructor(e,t,i){super(),this.data=t,this.bgColor=new ma(1,1,1,1),this.fog=null,this.backupFog=new Eq(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new fi,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new Na(zx,{...a_.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Axe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new GN((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new tK(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(e),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=co(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof Qg&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Ux)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&vOe(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=co(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=co(e.aoColor,t))}updateByOp(e,t,i,r){let n=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;kr(e.path,["fog"])?this.updateFog(s.fog,i.shared):kr(e.path,["ao"])?this.updateAo(s.ao,i.shared):kr(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):kr(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(co(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof XZ&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize??.5,e+=1),i instanceof qZ&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize??.5,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;tr.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((zc(n)||CO(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),FO(n,e,t,!0)),i(n))}};return i(this),t}updateEntity2DByOp(e,t,i,r){var n;(n=this.uiCanvas)==null||n.updateEntity2DByOp(e,t,i,r)}},tze=class extends UN(Pxe,GZ){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new k(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new k(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new Gn(n,s),o=new yT(a,new fi(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof yT){let i=this.shadow.camera,r=new k(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new k(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},ize=class extends ss{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?TN(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},jN=class extends ss{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let n in e)typeof e[n]=="string"&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));let t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=EN;break;case"Ellipse":n=AN;break;case"Polygon":n=kQ;break;case"Star":n=VQ;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?TN(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},WN=class extends NN{constructor(e,t,i){super(e,t,i),this.data=t}},Xy=class extends Fx(bd,Q_){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=GT.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of np.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=pp.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{...As.defaultData,...e,...Xu(As.defaultData,np.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of np.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&np.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(tr.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),XN(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};rK(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(tr.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof ss&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(f=>e.scene.find(n[f])),h=c.boneInverses.map(f=>new St().fromArray(f)),d=new OB(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function XN(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)tr.is(i)&&XN(i)}}function Cj(e,t,i,r){return e.component===t&&aN(e.identity,r)?e.overrideData===i?2:1:0}function rK(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof Xy&&n.isInstanceRoot&&n.expandInstanceChildren(e);let c=0;for(let u of n.children)if(tr.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=FT.resolve(i,h,1);d!=null&&!(d instanceof os)&&(Object.setPrototypeOf(d,os.prototype),console.error("wrong prototype"));let f=null,m;if(!o){let v=r.children[c];if(f=tr.is(v)?v:null,f!==null){let g=Cj(f,u,d,h);m=g>=1?f.stateSelection:void 0,g!==2&&(f=null)}if(f===null&&(f=e.scene.findInstance(h)??null,f!==null)){let g=Cj(f,u,d,h);if(m=g>=1?f.stateSelection:void 0,g!==2)f=null;else{let x=f.parent.children.indexOf(f);f.parent.children.splice(x,1),r.children.splice(c,0,f),f.parent===r?x<=c&&console.error("not possible"):(f.parent=r,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),e.pendingDeletes.delete(f))}}}if(f===null){let v=d?pp.apply(u.data,d):u.data;Xg.is(v.type)&&(v={...v,type:"Empty"}),f=ap.createEntity(h,v,e),f.overrideData=d,r.add(f),r.children.splice(r.children.length-1,1),r.children.splice(c,0,f),f.updateState(f.data,e),m&&f.changeSelectedState(m,e),e.scene.registerInstanceAndSetUuid(f)}if(f.isBone){let v=f.identity[f.identity.length-1];l[v]=f.uuid}c+=1,rK(e,t,i,f,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(tr.is(h))e.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var rze=class extends Fx(Tq,Q_){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},La=class extends ss{constructor(e,t,i){super(e,t,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new tK(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),e.type===0&&(e.props.frame!==void 0&&this.applyFrame(e.props.frame,i.shared),(e.props.width!==void 0||e.props.height!==void 0)&&this.applySize(e.props,i.shared))}applySize(e,t){let i=(e==null?void 0:e.width)??this.dataPatched.geometry.width,r=(e==null?void 0:e.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var i;let t=this.frame;t&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:t.cornerRadius,cornerType:0})}),(i=this.localGeometry)==null||i.dispose(),this.localGeometry=f_(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,r){this.uiCanvas.updateEntity2DByOp(e,t,i,r),e===this.frameId&&t.type===0&&(t.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):kr(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},nze=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=Cr,n=new Ho,s=new Bp;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new qr(new Ju(2,2),o);n.add(l),this.setDataType=function(f){return r=f,this},this.addVariable=function(f,m,v){let g=this.createShaderMaterial(m),x={name:f,initialValueTexture:v,material:g,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:qi,magFilter:qi};return this.variables.push(x),x},this.setVariableDependencies=function(f,m){f.dependencies=m},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let f=0;f<this.variables.length;f++){let m=this.variables[f];m.renderTargets[0]=this.createRenderTarget(e,t,m.wrapS,m.wrapT,m.minFilter,m.magFilter),m.renderTargets[1]=this.createRenderTarget(e,t,m.wrapS,m.wrapT,m.minFilter,m.magFilter),this.renderTexture(m.initialValueTexture,m.renderTargets[0]),this.renderTexture(m.initialValueTexture,m.renderTargets[1]);let v=m.material,g=v.uniforms;if(m.dependencies!==null)for(let x=0;x<m.dependencies.length;x++){let S=m.dependencies[x];if(S.name!==m.name){let _=!1;for(let A=0;A<this.variables.length;A++)if(S.name===this.variables[A].name){_=!0;break}if(!_)return"Variable dependency not found. Variable="+m.name+", dependency="+S.name}g[S.name]={value:null},v.fragmentShader=`
uniform sampler2D `+S.name+`;
`+v.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let f=this.currentTextureIndex,m=this.currentTextureIndex===0?1:0;for(let v=0,g=this.variables.length;v<g;v++){let x=this.variables[v];if(x.dependencies!==null){let S=x.material.uniforms;for(let _=0,A=x.dependencies.length;_<A;_++){let T=x.dependencies[_];S[T.name].value=T.renderTargets[f].texture}}this.doRenderTarget(x.material,x.renderTargets[m])}this.currentTextureIndex=m},this.getCurrentRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let f=this.variables;for(let m=0;m<f.length;m++){let v=f[m];v.initialValueTexture&&v.initialValueTexture.dispose();let g=v.renderTargets;for(let x=0;x<g.length;x++)g[x].dispose()}};function c(f){f.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(f,m){m=m||{};let v=new nr({uniforms:m,vertexShader:h(),fragmentShader:f});return c(v),v}this.createShaderMaterial=u,this.createRenderTarget=function(f,m,v,g,x,S){return f=f||e,m=m||t,v=v||sn,g=g||sn,x=x||qi,S=S||qi,new rr(f,m,{wrapS:v,wrapT:g,minFilter:x,magFilter:S,format:hn,type:r,depthBuffer:!1})},this.createTexture=function(){let f=new Float32Array(e*t*4),m=new lo(f,e,t,hn,Cr);return m.needsUpdate=!0,m},this.renderTexture=function(f,m){a.passThruTexture.value=f,this.doRenderTarget(o,m),a.passThruTexture.value=null},this.doRenderTarget=function(f,m){let v=i.getRenderTarget(),g=i.xr.enabled,x=i.shadowMap.autoUpdate,S=i.outputEncoding,_=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Qc,i.toneMapping=Wu,l.material=f,i.setRenderTarget(m),i.render(n,s),l.material=o,i.xr.enabled=g,i.shadowMap.autoUpdate=x,i.outputEncoding=S,i.toneMapping=_,i.setRenderTarget(v)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},sa=new ha,sE=new k,sze=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),sa.a.fromBufferAttribute(e,n),sa.b.fromBufferAttribute(e,n+1),sa.c.fromBufferAttribute(e,n+2),s*=sa.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),sa.a.fromBufferAttribute(this.positionAttribute,e*3),sa.b.fromBufferAttribute(this.positionAttribute,e*3+1),sa.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(sa.a,n).addScaledVector(sa.b,s).addScaledVector(sa.c,1-(n+s)),i!==void 0&&sa.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(sa.a.fromBufferAttribute(this.colorAttribute,e*3),sa.b.fromBufferAttribute(this.colorAttribute,e*3+1),sa.c.fromBufferAttribute(this.colorAttribute,e*3+2),sE.set(0,0,0).addScaledVector(sa.a,n).addScaledVector(sa.b,s).addScaledVector(sa.c,1-(n+s)),r.r=sE.x,r.g=sE.y,r.b=sE.z),this}};function aze(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function oze(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function lze(e,t){let i=new qr(e.geometry,e.material),r=[],n=[],s=new k,a=new k;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new sze(i).build();for(let u=0;u<t;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function Pj(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new lo(r,t,t,hn,Cr);return n.needsUpdate=!0,n}function cze({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new lo(t,e,e,hn,Cr);return i.needsUpdate=!0,i}function uze(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new lo(t,e,e,hn,Cr);return i.needsUpdate=!0,i}var hze=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,dze=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,fze=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,pze=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,mze=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,gze=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+dze+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${fze}
      // ATTRACTION
      ${pze}  
      // VORTEX
      ${mze}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,nK=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,vze=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,yze=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,xze=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${vze}
  ${nK}
`,wze=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,bze=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+nK+`  
  ${yze}

`,_ze=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,Sze=class extends nr{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],_s.startContext(_s.globalContext),this.lightLayer=new Ru(0,"",{...ks.defaultData("light","phong"),visible:!1},new RN,{},t.shared),_s.endContext(_s.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new iZ;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(e3e),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(t3e),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(xze),e.addFragmentParsCode(bze),e.addVertexFinalCode(wze({easeSize:this.easeSize})),e.addFragmentFinalCode(_ze({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},rR=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=oze(t);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=lze(t,e*e),n=Pj(i,e),s=Pj(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new By(t*.5,32,32);break}case"TorusEmitterShape":{i=new Nq(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new UB(t,t,15);break}case"BoxEmitterShape":{i=new Zc(t,t,t);break}case"PlaneEmitterShape":{i=new Ju(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new By(t,32,32);break}default:{i=new By(t,32,32);break}}return new qr(i,new Ld({color:16711680}))}applyToShader(e,t){this.size=new k().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function gy(e){let t={...e},i=LT.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var Mze=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,nR=10,Aze=class extends Mr{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new Mxe,this.currentWorldPosition=new k,this.systemQuaternion=new Ai,this.worldGravity=new k(0,0,0),this.directionAxis=new k(0,0,0),this.colliderV3=new k(0,0,0),this.colliderQuaternion=new Ai(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new Sze(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new k(0,0,0)},uEmissionData:{value:new k(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new k(0,0,0)},uWorldQuaternion:{value:new Ti(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new wn(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new wn(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){var r;let i=aze(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new Qb(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(gy({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/nR),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(gy(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/nR),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let n=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let n=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...gy(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let n=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Gt.DEG2RAD,Number(e[1])*Gt.DEG2RAD,Number(e[2])*Gt.DEG2RAD],i=new Ss(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new nze(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+hze,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+gze,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",Mze,uze(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=cze({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new k(0,0,0)},uWorldQuaternion:{value:new Ti(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new k(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Ti(0,0,0,1)},uColliderPos:{value:new k(0,0,0)},uColliderSize:{value:new k(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new Ti(0,0,0,1)},uColliderQuaternionInvert:{value:new Ti(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/nR}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let f=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],m={...gy(this.system.data).shape,size:f};this.emitterShape.applyToShader(n.material.uniforms,m),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new k(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new rR(i,t,e.type,r):new rR(i,t,"SphereEmitterShape")}else return new rR(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new Nye(new Ju(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(gy(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},pb=class extends mo{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new $t,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...gy(t)},this.geometry.setAttribute("position",new kt([],3)),this.material=new Ld({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new Aze(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),kr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Gs.drop(e,1).props}}),kr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Gs.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function Eze(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var sR=Eze();function Tze(e,t,i){var n;sR!==void 0&&(((n=t==null?void 0:t.geometry)==null?void 0:n.subdivisions)??0)>sR&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=sR);let r;return t.geometry.type==="TextGeometry"?new NN(e,t,i):t.geometry.type==="InputGeometry"?new WN(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new p_(e,t,i):t.geometry.type==="PathGeometry"?r=new jN(e,t,i):t.geometry.type==="VectorGeometry"?r=new ize(e,t,i):t.geometry.type==="BooleanGeometry"?r=new Qg(e,t,i):t.geometry.type==="ShapeBlendGeometry"?r=new Zg(e,t,i):t.geometry.type==="UIGeometry"?r=new La(e,t,i):r=new ss(e,t,i),r)}function qN(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?Tze(e,t,i):t.type==="Empty"?new Wy(e,t):t.type==="Particle"?new pb(e,t,i):t.type==="ParticleCollider"?new fb(e,t,i):t.type==="Splat"?new Wy(e,t):t.type==="Bone"?new rze(e,t):t.type==="Page"?new Vs(e,t,i):t.type==="PointLight"?new tze(e,t,i):t.type==="SpotLight"?new qZ(e,t,i):t.type==="DirectionalLight"?new XZ(e,t,i):t.type==="Component"||t.type==="Instance"?new Xy(e,t,i):Xg.is(t.type)?new Na(e,t):(console.error(t),new Wy(e,t))}ap.createEntity=qN;function Cze(e,t,i){let r=qN(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}ap.changeEntityProptotype=Cze;ap.Cloner=Vl;function Pze(e,t,i,r){e.updateByOp(t,i,r,!1)}var lg=5,mb=new $t;mb.setAttribute("position",new pi(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var zE=class extends pxe{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:iL,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function Dze(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/lg};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/lg};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/lg};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/lg};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/lg}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var BE=new Bp,Rze=class{constructor(){this.pyramidPassScene=new Ho,this.pyramidPassMaterial=new zE({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new qr(mb,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,r,n){new GB().min.setScalar(0);let s=t.length-1,a=new Ti;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?n[0]:n[1],h=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=t[c],f=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,d/f,d/f),c===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,3/f,3/f),i.render(this.pyramidPassScene,BE);let m=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=m,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},Tc=24,oa=96,Su=Dze(),Zh=2,sK=class extends ss{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new Ho,this.potentialPassScene=new Ho,this.voxelPassScene=new Ho,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new $t,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new qr(mb,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new lo(Su.triTable,16,256,ME,Cr);r.needsUpdate=!0;let n=new lo(Su.numTrisTable,256,1,ME,Cr);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new qr(mb,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new qr(mb,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(Bze.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new nr({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new nr({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new k},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new k,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Ee(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Ee(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,BE),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,BE),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,BE),sK.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new $t,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new pi(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*Tc)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*Zh,this.bboxOffset=8*Zh*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*Zh,this.bboxOffset=4*Zh*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*Zh,this.bboxOffset=2*Zh*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*Zh,this.bboxOffset=Zh*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new rr(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:hn,type:Cr,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:qi,magFilter:qi}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new rr(this.basePyramidSize,this.basePyramidSize,{format:hn,type:Cr,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:qi,magFilter:qi}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new gq(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:qi,magFilter:qi}),e.texture[0].format=hn,e.texture[0].type=Cr,e.texture[1].format=ME,e.texture[1].type=Cr,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new rr(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:hn,type:Cr,stencilBuffer:!1,depthBuffer:!1,magFilter:qi,minFilter:qi}),i=new rr(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:hn,type:Cr,stencilBuffer:!1,depthBuffer:!1,magFilter:qi,minFilter:qi});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new pi(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${Su.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${Tc-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${oa}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${Su.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*Tc}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${Tc}.);
				pc_FragColor.z = spatialKey(lowi+${2*Tc}.);
				pc_FragColor.w = spatialKey(lowi+${3*Tc}.);
			}
		`;return new zE({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${Su.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${Su.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${Tc}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/oa};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*Tc}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${Tc}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*Tc}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*Tc}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${Su.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new zE({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${Su.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${Su.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new zE({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${Zh}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${Su.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(r[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new Ju(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new Ee(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},Zg=sK;Zg.streamCompaction=new Rze;var Ize=new St,Lze=new St,iy=new Ai,Ff=new k,aE=new k,Oze=new Ai;function zze(e,t=0){let i=this.children.length;for(;i--;){let r=this.children[i];qg.is(r)&&aK.call(r,e,t+1)}}function aK(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];qg.is(r)&&aK.call(r,e,t+1)}}}function Bze(){if(this.shapesDataTexture.value===void 0){let a=new lo(new Float32Array(4*oa*lg),oa,lg,hn,Cr);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=Ize.copy(this.matrixWorld).invert(),s=0;zze.call(this,a=>{var x;if(a.visible===!1)return!0;let o;if(a instanceof Vl||a instanceof fb||a instanceof pb)return;a instanceof pa?o=a.object:o=a;let l=(x=a.data)==null?void 0:x.cloner;if(tr.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof ss))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(Lze.multiplyMatrices(n,a.matrixWorld).decompose(aE,iy,Ff),c.type==="TorusGeometry"&&c.arc!==360){let S=c.arc*Math.PI/180;S=S/4,iy.multiply(Oze.set(0,0,Math.sin(S),Math.cos(S)))}let h=u.overrideGlobalBlend?u.blendRange:r;h=h/this.bboxSize*2,t[s*4]=(aE.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(aE.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(aE.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,t[oa*4+s*4]=-iy.x,t[oa*4+s*4+1]=-iy.y,t[oa*4+s*4+2]=-iy.z,t[oa*4+s*4+3]=iy.w;let d=new Float32Array(4),f=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*Ff.x+h,d[2]*Ff.x+h,d[3]*Ff.x+h);else if(c.type==="CubeGeometry"){f=c.cornerRadius;let S=c.width,_=c.height,A=c.depth;d[0]=2,d[1]=(S-2*f)/this.bboxSize,d[2]=(_-2*f)/this.bboxSize,d[3]=(A-2*f)/this.bboxSize,i=Math.max(i,Math.sqrt(S**2+_**2+A**2)/this.bboxSize*Ff.x+h)}else if(c.type==="CylinderGeometry"){f=c.cornerRadius;let S=c.height,_=c.radiusBottom,A=c.radiusTop;if(A>=_){let T=Math.atan2(A-_,S),E=(Math.PI/2-T)/2;A-=f/Math.tan(E),_-=f*Math.tan(E)}else if(_>A){let T=Math.atan2(_-A,S),E=(Math.PI/2-T)/2;A-=f*Math.tan(E),_-=f/Math.tan(E)}d[1]=(c.height-2*f)/this.bboxSize,_===A?(d[0]=3,d[2]=_/this.bboxSize*2):(d[0]=4,d[2]=_/this.bboxSize*2,d[3]=A/this.bboxSize*2),i=Math.max(i,d[1]*4*Ff.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],t[oa*12+s*4+3]=d[2];let S=2*Math.atan2(d[2]/2,d[1]),_=c.arc*Math.PI/180/2-S;d[1]=Math.sin(_),d[2]=Math.cos(_)}i=Math.max(i,c.width*Ff.x/this.bboxSize+h)}t.set(d,oa*8+s*4),t[oa*12+s*4]=h,t[oa*12+s*4+1]=f/this.bboxSize*2,t[oa*12+s*4+2]=Ff.x;let m=o.material,v=m.uniforms.nodeU0.node.value,g=m.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(g=-1),t[oa*16+s*4]=v.r,t[oa*16+s*4+1]=v.g,t[oa*16+s*4+2]=v.b,t[oa*16+s*4+3]=g,g<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var oK=512;function Dj(e,t){let i=!1,r=e.layers.mask&oK,n=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,BN(e),zN(e)),n.length===0&&s.length===0&&e.layers.set(0),r&&e.layers.set(9),e instanceof Ux&&e.needsAO&&e.layers.enable(5),i}function Rj(e,t){if(!t.layers)return!1;let i=e.layers.mask&oK,r=!1,n=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),r=!0),n.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),r}function Nze(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Ux)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Dj(i,i.material[r])&&(t=!0);else Dj(i,i.material)&&(t=!0)}),t}function Uze(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Ux)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Rj(i,i.material[r])&&(t=!0);else Rj(i,i.material)&&(t=!0)}),t}var Fze=new Xq,kze=new St,Vze=new Mx;function FO(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=kze.copy(s.matrixWorld).invert(),o=Vze.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let c=Fze;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?s:e})}}var Hze=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},Gze="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",lp=class{};zw(lp,"DepthMapRange",65536),zw(lp,"MemoryPageSize",65536),zw(lp,"BytesPerFloat",4),zw(lp,"BytesPerInt",4);function jze(e){let t,i,r,n,s,a,o,l,c,u,h,d,f,m,v,g;function x(z){let F=new Float64Array(u,a,16);for(let N=0;N<16;N++)F[N]=z[N];let G;if(r>1){t.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let N=new Uint32Array(r);G=N.buffer,N.set(new Uint32Array(u,l,r))}else if(r===1){let N=new Uint32Array(r);N[0]=new Uint32Array(u,n,i)[0],G=N.buffer}else G=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:G},[G])}function S(z,F,G){let N=new Float32Array(u,s,i*3);r=0;let q=new Uint32Array(u,n,i);for(let ie=0;ie<G.length-1;ie++){let Q=F[ie],W=z[ie].elements,ee=Q.filter(j=>j.enabled&&j.mode==="Include").map(j=>j.type==="Box"?E(j):C(j)),K=Q.filter(j=>j.enabled&&j.mode==="Exclude").map(j=>j.type==="Box"?E(j):C(j));for(let j=G[ie];j<G[ie+1];j++){let $=f[j*3],se=f[j*3+1],re=f[j*3+2];if((ee.length===0||A($,se,re,ee))&&(K.length===0||!A($,se,re,K))){let he=1/(W[3]*$+W[7]*se+W[11]*re+W[15]);N[r*3]=(W[0]*$+W[4]*se+W[8]*re+W[12])*he,N[r*3+1]=(W[1]*$+W[5]*se+W[9]*re+W[13])*he,N[r*3+2]=(W[2]*$+W[6]*se+W[10]*re+W[14])*he,q[r]=j,r++}}}}function _(z,F){let G=[],N=F.filter(Q=>Q.enabled&&Q.mode==="Include").map(Q=>Q.type==="Box"?E(Q):C(Q)),q=F.filter(Q=>Q.enabled&&Q.mode==="Exclude").map(Q=>Q.type==="Box"?E(Q):C(Q)),ie=z.length;for(let Q=0;Q<ie;Q+=3){let W=z[Q],ee=z[Q+1],K=z[Q+2];(N.length===0||A(W,ee,K,N))&&(q.length===0||!A(W,ee,K,q))||G.push(Q/3)}return G}function A(z,F,G,N,q){return N[q==="Intersect"?"every":"some"](ie=>{let Q=T(z,F,G,ie.invRotationMatrix,ie.cropCenter);return Array.isArray(ie)?P(Q.x,Q.y,Q.z,ie):L(Q.x,Q.y,Q.z,ie)})}function T(z,F,G,N,q){let ie=z-q[0],Q=F-q[1],W=G-q[2],ee=1/(N[3]*ie+N[7]*Q+N[11]*W+N[15]);return{x:(N[0]*ie+N[4]*Q+N[8]*W+N[12])*ee+q[0],y:(N[1]*ie+N[5]*Q+N[9]*W+N[13])*ee+q[1],z:(N[2]*ie+N[6]*Q+N[10]*W+N[14])*ee+q[2]}}function E(z){let F=z.cropSize[0]/2,G=z.cropSize[1]/2,N=z.cropSize[2]/2,q=[z.cropCenter[0]-F,z.cropCenter[1]-G,z.cropCenter[2]-N,z.cropCenter[0]+F,z.cropCenter[1]+G,z.cropCenter[2]+N],ie=I(z.cropRotation);return Object.assign(q,{invRotationMatrix:ie,cropCenter:z.cropCenter})}function I(z){let F=[],G=z[0]*Math.PI/180,N=z[1]*Math.PI/180,q=z[2]*Math.PI/180,ie=Math.cos(G),Q=Math.sin(G),W=Math.cos(N),ee=Math.sin(N),K=Math.cos(q),j=Math.sin(q),$=ie*K,se=ie*j,re=Q*K,he=Q*j;return F[0]=W*K,F[1]=-W*j,F[2]=ee,F[4]=se+re*ee,F[5]=$-he*ee,F[6]=-Q*W,F[8]=he-$*ee,F[9]=re+se*ee,F[10]=ie*W,F[12]=0,F[13]=0,F[14]=0,F[3]=0,F[7]=0,F[11]=0,F[15]=1,F}function P(z,F,G,N){return z>=N[0]&&z<=N[3]&&F>=N[1]&&F<=N[4]&&G>=N[2]&&G<=N[5]}function C(z){let F=2/z.cropSize[0],G=2/z.cropSize[1],N=2/z.cropSize[2],q=I(z.cropRotation);return{invRadiusX:F,invRadiusY:G,invRadiusZ:N,cropCenter:z.cropCenter,invRotationMatrix:q}}function L(z,F,G,N){let q=(z-N.cropCenter[0])*N.invRadiusX,ie=(F-N.cropCenter[1])*N.invRadiusY,Q=(G-N.cropCenter[2])*N.invRadiusZ;return q*q+ie*ie+Q*Q<=1}e.onmessage=z=>{if(z.data.getCroppedIndexes){let F=new Uint32Array(_(new Float32Array(z.data.positions),z.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:F},[F])}else if(z.data.positions)h=z.data.positions,f=new Float32Array(h),v=z.data.meshMatrixWorlds,g=z.data.cropsArray,m=z.data.meshIndexIntervals,S(v,g,m),e.postMessage({sortSetupComplete:!0});else if(z.data.sort||z.data.newMatrixWorlds||z.data.newCropsArray)(z.data.newMatrixWorlds||z.data.newCropsArray)&&(g=z.data.newCropsArray||g,v=z.data.newMatrixWorlds||v,S(v,g,m)),x(z.data.sort.view,z.data.sort.cameraPosition);else if(z.data.init){d=z.data.init.Constants,i=z.data.init.splatCount;let F=d.BytesPerInt,G=d.BytesPerFloat*3,N=new Uint8Array(z.data.init.sorterWasmBytes),q=F+G,ie=i*q,Q=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,W=d.MemoryPageSize*32,ee=ie+Q+W,K=Math.floor(ee/d.MemoryPageSize)+1,j={module:{},env:{memory:new WebAssembly.Memory({initial:K*2,maximum:K*3,shared:!0})}};WebAssembly.compile(N).then($=>WebAssembly.instantiate($,j)).then($=>{t=$,n=0,s=i*F,a=s+i*G,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=j.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function Wze(e){let t=new Worker(URL.createObjectURL(new Blob(["(",jze.toString(),")(self)"],{type:"application/javascript"}))),i=atob(Gze),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:lp.BytesPerFloat,BytesPerInt:lp.BytesPerInt,DepthMapRange:lp.DepthMapRange,MemoryPageSize:lp.MemoryPageSize}}}),t}var aR=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),Xze=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},oE=new Ee;function Ij(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var NE=class extends qr{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=NE.buildGeomtery(t),o=NE.buildMaterial(n);return new NE(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Ee},viewport:{type:"v2",value:new Ee},basisViewport:{type:"v2",value:new Ee},debugColor:{type:"v3",value:new fi},covariancesTextureSize:{type:"v2",value:new Ee(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Ee(1024,1024)},orthoZoom:{type:"f",value:-1}};return new nr({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:Dg,depthTest:!0,depthWrite:!1,side:Oa})}static buildGeomtery(e){let t=new $t;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new pi(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new jq().copy(t),s=new Uint32Array(e),a=new Qb(s,1,!1);return a.setUsage(_pe),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new Ee(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new Ee(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=$xe.toHalfFloat(this.covariances[u]);r=new lo(n,t.x,t.y,sT,Id)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new lo(n,t.x,t.y,sT,Cr);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,f=u*4;s[f]=Xze(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[f+1]=aR(this.centers[d]),s[f+2]=aR(this.centers[d+1]),s[f+3]=aR(this.centers[d+2])}let a=new lo(s,i.x,i.y,aq,xd);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new lo(l,o,1,hn,Cr);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(oE.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(oE),this.material.uniforms.basisViewport.value.set(2/oE.x,2/oE.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},lK,qze=new Promise(e=>{lK=e}),Lj=!1,lE;function Yze(){if(Lj)return;if(lE)return lE;async function e(){let t=await Lp(()=>import("./gaussian-splat-compression-BblNKJdU.js"),[],import.meta.url);lK(t),Lj=!0}return lE=e(),lE}var cK;qze.then(e=>cK=e);var Qze=class{constructor(e={}){zw(this,"updateView",function(){let t=new St,i=[],r=new k(0,0,-1),n=new k(0,0,-1),s=new k,a=new k;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,f=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(f=!0),!d&&!f&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new St().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new Ee;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new k().fromArray(e.position)),e.orientation&&(e.orientation=new Ai().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new cK.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new k,r=new Ai,n=!1,s=1,a,o){this.splatMesh=NE.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(e){this.sortWorker=Wze(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},kO=new Ld;kO.wireframe=!0;var Oj=new k,YN=class extends Ho{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new Hze,this.invisibleObjects=new Wy("jflkdsafjasdifjaslk",{...qL.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new Vs("fdasfa",{...px.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=Uze(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=Nze(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof Vs&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>IY(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===zx)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof Vs&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof Vs&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof La&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof Vs&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),zc(n)&&Sd(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof Zg&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Sd(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),zc(r)&&(r.freeBooleanPointer(),n instanceof Qg&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof jN&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),zc(r)&&(r.invalidateUpstreamBooleanData(),Sd(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof Qg&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof Vs&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{Pze(n,t,i,{scene:this,shared:r}),n instanceof ss&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof La||a instanceof Vs)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof Na&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){tr.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{tr.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=s_(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...RY(h.identity),e].join("-"),f=this.entityIdentityToEntity[d];if(f){let m=f.uuid,v=Ms.zoom(u,t);v[i]=m}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Xy&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=s_(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of VT.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof Xy&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),XN(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof Xy&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)tr.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(tr.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(zc(s)||CO(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),FO(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;tr.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((zc(n)||CO(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),FO(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)tr.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)tr.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)tr.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof ss&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();Sd(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)qg.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)tr.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let a={scene:this,shared:s},o=qN(e,t,a);return o instanceof Zg&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof ss&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof ss&&u.bones&&u.boneInverses){let h=u.bones.map(m=>this.find(m)),d=u.boneInverses.map(m=>new St().fromArray(m)),f=new OB(h,d);c.bind(f,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new Gn;return i.setFromPoints(t),i.getCenter(Oj),Oj}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof mo)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Ep&&e(t.material[i]);else t.material instanceof Ep&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof Na&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new Qze({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},UE=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},Zze=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Jze(Math.atan2(r,i))},Kze=(e,t,i)=>{let r={x:0,y:0};return i=VO(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},VO=e=>e*(Math.PI/180),Jze=e=>e*(180/Math.PI),$ze=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,oR=new Map,zj=e=>{oR.has(e)&&clearTimeout(oR.get(e)),oR.set(e,setTimeout(e,100))},n2=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},Bj=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},uK=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),Nj=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},HO=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},QN=(e,t,i)=>{let r=hK(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},eBe=(e,t)=>{let i=hK(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},hK=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},lR=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},tBe=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},GO=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},iBe=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(dK="ontouchstart"in window,fK=!!window.PointerEvent,pK=!!window.MSPointerEvent);var dK,fK,pK,_w={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Iy,m_={};fK?Iy=_w.pointer:pK?Iy=_w.MSPointer:dK?(Iy=_w.touch,m_=_w.mouse):Iy=_w.mouse;function uv(){}uv.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};uv.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};uv.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};uv.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=tBe(t.options,e))};uv.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},n2(e,Iy[t],i._domHandlers_[t]),m_[t]&&n2(e,m_[t],i._domHandlers_[t]),i};uv.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},Bj(e,Iy[t],i._domHandlers_[t]),m_[t]&&Bj(e,m_[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var ZN=uv;function Ds(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Ds.id,Ds.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Ds.prototype=new ZN;Ds.constructor=Ds;Ds.id=0;Ds.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Ds.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=eBe("borderRadius","50%"),i=QN("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},lR(r.el,i),this.options.shape==="circle"&&lR(r.back,t),lR(r.front,t),this.applyStyles(r),this};Ds.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Ds.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Ds.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Ds.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Ds.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Ds.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Ds.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=QN("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Ds.prototype.restCallback=function(){var e=this,t={};t.front=QN("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Ds.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Ds.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var rBe=Ds;function jn(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=jn.id,jn.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}jn.prototype=new ZN;jn.constructor=jn;jn.id=0;jn.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};jn.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};jn.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};jn.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new rBe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(HO(c.ui.el,n),HO(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};jn.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};jn.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};jn.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};jn.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=uK(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return GO(e,n),t.manager.bindDocument(),!1};jn.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=UE(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};jn.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};jn.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!$ze(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=UE(l,n.position),u=Zze(l,n.position),h=VO(u),d=c/o,f={distance:c,position:l},m,v;if(n.options.shape==="circle"?(m=Math.min(c,o),v=Kze(n.position,m,u)):(v=iBe(l,n.position,o),m=UE(v,n.position)),i.follow){if(c>o){let _=l.x-v.x,A=l.y-v.y;n.position.x+=_,n.position.y+=A,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",c=UE(l,n.position)}}else l=v,c=m;var g=l.x-n.position.x,x=l.y-n.position.y;n.frontPosition={x:g,y:x},i.dataOnly||HO(n.ui.front,n.frontPosition);var S={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:g/o,y:-x/o},raw:f,instance:n,lockX:i.lockX,lockY:i.lockY};S=n.computeDirection(S),S.angle={radian:VO(180-u),degree:180-u},n.trigger("move",S),t.trigger("move "+n.id+":move",S)};jn.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};jn.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};jn.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var nBe=jn;function Ys(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=Nj(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;n2(window,"resize",function(){zj(i)});var r=function(){t.scroll=Nj()};return n2(window,"scroll",function(){zj(r)}),t.collections}Ys.prototype=new ZN;Ys.constructor=Ys;Ys.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};Ys.prototype.create=function(e){return this.createCollection(e)};Ys.prototype.createCollection=function(e){var t=this,i=new nBe(t,e);return t.bindCollection(i),t.collections.push(i),i};Ys.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Ys.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Ys.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Ys.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Ys.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};Ys.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Ys.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Ys.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Ys.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=uK(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),GO(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return GO(t,a),!1};Ys.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Ys.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var sBe=Ys,Uj=new sBe,aBe={create:function(e){return Uj.create(e)},factory:Uj},mK=new Map,gb=new Map,_g=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new Ww({src:l,volume:s,delay:a,loop:o}),gb.has(i.uuid)?gb.get(i.uuid).push(this):gb.set(i.uuid,[this]),mK.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},jO=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=mK.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=gb.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...gb.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},gK=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new _g(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new jO(t);else throw new Error("Missing property")}dispatchBasic(){if($r(this.shared,this.condition)===!1)return!1;this.interaction instanceof _g?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if($r(this.shared,this.condition)===!1)return!1;this.interaction instanceof _g?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if($r(this.shared,this.condition)===!1)return!1;this.interaction instanceof _g&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},vK=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if($r(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if($r(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if($r(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},oBe="text/plain",lBe="us-ascii",Fj=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),cBe=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(f=>f.trim());return h==="charset"&&(d=d.toLowerCase(),d===lBe)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==oBe)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function uBe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return cBe(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];Fj(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])Fj(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var hBe=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:uBe(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if($r(this.shared,this.condition)===!1)return!1;j_?window.location.assign(this.url):(this.context==="tab"||DY&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(wi[0]),TTe())}},yK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if($r(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if($r(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},xK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if($r(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),oU(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},wK={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},KN={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},dBe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],s2={CSS:{},springs:{}};function Vc(e,t,i){return Math.min(Math.max(e,t),i)}function vb(e,t){return e.indexOf(t)>-1}function cR(e,t){return e.apply(null,t)}var Ei={arr:function(e){return Array.isArray(e)},obj:function(e){return vb(Object.prototype.toString.call(e),"Object")},pth:function(e){return Ei.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||Ei.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return Ei.hex(e)||Ei.rgb(e)||Ei.hsl(e)},key:function(e){return!wK.hasOwnProperty(e)&&!KN.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function bK(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function _K(e,t){var i=bK(e),r=Vc(Ei.und(i[0])?1:i[0],.1,100),n=Vc(Ei.und(i[1])?100:i[1],.1,100),s=Vc(Ei.und(i[2])?10:i[2],.1,100),a=Vc(Ei.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(m){var v=t?t*m/1e3:m;return l<1?v=Math.exp(-v*l*o)*(u*Math.cos(c*v)+h*Math.sin(c*v)):v=(u+h*v)*Math.exp(-v*o),m===0||m===1?m:1-v}function f(){var m=s2.springs[e];if(m)return m;for(var v=1/6,g=0,x=0;;)if(g+=v,d(g)===1){if(x++,x>=16)break}else x=0;var S=g*v*1e3;return s2.springs[e]=S,S}return t?d:f}function fBe(e){return e===void 0&&(e=10),function(t){return Math.ceil(Vc(t,1e-6,1)*e)*(1/e)}}var pBe=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,f,m){var v,g,x=0;do g=h+(d-h)/2,v=s(g,f,m)-u,v>0?d=g:h=g;while(Math.abs(v)>1e-7&&++x<10);return g}function l(u,h,d,f){for(var m=0;m<4;++m){var v=a(h,d,f);if(v===0)return h;var g=s(h,d,f)-u;h-=g/v}return h}function c(u,h,d,f){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var m=new Float32Array(e);if(u!==h||d!==f)for(var v=0;v<e;++v)m[v]=s(v*t,u,d);function g(x){for(var S=0,_=1,A=e-1;_!==A&&m[_]<=x;++_)S+=t;--_;var T=(x-m[_])/(m[_+1]-m[_]),E=S+T*t,I=a(E,u,d);return I>=.001?l(x,E,u,d):I===0?E:o(x,S,S+t,u,d)}return function(x){return u===h&&d===f||x===0||x===1?x:s(g(x),h,f)}}return c}(),SK=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Vc(r,1,10),a=Vc(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function JN(e,t){if(Ei.fnc(e))return e;var i=e.split("(")[0],r=SK[i],n=bK(e);switch(i){case"spring":return _K(e,t);case"cubicBezier":return cR(pBe,n);case"steps":return cR(fBe,n);default:return cR(r,n)}}function MK(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function _C(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function SC(e){return e.reduce(function(t,i){return t.concat(Ei.arr(i)?SC(i):i)},[])}function kj(e){return Ei.arr(e)?e:(Ei.str(e)&&(e=MK(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function $N(e,t){return e.some(function(i){return i===t})}function eU(e){var t={};for(var i in e)t[i]=e[i];return t}function WO(e,t){var i=eU(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function MC(e,t){var i=eU(e);for(var r in t)i[r]=Ei.und(e[r])?t[r]:e[r];return i}function mBe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function gBe(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function vBe(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,f,m){return m<0&&(m+=1),m>1&&(m-=1),m<1/6?d+(f-d)*6*m:m<1/2?f:m<2/3?d+(f-d)*(2/3-m)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function yBe(e){if(Ei.rgb(e))return mBe(e);if(Ei.hex(e))return gBe(e);if(Ei.hsl(e))return vBe(e)}function Cd(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function xBe(e){if(vb(e,"translate")||e==="perspective")return"px";if(vb(e,"rotate")||vb(e,"skew"))return"deg"}function XO(e,t){return Ei.fnc(e)?e(t.target,t.id,t.total):e}function Fu(e,t){return e.getAttribute(t)}function tU(e,t,i){var r=Cd(t);if($N([i,"deg","rad","turn"],r))return t;var n=s2.CSS[t+i];if(!Ei.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(t);return s2.CSS[t+i]=c,c}function AK(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?tU(e,n,i):n}}function iU(e,t){if(Ei.dom(e)&&!Ei.inp(e)&&(Fu(e,t)||Ei.svg(e)&&e[t]))return"attribute";if(Ei.dom(e)&&$N(dBe,t))return"transform";if(Ei.dom(e)&&t!=="transform"&&AK(e,t))return"css";if(e[t]!=null)return"object"}function EK(e){if(Ei.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function wBe(e,t,i,r){var n=vb(t,"scale")?1:0+xBe(t),s=EK(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?tU(e,s,r):s}function rU(e,t,i,r){switch(iU(e,t)){case"transform":return wBe(e,t,r,i);case"css":return AK(e,t,i);case"attribute":return Fu(e,t);default:return e[t]||0}}function nU(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Cd(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function TK(e,t){if(Ei.col(e))return yBe(e);if(/\s/g.test(e))return e;var i=Cd(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function sU(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function bBe(e){return Math.PI*2*Fu(e,"r")}function _Be(e){return Fu(e,"width")*2+Fu(e,"height")*2}function SBe(e){return sU({x:Fu(e,"x1"),y:Fu(e,"y1")},{x:Fu(e,"x2"),y:Fu(e,"y2")})}function CK(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=sU(r,s)),r=s}return i}function MBe(e){var t=e.points;return CK(e)+sU(t.getItem(t.numberOfItems-1),t.getItem(0))}function PK(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return bBe(e);case"rect":return _Be(e);case"line":return SBe(e);case"polyline":return CK(e);case"polygon":return MBe(e)}}function ABe(e){var t=PK(e);return e.setAttribute("stroke-dasharray",t),t}function EBe(e){for(var t=e.parentNode;Ei.svg(t)&&Ei.svg(t.parentNode);)t=t.parentNode;return t}function DK(e,t){var i=t||{},r=i.el||EBe(e),n=r.getBoundingClientRect(),s=Fu(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function TBe(e,t){var i=Ei.str(e)?MK(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:DK(i),totalLength:PK(i)*(r/100)}}}function CBe(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=DK(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function Vj(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=TK(Ei.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Ei.str(e)||t?r.split(i):[]}}function RK(e){var t=e?SC(Ei.arr(e)?e.map(kj):kj(e)):[];return _C(t,function(i,r,n){return n.indexOf(i)===r})}function IK(e){var t=RK(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:EK(i)}}})}function PBe(e,t){var i=eU(t);if(/^spring/.test(i.easing)&&(i.duration=_K(i.easing)),Ei.arr(e)){var r=e.length,n=r===2&&!Ei.obj(e[0]);n?e={value:e}:Ei.fnc(t.duration)||(i.duration=t.duration/r)}var s=Ei.arr(e)?e:[e];return s.map(function(a,o){var l=Ei.obj(a)&&!Ei.pth(a)?a:{value:a};return Ei.und(l.delay)&&(l.delay=o?0:t.delay),Ei.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return MC(a,i)})}function DBe(e){for(var t=_C(SC(e.map(function(s){return Object.keys(s)})),function(s){return Ei.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var c in o)Ei.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<t.length;n++)r(n);return i}function RBe(e,t){var i=[],r=t.keyframes;r&&(t=MC(DBe(r),t));for(var n in t)Ei.key(n)&&i.push({name:n,tweens:PBe(t[n],e)});return i}function IBe(e,t){var i={};for(var r in e){var n=XO(e[r],t);Ei.arr(n)&&(n=n.map(function(s){return XO(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function LBe(e,t){var i;return e.tweens.map(function(r){var n=IBe(r,t),s=n.value,a=Ei.arr(s)?s[1]:s,o=Cd(a),l=rU(t.target,e.name,o,t),c=i?i.to.original:l,u=Ei.arr(s)?s[0]:c,h=Cd(u)||Cd(l),d=o||h;return Ei.und(a)&&(a=c),n.from=Vj(u,d),n.to=Vj(nU(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=JN(n.easing,n.duration),n.isPath=Ei.pth(s),n.isColor=Ei.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var LK={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function OK(e,t){var i=IK(e);i.forEach(function(r){for(var n in t){var s=XO(t[n],r),a=r.target,o=Cd(s),l=rU(a,n,o,r),c=o||Cd(l),u=nU(TK(s,c),l),h=iU(a,n);LK[h](a,n,u,r.transforms,!0)}})}function OBe(e,t){var i=iU(e.target,t.name);if(i){var r=LBe(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function zBe(e,t){return _C(SC(e.map(function(i){return t.map(function(r){return OBe(i,r)})})),function(i){return!Ei.und(i)})}function zK(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var Hj=0;function BBe(e){var t=WO(wK,e),i=WO(KN,e),r=RBe(i,e),n=IK(e.targets),s=zBe(n,r),a=zK(s,i),o=Hj;return Hj++,MC(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var jl=[],Gj=[],FE,NBe=function(){function e(){FE=requestAnimationFrame(t)}function t(i){var r=jl.length;if(r){for(var n=0;n<r;){var s=jl[n];s.paused?(jl.splice(n,1),r-=1):(s.tick(i),n++)}e()}else FE=cancelAnimationFrame(FE)}return e}();function UBe(e){document.hidden?(jl.forEach(function(t){return t.pause(e.timeStamp)}),Gj=jl.slice(0),Hn.running=jl=[]):Gj.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",UBe);function Hn(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(E){var I=window.Promise&&new Promise(function(P){return o=P});return E.finished=I,I}var c=BBe(e);l(c);function u(){var E=c.direction;E!=="alternate"&&(c.direction=E!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(I){(I.loop===1||I.loop%2===0)&&(I.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(E){return E.reversed=!1})}function d(E){return c.reversed?c.duration-E:E}function f(){t=0,i=d(c.currentTime)*(1/Hn.speed)}function m(E,I,P=!1){I&&(c.reversed?I.seek(I.duration*I.loop-(E-I.timelineOffset-I.pingPongDelayCorrection),P):I.seek(E-I.timelineOffset-I.startOnceDelay-I.pingPongDelayCorrection,P))}function v(E,I=!1){if(c.reversed)for(var P=a;P--;)m(E,s[P],I);else for(var C=0;C<a;C++)m(E,s[C],I)}function g(E){var ve,xe,be,Me,Te,ae,Ce,Ie,Be,Ve;var I=0,P=c.animations,C=P.length;for(c.direction!=="alternate"&&((ve=c.parent)==null?void 0:ve.direction)==="alternate"?((xe=c.parent)==null?void 0:xe.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((be=c.parent)!=null&&be.reversed&&c.direction==="alternate"?E=c.duration-c.delay+c.endDelay-E:E=c.duration+c.delay-c.endDelay-E):A(!1,(Me=c.parent)==null?void 0:Me.rewind,c.rewind,(Te=c.parent)==null?void 0:Te.reversePlayback,c.reversePlayback)&&((ae=c.parent)!=null&&ae.reversed&&c.direction==="alternate"?E=c.duration-c.delay+c.endDelay-E:E=c.duration+c.delay-c.endDelay-E);I<C;){var L=P[I],z=L.animatable,F=L.tweens,G=F.length-1,N=F[G];G&&(N=_C(F,function(We){return E<We.end})[0]||N);let lt;(Ce=c.parent)!=null&&Ce.reversed&&c.direction==="alternate"?lt=Vc(E-N.start-N.endDelay,0,N.duration)/N.duration:lt=Vc(E-N.start-N.delay,0,N.duration)/N.duration;for(var q=isNaN(lt)?1:N.easing(lt),ie=N.to.strings,Q=N.round,W=[],ee=N.to.numbers.length,K=void 0,j=0;j<ee;j++){var $=void 0;let We,je;c.direction!=="alternate"?((Ie=c.parent)==null?void 0:Ie.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(We=N.to.numbers[j],je=N.from.numbers[j]||0):(je=N.to.numbers[j],We=N.from.numbers[j]||0):A(!0,(Be=c.parent)==null?void 0:Be.rewind,c.rewind,(Ve=c.parent)==null?void 0:Ve.reversePlayback,c.reversePlayback)?(We=N.to.numbers[j],je=N.from.numbers[j]||0):(je=N.to.numbers[j],We=N.from.numbers[j]||0),N.isPath?$=CBe(N.value,q*je):$=We+q*(je-We),Q&&(N.isColor&&j>2||($=Math.round($*Q)/Q)),W.push($)}var se=ie.length;if(!se)K=W[0];else{K=ie[0];for(var re=0;re<se;re++){ie[re];var he=ie[re+1],oe=W[re];isNaN(oe)||(he?K+=oe+he:K+=oe+" ")}}LK[L.type](z.target,L.property,K,z.transforms),L.currentValue=K,I++}}function x(E){c[E]&&!c.passThrough&&c[E](c)}function S(){c.remaining&&c.remaining!==!0&&c.remaining--}let _={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function A(E,I,P,C,L){return _[E<<4|I<<3|P<<2|C<<1|L]}function T(E,I=!1){var F;var P=c.duration;let C=c.delay,L=P-c.endDelay;(F=c.parent)!=null&&F.reversed&&c.direction==="alternate"&&(C=c.endDelay,L=P-c.delay);var z=d(E);if(c.progress=Vc(z/P*100,0,100),I||(c.reversePlayback=z<c.currentTime),a&&v(z,I),!c.began&&c.currentTime>=0&&(c.began=!0,x("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,x("loopBegin")),(c.reversed||z>=0)&&z<=C&&c.currentTime!==0&&(g(0),x("change")),(z>=L&&c.currentTime!==P+c.pingPongDelayCorrection||!P)&&(g(P),x("change")),z>C&&z<L?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,x("changeBegin")),g(z),x("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,x("change"),a&&x("timelineChangeComplete")):c.began&&z>L&&x("changeComplete"),c.currentTime=Vc(z,0,P+c.pingPongDelayCorrection),c.began&&x("update"),E>=P)if(S(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,x("loopComplete"),x("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?t+=c.duration/Hn.speed:t+=c.duration;for(let G of s)G.setStartTime(0),G.remaining=G.loop;x("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var E=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=E==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var I=a;I--;)c.children[I].reset();g(c.reversed?c.duration:0)},c.setStartTime=function(E){t=E},c.set=function(E,I){return OK(E,I),c},c.tick=function(E){r=E,t||(t=r),T((r+(i-t))*Hn.speed)},c.seek=function(E,I=!1){T(E-t,I)},c.pause=function(E){c.paused=!0,a&&(n=E??performance.now())},c.play=function(E){!c.paused||(c.completed&&c.reset(),c.paused=!1,jl.push(c),a&&n!==void 0&&(t+=(E??performance.now())-n),FE||NBe())},c.reverse=function(){u(),c.completed=!c.reversed,f()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function jj(e,t){for(var i=t.length;i--;)$N(e,t[i].animatable.target)&&t.splice(i,1)}function FBe(e){for(var t=RK(e),i=jl.length;i--;){var r=jl[i],n=r.animations,s=r.children;jj(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;jj(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function kBe(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?JN(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",c=a==="last",u=Ei.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,f=Cd(u?e[1]:e)||0,m=t.start||0+(u?h:0),v=[],g=0;return function(x,S,_){if(o&&(a=0),l&&(a=(_-1)/2),c&&(a=_-1),!v.length){for(var A=0;A<_;A++){if(!n)v.push(Math.abs(a-A));else{var T=l?(n[0]-1)/2:a%n[0],E=l?(n[1]-1)/2:Math.floor(a/n[0]),I=A%n[0],P=Math.floor(A/n[0]),C=T-I,L=E-P,z=Math.sqrt(C*C+L*L);s==="x"&&(z=-C),s==="y"&&(z=-L),v.push(z)}g=Math.max.apply(Math,v)}r&&(v=v.map(function(G){return r(G/g)*g})),i==="reverse"&&(v=v.map(function(G){return s?G<0?G*-1:-G:Math.abs(g-G)}))}var F=u?(d-h)/g:h;return m+F*(Math.round(v[S]*100)/100)+f}}function VBe(e){e===void 0&&(e={});var t=Hn(e);return t.duration=0,t.add=function(i,r){var n=jl.indexOf(t),s=t.children;n>-1&&jl.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=MC(i,WO(KN,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=Ei.und(r)?c:nU(r,c),a(t);var u=Hn(l);a(u),s.push(u),u.parent=t;var h=zK(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}Hn.version="3.2.0";Hn.speed=1;Hn.running=jl;Hn.remove=FBe;Hn.get=rU;Hn.set=OK;Hn.convertPx=tU;Hn.path=TBe;Hn.setDashoffset=ABe;Hn.stagger=kBe;Hn.timeline=VBe;Hn.easing=JN;Hn.penner=SK;Hn.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var BK=Hn,Wj=new k,Xj=new k,qj=new Ai;function HBe(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*e.w+r*t.w,i.x=u*e.x+r*t.x,i.y=u*e.y+r*t.y,i.z=u*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function ca(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Gt.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function aU(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||aN(c,u)))return{update:h=>{c.forEach((d,f)=>{let m=Gt.lerp(d,u[f],h);t[e][f]=s?Math.trunc(m):m})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function a2(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function Yj(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?a2(new k,s,n):o.clone(),c=a2(new k,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function Qj(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function o2(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof Ee),c=o instanceof Ee?o:new Ee().fromArray(o),u=s?Qj(new Ee,s,n):c.clone(),h=Qj(new Ee,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function GBe(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new St().fromArray(n):a.clone(),l=new k,c=new Ai,u=new k;o.decompose(l,c,u);let h=new St().fromArray(s),d=new k,f=new Ai,m=new k;if(h.decompose(d,f,m),!o.equals(h))return{update:v=>{qj.slerpQuaternions(c,f,v),Wj.lerpVectors(l,d,v),Xj.lerpVectors(u,m,v),a.compose(Wj,qj,Xj)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,f,m)}}}function jBe(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new fi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new fi().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{var d,f;u.lerpColors(l,c,h),(f=(d=t[e])==null?void 0:d.copy)==null||f.call(d,u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function cE(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new ma(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new ma(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new ma(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Gt.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function Up(e,t,i,r,n){if(typeof t[e]=="number")return ca(e,t,i??{},r,n);if(Array.isArray(t[e]))return aU(e,t,i??{},r,n)}function WBe(e,t,i,r){var o,l,c,u;let n=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??e.zoom,d=a;h!==d&&n.push({update:f=>{e.zoom=Gt.lerp(h,d,f),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=ca("targetOffset",e,t,i,r);h&&n.push(h)}return n}function XBe(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Og.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[Gt.lerp(n[0],s[0],o),Gt.lerp(n[1],s[1],o),Gt.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function qBe(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return fQ.forEach(l=>{let c=Up(l,n,s,a,r);c&&o.push(c)}),o}function YBe(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof p_){let l=XBe(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Xu(s,m3),Xu(a,m3)),m3.forEach(c=>{let u=Up(c,l,a,o,r);u&&n.push(u)}),e instanceof jN){Object.assign(l,{extrusion:{...s.extrusion}});let c=qBe(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function QBe(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=ca("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=jBe("color",e,t,i,r);s&&n.push(s)}return n}function ZBe(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...Zj(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...Zj(e.material,s,a,r))}return n}function Zj(e,t,i,r){var a;let n=[],s=Ry(i,r)||!!t.layers&&Ry(t,r);n.push(sNe(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!uQ.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),f;if(h==="colors")f=rNe(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(f=iNe(o,l,c,h));else if(typeof d=="number")f=KBe(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof Ee?f=JBe(o,l,c,h):d instanceof k?f=$Be(o,l,c,h,r):d instanceof ma?f=tNe(o,l,c,h,r):d instanceof fi?f=eNe(o,l,c,h,r):"isTexture"in d&&(f=nNe(o,l,c,h))}f&&(Array.isArray(f)?n.push(...f):n.push(f))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return n}function KBe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{e.setValue(r,Gt.lerp(o,l,c))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function JBe(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new Ee().fromArray(t[r]):n.clone(),a=new Ee().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function $Be(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?a2(new k,a,n):s.clone(),c=a2(new k,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function eNe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new fi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new fi().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function tNe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new fi().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new ma(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function iNe(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return aN(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=Gt.lerp(h,d,l)}e.setValue(r,c)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function rNe(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];IT.isEqual(c,u)||n.push({update:h=>{s[l].fromArray(IT.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function nNe(e,t,i,r="texture"){var g,x;if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=((g=t==null?void 0:t[r])==null?void 0:g.rotation)??0,a=((x=i[r])==null?void 0:x.rotation)??0;if(n&&s!==a)return{update:S=>{n.value=Gt.lerp(s,a,S)*Gt.DEG2RAD},start:()=>{n.value=s*Gt.DEG2RAD},end:()=>{n.value=a*Gt.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],f=[...c.offset],m=l.rotation??0,v=c.rotation??0;if(!_d.isEqual(u,d)||!_d.isEqual(h,f)||m!==v)return{update:S=>{o.repeat=_d.lerp(u,d,S),o.offset=_d.lerp(h,f,S),o.rotation=Gt.lerp(m,v,S),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=m,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...f],o.rotation=v,o.updateMatrix()}}}function sNe(e,t){return{update:()=>{e.transparent=t}}}var uR=new k,Kj=new Ss;function aNe(e,t,i,r,n){var m,v,g,x,S,_;let s=[],a,o,l,c,u,h,d,f;if(e instanceof qs?(a=o2("position",e,t,i,n),a&&s.push(a),l=ca("rotation",e,t,i,n),l&&s.push(l),c=o2("shear",e,t,i,n),c&&s.push(c)):(f={slide:((m=t.pathSnapping)==null?void 0:m.slide)??((v=e.updatedPathSnapping)==null?void 0:v.slide)??((g=e.dataPatched.pathSnapping)==null?void 0:g.slide)??0,offset:((x=t.pathSnapping)==null?void 0:x.offset)??((S=e.updatedPathSnapping)==null?void 0:S.offset)??((_=e.dataPatched.pathSnapping)==null?void 0:_.offset)??0},h=ca("slide",f,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),h&&s.push(h),d=ca("offset",f,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=Yj("position",e,t,i,n),a&&s.push(a),o=Yj("scale",e,t,i,n),o&&s.push(o),l=oNe(e,t,i,r,n),l&&s.push(l),u=GBe("hiddenMatrix",e,t,i),u&&s.push(u))),a||o||l||u||h||d){let A=e instanceof qs?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var T;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(T=e.parent)!=null&&T.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),zc(e)&&Sd(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,f))};s.push({update:A,start:A,end:A})}return s}function oNe(e,t,i,r,n){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Gt.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Gt.DEG2RAD);if(!a)return;let o=s?new k().fromArray(s):new k().setFromEuler(e.rotation),l=new k().fromArray(a);if(o.equals(l))return;let c=uR.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new Ai().setFromEuler(Kj.setFromVector3(o)),d=new Ai().setFromEuler(Kj.setFromVector3(l));return{update:f=>{HBe(h,d,e.quaternion,f)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{uR.lerpVectors(o,l,h),e.rotation.setFromVector3(uR)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function lNe(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;nQ.forEach(f=>{let m;f==="count"?m=ca("count",s.parameters,a,o,r,!0):m=Up(f,s.parameters,a??{},o,r),m&&n.push(m)});let l=cNe(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=uNe(s,a,o,r);c!=null&&c.length&&n.push(...c);let u=hNe(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=dNe(s,a,o,r);h!=null&&h.length&&n.push(...h);let d=fNe(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function cNe(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return sQ.forEach(l=>{let c=Up(l,a,n??{},s,r);c&&o.push(c)}),o}function uNe(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return aQ.forEach(l=>{let c=Up(l,o,n??{},s,r);c&&a.push(c)}),a}function hNe(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return oQ.forEach(l=>{let c;l==="count"?c=aU(l,o,n??{},s,r,!0):c=Up(l,o,n??{},s,r),c&&a.push(c)}),a}function dNe(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return lQ.forEach(l=>{let c;l==="count"?c=ca(l,o,n??{},s,r,!0):c=Up(l,o,n??{},s,r),c&&a.push(c)}),a}function fNe(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return cQ.forEach(l=>{let c=Up(l,o,n??{},s,r);c&&a.push(c)}),a}function pNe(e,t){return{update:()=>{e instanceof Hs&&(e.fill.enabled=t)}}}function mNe(e,t){return{update:()=>{e instanceof Hs&&(e.stroke.enabled=t)}}}function gNe(e,t){return{update:()=>{e instanceof Hs&&(e.dropShadow.enabled=t)}}}function vNe(e,t){return{update:()=>{e instanceof Hs&&(e.innerShadow.enabled=t)}}}function yNe(e,t){return{update:()=>{e instanceof Hs&&(e.backgroundBlur.enabled=t)}}}function xNe(e,t){return{update:()=>{e instanceof Hs&&(e.layerBlur.enabled=t)}}}function wNe(e,t,i,r,n){let s=[],a,o,l,c,u,h,d,f,m,v,g,x,S,_,A;if("width"in e&&(a=ca("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=ca("height",e,t,i,n),o&&s.push(o)),e instanceof Hs||e instanceof Yu){let T={...t.fill},E={...i.fill};T.enabled!==void 0&&T.enabled!==E.enabled&&(s.push(pNe(e,!0)),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),l=cE("color",e.fill,T,E,n),l&&s.push(l)}if(e instanceof Hs){let T={...t.stroke},E={...i.stroke};(T.enabled||E.enabled)&&(s.push(mNe(e,!0)),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),c=cE("color",e.stroke,T,E,n),c&&s.push(c),u=ca("thickness",e.stroke,T,E,n),u&&s.push(u)}if(e instanceof Hs){let T={...t.dropShadow},E={...i.dropShadow};(T.enabled||E.enabled)&&(s.push(gNe(e,!0)),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),h=cE("color",e.dropShadow,T,E,n),h&&s.push(h),d=ca("blurRadius",e.dropShadow,T,E,n),d&&s.push(d),m=ca("spread",e.dropShadow,T,E,n),m&&s.push(m),f=o2("offset",e.dropShadow,T,E,n),f&&s.push(f)}if(e instanceof Hs){let T={...t.innerShadow},E={...i.innerShadow};(T.enabled||E.enabled)&&(s.push(vNe(e,!0)),T.enabled||Object.assign(T,{enabled:!0,color:{...T.color,a:0}}),E.enabled||Object.assign(E,{enabled:!0,color:{...E.color,a:0}})),v=cE("color",e.innerShadow,T,E,n),v&&s.push(v),g=ca("blurRadius",e.innerShadow,T,E,n),g&&s.push(g),S=ca("spread",e.innerShadow,T,E,n),S&&s.push(S),x=o2("offset",e.innerShadow,T,E,n),x&&s.push(x)}if(e instanceof Hs||e instanceof Yu){let T={...t.backgroundBlur},E={...i.backgroundBlur};(T.enabled||E.enabled)&&(s.push(yNe(e,!0)),T.enabled||Object.assign(T,{enabled:!0,radius:0}),E.enabled||Object.assign(E,{enabled:!0,radius:0})),_=ca("radius",e.backgroundBlur,T,E,n),_&&s.push(_)}if(e instanceof Hs){let T={...t.layerBlur},E={...i.layerBlur};(T.enabled||E.enabled)&&(s.push(xNe(e,!0)),T.enabled||Object.assign(T,{enabled:!0,radius:0}),E.enabled||Object.assign(E,{enabled:!0,radius:0})),A=ca("radius",e.layerBlur,T,E,n),A&&s.push(A)}if(e instanceof Yu||e instanceof K_){let T=aU("cornerRadius",e,t,i,n);T&&s.push(T)}return s}function Jj(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...aNe(e,t,i,n,r)),e instanceof qs?s.push(...wNe(e,t,i,n,r)):(e.data.visible&&s.push(...lNe(e,t,i,r)),zc(e)?(e instanceof ss&&e.data.visible&&s.push(...YBe(e,t,i,r)),e.data.visible&&s.push(...ZBe(e,t,i,r))):sIe(e)?e.data.visible&&s.push(...QBe(e,t,i,r)):nIe(e)&&s.push(...WBe(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var $j=new k;function oU(e,t,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=wg.patch(o,c)}tW(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),eW(e)};e.scene.traverse2D(n),e.traverseChildren(a=>{var u,h,d,f,m,v;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel($j,!0),(f=a.rigidBody)==null||f.setAngvel($j,!0)),!tr.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===zx)return;let c=!1;r.some(g=>{var x;return(x=e.scene.find(o))==null?void 0:x.isDescendantOf(g)})?c=!0:((m=l.physics)==null?void 0:m.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let g of l.states){let x={...g.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(g.data.position!==void 0&&delete x.position,g.data.rotation!==void 0&&delete x.rotation,g.data.hiddenMatrix!==void 0&&delete x.hiddenMatrix),a.states||(a.states={}),a.states[g.id]=vg.patch(l,x)}tW(e.scene,a,null,t,l.events.find(g=>g.data.type==="Follow"||g.data.type==="LookAt")!==void 0),a instanceof La&&a.frame&&(a.frame.traverse(g=>n(g)),(v=a.uiCanvas)==null||v.applySize())}),eW(e),e.frame&&(e.frame.traverse(a=>n(a)),(s=e.uiCanvas)==null||s.applySize())}function eW(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function tW(e,t,i,r,n=!1){if(t instanceof ss&&!(t instanceof Zg)&&t.removeInteractionGeometry(r),t instanceof qs?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof ss&&t.updateGeometryGroupsIfNeeded(),t instanceof Na&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof qs)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function NK(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=Xf.linear;break;case 1:i=Xf.ease;break;case 2:i=Xf.easeIn;break;case 3:i=Xf.easeOut;break;case 4:i=Xf.easeInOut;break;default:i=Xf.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function qO(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var bNe={type:"beginState"},_Ne={type:"completeState",isfromEntity:!1},iW=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof qs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Na&&o.dispatchEvent(bNe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof qs||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Na&&o.dispatchEvent(_Ne)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=Jj(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=kE(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=kE(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=kE(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...qO(r),...NK(r),change:this.onChange},this.callback=Jj(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},UK=class extends va{constructor(e,t,i,r,n){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=kE(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&JH(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=qO(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=BK.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],f;u===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(f=void 0,this.object instanceof Na&&(this.object.wasMovedByUser=!1)):f=h.data.state===void 0?this.currentState:h.data.state;let m=new iW(this.object,f,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(m.params,{startOnceDelay:0}),this.tweens[u]=m,this.timeline.add(m.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],f;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(f=void 0,this.object instanceof Na&&(this.object.wasMovedByUser=!1)):f=h.data.state===void 0?this.currentState:h.data.state;let m=new iW(this.object,f,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(m.params,{startOnceDelay:0}),this.tweens[u-1]=m,this.timeline.add(m.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if($r(this.shared,this.condition)===!1||JH(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=qO(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof qs?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if($r(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if($r(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function kE(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var SNe={type:"beginState"},rW={type:"completeState",isfromEntity:!1},nW={type:"requestRender"},FK=class extends va{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new k,this.posEnd=new k,this.qStart=new Ai,this.qEnd=new Ai,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=BK({targets:i,t:1,...NK(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(SNe));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(nW),i.t===1&&r.dispatchEvent(rW)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if($r(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if($r(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(rW),this.page.activeCamera.dispatchEvent(nW))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function kK(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=KEe(t);return i&&i>2?i:2}return 2}var VK=class extends va{constructor(e,t,i,r,n){var l,c,u;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=kK(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if($r(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Gt.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if($r(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},HK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if($r(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),oU(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},GK=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=$r(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=jQ(this.data.expression,this.shared,fa.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},jK=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if($r(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},MNe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if($r(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(AO(e))})}dispose(){}},ANe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){var e;if($r(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function $r(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=jQ(t.expression,e,"boolean");return t.negate?!i:!!i}function ls(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?Da[e.type].includes("Audio")&&a.Audio.push(new gK(c,u,s,r,l)):u.type==="Video"&&!(s instanceof qs)?Da[e.type].includes("Video")&&a.Video.push(new XK(c,u,s,r,l)):u.type==="Particles"?Da[e.type].includes("Particles")&&a.Particles.push(new vK(u,i,r,l)):u.type==="Link"?Da[e.type].includes("Link")&&a.Link.push(new hBe(u,n.controlsManager,r,l)):u.type==="Create"?Da[e.type].includes("Create")&&a.Create.push(new qK(u,i,n.controlsManager,r,l)):u.type==="Destroy"?Da[e.type].includes("Destroy")&&a.Destroy.push(new yK(u,i,n.controlsManager,r,l)):u.type==="Reset"?Da[e.type].includes("Reset")&&a.Reset.push(new xK(u,i,r,n,l)):u.type==="Transition"?Da[e.type].includes("Transition")&&a.Transition.push(new UK(e.type,u,i,r,l)):u.type==="SwitchCamera"?Da[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new FK(u,i,r,l)):u.type==="SceneTransition"?Da[e.type].includes("SceneTransition")&&a.SceneTransition.push(new HK(u,i,n,r,l)):u.type==="Animation"?Da[e.type].includes("Animation")&&a.Animation.push(new VK(u,i,n.animationControls,r,l)):u.type==="SetVariable"?Da[e.type].includes("SetVariable")&&a.SetVariable.push(new GK(u,i,r,l)):u.type==="DynamicVariablePlay"?Da[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new jK(u,i,r,l)):u.type==="Conditional"?Da[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?Da[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new MNe(u,i,r,l)):u.type==="UserAPI"&&Da[e.type].includes("UserAPI")&&a.UserAPI.push(new ANe(u,i,r,l))}catch{}};return t.forEach(o()),a}function Xs(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof gK||i instanceof XK||i instanceof vK||i instanceof VK||i instanceof UK||i instanceof qK||i instanceof yK||i instanceof FK||i instanceof HK||i instanceof xK||i instanceof GK||i instanceof jK)&&i.dispose()})})}function ENe(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var WK=new Map,yb=new Map,qy=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=ENe(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,j_&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),yb.has(i.uuid)?yb.get(i.uuid).push(this):yb.set(i.uuid,[this]),WK.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},YO=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=WK.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=yb.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...yb.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},XK=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new qy(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new YO(t);else throw new Error("Missing property")}dispatchBasic(){if($r(this.shared,this.condition)===!1)return!1;this.interaction instanceof qy?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if($r(this.shared,this.condition)===!1)return!1;this.interaction instanceof qy?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},sW=(()=>{let e,t,i,r;function n(o){!e&&!aW()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let f=c[d];f.userData.createdTime===void 0&&(f.userData.createdTime=o),f.userData.lifetime===void 0&&f.userData.quantity===void 0||f.userData.lifetime&&o-f.userData.createdTime<f.userData.lifetime||f.userData.quantity&&u[f.userData.actionId]<=f.userData.quantity?(f.userData.velocity&&(f.position.addScaledVector(f.userData.velocity,l/1e3),f.updateMatrix(),r()),d++):(u[f.userData.actionId]>f.userData.quantity&&u[f.userData.actionId]--,c.splice(d,1),f.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&f.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(f.rigidBody)):(f.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(m=>m.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){aW()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function aW(){return!!document&&document.hidden}var oW=new Ai,TNe=new k,CNe=new k,qK=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Gt.generateUUID(),this.dispatch=()=>{if($r(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if($r(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=mTe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new pa(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),sW(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,f;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof Vl)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof pa)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof Vl)return;a instanceof pa?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new k().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(TNe,oW,CNe),l.applyQuaternion(oW),this.data.velocity.some(m=>m!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(m=>m!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((f=o.dataPatched.physics)==null?void 0:f.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");sW(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},YK=200,hR=.02,dR=.3,PNe=65;new k;var lW=new k,cW=new k,DNe=new k,eo=new k,Do=new k,kf=new k,fR=new St,uW=new St,RNe=new St;new St;var Cc=new Ai,Kh=new Ai,Mu=new Ss(0,0,0,"YXZ"),INe=new k(1,0,0),Pc=new k(0,1,0),LNe=new k(0,0,1),hW=new k(1,1,1);new jo;var ONe=1,zNe=.025,BNe=16e-6,dW=12,NNe=20,Us=new Gl,Ll=new Gn,UNe={type:"requestRender"},FNe={type:"updateMatrix"},fW=Math.PI/6,QO=class extends va{constructor(e,t,i,r,n,s,a,o,l){var m;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new St,this.target0=new k,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=YK,this.euler0=new Ss(0,0,0,"YXZ"),this.position0Cam=new k,this.quat0Cam=new Ai,this.scale0Cam=new k,this.hiddenMatrix0Cam=new St,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Gl(new k(0,-40,0),new k(0,40,0)),matrix:new St,position:new k,rotation:new Ai},this.euler=new Ss(0,0,0,"YXZ"),this.eulerDelta=new k,this.lastPosition=new k,this.lastCameraQuaternion=new Ai,this.lastCameraPosition=new k,this.PI_2=Math.PI/2,this.prevMouse=new Ee,this.velocityTarget=new k,this.velocity=new k,this.directionXZ=new k,this.rotVelocityStick=new k,this.rotVelocityTarget=new k,this.rotVelocity=new k,this.rotDirection=new k,this.nonColliderRotOffset=new St,this.nonColliderPosOffset=new St,this.firstPointerId=-1,this.rot=new k,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new St,this.objectToTarget=new k,this.objectToTarget0=new k,this.objectToCamXZ=new k,this.objectToCamXZ0=new k,this.targetToCamera=new k,this.targetToCamera0=new k,this.cameraPolarAxis0=new k,this.targetPos=new k,this.targetQuat=new Ai,this.lerpFactorPos=new k().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Ai,this.objXZQuatInv=new Ai,this.objXZRotMat=new St,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new k,this.pushedVelocity=new k,this.groundYRotation=0,this.objectRealQuat=new Ai,this.colliderWorldQuat=new Ai,this.groundNormal=new k,this.groundTilt=new Ai,this.groundTiltInv=new Ai,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new k,this.quaternion=new Ai,this.scale=new k,this.initialAction=!0,this.onPointerDown=v=>{var g;!(v.target===this.domElement||v.target instanceof HTMLElement&&v.target.tagName==="SPLINE-VIEWER"&&((g=v.target.shadowRoot)!=null&&g.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=v.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!dl&&!NH&&this.domElement.requestPointerLock(),this.prevMouse.set(v.clientX,v.clientY))},this.onPointerUp=v=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),v.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=v=>{if(v.pointerId!==this.firstPointerId)return;let g=v.clientX-this.prevMouse.x,x=v.clientY-this.prevMouse.y;this.prevMouse.set(v.clientX,v.clientY),v.pointerType==="mouse"&&this.rotBy!=="keys"&&(NH&&ATe<15.5&&!dl?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-x*this.mouseOrbitSensitivity):(this.eulerDelta.y=-v.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-v.movementY*this.mouseOrbitSensitivity)),v.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-x*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=v=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?QO.isLocked=!0:QO.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let v in this.movementState)this.movementState[v]=0},this.onKeyDown=v=>{!(v.target instanceof HTMLInputElement)&&(v.code==="ArrowLeft"||v.code==="ArrowUp"||v.code==="ArrowRight"||v.code==="ArrowDown"||v.code==="Space")&&v.preventDefault();for(let g of this.keyAssignments)if(v.key.toUpperCase()===g[1]||v.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=v=>{for(let g of this.keyAssignments)if(v.key.toUpperCase()===g[1]||v.key===g[1]||v.code.slice(3,v.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(v,g)=>{for(let x=2;x<4;x++){let S=v.axes[x];g===0?x===2?this.movementState.movePosX=S:this.movementState.movePosZ=S:(v.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,x===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(S)>=.3&&(this.vrEulerYOffset+=S<0?1:-1),this.movementState.rotPosY=S):this.moveMode==="fly"&&(this.movementState.moveNegY=S))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((m=this.camera)==null?void 0:m.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let v=new k(0,0,-1).applyQuaternion(this.camera.quaternion),g=new k().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let x,S;Math.abs(v.y)<1e-6?(g.y=0,v.y=0,S=g.projectOnVector(v)):g.y/v.y>0?S=v.multiplyScalar(g.y/v.y):S=v.multiplyScalar(g.length()),this.targetToCamera0.copy(S).negate(),x=this.camera.position.clone().add(S),this.objectToTarget0.subVectors(x,this.position);let _=new Ss().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-_.x,_.x=0,_.z=0,_.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(_)}if(this.object instanceof Na&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*ONe,this.speedOrbit=(i.speedRotate??100)*zNe,this.mouseOrbitSensitivity=(i.speedRotate??100)*BNe,this.keyAssignments=i.keyAssignments.map(v=>{let g=[v[0],v[1]];return g[1]==="▲"?g[1]="ArrowUp":g[1]==="◀"?g[1]="ArrowLeft":g[1]==="▼"?g[1]="ArrowDown":g[1]==="▶"?g[1]="ArrowRight":g[1]==="⇧"?g[1]="Shift":g[1]==="↵"?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]==="⌘"?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),i.rotBy==="mouse"){let v;v=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),v!==-1&&(this.keyAssignments[v][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??dx.defaultData.gravity)*dW,this.usePhysics=this.gloabalPhysics.usePhysics??dx.defaultData.usePhysics,this.jumpPower=i.jumpPower*NNe,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??HT.defaultDataThirdPerson.orientWith,this.slopeThresh=PNe*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*hR/this.pixelsPerMeter,this.stepThresh=i.collider.height*dR/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*hR/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*dR/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*hR/this.pixelsPerMeter,this.stepThresh=i.collider.height*dR/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new k().fromArray(i.collider.position),d=new Ai().setFromEuler(new Ss().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,hW),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let f=i.navmesh.destinationHelperRadius*2;if(f>0){let v=new ti;v.push({fi:0,data:{...ks.defaultData("light","phong"),alpha:0},id:"layer1"}),v.push({fi:0,data:{...ks.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let g=new IN({layers:v},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new qr(_Q.create({parameters:{width:f,height:f/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new Ss().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Na?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},VT.list.forEach(i=>{this.actions[i]=ls({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Xs(this.actions.idle),Xs(this.actions.move),Xs(this.actions.run),Xs(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return eo.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,f,m,v;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let g=Do.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*dW),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),x=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,g,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(x){this.onObject=!0,this.groundNormal.set(x.normal2.x,x.normal2.y,x.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=x.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let S=x.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let _ of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(_.rigidBody===S&&_.userData.isFollowingObj!==this.object.uuid){(_.hasNonUniformScale?_.matrixWorldRigid:_.matrixWorld).decompose(eo,Kh,Do),this.groundVelocity.subVectors(eo,_.prevT),this.object.getWorldPosition(Do).add(this.collider.position).sub(eo),this.groundYRotation=Mu.setFromQuaternion(Kh).y-_.prevR.y,kf.copy(Do).applyAxisAngle(Pc,this.groundYRotation),this.groundVelocity.add(kf.sub(Do)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let g=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let x=eo.subVectors(this.path[1],this.position),S=Do.subVectors(this.path[1],this.path[0]);x.dot(S)<0?this.path.shift():(this.directionXZ.x=S.x,this.directionXZ.z=S.z),g.opacity=g.userData.opacity0}else g.opacity-=.05*g.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=DNe.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let g=Do.copy(a);g.y=0,a.set(0,a.y,g.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let g=eo;this.camera.getWorldDirection(g);let x=kf.copy(Pc).multiplyScalar(g.dot(Pc));g.sub(x);let S=Do.copy(this.directionXZ);S.x*=-1,this.rot.y=g.angleTo(S)*(g.cross(S).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(Mu.setFromVector3(this.rot),this.moveMode==="walk"&&(Mu.x=0),a.applyEuler(Mu),s&&(Kh.setFromUnitVectors(Pc,this.groundNormal),a.applyQuaternion(Kh)),i){let g=Mu.set(0,this.vrEulerYOffset*fW,0);i.applyEuler(g),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let g=Do;this.pushedVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim){let S=kf.setFromMatrixPosition(x.matrixWorld).sub(x.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),_=x.rigidBody.collider(0).castCollider(S,this.object.rigidBody.collider(0),eo.copy(a).divideScalar(this.pixelsPerMeter),r,!1);S.multiplyScalar(this.pixelsPerMeter);let A=tr.is(x)?x:x.object;if(_!==null&&this.lastHitObj!==A){let T;x instanceof pa&&(T=x);let E=this.sharedGameControlGlobals.entityToCollisionEvents[A.uuid];if(E)for(let I of E)I.data.target==="character"&&(I.dispatch(T),A.dispatchEvent(KO));this.lastHitObj=A}if(_!==null){this.pushedVelocity.copy(S),g.copy(_.normal1).applyQuaternion(x.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let x=g.dot(a);x<0&&a.addScaledVector(g,-x),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(Pc,this.euler.y-this.euler0.y);let g=Do.copy(this.objectToCamXZ).normalize(),x=kf.copy(a).multiplyScalar(r);x.y=0;let S=x.sub(eo.copy(g).multiplyScalar(x.dot(g))).cross(g).y;this.euler.y-=Math.atan2(S,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Gt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Gt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Gt.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Mu.copy(t),Mu.y=0):(Mu.copy(this.euler),Mu.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Mu)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*fW),Cc.setFromAxisAngle(INe,this.rot.x),Kh.setFromAxisAngle(Pc,this.rot.y),Kh.multiply(Cc),Cc.setFromAxisAngle(LNe,this.rot.z),Kh.multiply(Cc),this.quaternion.copy(Kh),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let g=Do.copy(a).multiplyScalar(r/this.pixelsPerMeter),x=null;this.didHit=!1;let S=new k;for(let _=0;_<5;_++){let A=g.length(),T=kf.copy(g).normalize();if(x=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(S),this.colliderWorldQuat,T,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,A,!1,24,void 0,void 0,this.object.rigidBody),x!==null){this.didHit=!0;let E=this.sharedGameControlGlobals.colliderToEntity.get(x.collider.handle);if(E!==this.lastHitObj&&_===0){this.lastHitObj=E;let L=this.sharedGameControlGlobals.entityToCollisionEvents[E==null?void 0:E.uuid];if(L){for(let z of L)if(z.data.target==="character"){let F=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(x.collider.handle))._parent,G;if(E.cloner){for(let N of E.cloner.children)if(N.rigidBody===F){G=N;break}}z.dispatch(G),E.dispatchEvent(KO)}}}let I=lW.set(x.normal2.x,x.normal2.y,x.normal2.z).applyQuaternion(this.colliderWorldQuat),P=cW.copy(T).multiplyScalar(x.toi).dot(I),C=x.toi;if(C===0&&(this.position.y+=this.offset*this.pixelsPerMeter),P>this.offset&&(C=x.toi*(P-this.offset)/P,S.addScaledVector(T,C)),g.copy(T).multiplyScalar(A-C),Math.acos(-I.y)>this.slopeThresh){let L=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(S),z=kf.copy(x.witness2).applyQuaternion(this.colliderWorldQuat);z.y=0;let F=L.add(z);F.y+=this.stepThresh;let G=this.sharedGameControlGlobals.rapierWorld.castShape(F,this.colliderWorldQuat,g,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);G!==null&&G.toi===0&&(I.y=0,I.normalize())}g.addScaledVector(I,-g.dot(I))}else{_===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),S.add(g);break}}this.position.addScaledVector(S,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(eo.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(f=this.object.rigidBody)==null||f.setRotation(Cc.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let g=this.onObject?1:5,x=a.multiplyScalar(r/g);for(let S=0;S<g;S++)this.position.add(x),this.collisionAdjustment(r/g)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let g=this.objectToTarget.add(this.position),x=this.targetToCamera.add(g);fR.lookAt(x,g,Pc).setPosition(x),fR.decompose(this.targetPos,this.targetQuat,eo),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Gt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Gt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(FNe),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((v=(m=this.navMeshPathDest)==null?void 0:m.material)==null?void 0:v.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(UNe),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Cc.setFromAxisAngle(Pc,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Gt.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Gt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Gt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=eo.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=Kh.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){Pc.angleTo(e)*180/Math.PI<15||Pc.angleTo(e)*180/Math.PI>85?Cc.identity():Cc.setFromUnitVectors(Pc,e),this.groundTilt.slerp(Cc,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=cW.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=fR.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(eo,Cc,Do).compose(eo,Cc,hW);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Ll.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=uW.copy(a).invert(),l=RNe.copy(uW).multiply(i);Us.copy(this.collider.segment),Us.start.applyMatrix4(l),Us.end.applyMatrix4(l);let c=lW.copy(this.position).applyMatrix4(o);Ll.expandByPoint(Us.start),Ll.expandByPoint(Us.end),Ll.min.addScalar(-this.collider.radius),Ll.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(Us.end)},intersectsBounds:u=>u.intersectsBox(Ll),intersectsTriangle:u=>{let h=eo,d=Do,f=u.closestPointToSegment(Us,h,d);if(f<this.collider.radius){let m=this.collider.radius-f,v=d.sub(h).normalize(),g=kf.copy(c);g.addScaledVector(v,m);let x=g.applyMatrix4(a).sub(this.position);t.add(x),Us.start.addScaledVector(v,m),Us.end.addScaledVector(v,m)}}})}),Ll.makeEmpty(),Us.copy(this.collider.segment),Us.start.applyMatrix4(i),Us.end.applyMatrix4(i),Ll.expandByPoint(Us.start),Ll.expandByPoint(Us.end),Ll.min.addScalar(-this.collider.radius),Ll.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(Us.end)},intersectsBounds:s=>s.intersectsBox(Ll),intersectsTriangle:s=>{let a=eo,o=Do,l=s.closestPointToSegment(Us,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),Us.start.addScaledVector(u,c),Us.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},QK=QO;QK.isLocked=!1;var kNe=zp($X());function ZK(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,r=t[4]**2+t[5]**2+t[6]**2,n=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function ud(e,t){let i=new $t;if(t&&ZK(t))return i.setAttribute("position",new kt([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new kt([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=yC(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new kt(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var VNe=new St,HNe=new St,Au=[[0,0,0],[0,0,0],[0,0,0]];function KK(e){let t=e.elements;Au[0][0]=t[0],Au[0][1]=t[4],Au[0][2]=t[8],Au[1][0]=t[1],Au[1][1]=t[5],Au[1][2]=t[9],Au[2][0]=t[2],Au[2][1]=t[6],Au[2][2]=t[10];let{u:i,v:r}=(0,kNe.SVD)(Au),n=VNe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=HNe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var GNe=class extends Xq{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new Np({color:65280,linewidth:10}),t=new k(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new k(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new k().addVectors(t,i.multiplyScalar(r)),s=new $t;return s.setFromPoints([t,n]),new hT(s,e)}},JK=e=>e instanceof Wy||e instanceof Xy;function jNe(e,t){return e.distance-t.distance}function $K(e,t,i){if(!(!cd(t)||!t.visible)){zc(t)&&t.raycast(e,i);for(let r of t.children)$K(e,r,i)}}function VE(e,t,i,r=!1){if(!r&&!i.some(s=>l2(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>$K(e,s,n)),n.sort(jNe),n}function ZO(e){let t=[];if(e.length){let i=e[0].object;cd(i)&&t.push(i);let r=i.parent;for(;r;)JK(r)&&t.push(r),r=r.parent}return t}function hd(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function l2(e,t){if(zc(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(JK(t))return eJ(e,t)}function eJ(e,t){if(!(!cd(t)||!t.visible)){if(zc(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=eJ(e,i);if(r)return r}}}function WNe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function XNe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var qNe=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new GNe,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=WNe(t,i,this._domRect),this.pointerScreen=XNe(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Fa=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},lU=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],tJ=e=>{var t;return(t=lU.find(([i,r])=>r===e))==null?void 0:t[0]},J_=e=>{var t;return(t=lU.find(([i])=>i===e))==null?void 0:t[1]},YNe=(e,t)=>{let i=tJ(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},QNe=class extends Fa{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var r;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(r=this.splineEvents[tJ(e.eventName)])==null?void 0:r[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,r;if((i=t.data)!=null&&i.events.length){for(let[n,s]of lU)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(t):this.objectsPerEvents.set(n,[t]);let a={id:t.uuid,name:t.name},o=YNe(s,a),l=this.splineEvents[n];l?l[t.uuid]=o:this.splineEvents[n]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},ZNe=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=ls(t,t.actions,r,n,s,i)}disconnect(){Xs(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},KNe=class extends Fa{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=VE(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{wi.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{wi.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{wi.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{wi.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,u;if(!r||!n)return;let a=J_(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(u,h)=>{var f,m;if(!((f=u.data)!=null&&f.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let v of d){let g=this.eventsPerObjects[v];if(u.data.events.filter(({data:x})=>x.type===v&&x.disabled!==!0).forEach(({id:x,data:S})=>{try{let _=new ZNe(x,S,u,e,t,this.eventManager);_.actions.Video.length&&(this.hasVideoAction=!0),(S.type==="MouseDown"||S.type==="MouseUp"||S.type==="MousePress")&&(S.mode==="Canvas"||S.mode==="Window")?this.canvasMouseEvents.push(_):(g[u.uuid]?g[u.uuid].some(A=>A.id===_.id)||g[u.uuid].push(_):g[u.uuid]=[_],u instanceof Zg&&u.traverseChildren(A=>{var T;if(!A.visible)return!0;A instanceof ss&&((T=A.data.geometry.shapeBlendNode)==null?void 0:T.operation)!==2&&(g[A.uuid]?g[A.uuid].push(_):g[A.uuid]=[_])}))}catch{}}),((m=g[u.uuid])==null?void 0:m.length)&&(this.objectsPerTypes[v].push(u instanceof qs&&(v==="MouseDown"||v==="MouseUp"||v==="MousePress")?h:u),u instanceof Zg)){let x=this.objectsPerTypes[v];u.traverseChildren(S=>{if(!S.visible)return!0;S instanceof ss&&x.indexOf(S)===-1&&x.push(S)})}}};e.traverseEntity(u=>{var h;(u instanceof La||u instanceof Vs)&&((h=u.frame)==null||h.traverse(d=>{r(d,u)})),r(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(h=>!(h instanceof qs));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&hd(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=VE(i,r,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];ZO(h).forEach(f=>{f instanceof La&&hd(f,d,Object.keys(this.eventsPerObjects[e]),m=>{this.handleObjectMouseEventDispatch(m,e)}),this.eventsPerObjects[e][f.uuid]&&this.handleObjectMouseEventDispatch(f,e)})}}t||a.forEach(h=>{var f,m;let d=l2(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof La&&hd(h,[((f=d==null?void 0:d.uv)==null?void 0:f.x)??0,((m=d==null?void 0:d.uv)==null?void 0:m.y)??0],Object.keys(this.eventsPerObjects[e]),v=>{this.handleObjectMouseEventDispatch(v,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof qs)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=hd(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{n.push(u)})),s&&!c){let u=VE(a,o,r);n=ZO(u),u.forEach(h=>{var d,f;h.object instanceof La&&hd(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((f=h==null?void 0:h.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[t]),m=>{n.push(m)})})}else r.forEach(u=>{var d,f;let h=l2(a,u);h&&(n.push(u),u instanceof La&&hd(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((f=h==null?void 0:h.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[t]),m=>{n.push(m)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},JNe=new k,$Ne=new k,iJ=class{constructor(e,t,i,r,n){this.actionsIn=ls(e,e.inActions,i,r,n,t),this.actionsOut=ls(e,e.outActions,i,r,n,t)}disconnect(){Xs(this.actionsIn),Xs(this.actionsOut)}},eUe=class extends iJ{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=JNe.setFromMatrixPosition(this.objects[0].matrixWorld),u=$Ne.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(f=>f.dispatchConditional()),d.Particles.forEach(f=>f.dispatchConditional()),d.Video.forEach(f=>f.dispatchConditional()),d.Link.forEach(f=>f.dispatch()),d.Create.forEach(f=>f.dispatch()),d.Destroy.forEach(f=>f.dispatch()),d.Reset.forEach(f=>f.dispatch()),d.Transition.forEach(f=>{f.object.currentTransitionEvent!==this&&(f.object.currentTransitionEvent=this),f.init()}),d.Transition.forEach(f=>f.play()),d.Animation.forEach(f=>f.play()),d.SwitchCamera.forEach(f=>f.play()),d.SceneTransition.forEach(f=>f.dispatch()),d.SetVariable.forEach(f=>f.checkConditions()),d.SetVariable.forEach(f=>f.dispatch()),d.DynamicVariablePlay.forEach(f=>f.dispatch()),d.ClearLocalStorage.forEach(f=>f.dispatch()),d.UserAPI.forEach(f=>f.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},tUe=class extends iJ{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){gg(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),gg(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),gg(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),gg(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},iUe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new eUe(n,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new tUe(n,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Sw=new k,Vf=new k,Hm=new k,pW=new zo,rUe=.01,xr=new k,ws=new k,mW=new k,Sg=new Ai,pR=new Ss,nUe=new St,mR=new ns,ry=new k,Eu=new k,gR=.2;function vR(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var sUe=function(){let e=new St;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&vR(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?vR(n.position,t.limits):t.reference==="local"&&(Sg.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Sg),vR(n.position,t.limits),Sg.invert(),n.position.applyQuaternion(Sg),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(xr,n.quaternion,ws),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof mo&&Sd(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),aUe=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=ls(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=ls(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new k().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new k().setFromMatrixPosition(l.matrixWorld),pointStart:new k,pointEnd:new k,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new k().copy(l.position),quat0:new Ai().copy(l.quaternion),snapped:!1,orientationMatrix:new St,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Xs(this.actionsDrag),Xs(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},oUe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if(wi.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||tr.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(xr,Sg,ws),pR.setFromQuaternion(Sg),d.prevR===void 0?(d.prevR=pR.clone(),d.prevT=xr.clone()):(d.prevR.copy(pR),d.prevT.copy(xr)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if(wi.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(wi.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||tr.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof Wy)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===d.object.uuid||n.scene.find(f).isAncestorOf(d.object.uuid))))[0]),h){let d=mW.copy(h.face.normal).applyMatrix3(mR.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){xr.copy(d).applyMatrix3(mR.setFromMatrix4(u.obj.matrixWorld).transpose());let f=u.obj;xr.x>gR?ws.x=-f.recursiveBBox.min.x:xr.x<-.2&&(ws.x=-f.recursiveBBox.max.x),xr.y>gR?ws.y=-f.recursiveBBox.min.y:xr.y<-.2&&(ws.y=-f.recursiveBBox.max.y),xr.z>gR?ws.z=-f.recursiveBBox.min.z:xr.z<-.2&&(ws.z=-f.recursiveBBox.max.z),ws.applyMatrix3(mR.invert())}else ws.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(ws)}this.activeEvent.data.autoOrient&&(xr.set(0,1,0).cross(d),xr.length()<1e-4&&xr.set(-1,0,0).cross(d),ws.crossVectors(mW,xr),u.orientationMatrix.makeBasis(xr,ws,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new aUe(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(Vf),Vf.negate();let a=Sg.identity();switch(r==="parent"?nUe.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(xr,a,ws):r==="local"&&e.matrixWorld.decompose(xr,a,ws),i){case"x":xr.set(1,0,0).applyQuaternion(a),ry.copy(Vf).cross(xr),Eu.copy(xr).cross(ry);break;case"y":xr.set(0,1,0).applyQuaternion(a),ry.copy(Vf).cross(xr),Eu.copy(xr).cross(ry);break;case"z":xr.set(0,0,1).applyQuaternion(a),ry.copy(Vf).cross(xr),Eu.copy(xr).cross(ry);break;case"xy":Eu.set(0,0,1).applyQuaternion(a);break;case"yz":Eu.set(1,0,0).applyQuaternion(a);break;case"xz":Eu.set(0,1,0).applyQuaternion(a);break;case"adaptive":Vf.angleTo(ws.set(0,1,0))>Math.PI/6?(xr.crossVectors(ws.set(0,1,0),Vf),Eu.crossVectors(xr,ws)):Eu.set(0,1,0);break;default:Eu.copy(Vf);break}Hm.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Hm;if(pW.setFromNormalAndCoplanarPoint(Eu,o),!!s.ray.intersectPlane(pW,t)&&(i==="x"||i==="y"||i==="z")){let l=ws.subVectors(t,o).dot(xr);t.copy(o).addScaledVector(xr,l)}}updateDragItem(e,t=!1){var i,r;Hm.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?Sw.subVectors(e.fromPosition,Hm).divideScalar(e.currentDampingFactor):e.reset==="original"?(Sw.subVectors(e.obj.userData.worldPosition0,Hm).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Sw.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Hm).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?Sw.length()<rUe:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&sUe(e,Sw.add(Hm),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},ny=new k,yR=new k,Jh=new k,$h=new k,gW=new zo,lUe=.01,cUe={type:"requestRender"},uUe=function(){let e=new k,t=new k;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),vW=function(){let e=new St;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof mo&&Sd(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),hUe=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new k,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...TL.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=ls(e,e.actions,r,n,s,i)}},dUe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(wi.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new hUe(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),dl&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),dl&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Xs(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(Jh),e.isReset)$h.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition($h);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(yR),yR.negate(),ny.copy(yR)):i==="xy"?ny.set(0,0,1):i==="xz"?ny.set(0,1,0):i==="yz"&&ny.set(1,0,0),gW.setFromNormalAndCoplanarPoint(ny,Jh),!l.ray.intersectPlane(gW,$h))return}if(!e.isReset){if($h.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)$h.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&($h.x=Jh.x),e.data.enabledTranslation[1]===!1&&($h.y=Jh.y),e.data.enabledTranslation[2]===!1&&($h.z=Jh.z);let s=uUe(Jh,$h,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=ny.subVectors(s,Jh).divideScalar(e.currentDampingFactor);Jh.add(o),t&&vW(e.object,Jh),e.paused=o.length()<lUe}else vW(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(cUe)}},Mw=new k,uE=new k,Aw=new St,sy=new Ai,Hf=new Ai,Ew=new k,Tw=new k,Gm=new k,ed=new k,xR=new zo,fUe=1e-6,pUe={type:"requestRender"},mUe={type:"changeRotation"},yW=function(){let e=new St;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(KK(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof mo&&Sd(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),gUe=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Ai,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...CL.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},vUe=class extends Fa{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(wi.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=J_(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new gUe(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),dl&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),dl&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(Ew),!e.isReset)if(e.target)e.target.getWorldPosition(Tw);else{if(n==="custom"?(l().getWorldDirection(uE),uE.negate(),xR.setFromNormalAndCoplanarPoint(uE,Ew)):(n==="xy"?Mw.set(0,0,1):n==="xz"?Mw.set(0,1,0):n==="yz"&&Mw.set(1,0,0),xR.setFromNormalAndCoplanarPoint(Mw,Ew)),!c.ray.intersectPlane(xR,Tw))return;r>0&&(n==="custom"||n===void 0)&&Tw.addScaledVector(uE,r)}if(e.isReset||(h?t==="target"?Gm.copy(h.up).applyMatrix4(Aw.extractRotation(h.matrixWorld)).normalize():a.some(f=>f===!1)?(i==="x"?(ed.set(0,0,1),a[2]===!1&&ed.set(0,1,0)):i==="y"?(ed.set(1,0,0),a[0]===!1&&ed.set(0,0,1)):(ed.set(0,1,0),a[1]===!1&&ed.set(1,0,0)),Gm.copy(ed).applyQuaternion(e.worldQuaternion0).normalize()):Gm.set(0,1,0):n==="custom"?Gm.set(0,1,0):Gm.copy(Mw)),e.isReset)Hf.copy(e.worldQuaternion0);else if(Ew.distanceTo(Tw)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Hf.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;yUe(Aw,Tw,Ew,Gm,i,ed),Hf.setFromRotationMatrix(Aw),sy.setFromUnitVectors(ed.applyQuaternion(Hf),Gm),a.some(f=>f===!1)&&t!=="target"&&Hf.premultiply(sy).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),sy.setFromRotationMatrix(KK(u.matrixWorld)),sy.slerp(Hf,1/e.currentDampingFactor),yW(u,Aw.makeRotationFromQuaternion(sy)),e.paused=8*(1-sy.dot(Hf))<fUe):(yW(u,Aw.makeRotationFromQuaternion(Hf)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(pUe),u.dispatchEvent(mUe)}},Ol=new k,xs=new k,Un=new k;function yUe(e,t,i,r,n,s){let a=e.elements;Un.subVectors(t,i),Un.lengthSq()===0&&(Un.z=1),Un.normalize(),xs.crossVectors(r,Un),xs.lengthSq()===0&&(Math.abs(r.z)===1?Un.x+=1e-4:Un.z+=1e-4,Un.normalize(),xs.crossVectors(r,Un)),xs.normalize(),Ol.crossVectors(Un,xs),n==="x"?s.z===1?[xs,Ol,Un]=[Un,xs,Ol]:(xs.negate(),[xs,Un]=[Un,xs]):n==="y"?s.x===1?[xs,Ol,Un]=[Ol,Un,xs]:(xs.negate(),[Ol,Un]=[Un,Ol]):s.x===1&&(xs.negate(),[xs,Ol]=[Ol,xs]),a[0]=xs.x,a[4]=Ol.x,a[8]=Un.x,a[1]=xs.y,a[5]=Ol.y,a[9]=Un.y,a[2]=xs.z,a[6]=Ol.z,a[10]=Un.z}var xUe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=ls(t,t.actions,r,n,s,i)}disconnect(){Xs(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},wUe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{wi.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{wi.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{wi.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=J_(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new xUe(l,c,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof qs?s:n)}};if(e.traverseEntity(n=>{var s;(n instanceof La||n instanceof Vs)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),dl&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),dl&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=hd(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=VE(r,n,this.objects);t=ZO(o),o.forEach(l=>{var c,u;l.object instanceof La&&hd(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=l2(r,o);l&&(t.push(o),o instanceof La&&hd(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},bUe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=ls(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){Xs(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},_Ue=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=ls(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let c=t.getBoundingClientRect(),u=window.getComputedStyle(e),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),f=parseFloat(u.bottom),m=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=m-i.height,r.bottom-=m-i.height);else if(!isNaN(f)){let v=document.body.clientHeight??window.innerHeight,g=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===v-f?(r.top+=c.top-i.height+f+g,r.bottom+=c.top-i.height+f+g):i.bottom<v-f&&(r.top-=m-i.height,r.bottom-=m-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Xs(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},SUe=class extends Fa{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=J_(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!r){let h=new bUe(c,u,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(h):this.wheelEventsPerObject.set(s,[h])}else{let h=new _Ue(c,u,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(h):this.scrollEventsPerObject.set(s,[h])}}};e.traverseEntity(s=>{var a;(s instanceof La||s instanceof Vs)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},MUe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=ls(t,t.actions,r,n,s,i)}disconnect(){Xs(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof _g?t.interaction.audioPlayer.play():t.interaction instanceof jO&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof qy?t.interaction.play(i==="autoplay"):t.interaction instanceof YO&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof _g?t.interaction.audioPlayer.play():t.interaction instanceof jO&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof qy?t.interaction.play():t.interaction instanceof YO&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},AUe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof _g&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof qy&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=J_(i);s&&s==="Start"&&(r instanceof qs||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new MUe(c,u,r,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(t.traverseEntity(r=>{var n;(r instanceof La||r instanceof Vs)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},EUe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=ls(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){Xs(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},TUe=class extends Fa{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:f,property:m,prevValue:v}=this.propertiesToWatch[d],g=this.eventContext.scene.find(f),x=DL.propertyPaths[m];if(x[0]==="width"||x[0]==="height"||x[0]==="depth")g=g.geometry.userData.parameters[x[0]];else for(let S=0;S<x.length;S++)g=g[x[S]];v===null?this.propertiesToWatch[d].prevValue=g instanceof k?g.clone():g:(g instanceof k?!g.equals(v):v!==g)&&(c.push({objId:f,property:m}),g instanceof k?this.propertiesToWatch[d].prevValue.copy(g):this.propertiesToWatch[d].prevValue=g)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:f,prevValue:m}=this.variablesToWatch[d],v=a.getVariable(f);v!==m&&(l.push(f),this.variablesToWatch[d].prevValue=v)}for(let d=0;d<this.dynamicVars.length;d++){let{id:f,expectedTime:m,last:v,data:g,timerSeconds:x,startValue:S}=this.dynamicVars[d],_=1e3;if((g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&g.format==="number3decimal"?_=1:g.dynamicVariableType==="counter"?_=g.updateInterval:g.dynamicVariableType==="random"&&(_=g.isStatic?1/0:g.updateInterval),m===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+_;continue}if(!((a.getDynamicVariablePlayState(f)==="Stopped"||a.getDynamicVariablePlayState(f)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+_,g.dynamicVariableType==="counter"&&a.getVariable(f)!==S&&(a.updateVariable(f,S),this.eventManager.requestRender()),(g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==S&&(this.dynamicVars[d].timerSeconds=S,a.updateVariable(f,Ul.getFormattedTimerTime(S,g)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(f)==="Restarted"&&a.setDynamicVariablePlayState(f,"Playing"),a.getDynamicVariablePlayState(f)==="Stopped"))){if(a.getDynamicVariablePlayState(f)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(_-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=m)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=_,g.dynamicVariableType==="random"){let A=g.min+Math.random()*(g.max-g.min),T=g.decimals;A=Math.round(A*Math.pow(10,T))/Math.pow(10,T),a.updateVariable(f,A),l.push(f),this.eventManager.requestRender()}else if(g.dynamicVariableType==="counter"){let A=a.getVariable(f),T=a.getDynamicVariableToggleIsForward(f)??!0,E=a.getVariable(f)+g.increment*(T?1:-1);g.hasEnd&&(E=g.increment>0?Gt.clamp(E,S,g.endValue):Gt.clamp(E,g.endValue,S),E===S&&a.setDynamicVariableToggleIsForward(f,void 0),g.repeat?E===g.endValue&&(E=S):(E===S||E===g.endValue)&&a.setDynamicVariablePlayState(f,"Paused")),E!==A&&(l.push(f),a.updateVariable(f,E),this.eventManager.requestRender())}else if(g.dynamicVariableType==="time"){let A=a.getVariable(f),T=IG(o,g);if(typeof A=="object"&&"textValue"in A&&typeof T=="object"&&"textValue"in T){if(Array.isArray(A.textValue)&&Array.isArray(T.textValue)){if(A.textValue.every((E,I)=>E===T.textValue[I]))continue}else if(A.textValue===T.textValue)continue}else if(A===T)continue;a.updateVariable(f,T),l.push(f),this.eventManager.requestRender()}else{let A=fa.isTextValue(g.endValue)?xW(g.endValue.textValue):g.endValue,T=a.getDynamicVariableToggleIsForward(f)??!0,E=x+(s-v)/1e3*(g.dynamicVariableType==="timer"?-1:1)*(T?1:-1);E=Math.max(E,0),g.hasEnd&&(E=g.dynamicVariableType==="stopwatch"?Gt.clamp(E,S,A):Gt.clamp(E,A,S),E===S&&a.setDynamicVariableToggleIsForward(f,void 0),g.repeat?Math.abs(E-A)<(g.format==="number3decimal"?1e-4:.1)&&(E=S):(Math.abs(E-S)<(g.format==="number3decimal"?1e-4:.1)||Math.abs(E-A)<(g.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(f,"Paused")),E!==x&&(l.push(f),this.dynamicVars[d].timerSeconds=E,a.updateVariable(f,Ul.getFormattedTimerTime(E,g)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(f=>f.objId===d.data.objectId&&f.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new CUe(r.id,r.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(fa.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,IG(new Date,i)),i.dynamicVariableType==="counter"&&(r=fa.isTextValue(i.value)?xW(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},CUe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=ls(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){Xs(this.actions)}};function xW(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var PUe="https://unpkg.com/@splinetool/runtime@1.9.81/build/",DUe="https://unpkg.com/@splinetool/navmesh-wasm@1.9.81/build/",RUe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${PUe}' + 'navmesh.js'),
		fetch('${DUe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,IUe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,LUe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,OUe=.001,zUe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},rJ,Ji,aa;DTe.then(e=>{rJ=e,Ji=new e.Vec3,aa=new e.Vec3});var BUe=new k,NUe=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(wi.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=BUe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,f,m,v,g,x,S;let s;if(n instanceof Vl)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof pa)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((f=s.dataPatched.cloner)==null?void 0:f.hideBase)&&((m=s.dataPatched.physics)==null?void 0:m.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((v=a.physics)==null?void 0:v.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=c2(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let _ of a.events)_.data.disabled!==!0&&(_.data.type==="GameControl"?u=!0:_.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((g=a.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((x=a.physics)!=null&&x.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(ud(n.geometry,n.matrixWorld)),this.usePhysics&&((S=a.physics)==null?void 0:S.fusedBody))return n.traverseObject((_,A)=>{var I,P;if(A===0)return;let T;if(_ instanceof Vl)if(_.objectForSample){if(_.objectForSample.dataPatched.physics.fusedBody)return;T=_.object}else return _.object.dataPatched.physics.fusedBody===!0&&_.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(_ instanceof pa)T=_.object;else if(T=_,(I=_.dataPatched.cloner)==null?void 0:I.hideBase)return!0;let E=T.dataPatched;if(!E.visible&&((P=E.physics)==null?void 0:P.enabled)!==!0)return!0;"geometry"in _&&_.geometry&&i.push(ud(_.geometry,_.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof Vl)return;n instanceof pa?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(c2(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(ud(o,n.matrixWorld))},this.navmeshWasm=rJ,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?RUe:IUe)+LUe])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new k().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=bg(r),{positions:a,triIndices:o}=yC(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...zUe,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new $t;return a.setIndex(new pi(n,1)),a.setAttribute("position",new pi(s,3)),a}getClosestPoint(e){return Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,this.navMesh.getClosestPoint(Ji)}getClosestPointToRef(e,t){Ji.x=e.x,Ji.y=e.y,Ji.z=e.z;let i=this.navMesh.getClosestPoint(Ji);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,this.navMesh.getRandomPointAround(Ji,t)}getRandomPointAroundToRef(e,t,i){Ji.x=e.x,Ji.y=e.y,Ji.z=e.z;let r=this.navMesh.getRandomPointAround(Ji,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,aa.x=t.x,aa.y=t.y,aa.z=t.z,this.navMesh.moveAlong(Ji,aa)}moveAlongToRef(e,t,i){return Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,aa.x=t.x,aa.y=t.y,aa.z=t.z,this.navMesh.moveAlong(Ji,aa)}computePath(e,t){let i=this.getClosestPoint(t);if(aa.x=i.x,aa.y=i.y,aa.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(Ji,aa),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new k(o.x,o.y,o.z))}return s}createCrowd(e,t){return new UUe(this,e,t)}setDefaultQueryExtent(e){Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,this.navMesh.setDefaultQueryExtent(Ji)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,this.navMesh.addCylinderObstacle(Ji,t,i)}addBoxObstacle(e,t,i){return Ji.x=e.x,Ji.y=e.y,Ji.z=e.z,aa.x=t.x,aa.y=t.y,aa.z=t.z,this.navMesh.addBoxObstacle(Ji,aa,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},UUe=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new k(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=OUe)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new k(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function FUe(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&o_.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var kUe={type:"change"},wW={type:"changeZoom"},VUe={type:"changePan"},jm={type:"start"},Wm={type:"end",changed:!0},HUe={type:"end",changed:!1},wR=new Ai,bW=new Ee,GUe=2*Math.PI,jUe=1e-8,WUe=.01,bR=new k,hE=new Ee,_R=new k,dE=new Ai,_W=new St,XUe={type:"requestRender"},nJ=class extends va{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Pl.DOLLY_ROTATE,Pl.PAN],this.offset=new k,this.eye=new k,this.lastPosition=new k,this.lastQuaternion=new Ai,this.current=new Ee,this.overShoot=new Ee,this.overRatio=new Ee,this.spherical=new QV,this.sphericalDelta=new QV,this.panOffset=new k,this.panLeftV=new k,this.panUpV=new k,this.panV=new k,this.rotateStart=new Ee,this.rotateEnd=new Ee,this.rotateDelta=new Ee,this.panStart=new Ee,this.panEnd=new Ee,this.panDelta=new Ee,this.dollyStart=new Ee,this.dollyEnd=new Ee,this.dollyDelta=new Ee,this.rotationRangeFactor=new Ee,this.panRangeFactor=new Ee,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(_R,dE,bR),this.offset.copy(_R).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(wR.copy(dE).invert()),this.panOffset.applyQuaternion(wR),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(dE),this.panOffset.applyQuaternion(dE)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),_R.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(_W.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(_W));let r=this.spherical.phi%GUe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Mr.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>WUe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>jUe?(this.dispatchEvent(kUe),this.object.dispatchEvent(XUe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&dl?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(jm),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&dl||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,bR.subVectors(this.position0,this.target0),this.spherical.setFromVector3(bR),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?hE.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):hE.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(hE).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(bW,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(hE).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&dl?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,wi.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),wi.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Wm):this.dispatchEvent(HUe),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&dl||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!SA(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(SA(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(SA(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(wi.length>1&&r.preventDefault(),this.touches[wi.length-1]){case Pl.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Pl.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Pl.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Pl.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(wi.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=i_(()=>this.dispatchEvent(Wm),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(jm),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!j_)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(jm),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Wm)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(jm))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(wi[0]),r.key===" "&&this.dispatchEvent(Wm))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(wR.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Tu(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Tu(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Tu(Tu(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Tu(Tu(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Pl.ROTATE),e.panTouches===1&&(this.touches[0]=Pl.PAN),e.orbitTouches===2&&(this.touches[1]=Pl.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Pl.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Pl.ROTATE),e.panTouches===3&&(this.touches[2]=Pl.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;e instanceof k?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set(Tu(this.spherical.theta),Tu(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=Tu(this.overShoot.x),this.overShoot.y=Tu(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=SW(Math.abs(this.overRatio.x)),this.overRatio.y=SW(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof k?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(VUe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(wW)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(wW)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(jm),this.dollyOut(e),this.dispatchEvent(Wm)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(jm),this.dollyIn(e),this.dispatchEvent(Wm)}setZoom(e){if(this.dispatchEvent(jm),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Wm)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(bW,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(MTe===!1&&SA(e)===!1&&ETe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(wi.length===2){let e=.5*(wi[0].pageX+wi[1].pageX),t=.5*(wi[0].pageY+wi[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(wi[0].pageX,wi[0].pageY)}handleTouchStartPan(){if(wi.length===2){let e=.5*(wi[0].pageX+wi[1].pageX),t=.5*(wi[0].pageY+wi[1].pageY);this.panStart.set(e,t)}else this.panStart.set(wi[0].pageX,wi[0].pageY)}handleTouchStartDolly(){let e=wi[0].pageX-wi[1].pageX,t=wi[0].pageY-wi[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(wi.length===2){let i=u3(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==wi[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(wi.length===2){let t=u3(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==wi[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=u3(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function Tu(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function SW(e){return 1-Math.pow(1-e,4)}var MW=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=ls(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){Xs(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},ar;ITe.then(e=>ar=e);var $n=new k,Dc=new Ai,Gf=new k,SR=new Ss(0,0,0,"YXZ"),AW=new Ss(0,0,0,"XYZ"),Rc=new k,MR=new k,AR=new k(1,1,1),ay=new Ai,fE=new St,EW=new St,qUe={type:"updateMatrix"},TW=new Ai,ER=new jo,KO={type:"beginEvent",eventName:"Collision"},YUe={type:"beginEvent",eventName:"Trigger"};function QUe(e){if(o_.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var c2=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),ZUe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==ar.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if($n.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),Dc.copy(t.rotation()),i.matrixWorld.compose($n,Dc,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(qUe),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let m of h)m.data.target==="scene"&&this.dispatchCollisionEvent(m,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),f=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(f!==void 0)for(let m of f)m.data.target==="scene"&&this.dispatchCollisionEvent(m,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=YK,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,r=t instanceof fb,n=t instanceof pb;if(t instanceof Vl||r||n)return;t instanceof pa?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(c2(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&(h.data.type==="GameControl"||h.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(ud(a,t.matrixWorld))}),e.length>0){let t=bg(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new hb(t)}}addRigidBody(e,t,i){if(ZK(e.matrixWorld))return;let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(ud(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=ar.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=ar.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=ar.RigidBodyDesc.fixed();let l=bg(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose($n,Dc,Gf),e.position0=$n.clone().divideScalar(this.pixelsPerMeter),e.rotation0=Dc.clone(),$n.divideScalar(this.pixelsPerMeter),a.setTranslation($n.x,$n.y,$n.z).setRotation(Dc),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(Gf.x/this.pixelsPerMeter,Gf.y/this.pixelsPerMeter,Gf.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[e,Gf.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(ud(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(n=>n.updateMatrixWorld(!0)),t.length>0){let n=bg(t,!1);e.bvhGeometry=n,n.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new hb(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=ar.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=ar.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(ar.CoefficientCombineRule.Average).setRestitutionCombineRule(ar.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(ar.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof Vl)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof pa)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(ud(a,i.matrixWorld))}}activate(e){var d,f;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let m of l.data.events){if(m.data.disabled||m.data.type!=="GameControl")continue;let v=l;for(;this.usePhysics&&((d=v=v.parent)==null?void 0:d.parent)!==null;)(f=v.data.physics)==null||f.fusedBody;m.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=m.data)}if(this.page.traverseEntity(m=>{for(let v of m.dataPatched.events)if(v.data.disabled===!1&&v.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let m=new QK(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=m,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,dl&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let m=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new NUe(this.usePhysics,this.isExport);let v;m.collider.type==="sphere"?v=m.collider.radius*2:v=m.collider.height,v=Math.floor(v/m.navmesh.ch-1),this.navigationMeshWrapper.init({...m.navmesh,walkableHeight:v},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:m,enablePan:v,enableZoom:g,autoRotate:x,hoverRotatePanMode:S}=this.eventManager.publish.orbitControls;(m||v||g||x||S!==0)&&(this.orbitControls=new nJ(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((m,v)=>{let g=document.body.appendChild(document.createElement("div")),[x,S,_]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[v],A=(u-5*x)/4+x,T={},E=m==="jmp",I=E?0:x;v<10?(v<5?T.top=I/2:T.bottom=I/2,T.left=I/2+v%5*A):v===10?(T.left=I/2,T.top=h/2):(T.right=I/2,T.top=h/2),T.top?T.top-=S[1]:T.bottom+=S[1],T.left?T.left+=S[0]:T.right-=S[0];for(let L in T)T[L]+="px";if(E){let L=g.appendChild(document.createElement("div"));Object.assign(L.style,T,{position:"absolute",width:x+"px",height:x+"px",backgroundColor:`rgba(255,255,255,${_==="show"?.4:0})`,zIndex:"9999",borderRadius:x+"px",border:_==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let z=x/16*16*.4;_==="show"&&(L.innerHTML=`
						<svg width="${z}" height="${x*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),L.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),L.addEventListener("touchend",F=>F.preventDefault()),this.joysticks[v]=[void 0,g];return}let P={zone:g,mode:"static",position:T,size:x};_==="hide"&&(P.restOpacity=0);let C=aBe.create(P);C.on("move",(L,z)=>{let F=this.gameControl;m==="pos"?z.force<.2?F.moveForce=0:(F.movementState.movePosZ=Math.sin(-z.angle.radian),F.movementState.movePosX=Math.cos(-z.angle.radian),z.force>1.2?F.movementState.run=1:F.movementState.run=0,z.force<.3?F.moveForce=(z.force-.2)/.1:F.moveForce=1):m==="rot"&&(z.force<.2?F.rotForce=0:(F.movementState.rotPosX=z.vector.y,F.movementState.rotPosY=-z.vector.x,z.force<.3?F.rotForce=(z.force-.2)/.1:F.rotForce=1)),this.requestRender()}),C.on("end",(L,z)=>{let F=this.gameControl;m==="pos"?(F.movementState.movePosZ=0,F.movementState.movePosX=0,F.moveForce=1):m==="rot"&&(F.movementState.rotPosX=0,F.movementState.rotPosY=0,F.rotForce=1)}),this.joysticks[v]=[C,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(m=>m.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new ar.World(new ar.Vector3(0,this.gravity,0)),this.events=new ar.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var x,S,_,A;let l;if(o instanceof Vl)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof pa)l=o.object;else{if(o instanceof pb||o instanceof fb)return;if(l=o,((x=l.dataPatched.cloner)==null?void 0:x.disabled)===!1&&((S=l.dataPatched.cloner)==null?void 0:S.hideBase)&&((_=l.dataPatched.physics)==null?void 0:_.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let T of c.events)T.data.disabled!==!0&&T.data.type==="GameControl"&&(u=T.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=c2(c),d=!1,f=l.userData.hasDestroy,m=l.userData.hasDrag,v=!1;for(let T of c.events)if(T.data.disabled!==!0){if(T.data.type==="Collision"){d=!0;let E=new EUe(T.id,T.data,l,this.page,this.sharedAssets,this.eventManager);E.initialDisabled=!0,this.collisionEvents.push(E),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(I=>I.id!==T.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(E):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[E]}else if(T.data.type==="Follow"){v=!0;let E=T.data.target;o.traverseVisible(I=>{I.userData.isFollowingObj=E})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let g=o.geometry;if(u!==void 0){let T=ar.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose($n,Dc,Gf),o.position0=$n.clone().divideScalar(this.pixelsPerMeter),o.rotation0=Dc.clone(),$n.divideScalar(this.pixelsPerMeter),T.setTranslation($n.x,$n.y,$n.z).setRotation(Dc);let E=this.sharedGameControlGlobals.rapierWorld.createRigidBody(T);o.rigidBody=E;let I;u.collider.type==="sphere"?I=ar.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?I=ar.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):I=ar.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),I.setFrictionCombineRule(ar.CoefficientCombineRule.Average).setRestitutionCombineRule(ar.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let P=this.sharedGameControlGlobals.rapierWorld.createCollider(I,E);this.sharedGameControlGlobals.colliderToEntity.set(P.handle,l),$n.fromArray(u.collider.position).multiply(Gf.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),P.setTranslationWrtParent($n);let C=new Ai().setFromEuler(new Ss().setFromVector3(new k().fromArray(u.collider.rotation)));P.setRotationWrtParent(C),P.setActiveEvents(ar.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||v||f||m||d?(this.addRigidBody(o,l,{hasFollow:v,hasTransformAnim:h,hasDrag:m}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(g&&e.push(ud(g,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((T,E)=>{var L;if(E===0)return;let I;if(T instanceof Vl)if(T.objectForSample){if(T.objectForSample.dataPatched.physics.fusedBody)return;I=T.object}else return T.object.dataPatched.physics.fusedBody===!0&&T.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(T instanceof pb||T instanceof fb)return;if(T instanceof pa)I=T.object;else if(I=T,(L=I.dataPatched.cloner)==null?void 0:L.hideBase)return!0}let P=I.dataPatched;if(P.physics.enabled==="visibility"?!P.visible:!P.physics.enabled)return!0;let C=T.geometry;(C==null?void 0:C.getAttribute("position"))!==void 0&&e.push(ud(C,T.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((A=c.physics)==null?void 0:A.fusedBody)===!0||u)return!0}),e.length===0)return;let i=bg(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=ar.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=ar.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(ar.CoefficientCombineRule.Multiply).setRestitutionCombineRule(ar.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new MW(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new St().compose(Rc.fromArray(t.data.position),ay.setFromEuler(AW.fromArray(t.data.rotation)),AR);if(t.data.triggerZone==="box"){let n=new Gn;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose($n,Dc,Gf),SR.setFromQuaternion(Dc);let i=t;i.prevR===void 0?(i.prevR=SR.clone(),i.prevT=$n.clone()):(i.prevR.copy(SR),i.prevT.copy($n)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation($n.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(Dc))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===r){n=a;break}}e.dispatch(n),t.dispatchEvent(KO)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=EW.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new MW(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=ar.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=ar.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(ar.ActiveEvents.COLLISION_EVENTS),Rc.fromArray(a.data.position),ay.setFromEuler(AW.fromArray(a.data.rotation)),fE.compose(Rc,ay,AR).premultiply(n.matrixWorld),i?(fE.decompose(Rc,ay,MR),l.setActiveCollisionTypes(ar.ActiveCollisionTypes.KINEMATIC_FIXED|ar.ActiveCollisionTypes.DYNAMIC_FIXED)):(fE.premultiply(r).decompose(Rc,ay,MR),e.rigidBody.bodyType()===ar.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===ar.RigidBodyType.Fixed?l.setActiveCollisionTypes(ar.ActiveCollisionTypes.KINEMATIC_FIXED|ar.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(ar.ActiveCollisionTypes.KINEMATIC_KINEMATIC|ar.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Rc.divideScalar(this.pixelsPerMeter),l.setTranslation(Rc.x,Rc.y,Rc.z),l.setRotation(ay),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(tr.is(o)?o:o.object)===!1)continue;let l=EW.copy(n.matrixWorld).decompose(Rc,TW,MR).compose(Rc,TW,AR).multiply(r),c=fE.copy(o.matrixWorld).invert().multiply(l);i instanceof Gn?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(ER.radius=i,ER.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(ER)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(YUe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function KUe(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===TB;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===oq){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var CW=!1,JUe=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=cL.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);CW===!1&&(Object.getPrototypeOf(c)._updateTime=KUe,CW=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new Wxe(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=lq}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=TB)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return kK(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},TR=new WeakMap,$Ue=class extends k_{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new uL(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(TR.has(e)){let o=TR.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),TR.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new $t;e.index&&t.setIndex(new pi(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new pi(s,a))}return t}_loadLibrary(e,t){let i=new uL(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=eFe.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function eFe(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,f=new h.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{let m=i(h,d,f,c),v=m.attributes.map(g=>g.array.buffer);m.index&&v.push(m.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:m},v)}catch(m){console.error(m),self.postMessage({type:"error",id:o.id,error:m.message})}finally{h.destroy(f),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,f,m=o.GetEncodedGeometryType(l);if(m===a.TRIANGULAR_MESH)d=new a.Mesh,f=o.DecodeBufferToMesh(l,d);else if(m===a.POINT_CLOUD)d=new a.PointCloud,f=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());let v={index:null,attributes:[]};for(let g in u){let x=self[h[g]],S,_;if(c.useUniqueIDs)_=u[g],S=o.GetAttributeByUniqueId(d,_);else{if(_=o.GetAttributeId(d,a[u[g]]),_===-1)continue;S=o.GetAttribute(d,_)}v.attributes.push(n(a,o,d,g,x,S))}return m===a.TRIANGULAR_MESH&&(v.index=r(a,o,d)),a.destroy(d),v}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),f=l.num_points()*d,m=f*u.BYTES_PER_ELEMENT,v=s(a,u),g=a._malloc(m);o.GetAttributeDataArrayForAllPoints(l,h,v,m,g);let x=new u(a.HEAPF32.buffer,g,f).slice();return a._free(g),{name:c,array:x,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var cp;function tFe(){return cp||(cp=new $Ue,cp.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),cp.decoderPending}async function iFe(e){if(cp){let t={attributeIDs:cp.defaultAttributeIDs,attributeTypes:cp.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await cp.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function rFe(e,t){let[i,r]=WY(AL.deserialize(new Uint8Array(e)));return gQ(i),r.result().data}function nFe(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function sFe(e){for(let t of e){let i=await iFe(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var aFe=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},oFe=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=ls(r,i.actions,s,a,o,n)}disconnect(){Xs(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},lFe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=PL.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new oFe(o,c,l,a,n,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(n=>{var s;(n instanceof La||n instanceof Vs)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},cFe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new uFe(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},uFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=ls(t,t.successActions,r,n,s,i),this.errorActions=ls(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},hFe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new dFe(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},dFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=ls(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function fFe(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var pFe=new k(0,0,1),PW=new k,DW=new k,RW=new ns,mFe=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new WZ,this.doubleClickHandler=new aFe,this.isDragging=!1,this.plane=new zo,this.caretInterval=0,this.planeIntersection=new k,this.projected=new Ee,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=_Oe(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=fFe(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof WN)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new k);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof e.geometry.width=="number"?e.geometry.width:1,n=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(RW.getNormalMatrix(this.virtualInput.matrixWorld),PW.copy(pFe).applyMatrix3(RW).normalize(),this.virtualInput.localToWorld(DW.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(PW,DW))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=gFe(e.geometry.horizontalAlign))}};function gFe(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var sJ=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return sJ(i.value,t)}return fa.getDisplayedValue(e)};function IW(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=sJ(n.value,t.variables))}else r=i.textValue.toString();return r}var vFe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Ho,this.helper=new WZ,this._onMouseDownFocusIn=i=>{if(wi.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new mFe(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof WN&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=IW(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=IW(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},yFe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new xFe(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("voice",this.onVoice)}},xFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=ls(t,t.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},wFe=class extends Fa{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new bFe(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("trigger_event",this.onTriggerEvent)}},bFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=ls(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},_Fe=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(e=!1){var r;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new QNe(this.eventContext),VariableChange:new TUe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new cFe(this.eventContext,this),WEBHOOK:new hFe(this.eventContext,this),AIAssistantListener:new yFe(this.eventContext,this),AIAssistantTrigger:new wFe(this.eventContext,this),Conditional:new iUe(this.eventContext,this),Start:new AUe(this.eventContext,this),Basic:new KNe(this.eventContext,this,this.needsRaycast),MouseHover:new wUe(this.eventContext,this),Scroll:new SUe(this.eventContext,this),Follow:new dUe(this.eventContext,this),DragDrop:new oUe(this.eventContext,this),LookAt:new vUe(this.eventContext),Resize:new lFe(this.eventContext,this),Textfields:new vFe(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(n=>{n.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(n=>n.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect())}deactivate(e=!1){var r,n;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),e||((n=this.eventContext.sharedAssets.openAIRealtime)==null||n.disconnect())}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(t);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(t);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(t);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(t);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(t)})}},SFe=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new Ee().copy(i),this._editorSize=new Ee().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=MFe(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function MFe(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var AFe=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new ON(e.shared,t,!0,i),this.scene=new YN(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof Vs&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof ss&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},EFe=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function TFe(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function xb(e){return e instanceof p_?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function CFe(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof mo)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof mo&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!js.isMergable(a))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!js.isMergable(c.material))return;s=js.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][xb(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][xb(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][xb(r)].push(c)}),i}function PFe(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function DFe(e,t){let i=CFe(t,e),r=PFe(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,f]of Object.entries(i))for(let m of Object.values(f)){if(o=0,c=0,m.forEach(g=>{g instanceof mo&&(a[o++]=g.geometry.clone(),l[c++]=g)}),c<2)continue;for(let g=0;g<c;g++)l[g].updateWorldMatrix(!0,!1),a[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&TFe(a[g]);let v=bg(a.slice(0,o),!1);if(v){let g;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new qr(v,l[0].material);break}default:{g=new qr(v,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let x=S=>{h=0;for(let _ of S)_.children&&x(_.children),_ instanceof mo&&(Array.isArray(_.material)||i[_.material.uuid]&&i[_.material.uuid][xb(_)]&&i[_.material.uuid][xb(_)].length>1||(u[h++]=_));for(let _=0;_<h;_++)t.attach(u[_])};for(let S=0;S<c;S++){let _=l[S];x(_.children),n[s++]=_}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var RFe=zp(Pfe(),1),IFe=new Ee;function LFe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var OFe=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,u,h,d,f,m,v,g;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(x=>{x.type==="ParticleSystem"&&(x.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((f=this._eventManager.handlers)==null?void 0:f.Follow).onAnimationFrameDamping(),((m=this._eventManager.handlers)==null?void 0:m.LookAt).onAnimationFrameDamping(),((v=this._eventManager.handlers)==null?void 0:v.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let x=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=x,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(g=this._perfs)==null||g.end()},this._resize=r=>{var n,s,a,o,l,c,u,h,d,f;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=IFe.set(this._viewportWidth,this._viewportHeight)),r){let m=this._viewportWidth,v=this._viewportHeight;this._renderer.setSize(m-1,v-1,!1),this._renderer.setSize(m,v,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let m=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(f=this._frameView)==null||f.updateCamera(m!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=i_(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new EFe({x:10,y:10})),CTe(e)}async load(e,t,i){LFe(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let r=await rFe(e);this._data=r;let n=nFe(r);r.version&&(0,RFe.default)(r.version,"1.9.81")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&tFe(),ij(r)&&IDe(),NRe(r)&&CDe(),o_.physicsEnabled(r.scene.objects)&&LTe(),KG(r)&&fRe(),Ij(r)&&Yze(),hRe(r)&&uRe(),Sj(r)&&OOe(),FUe(r)&&RTe()].filter(Boolean)),n.length&&await sFe(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new AFe(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();DFe(r,s.scene);let f=performance.now();console.log("Merged geometries in ",f-d," ms")}ij(r)&&this._scene.traverse(d=>{Sd(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(f=>{f instanceof Vl&&f.pendingMediaLoad&&f.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),KG(r)&&QUe(r)&&await Promise.all(a),Sj(r)){let d=[];this._scene.traverseEntity(f=>{(f instanceof La||f instanceof Vs)&&f.uiCanvas&&d.push(f.uiCanvas)}),await Promise.all(d.map(f=>f.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),oU(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new wOe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let f=d.getTexture(1001);this._renderer.pipeline.setWatermark(f)}Ij(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new SFe(this._renderer,this._camera,new Ee(this._viewportWidth,this._viewportHeight),new Ee(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let d=new qNe(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new ZUe(d),this._animationControls=new JUe(this._scene,this._requestRenderAutoMode),this._eventManager=new _Fe(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;typeof i.data.value=="number"?n=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?n=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=t.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&fa.isTextValue(e)?fa.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==zx&&!this._scene.isInvisibleObjects(i)&&!(i instanceof Vs)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof nJ&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new ma(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{sH.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,PTe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof Vs&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof Vs||e instanceof YN||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=sH(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){MZ.skiaWasmUrl=e}},CR,LW;function zFe(){if(LW)return CR;LW=1;var e="Expected a function",t=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof WS=="object"&&WS&&WS.Object===Object&&WS,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),h=Object.prototype,d=h.toString,f=Math.max,m=Math.min,v=function(){return u.Date.now()};function g(T,E,I){var P,C,L,z,F,G,N=0,q=!1,ie=!1,Q=!0;if(typeof T!="function")throw new TypeError(e);E=A(E)||0,x(I)&&(q=!!I.leading,ie="maxWait"in I,L=ie?f(A(I.maxWait)||0,E):L,Q="trailing"in I?!!I.trailing:Q);function W(ve){var xe=P,be=C;return P=C=void 0,N=ve,z=T.apply(be,xe),z}function ee(ve){return N=ve,F=setTimeout($,E),q?W(ve):z}function K(ve){var xe=ve-G,be=ve-N,Me=E-xe;return ie?m(Me,L-be):Me}function j(ve){var xe=ve-G,be=ve-N;return G===void 0||xe>=E||xe<0||ie&&be>=L}function $(){var ve=v();if(j(ve))return se(ve);F=setTimeout($,K(ve))}function se(ve){return F=void 0,Q&&P?W(ve):(P=C=void 0,z)}function re(){F!==void 0&&clearTimeout(F),N=0,P=G=C=F=void 0}function he(){return F===void 0?z:se(v())}function oe(){var ve=v(),xe=j(ve);if(P=arguments,C=this,G=ve,xe){if(F===void 0)return ee(G);if(ie)return F=setTimeout($,E),W(G)}return F===void 0&&(F=setTimeout($,E)),z}return oe.cancel=re,oe.flush=he,oe}function x(T){var E=typeof T;return!!T&&(E=="object"||E=="function")}function S(T){return!!T&&typeof T=="object"}function _(T){return typeof T=="symbol"||S(T)&&d.call(T)==i}function A(T){if(typeof T=="number")return T;if(_(T))return t;if(x(T)){var E=typeof T.valueOf=="function"?T.valueOf():T;T=x(E)?E+"":E}if(typeof T!="string")return T===0?T:+T;T=T.replace(r,"");var I=s.test(T);return I||a.test(T)?o(T.slice(2),I?2:8):n.test(T)?t:+T}return CR=g,CR}var BFe=zFe();const NFe=Cp(BFe);function UFe(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const FFe=[],kFe={width:"100%",height:"100%"},VFe=Se.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=FFe,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=Se.useRef(null),u=Se.useRef(0),[h,d]=Se.useState({width:0,height:0,top:0,left:0}),f=Se.useMemo(()=>{const m=Array.isArray(r)?r:[r];return NFe(v=>{d(g=>Object.keys(g).filter(x=>g[x]!==v[x]).every(x=>m.includes(x))?g:v)},i,{leading:s})},[i,s,r]);return Se.useEffect(()=>{const m=a||window.ResizeObserver,v=new m(g=>{g.forEach(x=>{const{left:S,top:_,width:A,height:T}=(x==null?void 0:x.contentRect)??{};u.current=window.requestAnimationFrame(()=>{f({width:A,height:T,top:_,left:S})})})});return c.current&&v.observe(c.current),()=>{window.cancelAnimationFrame(u.current),v.disconnect(),f.cancel()}},[f,a]),Qe.jsx("div",{style:{...kFe,...n},ref:UFe([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:f})})}),aJ=Se.forwardRef(({scene:e,style:t,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,children:f,...m},v)=>{const g=Se.useRef(null),[x,S]=Se.useState(!0),[_,A]=Se.useState();if(_)throw _;return Se.useEffect(()=>{S(!0);let T;const E=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(g.current){T=new OFe(g.current,{renderOnDemand:d});async function I(){await T.load(e);for(let P of E)P.cb&&T.addEventListener(P.name,P.cb);S(!1),h==null||h(T)}I().catch(P=>{A(P)})}return()=>{for(let I of E)I.cb&&T.removeEventListener(I.name,I.cb);T.dispose()}},[e]),Qe.jsx(VFe,{ref:v,parentSizeStyles:{overflow:"hidden",...t},debounceTime:50,...m,children:()=>Qe.jsxs(Qe.Fragment,{children:[x&&f,Qe.jsx("canvas",{ref:g,style:{display:x?"none":"block"}})]})})}),Wo={paddingX:"sm:px-16 px-6",padding:"sm:px-16 px-6 sm:py-16 py-10",heroHeadText:"font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-purple-500 lg:text-[80px] sm:text-[60px] xs:text-[50px] text-[40px] lg:leading-[98px] mt-2",heroSubText:"text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 font-medium lg:text-[30px] sm:text-[26px] xs:text-[20px] text-[16px] lg:leading-[40px]",sectionHeadText:"text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-purple-500 font-black md:text-[60px] sm:text-[50px] xs:text-[40px] text-[30px]",sectionSubText:"sm:text-[18px] text-[14px] text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400 uppercase tracking-wider"},HFe=()=>{const e=Se.useRef(null);return Qe.jsxs("section",{className:"w-full h-screen flex flex-col items-center",children:[Qe.jsxs("div",{className:"w-full h-[40vh] flex flex-col justify-center items-center text-center px-4",children:[Qe.jsxs("h1",{className:`${Wo.heroHeadText} text-white text-3xl sm:text-4xl`,children:["Hi, I'm ",Qe.jsx("span",{className:"text-[#915EFF]",children:"Nujan"})]}),Qe.jsx("p",{className:`${Wo.heroSubText} mt-2 text-white-100 text-base sm:text-lg`,children:"I develop Web Applications, Mobile Apps, and User Interfaces"})]}),Qe.jsx("div",{className:"w-full h-[50vh]",children:Qe.jsx(aJ,{scene:"https://prod.spline.design/4pPpv-IMIS4tjit3/scene.splinecode",onLoad:t=>{e.current=t,console.log("Spline scene loaded:",t)},className:"w-full h-full"})}),Qe.jsx("div",{className:"mt-6",children:Qe.jsx("a",{href:"#about",children:Qe.jsx("div",{className:"w-[30px] h-[60px] rounded-3xl border-4 border-secondary flex justify-center items-start p-2",children:Qe.jsx(Ku.div,{animate:{y:[0,24,0]},transition:{duration:1.5,repeat:1/0,repeatType:"loop"},className:"w-3 h-3 rounded-full bg-secondary mb-1"})})})})]})},oJ=""+new URL("logo-BqiL23lx.png",import.meta.url).href,GFe=""+new URL("backend-B4luK_fR.png",import.meta.url).href,OW=""+new URL("creator-rGfpc8BI.png",import.meta.url).href,lJ=""+new URL("web-DZezu_Vg.png",import.meta.url).href,jFe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='20'%20height='12'%20fill='%23FFF'%20viewBox='0%200%2020%2012'%3e%3cpath%20fill='%23FFF'%20d='M9%202L19%202C19.2652%202%2019.5196%201.89464%2019.7071%201.70711C19.8946%201.51957%2020%201.26522%2020%201C20%200.734784%2019.8946%200.480429%2019.7071%200.292892C19.5196%200.105356%2019.2652%200%2019%200L9%200C8.73478%200%208.48043%200.105356%208.29289%200.292892C8.10536%200.480429%208%200.734784%208%201C8%201.26522%208.10536%201.51957%208.29289%201.70711C8.48043%201.89464%208.73478%202%209%202ZM19%2010L1%2010C0.734784%2010%200.480429%2010.1054%200.292892%2010.2929C0.105356%2010.4804%200%2010.7348%200%2011C0%2011.2652%200.105356%2011.5196%200.292892%2011.7071C0.480429%2011.8946%200.734784%2012%201%2012L19%2012C19.2652%2012%2019.5196%2011.8946%2019.7071%2011.7071C19.8946%2011.5196%2020%2011.2652%2020%2011C20%2010.7348%2019.8946%2010.4804%2019.7071%2010.2929C19.5196%2010.1054%2019.2652%2010%2019%2010V10ZM1%207L19%207C19.2652%207%2019.5196%206.89464%2019.7071%206.70711C19.8946%206.51957%2020%206.26522%2020%206C20%205.73478%2019.8946%205.48043%2019.7071%205.29289C19.5196%205.10536%2019.2652%205%2019%205L1%205C0.734784%205%200.480429%205.10536%200.292892%205.29289C0.105356%205.48043%200%205.73478%200%206C0%206.26522%200.105356%206.51957%200.292892%206.70711C0.480429%206.89464%200.734784%207%201%207Z'/%3e%3c/svg%3e",WFe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='18'%20height='18'%20fill='%23FFF'%20viewBox='0%200%2018%2018'%3e%3cpath%20fill='%23FFF'%20d='M10.4099%209L16.7099%202.71C16.8982%202.5217%2017.004%202.2663%2017.004%202C17.004%201.7337%2016.8982%201.47831%2016.7099%201.29C16.5216%201.1017%2016.2662%200.995911%2015.9999%200.995911C15.7336%200.995911%2015.4782%201.1017%2015.2899%201.29L8.99994%207.59L2.70994%201.29C2.52164%201.1017%202.26624%200.995911%201.99994%200.995911C1.73364%200.995911%201.47824%201.1017%201.28994%201.29C1.10164%201.47831%200.995847%201.7337%200.995847%202C0.995847%202.2663%201.10164%202.5217%201.28994%202.71L7.58994%209L1.28994%2015.29C1.19621%2015.383%201.12182%2015.4936%201.07105%2015.6154C1.02028%2015.7373%200.994141%2015.868%200.994141%2016C0.994141%2016.132%201.02028%2016.2627%201.07105%2016.3846C1.12182%2016.5064%201.19621%2016.617%201.28994%2016.71C1.3829%2016.8037%201.4935%2016.8781%201.61536%2016.9289C1.73722%2016.9797%201.86793%2017.0058%201.99994%2017.0058C2.13195%2017.0058%202.26266%2016.9797%202.38452%2016.9289C2.50638%2016.8781%202.61698%2016.8037%202.70994%2016.71L8.99994%2010.41L15.2899%2016.71C15.3829%2016.8037%2015.4935%2016.8781%2015.6154%2016.9289C15.7372%2016.9797%2015.8679%2017.0058%2015.9999%2017.0058C16.132%2017.0058%2016.2627%2016.9797%2016.3845%2016.9289C16.5064%2016.8781%2016.617%2016.8037%2016.7099%2016.71C16.8037%2016.617%2016.8781%2016.5064%2016.9288%2016.3846C16.9796%2016.2627%2017.0057%2016.132%2017.0057%2016C17.0057%2015.868%2016.9796%2015.7373%2016.9288%2015.6154C16.8781%2015.4936%2016.8037%2015.383%2016.7099%2015.29L10.4099%209Z'/%3e%3c/svg%3e",XFe=""+new URL("css-CAsor-HB.png",import.meta.url).href,qFe=""+new URL("docker-DrQKSZ7f.png",import.meta.url).href,YFe=""+new URL("figma-DdeqztSZ.png",import.meta.url).href,QFe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAMAAAAJixmgAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB1FBMVEUAAAD3Uh7zUB3zUB70UR30UB71UB70UB7/Xx/zUR3zUR71Th3zUR7zUB32VSLzUB7zUB30UR7zUR33Tx/0UB7zUB70UB70UR7zUh/zUR3zUR3zUB31UB70UB70UR70Tx7zUB7zUR3zUB3zUB70UB30UB3zUB30UB30UR70UR70UR7/AAD/fwD1ThvzUB7zUB30Tx3/TBn0UR70UR30UB31VRzzUB70Uh70UR7zUB3zUR7/VQDzUR3zUR7wSx70UB7yUR7yTx3yUB/zUR3zTSH1URzzUB3zUR70UR71UR/1UB30UB31UB3zUB30UB71Tx3yVRjwTRz0URzzUB3/VSrrTif0Uh/0UB32TxrsSCT2UB/zUR3zUB7zTx7zUB7zUB3zUh/zUR7zTx/0UB3yUh70UR30UR70UB3xTx70UR3zUB7zUBz1UR/0UB30UR70UB7yTh7zUB31UBz1Ux30UR70UR30Tx/0UR70USDzUxv0UR7yUh/xTiDxUBrzUR7xUhvzUB72UiD3TR7/PwDzUB3zUR3zUR30UB3/RRf0UR70UR3zUR7yUhzwVRz0UR70UR3zUR3zUR7wUB3zUB30VR/yTBn0UB3pVRXyTx7xUBr0UR7////mY6gFAAAAmnRSTlMAInK41vMzuwic/hrIzh7d4cDfIH+IdXRzcXBvZmVkY/2A5reUkbXp0pAyAQI3hedgCnfvXxvKXalW+wO2VRHaVD1S+Bc1+rDbUWiST/lMTRUkSPcGDUpGHQ45RfZDsYtB9UB7O/EZpTry/Fk4eO7BKqI2NKrVMOwvLusoJyblJeQfIQTN3orXC0uTQj4S3LzPoCPgGBTEDFMTww/LsAAAAAFiS0dEm+/YV4QAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfnAwQKADldxWHDAAAGjElEQVR42u3d6X8TRRgH8E3SJM0WCjZGUUQDPRAK1IoitEULWK1HRVAExLOKWq33bb2wFvCoFmpFn7/WF1WbNruTOZ7JzDP7/F7xgkzn+3kmye7sk90o4nA4HA6Hw+FwOBwOh8PhcDgcDocTVHL5Qkex2FHI5zLBLZXh/5RLwXM7KzE0JK50hu3t2gQbsrk7ZG/3FmjK1ly2vCGLk73hitO8oYrTvWGKRd4QxWJveOJW3tDErb1hiWW8IYnlvOGIZb2hiOW9YYhVvCGI1bz0xape6mJ1L3HxTaCRnmq2Kky7xixmMYtZTCE317IlvgUgU+JbATIl3rY63cyI8/9NNyPi29ammwnx7Y3TzYB4+/rpBi++I4ZMiXfETdMNWnxnnDDdgMV31ROnG6x4R5wy3Z2N/6vaAwC7evtqtf6B3aR3fVLq2yy+e8/ewdV/7tt/YIis+J66YLq11JcN33uQ5qq+ry6cbro4uv8QRfED9RbT3Zn+2uHD9Fb1kZGW0xXUeHSMWo2PjkhMVyB+8CFa4vERqekKxMdIfR8fGZGc7vH0MXoJfTuNy3pPPJw+yASdI5Djj8jO9VHRMJNUjjIfk/bC46JxniBylPnklPwZwH7RQE/RuJp6UsELT4tGOkXi+vHpZ1TO8Z4VDXWGwtnicyeUTmqHRWONEugROKtUX4BzosHO+78joOqF50Wj5bzvA7nwguo+TV748ed758uLyl54STTey573+rzyqvpO3JTg0HJwErwWT2t4AV4TfMH53c/1elFnfnDxjdQR/d69PabnBXgzfcxqj781fmsGdLM9IlhjAy+8/Q69Gs9eBIPE7w4SE+99D8zy/gekVvXEQTDN1Icf0anxx+ZeAIC1AT/5tOqz+LPPARm8cUX6taqxvOvAHou/wPKuB3sr/vIrsAP2VDw3BLbAXooxvU1gD8Vf7wKbYO/EuN4EsGfib74F22CvxN8hexPBHonRvcngDUeI7vq5Tn0P7QFvFDvq57rUA+0Ci1Zk2/q5bHhTwcLZtqef64et0E6wcEW2o5+ry0Z9RWDhbOfLkuIuXW/nJmg3WLgiZfu5fhzWBFeg/WBhjacl/0BF84S/7gIsrLFkP1esd/fIMjgBw2nBJqLkXyjreHPgBjw5KJjUguSf0Plu2uYIfFk0qX6Mq+8pKTgCnxRNSrafq6ABvuIILFyNsv1cVzTAM47AZ0STku3nmiEEHsXo55ohtKSvYlS4g9CHFsp7WOdDK+8I/BPGp7TO11LVEbhfNKmfLR54uDq0XIjMj7S0Di2jUuzmWHrC+Fha8+TBzekhQK/x2ZLm6aGTDQAAgF/SJvSr5Q0AB1s8q+dLi8nTWfzN8haP7gUAUzD8Pp94lCX3G0WzbctqjwswHB7W3rU03Yq3UePWYFi6pLkvbX55yYJYAgzF2vnGWVyVvPKAcTkNf1XLgAGGDszu+/fa0qzstSWcli10sRwYAHaP9dVqfWPSVw+xWtSwV7U0WDF4LQDIYktgzCYPXLEdMG4bD6rYChi7UQtTbAOM34qHKLYAttFsiSfGB9tpp0UTo4NtNUxjibHB9n72gCRGBtv8mQfGUWZ9YG28AYRr7nZ/yGMsjq9dbxzv+rXYa6+xeHm6qW9j2Wuv4fv40B/NA6786en7F6HGSzeSBryx5HF9jcRDKTd6ODfktVd/VY+nDXjU3/VsUuMy8mWsdt4EQKvGF9LHO+t1fTVrLOq/0rjLQ7tv5KFe4z0Y/VeO6qsl/ks02rj3XvVVPScabM7v9axV479FY614X1/1Gs+Lhpr3v77KNUbpv3JZX9Uao/RfgevbHiqIUfqv3N/KU35Vo/RfeXB7WmnxsmiUBTJehVVt3n/lyU21ZWss6L8q0Kmviti0/8qfW4hLihdWkl++OEnMKy122H/l6JPLYf+Voxo77L9yJHbYf+Xq+9hd/5W742pX/VdeXYUhtp5tin1+aJoNsd+PxcMX+/7gQ2yx/4+2xBVTeHgpppjG42nxxFQeQIwlpvOIaRwxpYeIY4hpPSbeXEzLay6m5jUV0/OaiSl6TcQ0vfpiqt5QHwyPLabs1RHT9qqLqXtVxfS9auIQvCriMLzy4lC8suJwvHLikLwy4rC8rcWheVuJw/OKxSF6ReIwveniUL1p4nC9yeKQvVHU1XTXuc3dUdDprMSN3LjSGYWeUsMPDculKAvJ5QsdxWJHIZ+LOBwOh8PhcDgcDofD4XA4HA6Hw+EElX8Ax5Dzlr1WtMMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDMtMDRUMTA6MDA6MDIrMDA6MDBIE/HDAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTAzLTA0VDEwOjAwOjAyKzAwOjAwOU5JfwAAAABJRU5ErkJggg==",ZFe=""+new URL("html-_9c5Ggq_.png",import.meta.url).href,KFe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAMAAAAJixmgAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACkVBMVEUAAAD/1gAAAAFWSAH2zgDDpACNdgBgUQE/NQEhHAERDgEJCAEBAQEbFwEkHgFmVgGMdQC4mgD1zgD3zwCjiQBRRAEKCAEIBwFHPAGSewDvyQDtxwB4ZQEUEQENCwFvXQHeugD70wCLdQAQDQEGBQGAawD50QDYtQA2LQErJAHMqwC6nACylQCpjgAEAwGagQCxlQCligAODAHFpQAtJgEWEgHhvQCEbwDsxgAMCgGghgB7ZwESDwEYFAGZgAC0lwAvJwGPeADPrgDqxADJqQCTewA+NAFdTgHrxQBrWgELCQH+1QAwKAHBogBYSgEDAwFxXwH0zQD40ACDbgD80wBTRgHLqgDVswDzzAAqIwGHcQD60gC8ngBFOgFBNwHatwBjUwF/awCcgwCrkABGOwG/oACWfgACAgETEAHbuAAoIgEiHQGhhwCiiADGpgAFBAG3mgBURgExKQGnjADowwAHBgFeTwHQrwDSsAC5mwCCbQAuJwGmiwD91ABLPwGqjwBDOAHpxAB0YQHuyAApIgHKqgCFcAC7nQBZSwFhUQFJPQFCNwFOQQGzlgA0LAFyYAFMQAHRrwAaFgGQeQAfGgF+agGojQAyKgHxygCRegBEOQE3LgGvkwAXEwHmwQA9MwE6MQFzYQEsJQHgvABXSQGGcAAVEgFnVgG1mABfUAHTsQBpWAF5ZgE7MgF1YgHUsgAZFQE1LAHAoQA8MgGukgDwyQBsWwFKPgFVRwHyywDOrQBtWwHcuQAdGAE5MAF9aQHEpACehQBPQgG+nwDnwgBlVQGIcgCwlAAmIAEcFwHjvgDkvwB8aAHWtADIqABcTQGfhQBSRQEPDQFoVwFANgHivgAzKwEeGQFqWQEjHQH///9xKO5qAAAAAXRSTlMAQObYZgAAAAFiS0dE2u4DJoIAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfnAwQKAS+wCuXTAAAFo0lEQVR42u3b+VtUVRgHcM9hEYYBwqkBwQUEIVAnhEDQFAQFZRQCUdnUTGEwKEsWEwMXhDS31Iwss02LFnIvK9ttsT3b/5t+SKaZc+5y5unJub5+vz/ec8885/PcuXPnvOfcMWMQBEEQBEEQBEEQBEEQBEEQBEEQBEEUwm7CAAwwwAADDDDAAAMMMMAAAwwwwAADDDDAAAMMMMAAAwwwwAADDDDAAAMMMMAAAwwwwAADDDDAAAMMMMAAAwwwwAADDDDAAAMMMMAAAwwwwAADDDDAAAMMMMAAAwzw/wXmQkIMzg0NCx8bEWmLstuiYyJib4sbRxrsuP0Op3BufML4RKrgpAkTuVYmTU6mCE6Zksr1kjY1nRw4405ulMwsYuBpqdw4zumkwDNc3CyuuwiBs829nNtnkgFn5HCVxOcSAaffzdWSl08DPIurJoEEuKBQGcxnUwDPUffyewpufnDKXHWvbR6BK1wku4rnl5SOK12wsMzuf7x8EYV7eLHYWjHbPdqWu8TneGQcjedwpvi0Xeo7O64cPVx1bzWNf1o1VULjMr+utcuvf8tXUJk8rBTaour8+1bXc86jGhrJTA+bhLZVYucSF1+9hlABIFtou0/qvfZ+N6USzzqhbSz1qqX4GF5PHdwsPoUdxMFrxMYW4mCHR2hs3UB85eEBsbUtgza4XJo75LS7KYMf1JgGlj1EGJy0UWvmG/Ew3dXDR7Qn+5s6GomCl+rVN6KXddJcH16vW9Lp6t5MEfxomkEZa9UWNzkw6zGs3G19rJcauLfPuFiZuY0YmCVuNanPbs+iBWY7Mk3EVTsdpMCsP8KsCL9rgBSYpe/0mK2ID7opgRl7PNrsIu+uIQVmBXvMLvITDlJgxkr2moj31dICM7b/gLH4IDUwY2FP2o12thSRAzN2aE+8vvhwHT0wY4lHntIVH6UIZizl6SEdcM4zJMGMsWnbtcXHqIIZW/GsFvg5umDGjj8vgz0nCINZ5wuyeAZlMKt+UQK/ZHWw47+AWX6F2L3P6uBSJbDuHruDYveXLQR+pbtfPrhBHPFJjefuqYoFOp+ZK3Z/1TLgxgYnf00+PCyO+HXplDcOcF6vM9utk3auWQXcvItzbs+Wjp8SR/ymeHlndXHO+Vs6nyvexFXWAHeW/zPLsa0UW0ZE8NtCIf76v0iX9uazWvH9gEIrgHtbbN4lIWEJ/7T0XDnidx/0eBceIjU3jyaL3c9YAJx11mdAE8/5XaDzEviCT/PmTT4Nq7Vu44XSUkTQwRff8d8w6Vmc5G0L3S3/VTr07+Wd6r86/K5ctHLEiN0vBRs8U97i7Ywdfo8x5s6YH6nxzlXKaM/3i8W2vTvET/9AbUZ8A8GXdV46srV96NRsGPF2/UhuPOO/9F8zWT6lKdhXOJYHlo+9PT/RKl+VbfGWJtM76jW+IDXBBp+oCAzsszBWqf3duNTwadH09sHPWrVaK4M/Hw4PyNvms2KSn8MDzufBB7sTAhlwuG/XjoC9Q24LVDyu5KkPOOeiX9cvAgU3WaJq2RyvPOAv/XuGFgfmDbFIIf4rl+KAY8Tf2CtfB+K92m+VlYd2u9KAN8qz3m8i1b2FA9ZZW+qIUhnxeK3ZQZuqtyvOSsulA4fNRzxHs+eiMjVv6jlrLYh/O2L2Uvug3sLKd1UK3uLvrbbloXeezWjArcf1u/4wZMZNm1BjwU0tnT/q7lqwhxhuFa39yfBO9vxs8rJW0Mq0p8u7NPdZ7TPdWtbYoXsrX/vF9LWAINalC479KjyUPWd7flPqmjylTP4Hc7X7gsKrPcEtxCcOr13+e9413mX7Y+Rkz/7SQJYpwlr+7Fsy1+bik2x/na88uu6yWj9LrS3diAAMMMAAAwwwwAADDDDAAAMMMMAAA3xrgxEEQRAEQRAEQRAEQRAEQRAEQRAEuWXyNzdzSI4Dd9tRAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTAzLTA0VDEwOjAwOjAyKzAwOjAwSBPxwwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wMy0wNFQxMDowMDowMiswMDowMDlOSX8AAAAASUVORK5CYII=",JFe=""+new URL("mongodb-DnU9EL9s.png",import.meta.url).href,$Fe=""+new URL("nodejs-Bw5ER_SM.png",import.meta.url).href,eke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAC+lBMVEUAAABV1NRSwN1SwN5TwN5SwN5SwN1SwN5SwN1Swd1Vu91Qwt1Swd1Twd1Twd1SwN1Twd5Twd5Swd1SwN5VxuJRwdxSwN1Twd5TwN5Swd4A//9IttpTwt1Twd1Vwt5Swd5Twd1Uwd0/v79Uwd5Swd1SwN5TwN9VwuBSwd1SwN5TwdtTwd1Rv9pSwN5TwN1Twd1Twd5Tw9tVwN1TwN5Twd5Twd1SwN5Vv9ROxNdTwN5SwN1Twt1Rv99Vwtpaw+FTwt5TwN1Twd1TwN1TwN1Twd5Twd5Swd5Twd1Swd1SwN1SwNxTwN1Rw95Swd1Rv9xSwd1Swd5SwN5Twd5VvOJ///9Swd1MzOVSwt9fv99SwN1Vv91RwN5SwN5SwN1TwN1PwdtVxuJSwd5mzMxSwd5TwN9Twd1UwN5Swd5Swd1SwN5SwN5Swd1Sv99Swd5Twd5TwN1Swd5TwtxTwd5Uwt9TwN1SwN5RxdxTwN5VweBVv99Twd5Vw91SwN5Pv99Swd5RweBTwN5Twd1TwN5Twd5SwN1Uwd1Pv99SwN1SwN1Twd1Tv9xZv9hSwd1TwN1Twt1Vv9tTwN5OxOFTwN5Twd1Twd5SwNxVqv9Twd5Swd5SwN5Swd1SwN5SwN1SwN9Swd1Vw9xVwN9VxN5RwN1SwN5cuedTwd9TwN5Swd5SwN1TwN5Swd5Twd5Twd5UwN5Twd5RwN1Twd5TwN1Uv9xbyNpTwN5Tv99Twd5SwN5TwN1Twd1SwN1Swd5Sv91NvN1Twd1Vwd1Sw+FTwN1QwN9TwN1SwN1TwN1Swd5Twd1SwN1SwN5Swd9SwN5Swd1Tv9xSwd1Swd5TwN1Rv95SwN1Sv95Twd1SwN1Rv99TwN1TwN1Rwd1TwN5TwN5Swd1Swd1RweBQvdpSwN5Swd1Vv99SwN5Qu+RSv91SwN1SwN1Twd5Twd5RwN1Swd5Swd5Rwt1Svd5Rwd9SwtxSwd5Swd1Tv95Twd1Swd5TwN1SwN1Twd5Twt1TwN5TwN5Twd7///9l1TinAAAA/HRSTlMABlqkxOHVvJdTDyZssdbu+Nq2ZglC3vu0RwEHXMc/V9dbBGfn+Ukq9Mk67BzM/qJGKy1WjeCbDA2c/XE4FRE3n7diPbLcPt/3mCV6L6ks/HxvpRsCxgpQCNg8TtGgzR0SlQXrMYBV8OTU8aEo232SwkO7WK+jFvIhMOMexSCqMtmJrJbAZBByTb5ZFHnlLiTpGpNrukoDdMt+iH+CQc8zOSdF6gtoh6bthvO1T16MasrdYQ69QISOwZnI0kQXgTYijynQubjDrqf6YLO/NJGF5m2LXZD2SIqDS3duY3gZI5TOGHYTaXuw6F81np1UH3A7rZpl73X1c9NMq+JmbhbdAAAAAWJLR0T9SwmT6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+cDBAoBMD0C6CYAAAkSSURBVGje7ZlbYE5XFscXcmnHJQkqhIy6fE1Iv48gpR/iLhlKXCIxI1WiGlFaFGlDNYx76jZI61JxH6JBqFZdRqY6iNKh06BotR1TOh2mYzqmM/N7mIdzTr5z2eHkoW/W21l77fU/++y11/rvdUQeyAP5yaRa9RpBwSGhDz38s3tZ1axVu05YeETdevWr6v+RBugS2bBRlNqmcZNow4jgn1fNf9NITPJoMwVE8xYtzTaex6riPyYWq7RqbTdpFGIziXvcvf8oL+Br0za+XfsOCdp03xMdzRadntTU/qDOXbomdusO0MM9QFuAnjpYr94+APqYFtE3CYDkX/TTFf0BnnINUBcYEHgc2AOAlEHGTgyOBPANGVphkjoM6O7Wf1q4/XXStTcekCYiMrw7AL/8ldliBBCX6hKgEZBhVXV6GoCRz4iMGgbgG51mMcgcAzzrEmAsMNqufC4LYFzM0GyA8SPs47WBwS4Bng9ssUkmRADEJQBMjHEMvwC86BJgEjDZqR41xQj5SaOcoy8BU10CRAADFfrMaZr/3qrEMxnwugRIAp5RDUzPAfC8rBp7BajjEiAXmKHQD5+prSBblWCfAh51CTAOeNWpTp1l7EHd5s7R14A8lwDZQDunejZA6ByAXztHuwHZLgHmKqNoHkD2/OFBAAscwwuBRS4B5gCL7cq+kUDu4yL5EYC/rQp/gEuAF4HX7QG0BIhdKiKyLAxYvkJx0H7jEmAl0Ma2wasAX3vtYbUfmFvgPP5vuASYDLxpVa0BWGs8rQNYb7XwAm6r5gog1hKJb6UAG/rVLCzc2LqwcNOyVoB/s2WJserYVsuWQOrdGrN62/bfxqGQHUN2tmg0Ybhm1w8oinIL0BtYmdrvuZ27lnBfCa499u0ZUgzMdF0yXwfGFFEFiRsH7HbpfuievUonYUkleV6v15tXkhTmUxlE78u/v/fEldGWyb7g0GQgvMt+Ww3t4gGS38m1QKSENkm7p/sDQ5JNbxw6u+nS+pIOMMhp+y7ACNn6bPX3DuYEZmW9Xyl7SU0/ZH6bwzrFSAA2ZCqSdwSQpL1warR50T0OKP0/lm1YjBx0xA8sExGRnUCkki5M9gHviojI0RTg4d9lGB6Cjjl5eEN9LGFsqYgcBPqLiGzyAL+vnByEbxIRqQWMFJEP1upx7Xvelqv2JOur26yRp23AcRGRD4GW+9UAXeOAP4iInKhIRAXpk/QdbG+ynH9Sc39qqaHJL9OKTluAJoG6OHj37sGBTTwN0EjkZT/4K8j1sY80iO4VAXX0OABnzpowdwEfS+pxIMjIAKsPazMzjKQWNQk4XCB/BM6Ya0crbScS9YOVB5B12rL8JkBY/WLA10XTFHQIBMpuPVef9QE9M88B9SwBeT4WIKOriEjmTIBo2/WhYxYwL9hUpjqYY/gTXVkDWPInoGi+dX7pBoApBUYtPzXcvoOfAuWAp1SPYmtauKBpZ5TrZg4asPUkwFiRFeFA7QJHiPTTM4bBNzOsABt09UU9LJ1kNbMuUD5dtgPBqgSi3TqSVwR4lUV0bpmvZYkpCgcdc4FLEgLsU0X5ZwB8bFxq7ADn9YH1ACxUeegJHJbkSniipPYxLUA+sQPMNs5QGNBAebeZAZRLLLBUedXMA5KHmmmdWQwG0LUI2KK86McAOeIFLiuTn+UTXansE70HwFWVh8vAXvkcGDdcMaxlP2MJ7ewAetisKNdyu6LefzEeeEHmjwcuOoev+TVHX+rPx63+vzKxQIAjDgedvEDR1yJ/BnzzHOO7gXDAcy1w9TSJzk2veYA4oKF9/vVJBkmOaggw21az0sKAv+QCs1RxZGzxACB4MuCvaZ3frgRgTpSIyKgMgJHxFoNmQFbaacC3UQ/biyb/elh28wHFkgFst5zib8IB9nbSr4+HAJLXmNsdHwGjpSADGGZsYNuv9O+/2Zyuj6fKNiDYdBSOaBs2pcJhxxsA3NxT8Z2ulwGviFwA+LZiZnyttWtXBpZaXS84nXKAtwztX/Xr7neNTYeqllYyx33TVVPUM2jFFGB5orpk7j8HfGhU57/p1GSuzlxv2TYlSNMnT7vQXEQWGVxogkfVVwhUCM8EI8Sy6ouUrivRs+usoY7MUN0gactHH7ntBzZV0JaUYyr/S8uAnVp77Sbw9ysnDFJ46HvVhK2dK3hgmUEqRNKSgOzGTvOCvUDCVu3hIXMMz0yvjMdX62lqxOVMudgsvpp2feSS03gBQLqk3r7Qf05SYFrkP1rfk51ufCLHwmaTQu/sAMo22g5i/YGxQOyNkHDLAT/e+eh9+fXWlwbkKOl7edjNkgiv1xtR0iAsRWWQO3apyxvCOsBHlSQOCHV9w1kF/HPFwsttQlLu7zoypM3lhfnxQFFzl/5Tf6iocmkxjfatu7MrTPnJVj25pvjAtWqBOfEuASYAORYi830kELKptLCwsLCwXWlpbxxU4R3glkuAdOCEVfUvc/nUSO8QJ1Eb5BLgMnDHds6nmt653V2gj43TXwVquAT4Dvi3vSOYAJQXiogkTgQ8Z20GvYBolwCLgHRHw8kDnLstUm2RsmG0CYhwCZABOM/7Yh9QJ1HeB5jlyDajgB0uAYIrUqlF1gPMXQ8wzMlzCgB/gTuAHOBrBdWbZpyAJEXCaQ7Q2B1AEaDKWZmhep5VpZzGAC7b7zuAL1QDo4Irp9KdgEiXe9ASqKkaaKGxvTmqL7EMGO8S4EdA9ddqkJFhzyhav72AH10C3ACKnb2JaQD+OICQmsrue22XAB1MnLdCbkcDlC1+NQLgh8/s45eq0JFqqljtt+MBxl8Qme4F8HewHYUTwH9cAlz3A4WWVonWHcj7QESk438BCLFwmXjA09FtRQuy/s3I/7QMgF36ZTvq8xQA/9OBjkrUIhWFr1RuAaw04m/0XY3zvRE4Rm21rs3dL/XLg+wEOOAaIDUE4FT7+Blnr67SbzpvWq7aiTV0WnNwQZfp+V26U6Wupshrybb6O+a8vaC/PdFmkrWsKr9jiy2/e4t2Kk5W5vktZpuydKmS9A30fOvUquSneFrPQIP1f49IFSWtXu3snJaHT165JxeJuTK1zhhPXu+m1eSBPJCfTP4P2qckJ0elpLAAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDMtMDRUMTA6MDA6MDIrMDA6MDBIE/HDAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTAzLTA0VDEwOjAwOjAyKzAwOjAwOU5JfwAAAABJRU5ErkJggg==",tke=""+new URL("tailwind-CLR6e3yI.png",import.meta.url).href,ike="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAMAAAAJixmgAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACT1BMVEUAAAAZdtLg7fn///+BtOYwg9ZVmd5wquOMuuioy+7D2/PR5Pbf7Pnv9fzw9vzs9Pvb6vi/2fKrze+XweuAs+ZppuJKk9wqgNU8i9l6sOW41fHo8frN4fWiyO13ruRMlNwie9Q3iNjZ6Pj8/f6szu91reQ2h9hLlNy10/Gkye05idi00vD+/v+cxOwad9L1+f2SvuojfNSLuugvg9bT5faCtOYnftV5r+UdeNPG3fSNu+lnpeFJkttfoODD3PNWm95and9Nldy71/Lh7fm31PGWweuJueibw+vi7vlFkNszhte61vFhoeAsgdYof9XM4fX9/v9YnN5jouBvqeNxq+PJ3/Q0htcrgdbK3/X6/P5tqOKaw+v0+f3z+P1opeLx9vw9i9mgx+wbd9Kz0vCVwOp0rOSfxuypzO5Mldyuz+9goOClye3p8vvO4vWvz+/y9/0eedMhe9Tu9fzS5PaTv+psp+IgetPm8Pp9suYfetPk7/oceNNZnN+Ywuux0fAwhNeexuxGkdtRl93r8/v2+v3I3vT3+v1bnd97seVen9++2PJDj9rW5/clfdR6r+WjyO3o8vuFtufE3PSKuegnf9WPvOk7itm61vJiouDt9PvC2vPe6/i51fEpgNUtgtYyhdc6itk/jdnL4PXV5vfP4/aRvelcnt+Uv+qZwuvl7/pmpOFnpOEkfNTY6PfW5venyu5HkdvX5/fH3vT5+/5Cj9o4iNhXm96x0PBEkNpTmN3U5feHuOhlo+G20/H4+/6tzu92reROltx/s+bB2vMmftSrdjnjAAAAAXRSTlMAQObYZgAAAAFiS0dEAxEMTPIAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfnAwQKARAGbMjuAAAEfUlEQVR42u3c6VcTZxTHcW8GhBREFLC4IRIDGjAWsTSiSAsFFQVjrNKUUGrclxpwR1S0SlWsu7gvuGvdrdbWrtr+YZWjR48nd7bTF/jc+X1fknkm+RyyMHcm9OuHEEIIIYQQQgghhBBCCCGEEEIWIgUDGGCAAQYYYIABBhhggAEGGGCAAQYYYIABBhhggAEGGGCAAQYYYIABBhhggAEGGGCAAQYYYIABBhhggAEGGGCAAQYYYIABBhhggAEGGGCAAQYYYIABBhhggAEGGGDbYJf2f0vQ33li/6Rk9wcpqa4BaWkDXekpgwZnZGYN+VAmOHvosOE6K9JGjMwZlSsKPDo5z2yZJ32MN18IuGCsx9rScSLAvsIiq0vHCwD7vROsL/1IfXDxMDtLJyoPLplka+nHqoNL7Xm1TxQHBybbXJqkOLjM7tIpaoOneuwuLVcbPM320gqlwZ/aX/qZ0uBK/U2qPh9XXZM8fXDljHd/PlNlcK3OK9gza3bd27ur718zJ/jmtuw+AM8Nsc2Lf+Tp/JYh36sdZfLewtq4u6z7Yv7rGxe8PxOPhviH/qXxCvYZHf5K52C5MdJ7c4PC4EAT4w1+rbt9fU2zpuUqDP6G+wUvNFpRXx2OKgwuZ7yROuM7ySaFwQkMeJFCY1rb4MUMeIlk8FIGPFcyeBkDXi4ZvIIBr5QMXsWAGyWDG7kzDKWCwdzHkuYWDA6xhw4ZcsE+/mApIyAVTKt58bc+qeA1OvOBWGaLTHBIdySSGvJLBLeu1Z8CrSv3ywPTeqPB16RQVBy4JGI468vbEBAGpmST8abL2yILvDHdbKK7aXObJDAVhE2H2FuS2gWBaaiFuX3eVkFg2mblVMX2Djlgmm5FHMuRA/bvsHQ+alGpFPDLA2NLp8VTd4oB03e7rIh3V4gBU36nFfH3e8SAKbrXytV44X1iwESjuyyII/vlgIkqfjAXuw4IAlPg4GpT8SFJYKI272ETcHCIKDBR8ZG1xuKjwsBEB441G4qnSgMTHe9uMgC75YFf7mub/nFyc5tAMNGJk1YutxQEJjp1WgdcJhRMiWd4cJdUMLUUsuCzYsEUOMceQvjFguk8+zrOlQvmvxNxQTC4gAM3CAZf5MCtgsE93AXzqr5L+xLaTXe6nPvbUlXwJe3yftMJLgO+oi5Y8+wwuT76KvedCIXBmha5dt5gk+vce9YNpcGaFrvZo7dFyS0O/KPiYE0Lds1uZd+i2dPlRReUB/c+s7ffvhM33eLnHndJArj34/Xe/ZwHr08RtudnuWM6h8PdUsCvmuB6mHJ3hsGFEEU+WWDTHpHDwBUOAz8iZ4F/euwwcAI5Czwr6izwiGJyFLiznhwFXhN/malkcMzL7EIt8BMb/0YrOKaWlAdT28/Vc8JWuOGnv/B7UHBqmfvrsUFNxtxnv3XorVZ0TBvt+b3sj7w/uUOjqr/+Nvraltpz6cTnG150L3z6z5neKt3XNmeN+tdkSZ+C+yKAAQYYYIABBhhgNcAIIYQQQgghhBBCCCGEEEIIIcf0H6s0di86BKRLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTAzLTA0VDEwOjAwOjAyKzAwOjAwSBPxwwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wMy0wNFQxMDowMDowMiswMDowMDlOSX8AAAAASUVORK5CYII=",rke=""+new URL("OnviroTech-7USFNrNY.png",import.meta.url).href,nke=""+new URL("PCPS-v6tLhqyN.png",import.meta.url).href,ske=""+new URL("laliguras-DjZvKc-K.svg",import.meta.url).href,ake=""+new URL("laliguras-1-Bjhhcecb.png",import.meta.url).href,oke=""+new URL("lionsapp-Bd5GS92V.jpg",import.meta.url).href,lke=""+new URL("nepaltravel-UUFs-XvL.jpg",import.meta.url).href,cke=""+new URL("britishcollege-DISNd2l7.png",import.meta.url).href,uke=""+new URL("mountsinai-BjpTjpjp.png",import.meta.url).href,hke=""+new URL("islington-BwQkjy32.png",import.meta.url).href,dke=""+new URL("LA-C8p1Vc_M.png",import.meta.url).href,zW=[{id:"about",title:"About"},{id:"work",title:"Work"},{id:"contact",title:"Contact"}],fke=[{title:"Data Science",icon:OW},{title:"Database Developer",icon:OW},{title:"Web & Mobile Developer",icon:lJ},{title:"Backend Developer",icon:GFe}],pke=[{name:"HTML 5",icon:ZFe},{name:"CSS 3",icon:XFe},{name:"JavaScript",icon:KFe},{name:"TypeScript",icon:ike},{name:"React JS",icon:eke},{name:"Tailwind CSS",icon:tke},{name:"Node JS",icon:$Fe},{name:"MongoDB",icon:JFe},{name:"git",icon:QFe},{name:"figma",icon:YFe},{name:"docker",icon:qFe}],mke=[{title:"Full Time - Lecturer",company_name:"PCPS College",icon:nke,iconBg:"#E6DEDD",date:"September 2022 - Present",points:["PROVIDED INSTRUCTION AND GUIDANCE TO STUDENTS IN THE MODULES OF PYTHON PROGRAMMING, DATABASE,CONCEPT OF ARTIFICIAL INTELLIGENCE, MOBILE APPLICATION DEVELOPMENT (FLUTTER).","CONDUCTED LECTURING SESSIONS AS MODULE LEADER, TAKING FULL CONTROL OF MODULES/COURSES TO REINFORCE LEARNING OBJECTIVES AND ENABLE STUDENTS TO COMPLETE THEIR ASSIGNMENTS.","ASSISTED IN GRADING ASSIGNMENTS AND PROVIDED CONSTRUCTIVE FEEDBACK TO STUDENTS, FACILITATING THEIR GROWTH AND IMPROVEMENT."]},{title:"Front-End & NodeJs Developer (PART TIME)",company_name:"Laliguras",icon:ske,iconBg:"#E6DEDD",date:"November 2022 - Present",points:["Developing and maintaining web applications using HTML, CSS, NodeJS and other related technologies.","Collaborating with cross-functional teams including designers, product managers, and other developers to create high-quality products.","Implementing responsive design and ensuring cross-browser compatibility.","Participating in code reviews and providing constructive feedback to other developers."]},{title:"Flutter Developer",company_name:"OnviroTech",icon:rke,iconBg:"#E6DEDD",date:"September 2021 - August 2022",points:["Developing and maintaining Mobile applications using Flutter.","Designing UI/UX for the mobile application","Collaborating with cross-functional teams including designers, product managers, and other developers to create high-quality products.","Participating in code reviews and providing constructive feedback to other developers."]},{title:"Freelance Developer",company_name:"Self-Employed",icon:lJ,iconBg:"#E6DEDD",date:"January 2020 - Present",points:["Developing and maintaining web and mobile applications for various clients.","Implementing responsive design and ensuring cross-browser compatibility.","Collaborating with clients to understand their requirements and deliver high-quality solutions."]}],gke=[{title:"MSC INFORMATION AND TECHNOLOGY",company_name:"British College",icon:cke,iconBg:"#E6DEDD",date:"September  2022 - 2024",points:["The MSc Information and Technology is a programme rich in a specialisation, that provides a transformational experience to its students by integrating the technological and business aspects of modern IT.","In an era where digitalisation is pervasive across all sectors and industries, the course has been designed to address the high demands of both the private and public sector, by filling the current digital skills gap."]},{title:"BSC (HONS) COMPUTING - First Class",company_name:"Islington College",icon:hke,iconBg:"#E6DEDD",date:"2018 - 2022",points:["BSc (Hons) Computing, a 3 year IT course in Nepal is a unique blend of practical and theoretical learning that lays primary focus on the techniques, theory and application along with interpersonal, team working and IT skills","London Metropolitan University authorises and approves Islington College to deliver and assess part or all of the course. This course is also taught and assessed at London Met’s main campus in London, United Kingdom. London Met holds direct responsibility for quality assurance, curriculum content, and the teaching, learning and assessment strategy."]},{title:"+2 in Science",company_name:"Little Angles College",icon:dke,iconBg:"#E6DEDD",date:"2016 - 2018",points:["LAC is the strong foundation of the academically reputed institution of Little Angels’ Education Group","LAC has state-of-the-art infrastructure and modern self-development approaches conducive to the learning and teaching process"]},{title:"School",company_name:"Mount Sinai English Boarding School",icon:uke,iconBg:"#E6DEDD",date:"2003 - 2016",points:["Mount Sinai English Boarding School is a School located at M9GM+6H6, Madhyapur Thimi, 44600, NP.","The business is listed under school category. It has received 5 reviews with an average rating of 5 stars."]}],vke=[{name:"laliguras",description:"Web-based platform that allows users to search, book, and manage their Treaking Trip.",tags:[{name:"HTMl",color:"blue-text-gradient"},{name:"mongodb",color:"green-text-gradient"},{name:"nodejs",color:"green-text-gradient"},{name:"tailwind",color:"pink-text-gradient"}],image:ake,source_code_link:"https://laliguras.de"},{name:"LionsClub Nepal App",description:"Lions Club Offical Mobile application for Android/IOS.",tags:[{name:"Flutter",color:"blue-text-gradient"},{name:"Figma",color:"green-text-gradient"},{name:"Dart",color:"pink-text-gradient"}],image:oke,source_code_link:"https://play.google.com/store/apps/details?id=com.LionsClubapp.Nepal"},{name:"Nepal Travel",description:"A comprehensive Mobile Application travel booking platform that allows users to book hotels and offers curated recommendations for popular destinations of Nepal.",tags:[{name:"nextjs",color:"blue-text-gradient"},{name:"supabase",color:"green-text-gradient"},{name:"css",color:"pink-text-gradient"}],image:lke,source_code_link:"https://github.com/Nujan100/ReactChatApp"}],yke=()=>{const[e,t]=Se.useState(""),[i,r]=Se.useState(!1),[n,s]=Se.useState(!1);return Se.useEffect(()=>{const a=()=>{window.scrollY>100?s(!0):(s(!1),t(""))};window.addEventListener("scroll",a);const o=()=>{document.querySelectorAll("section[id]").forEach(c=>{const u=c.getAttribute("id"),h=c.offsetHeight,d=c.getBoundingClientRect().top-h*.2;d<0&&d+h>0&&t(u)})};return window.addEventListener("scroll",o),()=>{window.removeEventListener("scroll",a),window.removeEventListener("scroll",o)}},[]),Qe.jsx("nav",{className:`${Wo.paddingX} w-full flex items-center py-5 fixed top-0 z-20 ${n?"bg-primary":"bg-transparent"}`,children:Qe.jsxs("div",{className:"w-full flex justify-between items-center max-w-7xl mx-auto",children:[Qe.jsxs(S$,{to:"/",className:"flex items-center gap-2",onClick:()=>{window.scrollTo(0,0)},children:[Qe.jsx("img",{src:oJ,alt:"logo",className:"w-9 h-9 object-contain"}),Qe.jsxs("p",{className:"text-white text-[18px] font-bold cursor-pointer flex ",children:["Nujan  ",Qe.jsx("span",{className:"sm:block hidden",children:" | Shrestha"})]})]}),Qe.jsx("ul",{className:"list-none hidden sm:flex flex-row gap-10",children:zW.map(a=>Qe.jsx("li",{className:`${e===a.id?"text-white":"text-secondary"} hover:text-white text-[18px] font-medium cursor-pointer`,children:Qe.jsx("a",{href:`#${a.id}`,children:a.title})},a.id))}),Qe.jsxs("div",{className:"sm:hidden flex flex-1 justify-end items-center",children:[Qe.jsx("img",{src:i?WFe:jFe,alt:"menu",className:"w-[28px] h-[28px] object-contain",onClick:()=>r(!i)}),Qe.jsx("div",{className:`${i?"flex":"hidden"} p-6 black-gradient absolute top-20 right-0 mx-4 my-2 min-w-[140px] z-10 rounded-xl`,children:Qe.jsx("ul",{className:"list-none flex justify-end items-start flex-1 flex-col gap-4",children:zW.map(a=>Qe.jsx("li",{className:`font-poppins font-medium cursor-pointer text-[16px] ${e===a.id?"text-white":"text-secondary"}`,onClick:()=>{r(!i)},children:Qe.jsx("a",{href:`#${a.id}`,children:a.title})},a.id))})})]})]})})},BW=(e,t,i,r)=>{e.style.transition=`${t} ${i}ms ${r}`},dd=(e,t,i)=>Math.min(Math.max(e,t),i);class xke{constructor(t,i){this.glareAngle=0,this.glareOpacity=0,this.calculateGlareSize=a=>{const{width:o,height:l}=a,c=Math.sqrt(o**2+l**2);return{width:c,height:c}},this.setSize=a=>{const o=this.calculateGlareSize(a);this.glareEl.style.width=`${o.width}px`,this.glareEl.style.height=`${o.height}px`},this.update=(a,o,l,c)=>{this.updateAngle(a,o.glareReverse),this.updateOpacity(a,o,l,c)},this.updateAngle=(a,o)=>{const{xPercentage:l,yPercentage:c}=a,u=180/Math.PI,h=l?Math.atan2(c,-l)*u:0;this.glareAngle=h-(o?180:0)},this.updateOpacity=(a,o,l,c)=>{const{xPercentage:u,yPercentage:h}=a,{glarePosition:d,glareReverse:f,glareMaxOpacity:m}=o,v=l?-1:1,g=c?-1:1,x=f?-1:1;let S=0;switch(d){case"top":S=-u*v*x;break;case"right":S=h*g*x;break;case"bottom":case void 0:S=u*v*x;break;case"left":S=-h*g*x;break;case"all":S=Math.hypot(u,h)}const _=dd(S,0,100);this.glareOpacity=_*m/100},this.render=a=>{const{glareColor:o}=a;this.glareEl.style.transform=`rotate(${this.glareAngle}deg) translate(-50%, -50%)`,this.glareEl.style.opacity=this.glareOpacity.toString(),this.glareEl.style.background=`linear-gradient(0deg, rgba(255,255,255,0) 0%, ${o} 100%)`},this.glareWrapperEl=document.createElement("div"),this.glareEl=document.createElement("div"),this.glareWrapperEl.appendChild(this.glareEl),this.glareWrapperEl.className="glare-wrapper",this.glareEl.className="glare";const r={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",borderRadius:i,WebkitMaskImage:"-webkit-radial-gradient(white, black)",pointerEvents:"none"},n=this.calculateGlareSize(t),s={position:"absolute",top:"50%",left:"50%",transformOrigin:"0% 0%",pointerEvents:"none",width:`${n.width}px`,height:`${n.height}px`};Object.assign(this.glareWrapperEl.style,r),Object.assign(this.glareEl.style,s)}}class wke{constructor(){this.glareAngle=0,this.glareOpacity=0,this.tiltAngleX=0,this.tiltAngleY=0,this.tiltAngleXPercentage=0,this.tiltAngleYPercentage=0,this.update=(t,i)=>{this.updateTilt(t,i),this.updateTiltManualInput(t,i),this.updateTiltReverse(i),this.updateTiltLimits(i)},this.updateTilt=(t,i)=>{const{xPercentage:r,yPercentage:n}=t,{tiltMaxAngleX:s,tiltMaxAngleY:a}=i;this.tiltAngleX=r*s/100,this.tiltAngleY=n*a/100*-1},this.updateTiltManualInput=(t,i)=>{const{tiltAngleXManual:r,tiltAngleYManual:n,tiltMaxAngleX:s,tiltMaxAngleY:a}=i;(r!==null||n!==null)&&(this.tiltAngleX=r!==null?r:0,this.tiltAngleY=n!==null?n:0,t.xPercentage=100*this.tiltAngleX/s,t.yPercentage=100*this.tiltAngleY/a)},this.updateTiltReverse=t=>{const i=t.tiltReverse?-1:1;this.tiltAngleX=i*this.tiltAngleX,this.tiltAngleY=i*this.tiltAngleY},this.updateTiltLimits=t=>{const{tiltAxis:i}=t;this.tiltAngleX=dd(this.tiltAngleX,-90,90),this.tiltAngleY=dd(this.tiltAngleY,-90,90),i&&(this.tiltAngleX=i==="x"?this.tiltAngleX:0,this.tiltAngleY=i==="y"?this.tiltAngleY:0)},this.updateTiltAnglesPercentage=t=>{const{tiltMaxAngleX:i,tiltMaxAngleY:r}=t;this.tiltAngleXPercentage=this.tiltAngleX/i*100,this.tiltAngleYPercentage=this.tiltAngleY/r*100},this.render=t=>{t.style.transform+=`rotateX(${this.tiltAngleX}deg) rotateY(${this.tiltAngleY}deg) `}}}const bke={scale:1,perspective:1e3,flipVertically:!1,flipHorizontally:!1,reset:!0,transitionEasing:"cubic-bezier(.03,.98,.52,.99)",transitionSpeed:400,trackOnWindow:!1,gyroscope:!1,tiltEnable:!0,tiltReverse:!1,tiltAngleXInitial:0,tiltAngleYInitial:0,tiltMaxAngleX:20,tiltMaxAngleY:20,tiltAxis:void 0,tiltAngleXManual:null,tiltAngleYManual:null,glareEnable:!1,glareMaxOpacity:.7,glareColor:"#ffffff",glarePosition:"bottom",glareReverse:!1,glareBorderRadius:"0"};class cU extends Se.PureComponent{constructor(){super(...arguments),this.wrapperEl={node:null,size:{width:0,height:0,left:0,top:0},clientPosition:{x:null,y:null,xPercentage:0,yPercentage:0},updateAnimationId:null,scale:1},this.tilt=null,this.glare=null,this.addDeviceOrientationEventListener=async()=>{if(!window.DeviceOrientationEvent)return;const t=DeviceOrientationEvent.requestPermission;typeof t=="function"?await t()==="granted"&&window.addEventListener("deviceorientation",this.onMove):window.addEventListener("deviceorientation",this.onMove)},this.setSize=()=>{this.setWrapperElSize(),this.glare&&this.glare.setSize(this.wrapperEl.size)},this.mainLoop=t=>{this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.processInput(t),this.update(t.type),this.wrapperEl.updateAnimationId=requestAnimationFrame(this.renderFrame)},this.onEnter=t=>{const{onEnter:i}=this.props;this.setSize(),this.wrapperEl.node.style.willChange="transform",this.setTransitions(),i&&i({event:t})},this.onMove=t=>{this.mainLoop(t),this.emitOnMove(t)},this.onLeave=t=>{const{onLeave:i}=this.props;if(this.setTransitions(),i&&i({event:t}),this.props.reset){const r=new CustomEvent("autoreset");this.onMove(r)}},this.processInput=t=>{const{scale:i}=this.props;switch(t.type){case"mousemove":this.wrapperEl.clientPosition.x=t.pageX,this.wrapperEl.clientPosition.y=t.pageY,this.wrapperEl.scale=i;break;case"touchmove":this.wrapperEl.clientPosition.x=t.touches[0].pageX,this.wrapperEl.clientPosition.y=t.touches[0].pageY,this.wrapperEl.scale=i;break;case"deviceorientation":this.processInputDeviceOrientation(t),this.wrapperEl.scale=i;break;case"autoreset":{const{tiltAngleXInitial:r,tiltAngleYInitial:n,tiltMaxAngleX:s,tiltMaxAngleY:a}=this.props,o=n/a*100;this.wrapperEl.clientPosition.xPercentage=dd(r/s*100,-100,100),this.wrapperEl.clientPosition.yPercentage=dd(o,-100,100),this.wrapperEl.scale=1;break}}},this.processInputDeviceOrientation=t=>{if(!t.gamma||!t.beta||!this.props.gyroscope)return;const{tiltMaxAngleX:i,tiltMaxAngleY:r}=this.props,n=t.gamma;this.wrapperEl.clientPosition.xPercentage=t.beta/i*100,this.wrapperEl.clientPosition.yPercentage=n/r*100,this.wrapperEl.clientPosition.xPercentage=dd(this.wrapperEl.clientPosition.xPercentage,-100,100),this.wrapperEl.clientPosition.yPercentage=dd(this.wrapperEl.clientPosition.yPercentage,-100,100)},this.update=t=>{const{tiltEnable:i,flipVertically:r,flipHorizontally:n}=this.props;t!=="autoreset"&&t!=="deviceorientation"&&t!=="propChange"&&this.updateClientInput(),i&&this.tilt.update(this.wrapperEl.clientPosition,this.props),this.updateFlip(),this.tilt.updateTiltAnglesPercentage(this.props),this.glare&&this.glare.update(this.wrapperEl.clientPosition,this.props,r,n)},this.updateClientInput=()=>{const{trackOnWindow:t}=this.props;let i,r;if(t){const{x:n,y:s}=this.wrapperEl.clientPosition;i=s/window.innerHeight*200-100,r=n/window.innerWidth*200-100}else{const{size:{width:n,height:s,left:a,top:o},clientPosition:{x:l,y:c}}=this.wrapperEl;i=(c-o)/s*200-100,r=(l-a)/n*200-100}this.wrapperEl.clientPosition.xPercentage=dd(i,-100,100),this.wrapperEl.clientPosition.yPercentage=dd(r,-100,100)},this.updateFlip=()=>{const{flipVertically:t,flipHorizontally:i}=this.props;t&&(this.tilt.tiltAngleX+=180,this.tilt.tiltAngleY*=-1),i&&(this.tilt.tiltAngleY+=180)},this.renderFrame=()=>{this.resetWrapperElTransform(),this.renderPerspective(),this.tilt.render(this.wrapperEl.node),this.renderScale(),this.glare&&this.glare.render(this.props)}}componentDidMount(){if(this.tilt=new wke,this.initGlare(),this.setSize(),this.addEventListeners(),typeof CustomEvent>"u")return;const t=new CustomEvent("autoreset");this.mainLoop(t);const i=new CustomEvent("initial");this.emitOnMove(i)}componentWillUnmount(){this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.removeEventListeners()}componentDidUpdate(){const t=new CustomEvent("propChange");this.mainLoop(t),this.emitOnMove(t)}addEventListeners(){const{trackOnWindow:t,gyroscope:i}=this.props;window.addEventListener("resize",this.setSize),t&&(window.addEventListener("mouseenter",this.onEnter),window.addEventListener("mousemove",this.onMove),window.addEventListener("mouseout",this.onLeave),window.addEventListener("touchstart",this.onEnter),window.addEventListener("touchmove",this.onMove),window.addEventListener("touchend",this.onLeave)),i&&this.addDeviceOrientationEventListener()}removeEventListeners(){const{trackOnWindow:t,gyroscope:i}=this.props;window.removeEventListener("resize",this.setSize),t&&(window.removeEventListener("mouseenter",this.onEnter),window.removeEventListener("mousemove",this.onMove),window.removeEventListener("mouseout",this.onLeave),window.removeEventListener("touchstart",this.onEnter),window.removeEventListener("touchmove",this.onMove),window.removeEventListener("touchend",this.onLeave)),i&&window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this.onMove)}setWrapperElSize(){const t=this.wrapperEl.node.getBoundingClientRect();this.wrapperEl.size.width=this.wrapperEl.node.offsetWidth,this.wrapperEl.size.height=this.wrapperEl.node.offsetHeight,this.wrapperEl.size.left=t.left+window.scrollX,this.wrapperEl.size.top=t.top+window.scrollY}initGlare(){const{glareEnable:t,glareBorderRadius:i}=this.props;t&&(this.glare=new xke(this.wrapperEl.size,i),this.wrapperEl.node.appendChild(this.glare.glareWrapperEl))}emitOnMove(t){const{onMove:i}=this.props;if(!i)return;let r=0,n=0;this.glare&&(r=this.glare.glareAngle,n=this.glare.glareOpacity),i({tiltAngleX:this.tilt.tiltAngleX,tiltAngleY:this.tilt.tiltAngleY,tiltAngleXPercentage:this.tilt.tiltAngleXPercentage,tiltAngleYPercentage:this.tilt.tiltAngleYPercentage,glareAngle:r,glareOpacity:n,event:t})}resetWrapperElTransform(){this.wrapperEl.node.style.transform=""}renderPerspective(){const{perspective:t}=this.props;this.wrapperEl.node.style.transform+=`perspective(${t}px) `}renderScale(){const{scale:t}=this.wrapperEl;this.wrapperEl.node.style.transform+=`scale3d(${t},${t},${t})`}setTransitions(){const{transitionSpeed:t,transitionEasing:i}=this.props;BW(this.wrapperEl.node,"all",t,i),this.glare&&BW(this.glare.glareEl,"opacity",t,i)}render(){const{children:t,className:i,style:r}=this.props;return Qe.jsx("div",{ref:n=>{this.wrapperEl.node=n},onMouseEnter:this.onEnter,onMouseMove:this.onMove,onMouseLeave:this.onLeave,onTouchStart:this.onEnter,onTouchMove:this.onMove,onTouchEnd:this.onLeave,className:i,style:r,children:t})}}cU.defaultProps=bke;var PR,NW;function _ke(){if(NW)return PR;NW=1;function e(o){return o&&typeof o=="object"&&"default"in o?o.default:o}var t=Kg(),i=e(t);function r(o,l,c){return l in o?Object.defineProperty(o,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[l]=c,o}function n(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,o.__proto__=l}var s=!!(typeof window<"u"&&window.document&&window.document.createElement);function a(o,l,c){if(typeof o!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof l!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof c<"u"&&typeof c!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function u(h){return h.displayName||h.name||"Component"}return function(d){if(typeof d!="function")throw new Error("Expected WrappedComponent to be a React component.");var f=[],m;function v(){m=o(f.map(function(x){return x.props})),g.canUseDOM?l(m):c&&(m=c(m))}var g=function(x){n(S,x);function S(){return x.apply(this,arguments)||this}S.peek=function(){return m},S.rewind=function(){if(S.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var T=m;return m=void 0,f=[],T};var _=S.prototype;return _.UNSAFE_componentWillMount=function(){f.push(this),v()},_.componentDidUpdate=function(){v()},_.componentWillUnmount=function(){var T=f.indexOf(this);f.splice(T,1),v()},_.render=function(){return i.createElement(d,this.props)},S}(t.PureComponent);return r(g,"displayName","SideEffect("+u(d)+")"),r(g,"canUseDOM",s),g}}return PR=a,PR}var Ske=_ke();const Mke=Cp(Ske);var DR,UW;function Ake(){if(UW)return DR;UW=1;var e=typeof Element<"u",t=typeof Map=="function",i=typeof Set=="function",r=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function n(s,a){if(s===a)return!0;if(s&&a&&typeof s=="object"&&typeof a=="object"){if(s.constructor!==a.constructor)return!1;var o,l,c;if(Array.isArray(s)){if(o=s.length,o!=a.length)return!1;for(l=o;l--!==0;)if(!n(s[l],a[l]))return!1;return!0}var u;if(t&&s instanceof Map&&a instanceof Map){if(s.size!==a.size)return!1;for(u=s.entries();!(l=u.next()).done;)if(!a.has(l.value[0]))return!1;for(u=s.entries();!(l=u.next()).done;)if(!n(l.value[1],a.get(l.value[0])))return!1;return!0}if(i&&s instanceof Set&&a instanceof Set){if(s.size!==a.size)return!1;for(u=s.entries();!(l=u.next()).done;)if(!a.has(l.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(a)){if(o=s.length,o!=a.length)return!1;for(l=o;l--!==0;)if(s[l]!==a[l])return!1;return!0}if(s.constructor===RegExp)return s.source===a.source&&s.flags===a.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof a.valueOf=="function")return s.valueOf()===a.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof a.toString=="function")return s.toString()===a.toString();if(c=Object.keys(s),o=c.length,o!==Object.keys(a).length)return!1;for(l=o;l--!==0;)if(!Object.prototype.hasOwnProperty.call(a,c[l]))return!1;if(e&&s instanceof Element)return!1;for(l=o;l--!==0;)if(!((c[l]==="_owner"||c[l]==="__v"||c[l]==="__o")&&s.$$typeof)&&!n(s[c[l]],a[c[l]]))return!1;return!0}return s!==s&&a!==a}return DR=function(a,o){try{return n(a,o)}catch(l){if((l.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw l}},DR}var Eke=Ake();const Tke=Cp(Eke);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var RR,FW;function Cke(){if(FW)return RR;FW=1;var e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function r(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function n(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var a={},o=0;o<10;o++)a["_"+String.fromCharCode(o)]=o;var l=Object.getOwnPropertyNames(a).map(function(u){return a[u]});if(l.join("")!=="0123456789")return!1;var c={};return"abcdefghijklmnopqrst".split("").forEach(function(u){c[u]=u}),Object.keys(Object.assign({},c)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return RR=n()?Object.assign:function(s,a){for(var o,l=r(s),c,u=1;u<arguments.length;u++){o=Object(arguments[u]);for(var h in o)t.call(o,h)&&(l[h]=o[h]);if(e){c=e(o);for(var d=0;d<c.length;d++)i.call(o,c[d])&&(l[c[d]]=o[c[d]])}}return l},RR}var Pke=Cke();const Dke=Cp(Pke);var Ng={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},Vi={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(Vi).map(function(e){return Vi[e]});var un={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},u2={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},g_={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},Rke=Object.keys(u2).reduce(function(e,t){return e[u2[t]]=t,e},{}),Ike=[Vi.NOSCRIPT,Vi.SCRIPT,Vi.STYLE],Hc="data-react-helmet",Lke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oke=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},zke=function(){function e(t,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Io=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Bke=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},kW=function(e,t){var i={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);return i},Nke=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e},JO=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return i===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Uke=function(t){var i=Yy(t,Vi.TITLE),r=Yy(t,g_.TITLE_TEMPLATE);if(r&&i)return r.replace(/%s/g,function(){return Array.isArray(i)?i.join(""):i});var n=Yy(t,g_.DEFAULT_TITLE);return i||n||void 0},Fke=function(t){return Yy(t,g_.ON_CHANGE_CLIENT_STATE)||function(){}},IR=function(t,i){return i.filter(function(r){return typeof r[t]<"u"}).map(function(r){return r[t]}).reduce(function(r,n){return Io({},r,n)},{})},kke=function(t,i){return i.filter(function(r){return typeof r[Vi.BASE]<"u"}).map(function(r){return r[Vi.BASE]}).reverse().reduce(function(r,n){if(!r.length)for(var s=Object.keys(n),a=0;a<s.length;a++){var o=s[a],l=o.toLowerCase();if(t.indexOf(l)!==-1&&n[l])return r.concat(n)}return r},[])},Cw=function(t,i,r){var n={};return r.filter(function(s){return Array.isArray(s[t])?!0:(typeof s[t]<"u"&&jke("Helmet: "+t+' should be of type "Array". Instead found type "'+Lke(s[t])+'"'),!1)}).map(function(s){return s[t]}).reverse().reduce(function(s,a){var o={};a.filter(function(d){for(var f=void 0,m=Object.keys(d),v=0;v<m.length;v++){var g=m[v],x=g.toLowerCase();i.indexOf(x)!==-1&&!(f===un.REL&&d[f].toLowerCase()==="canonical")&&!(x===un.REL&&d[x].toLowerCase()==="stylesheet")&&(f=x),i.indexOf(g)!==-1&&(g===un.INNER_HTML||g===un.CSS_TEXT||g===un.ITEM_PROP)&&(f=g)}if(!f||!d[f])return!1;var S=d[f].toLowerCase();return n[f]||(n[f]={}),o[f]||(o[f]={}),n[f][S]?!1:(o[f][S]=!0,!0)}).reverse().forEach(function(d){return s.push(d)});for(var l=Object.keys(o),c=0;c<l.length;c++){var u=l[c],h=Dke({},n[u],o[u]);n[u]=h}return s},[]).reverse()},Yy=function(t,i){for(var r=t.length-1;r>=0;r--){var n=t[r];if(n.hasOwnProperty(i))return n[i]}return null},Vke=function(t){return{baseTag:kke([un.HREF,un.TARGET],t),bodyAttributes:IR(Ng.BODY,t),defer:Yy(t,g_.DEFER),encode:Yy(t,g_.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:IR(Ng.HTML,t),linkTags:Cw(Vi.LINK,[un.REL,un.HREF],t),metaTags:Cw(Vi.META,[un.NAME,un.CHARSET,un.HTTPEQUIV,un.PROPERTY,un.ITEM_PROP],t),noscriptTags:Cw(Vi.NOSCRIPT,[un.INNER_HTML],t),onChangeClientState:Fke(t),scriptTags:Cw(Vi.SCRIPT,[un.SRC,un.INNER_HTML],t),styleTags:Cw(Vi.STYLE,[un.CSS_TEXT],t),title:Uke(t),titleAttributes:IR(Ng.TITLE,t)}},$O=function(){var e=Date.now();return function(t){var i=Date.now();i-e>16?(e=i,t(i)):setTimeout(function(){$O(t)},0)}}(),VW=function(t){return clearTimeout(t)},Hke=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||$O:global.requestAnimationFrame||$O,Gke=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||VW:global.cancelAnimationFrame||VW,jke=function(t){return console&&typeof console.warn=="function"&&console.warn(t)},Pw=null,Wke=function(t){Pw&&Gke(Pw),t.defer?Pw=Hke(function(){HW(t,function(){Pw=null})}):(HW(t),Pw=null)},HW=function(t,i){var r=t.baseTag,n=t.bodyAttributes,s=t.htmlAttributes,a=t.linkTags,o=t.metaTags,l=t.noscriptTags,c=t.onChangeClientState,u=t.scriptTags,h=t.styleTags,d=t.title,f=t.titleAttributes;ez(Vi.BODY,n),ez(Vi.HTML,s),Xke(d,f);var m={baseTag:oy(Vi.BASE,r),linkTags:oy(Vi.LINK,a),metaTags:oy(Vi.META,o),noscriptTags:oy(Vi.NOSCRIPT,l),scriptTags:oy(Vi.SCRIPT,u),styleTags:oy(Vi.STYLE,h)},v={},g={};Object.keys(m).forEach(function(x){var S=m[x],_=S.newTags,A=S.oldTags;_.length&&(v[x]=_),A.length&&(g[x]=m[x].oldTags)}),i&&i(),c(t,v,g)},cJ=function(t){return Array.isArray(t)?t.join(""):t},Xke=function(t,i){typeof t<"u"&&document.title!==t&&(document.title=cJ(t)),ez(Vi.TITLE,i)},ez=function(t,i){var r=document.getElementsByTagName(t)[0];if(r){for(var n=r.getAttribute(Hc),s=n?n.split(","):[],a=[].concat(s),o=Object.keys(i),l=0;l<o.length;l++){var c=o[l],u=i[c]||"";r.getAttribute(c)!==u&&r.setAttribute(c,u),s.indexOf(c)===-1&&s.push(c);var h=a.indexOf(c);h!==-1&&a.splice(h,1)}for(var d=a.length-1;d>=0;d--)r.removeAttribute(a[d]);s.length===a.length?r.removeAttribute(Hc):r.getAttribute(Hc)!==o.join(",")&&r.setAttribute(Hc,o.join(","))}},oy=function(t,i){var r=document.head||document.querySelector(Vi.HEAD),n=r.querySelectorAll(t+"["+Hc+"]"),s=Array.prototype.slice.call(n),a=[],o=void 0;return i&&i.length&&i.forEach(function(l){var c=document.createElement(t);for(var u in l)if(l.hasOwnProperty(u))if(u===un.INNER_HTML)c.innerHTML=l.innerHTML;else if(u===un.CSS_TEXT)c.styleSheet?c.styleSheet.cssText=l.cssText:c.appendChild(document.createTextNode(l.cssText));else{var h=typeof l[u]>"u"?"":l[u];c.setAttribute(u,h)}c.setAttribute(Hc,"true"),s.some(function(d,f){return o=f,c.isEqualNode(d)})?s.splice(o,1):a.push(c)}),s.forEach(function(l){return l.parentNode.removeChild(l)}),a.forEach(function(l){return r.appendChild(l)}),{oldTags:s,newTags:a}},uJ=function(t){return Object.keys(t).reduce(function(i,r){var n=typeof t[r]<"u"?r+'="'+t[r]+'"':""+r;return i?i+" "+n:n},"")},qke=function(t,i,r,n){var s=uJ(r),a=cJ(i);return s?"<"+t+" "+Hc+'="true" '+s+">"+JO(a,n)+"</"+t+">":"<"+t+" "+Hc+'="true">'+JO(a,n)+"</"+t+">"},Yke=function(t,i,r){return i.reduce(function(n,s){var a=Object.keys(s).filter(function(c){return!(c===un.INNER_HTML||c===un.CSS_TEXT)}).reduce(function(c,u){var h=typeof s[u]>"u"?u:u+'="'+JO(s[u],r)+'"';return c?c+" "+h:h},""),o=s.innerHTML||s.cssText||"",l=Ike.indexOf(t)===-1;return n+"<"+t+" "+Hc+'="true" '+a+(l?"/>":">"+o+"</"+t+">")},"")},hJ=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(r,n){return r[u2[n]||n]=t[n],r},i)},Qke=function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(t).reduce(function(r,n){return r[Rke[n]||n]=t[n],r},i)},Zke=function(t,i,r){var n,s=(n={key:i},n[Hc]=!0,n),a=hJ(r,s);return[Gc.createElement(Vi.TITLE,a,i)]},Kke=function(t,i){return i.map(function(r,n){var s,a=(s={key:n},s[Hc]=!0,s);return Object.keys(r).forEach(function(o){var l=u2[o]||o;if(l===un.INNER_HTML||l===un.CSS_TEXT){var c=r.innerHTML||r.cssText;a.dangerouslySetInnerHTML={__html:c}}else a[l]=r[o]}),Gc.createElement(t,a)})},td=function(t,i,r){switch(t){case Vi.TITLE:return{toComponent:function(){return Zke(t,i.title,i.titleAttributes)},toString:function(){return qke(t,i.title,i.titleAttributes,r)}};case Ng.BODY:case Ng.HTML:return{toComponent:function(){return hJ(i)},toString:function(){return uJ(i)}};default:return{toComponent:function(){return Kke(t,i)},toString:function(){return Yke(t,i,r)}}}},dJ=function(t){var i=t.baseTag,r=t.bodyAttributes,n=t.encode,s=t.htmlAttributes,a=t.linkTags,o=t.metaTags,l=t.noscriptTags,c=t.scriptTags,u=t.styleTags,h=t.title,d=h===void 0?"":h,f=t.titleAttributes;return{base:td(Vi.BASE,i,n),bodyAttributes:td(Ng.BODY,r,n),htmlAttributes:td(Ng.HTML,s,n),link:td(Vi.LINK,a,n),meta:td(Vi.META,o,n),noscript:td(Vi.NOSCRIPT,l,n),script:td(Vi.SCRIPT,c,n),style:td(Vi.STYLE,u,n),title:td(Vi.TITLE,{title:d,titleAttributes:f},n)}},Jke=function(t){var i,r;return r=i=function(n){Bke(s,n);function s(){return Oke(this,s),Nke(this,n.apply(this,arguments))}return s.prototype.shouldComponentUpdate=function(o){return!Tke(this.props,o)},s.prototype.mapNestedChildrenToProps=function(o,l){if(!l)return null;switch(o.type){case Vi.SCRIPT:case Vi.NOSCRIPT:return{innerHTML:l};case Vi.STYLE:return{cssText:l}}throw new Error("<"+o.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},s.prototype.flattenArrayTypeChildren=function(o){var l,c=o.child,u=o.arrayTypeChildren,h=o.newChildProps,d=o.nestedChildren;return Io({},u,(l={},l[c.type]=[].concat(u[c.type]||[],[Io({},h,this.mapNestedChildrenToProps(c,d))]),l))},s.prototype.mapObjectTypeChildren=function(o){var l,c,u=o.child,h=o.newProps,d=o.newChildProps,f=o.nestedChildren;switch(u.type){case Vi.TITLE:return Io({},h,(l={},l[u.type]=f,l.titleAttributes=Io({},d),l));case Vi.BODY:return Io({},h,{bodyAttributes:Io({},d)});case Vi.HTML:return Io({},h,{htmlAttributes:Io({},d)})}return Io({},h,(c={},c[u.type]=Io({},d),c))},s.prototype.mapArrayTypeChildrenToProps=function(o,l){var c=Io({},l);return Object.keys(o).forEach(function(u){var h;c=Io({},c,(h={},h[u]=o[u],h))}),c},s.prototype.warnOnInvalidChildren=function(o,l){return!0},s.prototype.mapChildrenToProps=function(o,l){var c=this,u={};return Gc.Children.forEach(o,function(h){if(!(!h||!h.props)){var d=h.props,f=d.children,m=kW(d,["children"]),v=Qke(m);switch(c.warnOnInvalidChildren(h,f),h.type){case Vi.LINK:case Vi.META:case Vi.NOSCRIPT:case Vi.SCRIPT:case Vi.STYLE:u=c.flattenArrayTypeChildren({child:h,arrayTypeChildren:u,newChildProps:v,nestedChildren:f});break;default:l=c.mapObjectTypeChildren({child:h,newProps:l,newChildProps:v,nestedChildren:f});break}}}),l=this.mapArrayTypeChildrenToProps(u,l),l},s.prototype.render=function(){var o=this.props,l=o.children,c=kW(o,["children"]),u=Io({},c);return l&&(u=this.mapChildrenToProps(l,u)),Gc.createElement(t,u)},zke(s,null,[{key:"canUseDOM",set:function(o){t.canUseDOM=o}}]),s}(Gc.Component),i.propTypes={base:cn.object,bodyAttributes:cn.object,children:cn.oneOfType([cn.arrayOf(cn.node),cn.node]),defaultTitle:cn.string,defer:cn.bool,encodeSpecialCharacters:cn.bool,htmlAttributes:cn.object,link:cn.arrayOf(cn.object),meta:cn.arrayOf(cn.object),noscript:cn.arrayOf(cn.object),onChangeClientState:cn.func,script:cn.arrayOf(cn.object),style:cn.arrayOf(cn.object),title:cn.string,titleAttributes:cn.object,titleTemplate:cn.string},i.defaultProps={defer:!0,encodeSpecialCharacters:!0},i.peek=t.peek,i.rewind=function(){var n=t.rewind();return n||(n=dJ({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),n},r},$ke=function(){return null},e4e=Mke(Vke,Wke,dJ)($ke),tz=Jke(e4e);tz.renderStatic=tz.rewind;const AC=e=>({hidden:{y:-50,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",duration:1.25,delay:e}}}),uU=(e,t,i,r)=>({hidden:{x:e==="left"?100:e==="right"?-100:0,y:e==="up"?100:e==="down"?-100:0,opacity:0},show:{x:0,y:0,opacity:1,transition:{type:t,delay:i,duration:r,ease:"easeOut"}}}),t4e=(e,t,i,r)=>({hidden:{x:e==="left"?"-100%":e==="right"?"100%":0,y:e==="up"||e==="down"?"100%":0},show:{x:0,y:0,transition:{type:t,delay:i,duration:r,ease:"easeOut"}}}),i4e=(e,t)=>({hidden:{},show:{transition:{staggerChildren:e,delayChildren:t||0}}}),kx=(e,t)=>function(){return Qe.jsxs(Ku.section,{variants:i4e(),initial:"hidden",whileInView:"show",viewport:{once:!0,amount:.25},className:`${Wo.padding} max-w-7xl mx-auto relative z-0`,id:t,children:[Qe.jsx("span",{className:"hash-span",children:" "}),Qe.jsx(e,{})]})},r4e=({index:e,title:t,icon:i})=>Qe.jsx(cU,{className:"xs:w-[250px] w-full",children:Qe.jsx(Ku.div,{variants:uU("right","spring",e*.5,.75),className:"w-full green-pink-gradient p-[1px] rounded-[20px] shadow-card",children:Qe.jsxs("div",{options:{max:45,scale:1,speed:450},className:"bg-tertiary rounded-[20px] py-5 px-12 min-h-[280px] flex justify-evenly items-center flex-col",children:[Qe.jsx("img",{src:i,alt:t,className:"w-16 h-16 object-contain"}),Qe.jsx("h3",{className:"text-white text-[20px] font-bold text-center",children:t})]})})}),n4e=()=>Qe.jsxs("section",{children:[Qe.jsxs(tz,{children:[Qe.jsx("title",{children:"About Me - Your Portfolio"}),Qe.jsx("meta",{name:"description",content:"Learn more about me, a skilled software developer with a passion for creating efficient, scalable, and user-friendly solutions."})]}),Qe.jsx("header",{children:Qe.jsxs(Ku.div,{variants:AC(),children:[Qe.jsx("p",{className:Wo.sectionSubText,children:"Introduction"}),Qe.jsx("h2",{className:Wo.sectionHeadText,children:"Overview."})]})}),Qe.jsx("article",{children:Qe.jsx(Ku.p,{variants:uU("","",.1,1),className:"mt-4 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"I'm a skilled software developer. I'm a quick learner and collaborate closely with clients to create efficient, scalable, and user-friendly solutions that solve real-world problems. Let's work together to bring your ideas to life!"})}),Qe.jsx("section",{className:"mt-20 flex flex-wrap gap-10",children:fke.map((e,t)=>Qe.jsx(r4e,{index:t,...e},e.title))})]}),s4e=kx(n4e,"about"),a4e=()=>Qe.jsx(Qe.Fragment,{children:Qe.jsx("div",{className:"flex flex-row flex-wrap justify-center gap-10",children:pke.map(e=>Qe.jsx("div",{className:"w-28 h-28",children:Qe.jsx(Kle,{icon:e.icon})},e.name))})}),o4e=kx(a4e,"tech");var Dw={},LR={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var GW;function fJ(){return GW||(GW=1,function(e){(function(){var t={}.hasOwnProperty;function i(){for(var r=[],n=0;n<arguments.length;n++){var s=arguments[n];if(s){var a=typeof s;if(a==="string"||a==="number")r.push(s);else if(Array.isArray(s)){if(s.length){var o=i.apply(null,s);o&&r.push(o)}}else if(a==="object"){if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]")){r.push(s.toString());continue}for(var l in s)t.call(s,l)&&s[l]&&r.push(l)}}}return r.join(" ")}e.exports?(i.default=i,e.exports=i):window.classNames=i})()}(LR)),LR.exports}var jW;function l4e(){if(jW)return Dw;jW=1,Dw.__esModule=!0,Dw.default=void 0;var e=r(Kg()),t=r(eB()),i=r(fJ());function r(a){return a&&a.__esModule?a:{default:a}}const n=({animate:a=!0,className:o="",layout:l="2-columns",lineColor:c="#FFF",children:u})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",c),e.default.createElement("div",{className:(0,i.default)(o,"vertical-timeline",{"vertical-timeline--animate":a,"vertical-timeline--two-columns":l==="2-columns","vertical-timeline--one-column-left":l==="1-column"||l==="1-column-left","vertical-timeline--one-column-right":l==="1-column-right"})},u));n.propTypes={children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]).isRequired,className:t.default.string,animate:t.default.bool,layout:t.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:t.default.string};var s=n;return Dw.default=s,Dw}var Rw={};function iz(){return iz=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},iz.apply(this,arguments)}function c4e(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,rz(e,t)}function rz(e,t){return rz=Object.setPrototypeOf||function(r,n){return r.__proto__=n,r},rz(e,t)}function u4e(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}var nz=new Map,pE=new WeakMap,WW=0,pJ=void 0;function h4e(e){pJ=e}function d4e(e){return e?(pE.has(e)||(WW+=1,pE.set(e,WW.toString())),pE.get(e)):"0"}function f4e(e){return Object.keys(e).sort().filter(function(t){return e[t]!==void 0}).map(function(t){return t+"_"+(t==="root"?d4e(e.root):e[t])}).toString()}function p4e(e){var t=f4e(e),i=nz.get(t);if(!i){var r=new Map,n,s=new IntersectionObserver(function(a){a.forEach(function(o){var l,c=o.isIntersecting&&n.some(function(u){return o.intersectionRatio>=u});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=c),(l=r.get(o.target))==null||l.forEach(function(u){u(c,o)})})},e);n=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:r},nz.set(t,i)}return i}function hU(e,t,i,r){if(i===void 0&&(i={}),r===void 0&&(r=pJ),typeof window.IntersectionObserver>"u"&&r!==void 0){var n=e.getBoundingClientRect();return t(r,{isIntersecting:r,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:n,intersectionRect:n,rootBounds:n}),function(){}}var s=p4e(i),a=s.id,o=s.observer,l=s.elements,c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(t),o.observe(e),function(){c.splice(c.indexOf(t),1),c.length===0&&(l.delete(e),o.unobserve(e)),l.size===0&&(o.disconnect(),nz.delete(a))}}var m4e=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function XW(e){return typeof e.children!="function"}var h2=function(e){c4e(t,e);function t(r){var n;return n=e.call(this,r)||this,n.node=null,n._unobserveCb=null,n.handleNode=function(s){n.node&&(n.unobserve(),!s&&!n.props.triggerOnce&&!n.props.skip&&n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=s||null,n.observeNode()},n.handleChange=function(s,a){s&&n.props.triggerOnce&&n.unobserve(),XW(n.props)||n.setState({inView:s,entry:a}),n.props.onChange&&n.props.onChange(s,a)},n.state={inView:!!r.initialInView,entry:void 0},n}var i=t.prototype;return i.componentDidUpdate=function(n){(n.rootMargin!==this.props.rootMargin||n.root!==this.props.root||n.threshold!==this.props.threshold||n.skip!==this.props.skip||n.trackVisibility!==this.props.trackVisibility||n.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(!(!this.node||this.props.skip)){var n=this.props,s=n.threshold,a=n.root,o=n.rootMargin,l=n.trackVisibility,c=n.delay,u=n.fallbackInView;this._unobserveCb=hU(this.node,this.handleChange,{threshold:s,root:a,rootMargin:o,trackVisibility:l,delay:c},u)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!XW(this.props)){var n=this.state,s=n.inView,a=n.entry;return this.props.children({inView:s,entry:a,ref:this.handleNode})}var o=this.props,l=o.children,c=o.as,u=u4e(o,m4e);return Se.createElement(c||"div",iz({ref:this.handleNode},u),l)},t}(Se.Component);h2.displayName="InView";h2.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function g4e(e){var t=e===void 0?{}:e,i=t.threshold,r=t.delay,n=t.trackVisibility,s=t.rootMargin,a=t.root,o=t.triggerOnce,l=t.skip,c=t.initialInView,u=t.fallbackInView,h=Se.useRef(),d=Se.useState({inView:!!c}),f=d[0],m=d[1],v=Se.useCallback(function(x){h.current!==void 0&&(h.current(),h.current=void 0),!l&&x&&(h.current=hU(x,function(S,_){m({inView:S,entry:_}),_.isIntersecting&&o&&h.current&&(h.current(),h.current=void 0)},{root:a,rootMargin:s,threshold:i,trackVisibility:n,delay:r},u))},[Array.isArray(i)?i.toString():i,a,s,o,l,n,u,r]);Se.useEffect(function(){!h.current&&f.entry&&!o&&!l&&m({inView:!!c})});var g=[v,f.inView,f.entry];return g.ref=g[0],g.inView=g[1],g.entry=g[2],g}const v4e=Object.freeze(Object.defineProperty({__proto__:null,InView:h2,default:h2,defaultFallbackInView:h4e,observe:hU,useInView:g4e},Symbol.toStringTag,{value:"Module"})),y4e=HJ(v4e);var qW;function x4e(){if(qW)return Rw;qW=1,Rw.__esModule=!0,Rw.default=void 0;var e=n(Kg()),t=n(eB()),i=n(fJ()),r=y4e;function n(o){return o&&o.__esModule?o:{default:o}}const s=({children:o="",className:l="",contentArrowStyle:c=null,contentStyle:u=null,date:h="",dateClassName:d="",icon:f=null,iconClassName:m="",iconOnClick:v=null,onTimelineElementClick:g=null,iconStyle:x=null,id:S="",position:_="",style:A=null,textClassName:T="",intersectionObserverProps:E={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:I=!1})=>e.default.createElement(r.InView,E,({inView:P,ref:C})=>e.default.createElement("div",{ref:C,id:S,className:(0,i.default)(l,"vertical-timeline-element",{"vertical-timeline-element--left":_==="left","vertical-timeline-element--right":_==="right","vertical-timeline-element--no-children":o===""}),style:A},e.default.createElement(e.default.Fragment,null,e.default.createElement("span",{style:x,onClick:v,className:(0,i.default)(m,"vertical-timeline-element-icon",{"bounce-in":P||I,"is-hidden":!(P||I)})},f),e.default.createElement("div",{style:u,onClick:g,className:(0,i.default)(T,"vertical-timeline-element-content",{"bounce-in":P||I,"is-hidden":!(P||I)})},e.default.createElement("div",{style:c,className:"vertical-timeline-element-content-arrow"}),o,e.default.createElement("span",{className:(0,i.default)(d,"vertical-timeline-element-date")},h)))));s.propTypes={children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]),className:t.default.string,contentArrowStyle:t.default.shape({}),contentStyle:t.default.shape({}),date:t.default.node,dateClassName:t.default.string,icon:t.default.element,iconClassName:t.default.string,iconStyle:t.default.shape({}),iconOnClick:t.default.func,onTimelineElementClick:t.default.func,id:t.default.string,position:t.default.string,style:t.default.shape({}),textClassName:t.default.string,visible:t.default.bool,intersectionObserverProps:t.default.shape({root:t.default.object,rootMargin:t.default.string,threshold:t.default.number,triggerOnce:t.default.bool})};var a=s;return Rw.default=a,Rw}var OR,YW;function w4e(){return YW||(YW=1,OR={VerticalTimeline:l4e().default,VerticalTimelineElement:x4e().default}),OR}var EC=w4e();const b4e=({experience:e})=>Qe.jsxs(EC.VerticalTimelineElement,{contentStyle:{background:"#1d1836",color:"#fff"},contentArrowStyle:{borderRight:"7px solid  #232631"},date:e.date,iconStyle:{background:e.iconBg},icon:Qe.jsx("div",{className:"flex justify-center items-center w-full h-full",children:Qe.jsx("img",{src:e.icon,alt:e.company_name,className:"w-[60%] h-[60%] object-contain"})}),children:[Qe.jsxs("div",{children:[Qe.jsx("h3",{className:"text-white text-[24px] font-bold",children:e.title}),Qe.jsx("p",{className:"text-secondary text-[16px] font-semibold",style:{margin:0},children:e.company_name})]}),Qe.jsx("ul",{className:"mt-5 list-disc ml-5 space-y-2",children:e.points.map((t,i)=>Qe.jsx("li",{className:"text-white-100 text-[14px] pl-1 tracking-wider",children:t},`experience-point-${i}`))})]}),_4e=()=>Qe.jsxs(Qe.Fragment,{children:[Qe.jsxs(Ku.div,{variants:AC(),children:[Qe.jsx("p",{className:Wo.sectionSubText,children:"What I have done so far"}),Qe.jsx("h2",{className:Wo.sectionHeadText,children:"Work Experience."})]}),Qe.jsx("div",{className:"mt-20 flex flex-col",children:Qe.jsx(EC.VerticalTimeline,{children:mke.map((e,t)=>Qe.jsx(b4e,{experience:e},t))})})]}),S4e=kx(_4e,"work"),M4e=({index:e,name:t,description:i,tags:r,image:n,source_code_link:s})=>Qe.jsx(Ku.div,{variants:uU("up","spring",e*.5,.75),children:Qe.jsxs(cU,{options:{max:45,scale:1,speed:450},className:"bg-tertiary p-5 rounded-2xl sm:w-[300px] w-full",children:[Qe.jsxs("div",{className:"relative w-full h-[230px]",children:[Qe.jsx("img",{src:n,alt:t,className:"w-full h-full object-cover rounded-2xl"}),Qe.jsx("div",{className:"absolute inset-0 flex justify-end m-3 card-img_hover",children:Qe.jsx("div",{onClick:()=>window.open(s,"_blank"),className:"black-gradient w-10 h-10 rounded-full flex justify-center items-center cursor-pointer",children:Qe.jsx("img",{src:oJ,alt:"Website",className:"w-1/2 h-1/2 object-contain"})})})]}),Qe.jsxs("div",{className:"mt-5",children:[Qe.jsx("h3",{className:"text-white font-bold text-[24px]",children:t}),Qe.jsx("p",{className:"mt-2 text-secondary text-[14px]",children:i})]}),Qe.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:r.map(a=>Qe.jsxs("p",{className:`text-[14px] ${a.color}`,children:["#",a.name]},a.name))})]})}),A4e=()=>Qe.jsxs(Qe.Fragment,{children:[Qe.jsxs(Ku.div,{variants:AC(),children:[Qe.jsx("p",{className:Wo.sectionSubText,children:"My Work"}),Qe.jsx("h2",{className:Wo.sectionHeadText,children:"Projects."})]}),Qe.jsx("div",{className:"mt-20 flex flex-wrap gap-7",children:vke.map((e,t)=>Qe.jsx(M4e,{index:t,...e},`project-${t}`))})]}),E4e=kx(A4e,"works"),T4e=({experience:e})=>Qe.jsxs(EC.VerticalTimelineElement,{contentStyle:{background:"#1d1836",color:"#fff"},contentArrowStyle:{borderRight:"7px solid  #232631"},date:e.date,iconStyle:{background:e.iconBg},icon:Qe.jsx("div",{className:"flex justify-center items-center w-full h-full",children:Qe.jsx("img",{src:e.icon,alt:e.company_name,className:"w-[60%] h-[60%] object-contain"})}),children:[Qe.jsxs("div",{children:[Qe.jsx("h3",{className:"text-white text-[24px] font-bold",children:e.title}),Qe.jsx("p",{className:"text-secondary text-[16px] font-semibold",style:{margin:0},children:e.company_name})]}),Qe.jsx("ul",{className:"mt-5 list-disc ml-5 space-y-2",children:e.points.map((t,i)=>Qe.jsx("li",{className:"text-white-100 text-[14px] pl-1 tracking-wider",children:t},`experience-point-${i}`))})]}),C4e=()=>Qe.jsxs(Qe.Fragment,{children:[Qe.jsxs(Ku.div,{variants:AC(),children:[Qe.jsx("p",{className:Wo.sectionSubText,children:"What I Studied so far"}),Qe.jsx("h2",{className:Wo.sectionHeadText,children:"Education Experience."})]}),Qe.jsx("div",{className:"mt-20 flex flex-col",children:Qe.jsx(EC.VerticalTimeline,{children:gke.map((e,t)=>Qe.jsx(T4e,{experience:e},t))})})]}),P4e=kx(C4e,"work"),v_={_origin:"https://api.emailjs.com"},D4e=(e,t="https://api.emailjs.com")=>{v_._userID=e,v_._origin=t},mJ=(e,t,i)=>{if(!e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!i)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class QW{constructor(t){this.status=t?t.status:0,this.text=t?t.responseText:"Network Error"}}const gJ=(e,t,i={})=>new Promise((r,n)=>{const s=new XMLHttpRequest;s.addEventListener("load",({target:a})=>{const o=new QW(a);o.status===200||o.text==="OK"?r(o):n(o)}),s.addEventListener("error",({target:a})=>{n(new QW(a))}),s.open("POST",v_._origin+e,!0),Object.keys(i).forEach(a=>{s.setRequestHeader(a,i[a])}),s.send(t)}),R4e=(e,t,i,r)=>{const n=r||v_._userID;return mJ(n,e,t),gJ("/api/v1.0/email/send",JSON.stringify({lib_version:"3.11.0",user_id:n,service_id:e,template_id:t,template_params:i}),{"Content-type":"application/json"})},I4e=e=>{let t;if(typeof e=="string"?t=document.querySelector(e):t=e,!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return t},L4e=(e,t,i,r)=>{const n=r||v_._userID,s=I4e(i);mJ(n,e,t);const a=new FormData(s);return a.append("lib_version","3.11.0"),a.append("service_id",e),a.append("template_id",t),a.append("user_id",n),gJ("/api/v1.0/email/send-form",a)},O4e={init:D4e,send:R4e,sendForm:L4e},z4e=()=>{const e=Se.useRef(),t=Se.useRef(null),[i,r]=Se.useState({name:"",email:"",message:""}),[n,s]=Se.useState(!1),a=l=>{const{name:c,value:u}=l.target;r({...i,[c]:u})},o=l=>{l.preventDefault(),s(!0),O4e.send("service_78g5zzl","template_xy55uw1",{form_name:i.name,to_name:"Nujan",from_email:i.email,to_email:"nujan.shrestha.1@gmail.com",message:i.message},"f1zyZCJwrqz5CaM5H").then(()=>{s(!1),alert("Thank you. I will get back to you as soon as possible."),r({name:"",email:"",message:""})},c=>{s(!1),console.log(c),alert("Something went wrong.")})};return Qe.jsxs("section",{className:"w-full h-screen flex flex-col xl:flex-row items-center overflow-hidden",children:[Qe.jsxs(Ku.div,{variants:t4e("left","tween",.2,1),className:"flex-[0.75] bg-black-100 p-8 rounded-2xl pointer-events-auto",children:[Qe.jsx("p",{className:Wo.sectionSubText,children:"Get in touch"}),Qe.jsx("h3",{className:Wo.sectionHeadText,children:"Contact."}),Qe.jsxs("form",{ref:e,onSubmit:o,className:"mt-12 flex flex-col gap-8",children:[Qe.jsxs("label",{className:"flex flex-col",children:[Qe.jsx("span",{className:"text-white font-medium mb-4",children:"Your Name"}),Qe.jsx("input",{type:"text",name:"name",value:i.name,onChange:a,placeholder:"What's your name?",className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),Qe.jsxs("label",{className:"flex flex-col",children:[Qe.jsx("span",{className:"text-white font-medium mb-4",children:"Your email"}),Qe.jsx("input",{type:"email",name:"email",value:i.email,onChange:a,placeholder:"What's your email?",className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),Qe.jsxs("label",{className:"flex flex-col",children:[Qe.jsx("span",{className:"text-white font-medium mb-4",children:"Your Message"}),Qe.jsx("textarea",{rows:7,name:"message",value:i.message,onChange:a,placeholder:"What do you want to say?",className:"bg-tertiary py-4 px-6 placeholder:text-secondary text-white rounded-lg outline-none border-none font-medium"})]}),Qe.jsx("button",{type:"submit",className:"bg-tertiary py-3 px-8 rounded-xl outline-none w-fit text-white font-bold shadow-md shadow-primary",children:n?"Sending...":"Send"})]})]}),Qe.jsx("div",{className:"flex-1 w-full h-[50vh] overflow-hidden relative",children:Qe.jsx("div",{className:"w-full h-full pointer-events-auto",children:Qe.jsx(aJ,{scene:"https://prod.spline.design/qB2C61jAeDsMapPD/scene.splinecode",onLoad:l=>{t.current=l,console.log("Spline scene loaded:",l)},className:"w-full h-full pointer-events-auto"})})})]})},B4e=kx(z4e,"contact"),N4e=()=>Qe.jsx(w$,{children:Qe.jsxs("div",{className:"relative z-0 bg-primary",children:[Qe.jsxs("div",{className:"bg-hero-pattern bg-cover bg-no-repeat bg-center",children:[Qe.jsx(yke,{}),Qe.jsx(HFe,{})]}),Qe.jsx(s4e,{}),Qe.jsx(P4e,{}),Qe.jsx(S4e,{}),Qe.jsx(o4e,{}),Qe.jsx(E4e,{}),Qe.jsxs("div",{className:"relative z-0",children:[Qe.jsx(B4e,{}),Qe.jsx(ace,{})]})]})});JJ.createRoot(document.getElementById("root")).render(Qe.jsx(Gc.StrictMode,{children:Qe.jsx(N4e,{})}));export{WS as c,Cp as g};
